(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var qg={exports:{}},ar={},zg={exports:{}},it={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yo=Symbol.for("react.element"),tS=Symbol.for("react.portal"),nS=Symbol.for("react.fragment"),rS=Symbol.for("react.strict_mode"),iS=Symbol.for("react.profiler"),sS=Symbol.for("react.provider"),aS=Symbol.for("react.context"),oS=Symbol.for("react.forward_ref"),cS=Symbol.for("react.suspense"),lS=Symbol.for("react.memo"),uS=Symbol.for("react.lazy"),qf=Symbol.iterator;function dS(e){return e===null||typeof e!="object"?null:(e=qf&&e[qf]||e["@@iterator"],typeof e=="function"?e:null)}var Kg={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$g=Object.assign,Wg={};function Pa(e,t,n){this.props=e,this.context=t,this.refs=Wg,this.updater=n||Kg}Pa.prototype.isReactComponent={};Pa.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Pa.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Gg(){}Gg.prototype=Pa.prototype;function op(e,t,n){this.props=e,this.context=t,this.refs=Wg,this.updater=n||Kg}var cp=op.prototype=new Gg;cp.constructor=op;$g(cp,Pa.prototype);cp.isPureReactComponent=!0;var zf=Array.isArray,Zg=Object.prototype.hasOwnProperty,lp={current:null},Jg={key:!0,ref:!0,__self:!0,__source:!0};function Qg(e,t,n){var r,i={},a=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(a=""+t.key),t)Zg.call(t,r)&&!Jg.hasOwnProperty(r)&&(i[r]=t[r]);var u=arguments.length-2;if(u===1)i.children=n;else if(1<u){for(var p=Array(u),h=0;h<u;h++)p[h]=arguments[h+2];i.children=p}if(e&&e.defaultProps)for(r in u=e.defaultProps,u)i[r]===void 0&&(i[r]=u[r]);return{$$typeof:Yo,type:e,key:a,ref:o,props:i,_owner:lp.current}}function hS(e,t){return{$$typeof:Yo,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function up(e){return typeof e=="object"&&e!==null&&e.$$typeof===Yo}function pS(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Kf=/\/+/g;function sd(e,t){return typeof e=="object"&&e!==null&&e.key!=null?pS(""+e.key):t.toString(36)}function Gc(e,t,n,r,i){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Yo:case tS:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+sd(o,0):r,zf(i)?(n="",e!=null&&(n=e.replace(Kf,"$&/")+"/"),Gc(i,t,n,"",function(h){return h})):i!=null&&(up(i)&&(i=hS(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Kf,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",zf(e))for(var u=0;u<e.length;u++){a=e[u];var p=r+sd(a,u);o+=Gc(a,t,n,p,i)}else if(p=dS(e),typeof p=="function")for(e=p.call(e),u=0;!(a=e.next()).done;)a=a.value,p=r+sd(a,u++),o+=Gc(a,t,n,p,i);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Ec(e,t,n){if(e==null)return e;var r=[],i=0;return Gc(e,r,"","",function(a){return t.call(n,a,i++)}),r}function fS(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var On={current:null},Zc={transition:null},mS={ReactCurrentDispatcher:On,ReactCurrentBatchConfig:Zc,ReactCurrentOwner:lp};function Xg(){throw Error("act(...) is not supported in production builds of React.")}it.Children={map:Ec,forEach:function(e,t,n){Ec(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Ec(e,function(){t++}),t},toArray:function(e){return Ec(e,function(t){return t})||[]},only:function(e){if(!up(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};it.Component=Pa;it.Fragment=nS;it.Profiler=iS;it.PureComponent=op;it.StrictMode=rS;it.Suspense=cS;it.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mS;it.act=Xg;it.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=$g({},e.props),i=e.key,a=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,o=lp.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(p in t)Zg.call(t,p)&&!Jg.hasOwnProperty(p)&&(r[p]=t[p]===void 0&&u!==void 0?u[p]:t[p])}var p=arguments.length-2;if(p===1)r.children=n;else if(1<p){u=Array(p);for(var h=0;h<p;h++)u[h]=arguments[h+2];r.children=u}return{$$typeof:Yo,type:e.type,key:i,ref:a,props:r,_owner:o}};it.createContext=function(e){return e={$$typeof:aS,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:sS,_context:e},e.Consumer=e};it.createElement=Qg;it.createFactory=function(e){var t=Qg.bind(null,e);return t.type=e,t};it.createRef=function(){return{current:null}};it.forwardRef=function(e){return{$$typeof:oS,render:e}};it.isValidElement=up;it.lazy=function(e){return{$$typeof:uS,_payload:{_status:-1,_result:e},_init:fS}};it.memo=function(e,t){return{$$typeof:lS,type:e,compare:t===void 0?null:t}};it.startTransition=function(e){var t=Zc.transition;Zc.transition={};try{e()}finally{Zc.transition=t}};it.unstable_act=Xg;it.useCallback=function(e,t){return On.current.useCallback(e,t)};it.useContext=function(e){return On.current.useContext(e)};it.useDebugValue=function(){};it.useDeferredValue=function(e){return On.current.useDeferredValue(e)};it.useEffect=function(e,t){return On.current.useEffect(e,t)};it.useId=function(){return On.current.useId()};it.useImperativeHandle=function(e,t,n){return On.current.useImperativeHandle(e,t,n)};it.useInsertionEffect=function(e,t){return On.current.useInsertionEffect(e,t)};it.useLayoutEffect=function(e,t){return On.current.useLayoutEffect(e,t)};it.useMemo=function(e,t){return On.current.useMemo(e,t)};it.useReducer=function(e,t,n){return On.current.useReducer(e,t,n)};it.useRef=function(e){return On.current.useRef(e)};it.useState=function(e){return On.current.useState(e)};it.useSyncExternalStore=function(e,t,n){return On.current.useSyncExternalStore(e,t,n)};it.useTransition=function(){return On.current.useTransition()};it.version="18.3.1";zg.exports=it;var bs=zg.exports,Yg={exports:{}},ev={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(ge,ye){var Ee=ge.length;ge.push(ye);e:for(;0<Ee;){var Ne=Ee-1>>>1,Ye=ge[Ne];if(0<i(Ye,ye))ge[Ne]=ye,ge[Ee]=Ye,Ee=Ne;else break e}}function n(ge){return ge.length===0?null:ge[0]}function r(ge){if(ge.length===0)return null;var ye=ge[0],Ee=ge.pop();if(Ee!==ye){ge[0]=Ee;e:for(var Ne=0,Ye=ge.length,zt=Ye>>>1;Ne<zt;){var jt=2*(Ne+1)-1,en=ge[jt],Tt=jt+1,et=ge[Tt];if(0>i(en,Ee))Tt<Ye&&0>i(et,en)?(ge[Ne]=et,ge[Tt]=Ee,Ne=Tt):(ge[Ne]=en,ge[jt]=Ee,Ne=jt);else if(Tt<Ye&&0>i(et,Ee))ge[Ne]=et,ge[Tt]=Ee,Ne=Tt;else break e}}return ye}function i(ge,ye){var Ee=ge.sortIndex-ye.sortIndex;return Ee!==0?Ee:ge.id-ye.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var o=Date,u=o.now();e.unstable_now=function(){return o.now()-u}}var p=[],h=[],y=1,f=null,_=3,w=!1,R=!1,F=!1,S=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(ge){for(var ye=n(h);ye!==null;){if(ye.callback===null)r(h);else if(ye.startTime<=ge)r(h),ye.sortIndex=ye.expirationTime,t(p,ye);else break;ye=n(h)}}function L(ge){if(F=!1,k(ge),!R)if(n(p)!==null)R=!0,Pe(G);else{var ye=n(h);ye!==null&&xe(L,ye.startTime-ge)}}function G(ge,ye){R=!1,F&&(F=!1,b(U),U=-1),w=!0;var Ee=_;try{for(k(ye),f=n(p);f!==null&&(!(f.expirationTime>ye)||ge&&!ne());){var Ne=f.callback;if(typeof Ne=="function"){f.callback=null,_=f.priorityLevel;var Ye=Ne(f.expirationTime<=ye);ye=e.unstable_now(),typeof Ye=="function"?f.callback=Ye:f===n(p)&&r(p),k(ye)}else r(p);f=n(p)}if(f!==null)var zt=!0;else{var jt=n(h);jt!==null&&xe(L,jt.startTime-ye),zt=!1}return zt}finally{f=null,_=Ee,w=!1}}var K=!1,z=null,U=-1,J=5,Q=-1;function ne(){return!(e.unstable_now()-Q<J)}function oe(){if(z!==null){var ge=e.unstable_now();Q=ge;var ye=!0;try{ye=z(!0,ge)}finally{ye?he():(K=!1,z=null)}}else K=!1}var he;if(typeof x=="function")he=function(){x(oe)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,_e=X.port2;X.port1.onmessage=oe,he=function(){_e.postMessage(null)}}else he=function(){S(oe,0)};function Pe(ge){z=ge,K||(K=!0,he())}function xe(ge,ye){U=S(function(){ge(e.unstable_now())},ye)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ge){ge.callback=null},e.unstable_continueExecution=function(){R||w||(R=!0,Pe(G))},e.unstable_forceFrameRate=function(ge){0>ge||125<ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<ge?Math.floor(1e3/ge):5},e.unstable_getCurrentPriorityLevel=function(){return _},e.unstable_getFirstCallbackNode=function(){return n(p)},e.unstable_next=function(ge){switch(_){case 1:case 2:case 3:var ye=3;break;default:ye=_}var Ee=_;_=ye;try{return ge()}finally{_=Ee}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ge,ye){switch(ge){case 1:case 2:case 3:case 4:case 5:break;default:ge=3}var Ee=_;_=ge;try{return ye()}finally{_=Ee}},e.unstable_scheduleCallback=function(ge,ye,Ee){var Ne=e.unstable_now();switch(typeof Ee=="object"&&Ee!==null?(Ee=Ee.delay,Ee=typeof Ee=="number"&&0<Ee?Ne+Ee:Ne):Ee=Ne,ge){case 1:var Ye=-1;break;case 2:Ye=250;break;case 5:Ye=1073741823;break;case 4:Ye=1e4;break;default:Ye=5e3}return Ye=Ee+Ye,ge={id:y++,callback:ye,priorityLevel:ge,startTime:Ee,expirationTime:Ye,sortIndex:-1},Ee>Ne?(ge.sortIndex=Ee,t(h,ge),n(p)===null&&ge===n(h)&&(F?(b(U),U=-1):F=!0,xe(L,Ee-Ne))):(ge.sortIndex=Ye,t(p,ge),R||w||(R=!0,Pe(G))),ge},e.unstable_shouldYield=ne,e.unstable_wrapCallback=function(ge){var ye=_;return function(){var Ee=_;_=ye;try{return ge.apply(this,arguments)}finally{_=Ee}}}})(ev);Yg.exports=ev;var gS=Yg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vS=bs,sr=gS;function Re(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var tv=new Set,_o={};function Ds(e,t){ha(e,t),ha(e+"Capture",t)}function ha(e,t){for(_o[e]=t,e=0;e<t.length;e++)tv.add(t[e])}var mi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Wd=Object.prototype.hasOwnProperty,yS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,$f={},Wf={};function _S(e){return Wd.call(Wf,e)?!0:Wd.call($f,e)?!1:yS.test(e)?Wf[e]=!0:($f[e]=!0,!1)}function bS(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function SS(e,t,n,r){if(t===null||typeof t>"u"||bS(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Mn(e,t,n,r,i,a,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var pn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){pn[e]=new Mn(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];pn[t]=new Mn(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){pn[e]=new Mn(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){pn[e]=new Mn(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){pn[e]=new Mn(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){pn[e]=new Mn(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){pn[e]=new Mn(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){pn[e]=new Mn(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){pn[e]=new Mn(e,5,!1,e.toLowerCase(),null,!1,!1)});var dp=/[\-:]([a-z])/g;function hp(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(dp,hp);pn[t]=new Mn(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(dp,hp);pn[t]=new Mn(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(dp,hp);pn[t]=new Mn(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){pn[e]=new Mn(e,1,!1,e.toLowerCase(),null,!1,!1)});pn.xlinkHref=new Mn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){pn[e]=new Mn(e,1,!1,e.toLowerCase(),null,!0,!0)});function pp(e,t,n,r){var i=pn.hasOwnProperty(t)?pn[t]:null;(i!==null?i.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(SS(t,n,i,r)&&(n=null),r||i===null?_S(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:"":n:(t=i.attributeName,r=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Si=vS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Pc=Symbol.for("react.element"),Ks=Symbol.for("react.portal"),$s=Symbol.for("react.fragment"),fp=Symbol.for("react.strict_mode"),Gd=Symbol.for("react.profiler"),nv=Symbol.for("react.provider"),rv=Symbol.for("react.context"),mp=Symbol.for("react.forward_ref"),Zd=Symbol.for("react.suspense"),Jd=Symbol.for("react.suspense_list"),gp=Symbol.for("react.memo"),Di=Symbol.for("react.lazy"),iv=Symbol.for("react.offscreen"),Gf=Symbol.iterator;function Va(e){return e===null||typeof e!="object"?null:(e=Gf&&e[Gf]||e["@@iterator"],typeof e=="function"?e:null)}var Lt=Object.assign,ad;function ro(e){if(ad===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);ad=t&&t[1]||""}return`
`+ad+e}var od=!1;function cd(e,t){if(!e||od)return"";od=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(h){var r=h}Reflect.construct(e,[],t)}else{try{t.call()}catch(h){r=h}e.call(t.prototype)}else{try{throw Error()}catch(h){r=h}e()}}catch(h){if(h&&r&&typeof h.stack=="string"){for(var i=h.stack.split(`
`),a=r.stack.split(`
`),o=i.length-1,u=a.length-1;1<=o&&0<=u&&i[o]!==a[u];)u--;for(;1<=o&&0<=u;o--,u--)if(i[o]!==a[u]){if(o!==1||u!==1)do if(o--,u--,0>u||i[o]!==a[u]){var p=`
`+i[o].replace(" at new "," at ");return e.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",e.displayName)),p}while(1<=o&&0<=u);break}}}finally{od=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?ro(e):""}function wS(e){switch(e.tag){case 5:return ro(e.type);case 16:return ro("Lazy");case 13:return ro("Suspense");case 19:return ro("SuspenseList");case 0:case 2:case 15:return e=cd(e.type,!1),e;case 11:return e=cd(e.type.render,!1),e;case 1:return e=cd(e.type,!0),e;default:return""}}function Qd(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case $s:return"Fragment";case Ks:return"Portal";case Gd:return"Profiler";case fp:return"StrictMode";case Zd:return"Suspense";case Jd:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case rv:return(e.displayName||"Context")+".Consumer";case nv:return(e._context.displayName||"Context")+".Provider";case mp:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case gp:return t=e.displayName||null,t!==null?t:Qd(e.type)||"Memo";case Di:t=e._payload,e=e._init;try{return Qd(e(t))}catch{}}return null}function xS(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qd(t);case 8:return t===fp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Zi(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function sv(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function CS(e){var t=sv(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function kc(e){e._valueTracker||(e._valueTracker=CS(e))}function av(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=sv(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function bl(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Xd(e,t){var n=t.checked;return Lt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Zf(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Zi(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function ov(e,t){t=t.checked,t!=null&&pp(e,"checked",t,!1)}function Yd(e,t){ov(e,t);var n=Zi(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?eh(e,t.type,n):t.hasOwnProperty("defaultValue")&&eh(e,t.type,Zi(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Jf(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function eh(e,t,n){(t!=="number"||bl(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var io=Array.isArray;function ia(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Zi(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function th(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Re(91));return Lt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Qf(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Re(92));if(io(n)){if(1<n.length)throw Error(Re(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Zi(n)}}function cv(e,t){var n=Zi(t.value),r=Zi(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Xf(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function lv(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function nh(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?lv(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Tc,uv=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Tc=Tc||document.createElement("div"),Tc.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Tc.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function bo(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var co={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ES=["Webkit","ms","Moz","O"];Object.keys(co).forEach(function(e){ES.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),co[t]=co[e]})});function dv(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||co.hasOwnProperty(e)&&co[e]?(""+t).trim():t+"px"}function hv(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=dv(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}var PS=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rh(e,t){if(t){if(PS[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Re(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Re(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Re(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Re(62))}}function ih(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sh=null;function vp(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ah=null,sa=null,aa=null;function Yf(e){if(e=nc(e)){if(typeof ah!="function")throw Error(Re(280));var t=e.stateNode;t&&(t=ou(t),ah(e.stateNode,e.type,t))}}function pv(e){sa?aa?aa.push(e):aa=[e]:sa=e}function fv(){if(sa){var e=sa,t=aa;if(aa=sa=null,Yf(e),t)for(e=0;e<t.length;e++)Yf(t[e])}}function mv(e,t){return e(t)}function gv(){}var ld=!1;function vv(e,t,n){if(ld)return e(t,n);ld=!0;try{return mv(e,t,n)}finally{ld=!1,(sa!==null||aa!==null)&&(gv(),fv())}}function So(e,t){var n=e.stateNode;if(n===null)return null;var r=ou(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Re(231,t,typeof n));return n}var oh=!1;if(mi)try{var qa={};Object.defineProperty(qa,"passive",{get:function(){oh=!0}}),window.addEventListener("test",qa,qa),window.removeEventListener("test",qa,qa)}catch{oh=!1}function kS(e,t,n,r,i,a,o,u,p){var h=Array.prototype.slice.call(arguments,3);try{t.apply(n,h)}catch(y){this.onError(y)}}var lo=!1,Sl=null,wl=!1,ch=null,TS={onError:function(e){lo=!0,Sl=e}};function RS(e,t,n,r,i,a,o,u,p){lo=!1,Sl=null,kS.apply(TS,arguments)}function AS(e,t,n,r,i,a,o,u,p){if(RS.apply(this,arguments),lo){if(lo){var h=Sl;lo=!1,Sl=null}else throw Error(Re(198));wl||(wl=!0,ch=h)}}function Ns(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function yv(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function em(e){if(Ns(e)!==e)throw Error(Re(188))}function IS(e){var t=e.alternate;if(!t){if(t=Ns(e),t===null)throw Error(Re(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(i===null)break;var a=i.alternate;if(a===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return em(i),e;if(a===r)return em(i),t;a=a.sibling}throw Error(Re(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,u=i.child;u;){if(u===n){o=!0,n=i,r=a;break}if(u===r){o=!0,r=i,n=a;break}u=u.sibling}if(!o){for(u=a.child;u;){if(u===n){o=!0,n=a,r=i;break}if(u===r){o=!0,r=a,n=i;break}u=u.sibling}if(!o)throw Error(Re(189))}}if(n.alternate!==r)throw Error(Re(190))}if(n.tag!==3)throw Error(Re(188));return n.stateNode.current===n?e:t}function _v(e){return e=IS(e),e!==null?bv(e):null}function bv(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=bv(e);if(t!==null)return t;e=e.sibling}return null}var Sv=sr.unstable_scheduleCallback,tm=sr.unstable_cancelCallback,FS=sr.unstable_shouldYield,DS=sr.unstable_requestPaint,qt=sr.unstable_now,NS=sr.unstable_getCurrentPriorityLevel,yp=sr.unstable_ImmediatePriority,wv=sr.unstable_UserBlockingPriority,xl=sr.unstable_NormalPriority,OS=sr.unstable_LowPriority,xv=sr.unstable_IdlePriority,ru=null,ni=null;function MS(e){if(ni&&typeof ni.onCommitFiberRoot=="function")try{ni.onCommitFiberRoot(ru,e,void 0,(e.current.flags&128)===128)}catch{}}var Lr=Math.clz32?Math.clz32:BS,LS=Math.log,jS=Math.LN2;function BS(e){return e>>>=0,e===0?32:31-(LS(e)/jS|0)|0}var Rc=64,Ac=4194304;function so(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Cl(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,i=e.suspendedLanes,a=e.pingedLanes,o=n&268435455;if(o!==0){var u=o&~i;u!==0?r=so(u):(a&=o,a!==0&&(r=so(a)))}else o=n&~i,o!==0?r=so(o):a!==0&&(r=so(a));if(r===0)return 0;if(t!==0&&t!==r&&!(t&i)&&(i=r&-r,a=t&-t,i>=a||i===16&&(a&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Lr(t),i=1<<n,r|=e[n],t&=~i;return r}function US(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function HS(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-Lr(a),u=1<<o,p=i[o];p===-1?(!(u&n)||u&r)&&(i[o]=US(u,t)):p<=t&&(e.expiredLanes|=u),a&=~u}}function lh(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Cv(){var e=Rc;return Rc<<=1,!(Rc&4194240)&&(Rc=64),e}function ud(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ec(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Lr(t),e[t]=n}function VS(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-Lr(n),a=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~a}}function _p(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Lr(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var vt=0;function Ev(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Pv,bp,kv,Tv,Rv,uh=!1,Ic=[],Hi=null,Vi=null,qi=null,wo=new Map,xo=new Map,Oi=[],qS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nm(e,t){switch(e){case"focusin":case"focusout":Hi=null;break;case"dragenter":case"dragleave":Vi=null;break;case"mouseover":case"mouseout":qi=null;break;case"pointerover":case"pointerout":wo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":xo.delete(t.pointerId)}}function za(e,t,n,r,i,a){return e===null||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[i]},t!==null&&(t=nc(t),t!==null&&bp(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function zS(e,t,n,r,i){switch(t){case"focusin":return Hi=za(Hi,e,t,n,r,i),!0;case"dragenter":return Vi=za(Vi,e,t,n,r,i),!0;case"mouseover":return qi=za(qi,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return wo.set(a,za(wo.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,xo.set(a,za(xo.get(a)||null,e,t,n,r,i)),!0}return!1}function Av(e){var t=ms(e.target);if(t!==null){var n=Ns(t);if(n!==null){if(t=n.tag,t===13){if(t=yv(n),t!==null){e.blockedOn=t,Rv(e.priority,function(){kv(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Jc(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=dh(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);sh=r,n.target.dispatchEvent(r),sh=null}else return t=nc(n),t!==null&&bp(t),e.blockedOn=n,!1;t.shift()}return!0}function rm(e,t,n){Jc(e)&&n.delete(t)}function KS(){uh=!1,Hi!==null&&Jc(Hi)&&(Hi=null),Vi!==null&&Jc(Vi)&&(Vi=null),qi!==null&&Jc(qi)&&(qi=null),wo.forEach(rm),xo.forEach(rm)}function Ka(e,t){e.blockedOn===t&&(e.blockedOn=null,uh||(uh=!0,sr.unstable_scheduleCallback(sr.unstable_NormalPriority,KS)))}function Co(e){function t(i){return Ka(i,e)}if(0<Ic.length){Ka(Ic[0],e);for(var n=1;n<Ic.length;n++){var r=Ic[n];r.blockedOn===e&&(r.blockedOn=null)}}for(Hi!==null&&Ka(Hi,e),Vi!==null&&Ka(Vi,e),qi!==null&&Ka(qi,e),wo.forEach(t),xo.forEach(t),n=0;n<Oi.length;n++)r=Oi[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<Oi.length&&(n=Oi[0],n.blockedOn===null);)Av(n),n.blockedOn===null&&Oi.shift()}var oa=Si.ReactCurrentBatchConfig,El=!0;function $S(e,t,n,r){var i=vt,a=oa.transition;oa.transition=null;try{vt=1,Sp(e,t,n,r)}finally{vt=i,oa.transition=a}}function WS(e,t,n,r){var i=vt,a=oa.transition;oa.transition=null;try{vt=4,Sp(e,t,n,r)}finally{vt=i,oa.transition=a}}function Sp(e,t,n,r){if(El){var i=dh(e,t,n,r);if(i===null)bd(e,t,r,Pl,n),nm(e,r);else if(zS(i,e,t,n,r))r.stopPropagation();else if(nm(e,r),t&4&&-1<qS.indexOf(e)){for(;i!==null;){var a=nc(i);if(a!==null&&Pv(a),a=dh(e,t,n,r),a===null&&bd(e,t,r,Pl,n),a===i)break;i=a}i!==null&&r.stopPropagation()}else bd(e,t,r,null,n)}}var Pl=null;function dh(e,t,n,r){if(Pl=null,e=vp(r),e=ms(e),e!==null)if(t=Ns(e),t===null)e=null;else if(n=t.tag,n===13){if(e=yv(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Pl=e,null}function Iv(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(NS()){case yp:return 1;case wv:return 4;case xl:case OS:return 16;case xv:return 536870912;default:return 16}default:return 16}}var Bi=null,wp=null,Qc=null;function Fv(){if(Qc)return Qc;var e,t=wp,n=t.length,r,i="value"in Bi?Bi.value:Bi.textContent,a=i.length;for(e=0;e<n&&t[e]===i[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===i[a-r];r++);return Qc=i.slice(e,1<r?1-r:void 0)}function Xc(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Fc(){return!0}function im(){return!1}function or(e){function t(n,r,i,a,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var u in e)e.hasOwnProperty(u)&&(n=e[u],this[u]=n?n(a):a[u]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Fc:im,this.isPropagationStopped=im,this}return Lt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Fc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Fc)},persist:function(){},isPersistent:Fc}),t}var ka={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xp=or(ka),tc=Lt({},ka,{view:0,detail:0}),GS=or(tc),dd,hd,$a,iu=Lt({},tc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cp,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$a&&($a&&e.type==="mousemove"?(dd=e.screenX-$a.screenX,hd=e.screenY-$a.screenY):hd=dd=0,$a=e),dd)},movementY:function(e){return"movementY"in e?e.movementY:hd}}),sm=or(iu),ZS=Lt({},iu,{dataTransfer:0}),JS=or(ZS),QS=Lt({},tc,{relatedTarget:0}),pd=or(QS),XS=Lt({},ka,{animationName:0,elapsedTime:0,pseudoElement:0}),YS=or(XS),ew=Lt({},ka,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),tw=or(ew),nw=Lt({},ka,{data:0}),am=or(nw),rw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},sw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aw(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=sw[e])?!!t[e]:!1}function Cp(){return aw}var ow=Lt({},tc,{key:function(e){if(e.key){var t=rw[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Xc(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?iw[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cp,charCode:function(e){return e.type==="keypress"?Xc(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Xc(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),cw=or(ow),lw=Lt({},iu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),om=or(lw),uw=Lt({},tc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cp}),dw=or(uw),hw=Lt({},ka,{propertyName:0,elapsedTime:0,pseudoElement:0}),pw=or(hw),fw=Lt({},iu,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),mw=or(fw),gw=[9,13,27,32],Ep=mi&&"CompositionEvent"in window,uo=null;mi&&"documentMode"in document&&(uo=document.documentMode);var vw=mi&&"TextEvent"in window&&!uo,Dv=mi&&(!Ep||uo&&8<uo&&11>=uo),cm=" ",lm=!1;function Nv(e,t){switch(e){case"keyup":return gw.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ov(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ws=!1;function yw(e,t){switch(e){case"compositionend":return Ov(t);case"keypress":return t.which!==32?null:(lm=!0,cm);case"textInput":return e=t.data,e===cm&&lm?null:e;default:return null}}function _w(e,t){if(Ws)return e==="compositionend"||!Ep&&Nv(e,t)?(e=Fv(),Qc=wp=Bi=null,Ws=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Dv&&t.locale!=="ko"?null:t.data;default:return null}}var bw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function um(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!bw[e.type]:t==="textarea"}function Mv(e,t,n,r){pv(r),t=kl(t,"onChange"),0<t.length&&(n=new xp("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var ho=null,Eo=null;function Sw(e){Wv(e,0)}function su(e){var t=Js(e);if(av(t))return e}function ww(e,t){if(e==="change")return t}var Lv=!1;if(mi){var fd;if(mi){var md="oninput"in document;if(!md){var dm=document.createElement("div");dm.setAttribute("oninput","return;"),md=typeof dm.oninput=="function"}fd=md}else fd=!1;Lv=fd&&(!document.documentMode||9<document.documentMode)}function hm(){ho&&(ho.detachEvent("onpropertychange",jv),Eo=ho=null)}function jv(e){if(e.propertyName==="value"&&su(Eo)){var t=[];Mv(t,Eo,e,vp(e)),vv(Sw,t)}}function xw(e,t,n){e==="focusin"?(hm(),ho=t,Eo=n,ho.attachEvent("onpropertychange",jv)):e==="focusout"&&hm()}function Cw(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return su(Eo)}function Ew(e,t){if(e==="click")return su(t)}function Pw(e,t){if(e==="input"||e==="change")return su(t)}function kw(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Hr=typeof Object.is=="function"?Object.is:kw;function Po(e,t){if(Hr(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Wd.call(t,i)||!Hr(e[i],t[i]))return!1}return!0}function pm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function fm(e,t){var n=pm(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=pm(n)}}function Bv(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Bv(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Uv(){for(var e=window,t=bl();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=bl(e.document)}return t}function Pp(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Tw(e){var t=Uv(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Bv(n.ownerDocument.documentElement,n)){if(r!==null&&Pp(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,a=Math.min(r.start,i);r=r.end===void 0?a:Math.min(r.end,i),!e.extend&&a>r&&(i=r,r=a,a=i),i=fm(n,a);var o=fm(n,r);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Rw=mi&&"documentMode"in document&&11>=document.documentMode,Gs=null,hh=null,po=null,ph=!1;function mm(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ph||Gs==null||Gs!==bl(r)||(r=Gs,"selectionStart"in r&&Pp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),po&&Po(po,r)||(po=r,r=kl(hh,"onSelect"),0<r.length&&(t=new xp("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Gs)))}function Dc(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Zs={animationend:Dc("Animation","AnimationEnd"),animationiteration:Dc("Animation","AnimationIteration"),animationstart:Dc("Animation","AnimationStart"),transitionend:Dc("Transition","TransitionEnd")},gd={},Hv={};mi&&(Hv=document.createElement("div").style,"AnimationEvent"in window||(delete Zs.animationend.animation,delete Zs.animationiteration.animation,delete Zs.animationstart.animation),"TransitionEvent"in window||delete Zs.transitionend.transition);function au(e){if(gd[e])return gd[e];if(!Zs[e])return e;var t=Zs[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Hv)return gd[e]=t[n];return e}var Vv=au("animationend"),qv=au("animationiteration"),zv=au("animationstart"),Kv=au("transitionend"),$v=new Map,gm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function es(e,t){$v.set(e,t),Ds(t,[e])}for(var vd=0;vd<gm.length;vd++){var yd=gm[vd],Aw=yd.toLowerCase(),Iw=yd[0].toUpperCase()+yd.slice(1);es(Aw,"on"+Iw)}es(Vv,"onAnimationEnd");es(qv,"onAnimationIteration");es(zv,"onAnimationStart");es("dblclick","onDoubleClick");es("focusin","onFocus");es("focusout","onBlur");es(Kv,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);Ds("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ds("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ds("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ds("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ds("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ds("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ao="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fw=new Set("cancel close invalid load scroll toggle".split(" ").concat(ao));function vm(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,AS(r,t,void 0,e),e.currentTarget=null}function Wv(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var u=r[o],p=u.instance,h=u.currentTarget;if(u=u.listener,p!==a&&i.isPropagationStopped())break e;vm(i,u,h),a=p}else for(o=0;o<r.length;o++){if(u=r[o],p=u.instance,h=u.currentTarget,u=u.listener,p!==a&&i.isPropagationStopped())break e;vm(i,u,h),a=p}}}if(wl)throw e=ch,wl=!1,ch=null,e}function Pt(e,t){var n=t[yh];n===void 0&&(n=t[yh]=new Set);var r=e+"__bubble";n.has(r)||(Gv(t,e,2,!1),n.add(r))}function _d(e,t,n){var r=0;t&&(r|=4),Gv(n,e,r,t)}var Nc="_reactListening"+Math.random().toString(36).slice(2);function ko(e){if(!e[Nc]){e[Nc]=!0,tv.forEach(function(n){n!=="selectionchange"&&(Fw.has(n)||_d(n,!1,e),_d(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Nc]||(t[Nc]=!0,_d("selectionchange",!1,t))}}function Gv(e,t,n,r){switch(Iv(t)){case 1:var i=$S;break;case 4:i=WS;break;default:i=Sp}n=i.bind(null,t,n,e),i=void 0,!oh||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),r?i!==void 0?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):i!==void 0?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function bd(e,t,n,r,i){var a=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var u=r.stateNode.containerInfo;if(u===i||u.nodeType===8&&u.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var p=o.tag;if((p===3||p===4)&&(p=o.stateNode.containerInfo,p===i||p.nodeType===8&&p.parentNode===i))return;o=o.return}for(;u!==null;){if(o=ms(u),o===null)return;if(p=o.tag,p===5||p===6){r=a=o;continue e}u=u.parentNode}}r=r.return}vv(function(){var h=a,y=vp(n),f=[];e:{var _=$v.get(e);if(_!==void 0){var w=xp,R=e;switch(e){case"keypress":if(Xc(n)===0)break e;case"keydown":case"keyup":w=cw;break;case"focusin":R="focus",w=pd;break;case"focusout":R="blur",w=pd;break;case"beforeblur":case"afterblur":w=pd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":w=sm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":w=JS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":w=dw;break;case Vv:case qv:case zv:w=YS;break;case Kv:w=pw;break;case"scroll":w=GS;break;case"wheel":w=mw;break;case"copy":case"cut":case"paste":w=tw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":w=om}var F=(t&4)!==0,S=!F&&e==="scroll",b=F?_!==null?_+"Capture":null:_;F=[];for(var x=h,k;x!==null;){k=x;var L=k.stateNode;if(k.tag===5&&L!==null&&(k=L,b!==null&&(L=So(x,b),L!=null&&F.push(To(x,L,k)))),S)break;x=x.return}0<F.length&&(_=new w(_,R,null,n,y),f.push({event:_,listeners:F}))}}if(!(t&7)){e:{if(_=e==="mouseover"||e==="pointerover",w=e==="mouseout"||e==="pointerout",_&&n!==sh&&(R=n.relatedTarget||n.fromElement)&&(ms(R)||R[gi]))break e;if((w||_)&&(_=y.window===y?y:(_=y.ownerDocument)?_.defaultView||_.parentWindow:window,w?(R=n.relatedTarget||n.toElement,w=h,R=R?ms(R):null,R!==null&&(S=Ns(R),R!==S||R.tag!==5&&R.tag!==6)&&(R=null)):(w=null,R=h),w!==R)){if(F=sm,L="onMouseLeave",b="onMouseEnter",x="mouse",(e==="pointerout"||e==="pointerover")&&(F=om,L="onPointerLeave",b="onPointerEnter",x="pointer"),S=w==null?_:Js(w),k=R==null?_:Js(R),_=new F(L,x+"leave",w,n,y),_.target=S,_.relatedTarget=k,L=null,ms(y)===h&&(F=new F(b,x+"enter",R,n,y),F.target=k,F.relatedTarget=S,L=F),S=L,w&&R)t:{for(F=w,b=R,x=0,k=F;k;k=Vs(k))x++;for(k=0,L=b;L;L=Vs(L))k++;for(;0<x-k;)F=Vs(F),x--;for(;0<k-x;)b=Vs(b),k--;for(;x--;){if(F===b||b!==null&&F===b.alternate)break t;F=Vs(F),b=Vs(b)}F=null}else F=null;w!==null&&ym(f,_,w,F,!1),R!==null&&S!==null&&ym(f,S,R,F,!0)}}e:{if(_=h?Js(h):window,w=_.nodeName&&_.nodeName.toLowerCase(),w==="select"||w==="input"&&_.type==="file")var G=ww;else if(um(_))if(Lv)G=Pw;else{G=Cw;var K=xw}else(w=_.nodeName)&&w.toLowerCase()==="input"&&(_.type==="checkbox"||_.type==="radio")&&(G=Ew);if(G&&(G=G(e,h))){Mv(f,G,n,y);break e}K&&K(e,_,h),e==="focusout"&&(K=_._wrapperState)&&K.controlled&&_.type==="number"&&eh(_,"number",_.value)}switch(K=h?Js(h):window,e){case"focusin":(um(K)||K.contentEditable==="true")&&(Gs=K,hh=h,po=null);break;case"focusout":po=hh=Gs=null;break;case"mousedown":ph=!0;break;case"contextmenu":case"mouseup":case"dragend":ph=!1,mm(f,n,y);break;case"selectionchange":if(Rw)break;case"keydown":case"keyup":mm(f,n,y)}var z;if(Ep)e:{switch(e){case"compositionstart":var U="onCompositionStart";break e;case"compositionend":U="onCompositionEnd";break e;case"compositionupdate":U="onCompositionUpdate";break e}U=void 0}else Ws?Nv(e,n)&&(U="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(U="onCompositionStart");U&&(Dv&&n.locale!=="ko"&&(Ws||U!=="onCompositionStart"?U==="onCompositionEnd"&&Ws&&(z=Fv()):(Bi=y,wp="value"in Bi?Bi.value:Bi.textContent,Ws=!0)),K=kl(h,U),0<K.length&&(U=new am(U,e,null,n,y),f.push({event:U,listeners:K}),z?U.data=z:(z=Ov(n),z!==null&&(U.data=z)))),(z=vw?yw(e,n):_w(e,n))&&(h=kl(h,"onBeforeInput"),0<h.length&&(y=new am("onBeforeInput","beforeinput",null,n,y),f.push({event:y,listeners:h}),y.data=z))}Wv(f,t)})}function To(e,t,n){return{instance:e,listener:t,currentTarget:n}}function kl(e,t){for(var n=t+"Capture",r=[];e!==null;){var i=e,a=i.stateNode;i.tag===5&&a!==null&&(i=a,a=So(e,n),a!=null&&r.unshift(To(e,a,i)),a=So(e,t),a!=null&&r.push(To(e,a,i))),e=e.return}return r}function Vs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ym(e,t,n,r,i){for(var a=t._reactName,o=[];n!==null&&n!==r;){var u=n,p=u.alternate,h=u.stateNode;if(p!==null&&p===r)break;u.tag===5&&h!==null&&(u=h,i?(p=So(n,a),p!=null&&o.unshift(To(n,p,u))):i||(p=So(n,a),p!=null&&o.push(To(n,p,u)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var Dw=/\r\n?/g,Nw=/\u0000|\uFFFD/g;function _m(e){return(typeof e=="string"?e:""+e).replace(Dw,`
`).replace(Nw,"")}function Oc(e,t,n){if(t=_m(t),_m(e)!==t&&n)throw Error(Re(425))}function Tl(){}var fh=null,mh=null;function gh(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var vh=typeof setTimeout=="function"?setTimeout:void 0,Ow=typeof clearTimeout=="function"?clearTimeout:void 0,bm=typeof Promise=="function"?Promise:void 0,Mw=typeof queueMicrotask=="function"?queueMicrotask:typeof bm<"u"?function(e){return bm.resolve(null).then(e).catch(Lw)}:vh;function Lw(e){setTimeout(function(){throw e})}function Sd(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){e.removeChild(i),Co(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Co(t)}function zi(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Sm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Ta=Math.random().toString(36).slice(2),ti="__reactFiber$"+Ta,Ro="__reactProps$"+Ta,gi="__reactContainer$"+Ta,yh="__reactEvents$"+Ta,jw="__reactListeners$"+Ta,Bw="__reactHandles$"+Ta;function ms(e){var t=e[ti];if(t)return t;for(var n=e.parentNode;n;){if(t=n[gi]||n[ti]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Sm(e);e!==null;){if(n=e[ti])return n;e=Sm(e)}return t}e=n,n=e.parentNode}return null}function nc(e){return e=e[ti]||e[gi],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Js(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Re(33))}function ou(e){return e[Ro]||null}var _h=[],Qs=-1;function ts(e){return{current:e}}function kt(e){0>Qs||(e.current=_h[Qs],_h[Qs]=null,Qs--)}function wt(e,t){Qs++,_h[Qs]=e.current,e.current=t}var Ji={},xn=ts(Ji),Wn=ts(!1),Es=Ji;function pa(e,t){var n=e.type.contextTypes;if(!n)return Ji;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},a;for(a in n)i[a]=t[a];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Gn(e){return e=e.childContextTypes,e!=null}function Rl(){kt(Wn),kt(xn)}function wm(e,t,n){if(xn.current!==Ji)throw Error(Re(168));wt(xn,t),wt(Wn,n)}function Zv(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(Re(108,xS(e)||"Unknown",i));return Lt({},n,r)}function Al(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ji,Es=xn.current,wt(xn,e),wt(Wn,Wn.current),!0}function xm(e,t,n){var r=e.stateNode;if(!r)throw Error(Re(169));n?(e=Zv(e,t,Es),r.__reactInternalMemoizedMergedChildContext=e,kt(Wn),kt(xn),wt(xn,e)):kt(Wn),wt(Wn,n)}var ui=null,cu=!1,wd=!1;function Jv(e){ui===null?ui=[e]:ui.push(e)}function Uw(e){cu=!0,Jv(e)}function ns(){if(!wd&&ui!==null){wd=!0;var e=0,t=vt;try{var n=ui;for(vt=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}ui=null,cu=!1}catch(i){throw ui!==null&&(ui=ui.slice(e+1)),Sv(yp,ns),i}finally{vt=t,wd=!1}}return null}var Xs=[],Ys=0,Il=null,Fl=0,gr=[],vr=0,Ps=null,hi=1,pi="";function ds(e,t){Xs[Ys++]=Fl,Xs[Ys++]=Il,Il=e,Fl=t}function Qv(e,t,n){gr[vr++]=hi,gr[vr++]=pi,gr[vr++]=Ps,Ps=e;var r=hi;e=pi;var i=32-Lr(r)-1;r&=~(1<<i),n+=1;var a=32-Lr(t)+i;if(30<a){var o=i-i%5;a=(r&(1<<o)-1).toString(32),r>>=o,i-=o,hi=1<<32-Lr(t)+i|n<<i|r,pi=a+e}else hi=1<<a|n<<i|r,pi=e}function kp(e){e.return!==null&&(ds(e,1),Qv(e,1,0))}function Tp(e){for(;e===Il;)Il=Xs[--Ys],Xs[Ys]=null,Fl=Xs[--Ys],Xs[Ys]=null;for(;e===Ps;)Ps=gr[--vr],gr[vr]=null,pi=gr[--vr],gr[vr]=null,hi=gr[--vr],gr[vr]=null}var ir=null,rr=null,At=!1,Or=null;function Xv(e,t){var n=yr(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Cm(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ir=e,rr=zi(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ir=e,rr=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Ps!==null?{id:hi,overflow:pi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=yr(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,ir=e,rr=null,!0):!1;default:return!1}}function bh(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Sh(e){if(At){var t=rr;if(t){var n=t;if(!Cm(e,t)){if(bh(e))throw Error(Re(418));t=zi(n.nextSibling);var r=ir;t&&Cm(e,t)?Xv(r,n):(e.flags=e.flags&-4097|2,At=!1,ir=e)}}else{if(bh(e))throw Error(Re(418));e.flags=e.flags&-4097|2,At=!1,ir=e}}}function Em(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ir=e}function Mc(e){if(e!==ir)return!1;if(!At)return Em(e),At=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!gh(e.type,e.memoizedProps)),t&&(t=rr)){if(bh(e))throw Yv(),Error(Re(418));for(;t;)Xv(e,t),t=zi(t.nextSibling)}if(Em(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Re(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){rr=zi(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}rr=null}}else rr=ir?zi(e.stateNode.nextSibling):null;return!0}function Yv(){for(var e=rr;e;)e=zi(e.nextSibling)}function fa(){rr=ir=null,At=!1}function Rp(e){Or===null?Or=[e]:Or.push(e)}var Hw=Si.ReactCurrentBatchConfig;function Wa(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Re(309));var r=n.stateNode}if(!r)throw Error(Re(147,e));var i=r,a=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===a?t.ref:(t=function(o){var u=i.refs;o===null?delete u[a]:u[a]=o},t._stringRef=a,t)}if(typeof e!="string")throw Error(Re(284));if(!n._owner)throw Error(Re(290,e))}return e}function Lc(e,t){throw e=Object.prototype.toString.call(t),Error(Re(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Pm(e){var t=e._init;return t(e._payload)}function e0(e){function t(b,x){if(e){var k=b.deletions;k===null?(b.deletions=[x],b.flags|=16):k.push(x)}}function n(b,x){if(!e)return null;for(;x!==null;)t(b,x),x=x.sibling;return null}function r(b,x){for(b=new Map;x!==null;)x.key!==null?b.set(x.key,x):b.set(x.index,x),x=x.sibling;return b}function i(b,x){return b=Gi(b,x),b.index=0,b.sibling=null,b}function a(b,x,k){return b.index=k,e?(k=b.alternate,k!==null?(k=k.index,k<x?(b.flags|=2,x):k):(b.flags|=2,x)):(b.flags|=1048576,x)}function o(b){return e&&b.alternate===null&&(b.flags|=2),b}function u(b,x,k,L){return x===null||x.tag!==6?(x=Rd(k,b.mode,L),x.return=b,x):(x=i(x,k),x.return=b,x)}function p(b,x,k,L){var G=k.type;return G===$s?y(b,x,k.props.children,L,k.key):x!==null&&(x.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===Di&&Pm(G)===x.type)?(L=i(x,k.props),L.ref=Wa(b,x,k),L.return=b,L):(L=sl(k.type,k.key,k.props,null,b.mode,L),L.ref=Wa(b,x,k),L.return=b,L)}function h(b,x,k,L){return x===null||x.tag!==4||x.stateNode.containerInfo!==k.containerInfo||x.stateNode.implementation!==k.implementation?(x=Ad(k,b.mode,L),x.return=b,x):(x=i(x,k.children||[]),x.return=b,x)}function y(b,x,k,L,G){return x===null||x.tag!==7?(x=ws(k,b.mode,L,G),x.return=b,x):(x=i(x,k),x.return=b,x)}function f(b,x,k){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Rd(""+x,b.mode,k),x.return=b,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Pc:return k=sl(x.type,x.key,x.props,null,b.mode,k),k.ref=Wa(b,null,x),k.return=b,k;case Ks:return x=Ad(x,b.mode,k),x.return=b,x;case Di:var L=x._init;return f(b,L(x._payload),k)}if(io(x)||Va(x))return x=ws(x,b.mode,k,null),x.return=b,x;Lc(b,x)}return null}function _(b,x,k,L){var G=x!==null?x.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return G!==null?null:u(b,x,""+k,L);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Pc:return k.key===G?p(b,x,k,L):null;case Ks:return k.key===G?h(b,x,k,L):null;case Di:return G=k._init,_(b,x,G(k._payload),L)}if(io(k)||Va(k))return G!==null?null:y(b,x,k,L,null);Lc(b,k)}return null}function w(b,x,k,L,G){if(typeof L=="string"&&L!==""||typeof L=="number")return b=b.get(k)||null,u(x,b,""+L,G);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case Pc:return b=b.get(L.key===null?k:L.key)||null,p(x,b,L,G);case Ks:return b=b.get(L.key===null?k:L.key)||null,h(x,b,L,G);case Di:var K=L._init;return w(b,x,k,K(L._payload),G)}if(io(L)||Va(L))return b=b.get(k)||null,y(x,b,L,G,null);Lc(x,L)}return null}function R(b,x,k,L){for(var G=null,K=null,z=x,U=x=0,J=null;z!==null&&U<k.length;U++){z.index>U?(J=z,z=null):J=z.sibling;var Q=_(b,z,k[U],L);if(Q===null){z===null&&(z=J);break}e&&z&&Q.alternate===null&&t(b,z),x=a(Q,x,U),K===null?G=Q:K.sibling=Q,K=Q,z=J}if(U===k.length)return n(b,z),At&&ds(b,U),G;if(z===null){for(;U<k.length;U++)z=f(b,k[U],L),z!==null&&(x=a(z,x,U),K===null?G=z:K.sibling=z,K=z);return At&&ds(b,U),G}for(z=r(b,z);U<k.length;U++)J=w(z,b,U,k[U],L),J!==null&&(e&&J.alternate!==null&&z.delete(J.key===null?U:J.key),x=a(J,x,U),K===null?G=J:K.sibling=J,K=J);return e&&z.forEach(function(ne){return t(b,ne)}),At&&ds(b,U),G}function F(b,x,k,L){var G=Va(k);if(typeof G!="function")throw Error(Re(150));if(k=G.call(k),k==null)throw Error(Re(151));for(var K=G=null,z=x,U=x=0,J=null,Q=k.next();z!==null&&!Q.done;U++,Q=k.next()){z.index>U?(J=z,z=null):J=z.sibling;var ne=_(b,z,Q.value,L);if(ne===null){z===null&&(z=J);break}e&&z&&ne.alternate===null&&t(b,z),x=a(ne,x,U),K===null?G=ne:K.sibling=ne,K=ne,z=J}if(Q.done)return n(b,z),At&&ds(b,U),G;if(z===null){for(;!Q.done;U++,Q=k.next())Q=f(b,Q.value,L),Q!==null&&(x=a(Q,x,U),K===null?G=Q:K.sibling=Q,K=Q);return At&&ds(b,U),G}for(z=r(b,z);!Q.done;U++,Q=k.next())Q=w(z,b,U,Q.value,L),Q!==null&&(e&&Q.alternate!==null&&z.delete(Q.key===null?U:Q.key),x=a(Q,x,U),K===null?G=Q:K.sibling=Q,K=Q);return e&&z.forEach(function(oe){return t(b,oe)}),At&&ds(b,U),G}function S(b,x,k,L){if(typeof k=="object"&&k!==null&&k.type===$s&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case Pc:e:{for(var G=k.key,K=x;K!==null;){if(K.key===G){if(G=k.type,G===$s){if(K.tag===7){n(b,K.sibling),x=i(K,k.props.children),x.return=b,b=x;break e}}else if(K.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===Di&&Pm(G)===K.type){n(b,K.sibling),x=i(K,k.props),x.ref=Wa(b,K,k),x.return=b,b=x;break e}n(b,K);break}else t(b,K);K=K.sibling}k.type===$s?(x=ws(k.props.children,b.mode,L,k.key),x.return=b,b=x):(L=sl(k.type,k.key,k.props,null,b.mode,L),L.ref=Wa(b,x,k),L.return=b,b=L)}return o(b);case Ks:e:{for(K=k.key;x!==null;){if(x.key===K)if(x.tag===4&&x.stateNode.containerInfo===k.containerInfo&&x.stateNode.implementation===k.implementation){n(b,x.sibling),x=i(x,k.children||[]),x.return=b,b=x;break e}else{n(b,x);break}else t(b,x);x=x.sibling}x=Ad(k,b.mode,L),x.return=b,b=x}return o(b);case Di:return K=k._init,S(b,x,K(k._payload),L)}if(io(k))return R(b,x,k,L);if(Va(k))return F(b,x,k,L);Lc(b,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,x!==null&&x.tag===6?(n(b,x.sibling),x=i(x,k),x.return=b,b=x):(n(b,x),x=Rd(k,b.mode,L),x.return=b,b=x),o(b)):n(b,x)}return S}var ma=e0(!0),t0=e0(!1),Dl=ts(null),Nl=null,ea=null,Ap=null;function Ip(){Ap=ea=Nl=null}function Fp(e){var t=Dl.current;kt(Dl),e._currentValue=t}function wh(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ca(e,t){Nl=e,Ap=ea=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&($n=!0),e.firstContext=null)}function br(e){var t=e._currentValue;if(Ap!==e)if(e={context:e,memoizedValue:t,next:null},ea===null){if(Nl===null)throw Error(Re(308));ea=e,Nl.dependencies={lanes:0,firstContext:e}}else ea=ea.next=e;return t}var gs=null;function Dp(e){gs===null?gs=[e]:gs.push(e)}function n0(e,t,n,r){var i=t.interleaved;return i===null?(n.next=n,Dp(t)):(n.next=i.next,i.next=n),t.interleaved=n,vi(e,r)}function vi(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var Ni=!1;function Np(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function r0(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function fi(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ki(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,ct&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,vi(e,n)}return i=r.interleaved,i===null?(t.next=t,Dp(r)):(t.next=i.next,i.next=t),r.interleaved=t,vi(e,n)}function Yc(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,_p(e,n)}}function km(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?i=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?i=a=t:a=a.next=t}else i=a=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ol(e,t,n,r){var i=e.updateQueue;Ni=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,u=i.shared.pending;if(u!==null){i.shared.pending=null;var p=u,h=p.next;p.next=null,o===null?a=h:o.next=h,o=p;var y=e.alternate;y!==null&&(y=y.updateQueue,u=y.lastBaseUpdate,u!==o&&(u===null?y.firstBaseUpdate=h:u.next=h,y.lastBaseUpdate=p))}if(a!==null){var f=i.baseState;o=0,y=h=p=null,u=a;do{var _=u.lane,w=u.eventTime;if((r&_)===_){y!==null&&(y=y.next={eventTime:w,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var R=e,F=u;switch(_=t,w=n,F.tag){case 1:if(R=F.payload,typeof R=="function"){f=R.call(w,f,_);break e}f=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=F.payload,_=typeof R=="function"?R.call(w,f,_):R,_==null)break e;f=Lt({},f,_);break e;case 2:Ni=!0}}u.callback!==null&&u.lane!==0&&(e.flags|=64,_=i.effects,_===null?i.effects=[u]:_.push(u))}else w={eventTime:w,lane:_,tag:u.tag,payload:u.payload,callback:u.callback,next:null},y===null?(h=y=w,p=f):y=y.next=w,o|=_;if(u=u.next,u===null){if(u=i.shared.pending,u===null)break;_=u,u=_.next,_.next=null,i.lastBaseUpdate=_,i.shared.pending=null}}while(!0);if(y===null&&(p=f),i.baseState=p,i.firstBaseUpdate=h,i.lastBaseUpdate=y,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else a===null&&(i.shared.lanes=0);Ts|=o,e.lanes=o,e.memoizedState=f}}function Tm(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Re(191,i));i.call(r)}}}var rc={},ri=ts(rc),Ao=ts(rc),Io=ts(rc);function vs(e){if(e===rc)throw Error(Re(174));return e}function Op(e,t){switch(wt(Io,t),wt(Ao,e),wt(ri,rc),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:nh(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=nh(t,e)}kt(ri),wt(ri,t)}function ga(){kt(ri),kt(Ao),kt(Io)}function i0(e){vs(Io.current);var t=vs(ri.current),n=nh(t,e.type);t!==n&&(wt(Ao,e),wt(ri,n))}function Mp(e){Ao.current===e&&(kt(ri),kt(Ao))}var Ot=ts(0);function Ml(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var xd=[];function Lp(){for(var e=0;e<xd.length;e++)xd[e]._workInProgressVersionPrimary=null;xd.length=0}var el=Si.ReactCurrentDispatcher,Cd=Si.ReactCurrentBatchConfig,ks=0,Mt=null,Xt=null,sn=null,Ll=!1,fo=!1,Fo=0,Vw=0;function vn(){throw Error(Re(321))}function jp(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Hr(e[n],t[n]))return!1;return!0}function Bp(e,t,n,r,i,a){if(ks=a,Mt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,el.current=e===null||e.memoizedState===null?$w:Ww,e=n(r,i),fo){a=0;do{if(fo=!1,Fo=0,25<=a)throw Error(Re(301));a+=1,sn=Xt=null,t.updateQueue=null,el.current=Gw,e=n(r,i)}while(fo)}if(el.current=jl,t=Xt!==null&&Xt.next!==null,ks=0,sn=Xt=Mt=null,Ll=!1,t)throw Error(Re(300));return e}function Up(){var e=Fo!==0;return Fo=0,e}function ei(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?Mt.memoizedState=sn=e:sn=sn.next=e,sn}function Sr(){if(Xt===null){var e=Mt.alternate;e=e!==null?e.memoizedState:null}else e=Xt.next;var t=sn===null?Mt.memoizedState:sn.next;if(t!==null)sn=t,Xt=e;else{if(e===null)throw Error(Re(310));Xt=e,e={memoizedState:Xt.memoizedState,baseState:Xt.baseState,baseQueue:Xt.baseQueue,queue:Xt.queue,next:null},sn===null?Mt.memoizedState=sn=e:sn=sn.next=e}return sn}function Do(e,t){return typeof t=="function"?t(e):t}function Ed(e){var t=Sr(),n=t.queue;if(n===null)throw Error(Re(311));n.lastRenderedReducer=e;var r=Xt,i=r.baseQueue,a=n.pending;if(a!==null){if(i!==null){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(i!==null){a=i.next,r=r.baseState;var u=o=null,p=null,h=a;do{var y=h.lane;if((ks&y)===y)p!==null&&(p=p.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),r=h.hasEagerState?h.eagerState:e(r,h.action);else{var f={lane:y,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};p===null?(u=p=f,o=r):p=p.next=f,Mt.lanes|=y,Ts|=y}h=h.next}while(h!==null&&h!==a);p===null?o=r:p.next=u,Hr(r,t.memoizedState)||($n=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=p,n.lastRenderedState=r}if(e=n.interleaved,e!==null){i=e;do a=i.lane,Mt.lanes|=a,Ts|=a,i=i.next;while(i!==e)}else i===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Pd(e){var t=Sr(),n=t.queue;if(n===null)throw Error(Re(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do a=e(a,o.action),o=o.next;while(o!==i);Hr(a,t.memoizedState)||($n=!0),t.memoizedState=a,t.baseQueue===null&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function s0(){}function a0(e,t){var n=Mt,r=Sr(),i=t(),a=!Hr(r.memoizedState,i);if(a&&(r.memoizedState=i,$n=!0),r=r.queue,Hp(l0.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||sn!==null&&sn.memoizedState.tag&1){if(n.flags|=2048,No(9,c0.bind(null,n,r,i,t),void 0,null),an===null)throw Error(Re(349));ks&30||o0(n,t,i)}return i}function o0(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=Mt.updateQueue,t===null?(t={lastEffect:null,stores:null},Mt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function c0(e,t,n,r){t.value=n,t.getSnapshot=r,u0(t)&&d0(e)}function l0(e,t,n){return n(function(){u0(t)&&d0(e)})}function u0(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Hr(e,n)}catch{return!0}}function d0(e){var t=vi(e,1);t!==null&&jr(t,e,1,-1)}function Rm(e){var t=ei();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Do,lastRenderedState:e},t.queue=e,e=e.dispatch=Kw.bind(null,Mt,e),[t.memoizedState,e]}function No(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=Mt.updateQueue,t===null?(t={lastEffect:null,stores:null},Mt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function h0(){return Sr().memoizedState}function tl(e,t,n,r){var i=ei();Mt.flags|=e,i.memoizedState=No(1|t,n,void 0,r===void 0?null:r)}function lu(e,t,n,r){var i=Sr();r=r===void 0?null:r;var a=void 0;if(Xt!==null){var o=Xt.memoizedState;if(a=o.destroy,r!==null&&jp(r,o.deps)){i.memoizedState=No(t,n,a,r);return}}Mt.flags|=e,i.memoizedState=No(1|t,n,a,r)}function Am(e,t){return tl(8390656,8,e,t)}function Hp(e,t){return lu(2048,8,e,t)}function p0(e,t){return lu(4,2,e,t)}function f0(e,t){return lu(4,4,e,t)}function m0(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function g0(e,t,n){return n=n!=null?n.concat([e]):null,lu(4,4,m0.bind(null,t,e),n)}function Vp(){}function v0(e,t){var n=Sr();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&jp(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function y0(e,t){var n=Sr();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&jp(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function _0(e,t,n){return ks&21?(Hr(n,t)||(n=Cv(),Mt.lanes|=n,Ts|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,$n=!0),e.memoizedState=n)}function qw(e,t){var n=vt;vt=n!==0&&4>n?n:4,e(!0);var r=Cd.transition;Cd.transition={};try{e(!1),t()}finally{vt=n,Cd.transition=r}}function b0(){return Sr().memoizedState}function zw(e,t,n){var r=Wi(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},S0(e))w0(t,n);else if(n=n0(e,t,n,r),n!==null){var i=Dn();jr(n,e,r,i),x0(n,t,r)}}function Kw(e,t,n){var r=Wi(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(S0(e))w0(t,i);else{var a=e.alternate;if(e.lanes===0&&(a===null||a.lanes===0)&&(a=t.lastRenderedReducer,a!==null))try{var o=t.lastRenderedState,u=a(o,n);if(i.hasEagerState=!0,i.eagerState=u,Hr(u,o)){var p=t.interleaved;p===null?(i.next=i,Dp(t)):(i.next=p.next,p.next=i),t.interleaved=i;return}}catch{}finally{}n=n0(e,t,i,r),n!==null&&(i=Dn(),jr(n,e,r,i),x0(n,t,r))}}function S0(e){var t=e.alternate;return e===Mt||t!==null&&t===Mt}function w0(e,t){fo=Ll=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function x0(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,_p(e,n)}}var jl={readContext:br,useCallback:vn,useContext:vn,useEffect:vn,useImperativeHandle:vn,useInsertionEffect:vn,useLayoutEffect:vn,useMemo:vn,useReducer:vn,useRef:vn,useState:vn,useDebugValue:vn,useDeferredValue:vn,useTransition:vn,useMutableSource:vn,useSyncExternalStore:vn,useId:vn,unstable_isNewReconciler:!1},$w={readContext:br,useCallback:function(e,t){return ei().memoizedState=[e,t===void 0?null:t],e},useContext:br,useEffect:Am,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,tl(4194308,4,m0.bind(null,t,e),n)},useLayoutEffect:function(e,t){return tl(4194308,4,e,t)},useInsertionEffect:function(e,t){return tl(4,2,e,t)},useMemo:function(e,t){var n=ei();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=ei();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=zw.bind(null,Mt,e),[r.memoizedState,e]},useRef:function(e){var t=ei();return e={current:e},t.memoizedState=e},useState:Rm,useDebugValue:Vp,useDeferredValue:function(e){return ei().memoizedState=e},useTransition:function(){var e=Rm(!1),t=e[0];return e=qw.bind(null,e[1]),ei().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Mt,i=ei();if(At){if(n===void 0)throw Error(Re(407));n=n()}else{if(n=t(),an===null)throw Error(Re(349));ks&30||o0(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Am(l0.bind(null,r,a,e),[e]),r.flags|=2048,No(9,c0.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=ei(),t=an.identifierPrefix;if(At){var n=pi,r=hi;n=(r&~(1<<32-Lr(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=Fo++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Vw++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Ww={readContext:br,useCallback:v0,useContext:br,useEffect:Hp,useImperativeHandle:g0,useInsertionEffect:p0,useLayoutEffect:f0,useMemo:y0,useReducer:Ed,useRef:h0,useState:function(){return Ed(Do)},useDebugValue:Vp,useDeferredValue:function(e){var t=Sr();return _0(t,Xt.memoizedState,e)},useTransition:function(){var e=Ed(Do)[0],t=Sr().memoizedState;return[e,t]},useMutableSource:s0,useSyncExternalStore:a0,useId:b0,unstable_isNewReconciler:!1},Gw={readContext:br,useCallback:v0,useContext:br,useEffect:Hp,useImperativeHandle:g0,useInsertionEffect:p0,useLayoutEffect:f0,useMemo:y0,useReducer:Pd,useRef:h0,useState:function(){return Pd(Do)},useDebugValue:Vp,useDeferredValue:function(e){var t=Sr();return Xt===null?t.memoizedState=e:_0(t,Xt.memoizedState,e)},useTransition:function(){var e=Pd(Do)[0],t=Sr().memoizedState;return[e,t]},useMutableSource:s0,useSyncExternalStore:a0,useId:b0,unstable_isNewReconciler:!1};function Fr(e,t){if(e&&e.defaultProps){t=Lt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function xh(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:Lt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var uu={isMounted:function(e){return(e=e._reactInternals)?Ns(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Dn(),i=Wi(e),a=fi(r,i);a.payload=t,n!=null&&(a.callback=n),t=Ki(e,a,i),t!==null&&(jr(t,e,i,r),Yc(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Dn(),i=Wi(e),a=fi(r,i);a.tag=1,a.payload=t,n!=null&&(a.callback=n),t=Ki(e,a,i),t!==null&&(jr(t,e,i,r),Yc(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Dn(),r=Wi(e),i=fi(n,r);i.tag=2,t!=null&&(i.callback=t),t=Ki(e,i,r),t!==null&&(jr(t,e,r,n),Yc(t,e,r))}};function Im(e,t,n,r,i,a,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,a,o):t.prototype&&t.prototype.isPureReactComponent?!Po(n,r)||!Po(i,a):!0}function C0(e,t,n){var r=!1,i=Ji,a=t.contextType;return typeof a=="object"&&a!==null?a=br(a):(i=Gn(t)?Es:xn.current,r=t.contextTypes,a=(r=r!=null)?pa(e,i):Ji),t=new t(n,a),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=uu,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function Fm(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&uu.enqueueReplaceState(t,t.state,null)}function Ch(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Np(e);var a=t.contextType;typeof a=="object"&&a!==null?i.context=br(a):(a=Gn(t)?Es:xn.current,i.context=pa(e,a)),i.state=e.memoizedState,a=t.getDerivedStateFromProps,typeof a=="function"&&(xh(e,t,a,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&uu.enqueueReplaceState(i,i.state,null),Ol(e,n,i,r),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function va(e,t){try{var n="",r=t;do n+=wS(r),r=r.return;while(r);var i=n}catch(a){i=`
Error generating stack: `+a.message+`
`+a.stack}return{value:e,source:t,stack:i,digest:null}}function kd(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Eh(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var Zw=typeof WeakMap=="function"?WeakMap:Map;function E0(e,t,n){n=fi(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Ul||(Ul=!0,Oh=r),Eh(e,t)},n}function P0(e,t,n){n=fi(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Eh(e,t)}}var a=e.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Eh(e,t),typeof r!="function"&&($i===null?$i=new Set([this]):$i.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function Dm(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new Zw;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=lx.bind(null,e,t,n),t.then(e,e))}function Nm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Om(e,t,n,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=fi(-1,1),t.tag=2,Ki(n,t,1))),n.lanes|=1),e)}var Jw=Si.ReactCurrentOwner,$n=!1;function An(e,t,n,r){t.child=e===null?t0(t,null,n,r):ma(t,e.child,n,r)}function Mm(e,t,n,r,i){n=n.render;var a=t.ref;return ca(t,i),r=Bp(e,t,n,r,a,i),n=Up(),e!==null&&!$n?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,yi(e,t,i)):(At&&n&&kp(t),t.flags|=1,An(e,t,r,i),t.child)}function Lm(e,t,n,r,i){if(e===null){var a=n.type;return typeof a=="function"&&!Jp(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=a,k0(e,t,a,r,i)):(e=sl(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(a=e.child,!(e.lanes&i)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:Po,n(o,r)&&e.ref===t.ref)return yi(e,t,i)}return t.flags|=1,e=Gi(a,r),e.ref=t.ref,e.return=t,t.child=e}function k0(e,t,n,r,i){if(e!==null){var a=e.memoizedProps;if(Po(a,r)&&e.ref===t.ref)if($n=!1,t.pendingProps=r=a,(e.lanes&i)!==0)e.flags&131072&&($n=!0);else return t.lanes=e.lanes,yi(e,t,i)}return Ph(e,t,n,r,i)}function T0(e,t,n){var r=t.pendingProps,i=r.children,a=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},wt(na,tr),tr|=n;else{if(!(n&1073741824))return e=a!==null?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,wt(na,tr),tr|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,wt(na,tr),tr|=r}else a!==null?(r=a.baseLanes|n,t.memoizedState=null):r=n,wt(na,tr),tr|=r;return An(e,t,i,n),t.child}function R0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ph(e,t,n,r,i){var a=Gn(n)?Es:xn.current;return a=pa(t,a),ca(t,i),n=Bp(e,t,n,r,a,i),r=Up(),e!==null&&!$n?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,yi(e,t,i)):(At&&r&&kp(t),t.flags|=1,An(e,t,n,i),t.child)}function jm(e,t,n,r,i){if(Gn(n)){var a=!0;Al(t)}else a=!1;if(ca(t,i),t.stateNode===null)nl(e,t),C0(t,n,r),Ch(t,n,r,i),r=!0;else if(e===null){var o=t.stateNode,u=t.memoizedProps;o.props=u;var p=o.context,h=n.contextType;typeof h=="object"&&h!==null?h=br(h):(h=Gn(n)?Es:xn.current,h=pa(t,h));var y=n.getDerivedStateFromProps,f=typeof y=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(u!==r||p!==h)&&Fm(t,o,r,h),Ni=!1;var _=t.memoizedState;o.state=_,Ol(t,r,o,i),p=t.memoizedState,u!==r||_!==p||Wn.current||Ni?(typeof y=="function"&&(xh(t,n,y,r),p=t.memoizedState),(u=Ni||Im(t,n,u,r,_,p,h))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=h,r=u):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,r0(e,t),u=t.memoizedProps,h=t.type===t.elementType?u:Fr(t.type,u),o.props=h,f=t.pendingProps,_=o.context,p=n.contextType,typeof p=="object"&&p!==null?p=br(p):(p=Gn(n)?Es:xn.current,p=pa(t,p));var w=n.getDerivedStateFromProps;(y=typeof w=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(u!==f||_!==p)&&Fm(t,o,r,p),Ni=!1,_=t.memoizedState,o.state=_,Ol(t,r,o,i);var R=t.memoizedState;u!==f||_!==R||Wn.current||Ni?(typeof w=="function"&&(xh(t,n,w,r),R=t.memoizedState),(h=Ni||Im(t,n,h,r,_,R,p)||!1)?(y||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,R,p),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,R,p)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||u===e.memoizedProps&&_===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||u===e.memoizedProps&&_===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=R),o.props=r,o.state=R,o.context=p,r=h):(typeof o.componentDidUpdate!="function"||u===e.memoizedProps&&_===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||u===e.memoizedProps&&_===e.memoizedState||(t.flags|=1024),r=!1)}return kh(e,t,n,r,a,i)}function kh(e,t,n,r,i,a){R0(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return i&&xm(t,n,!1),yi(e,t,a);r=t.stateNode,Jw.current=t;var u=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=ma(t,e.child,null,a),t.child=ma(t,null,u,a)):An(e,t,u,a),t.memoizedState=r.state,i&&xm(t,n,!0),t.child}function A0(e){var t=e.stateNode;t.pendingContext?wm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&wm(e,t.context,!1),Op(e,t.containerInfo)}function Bm(e,t,n,r,i){return fa(),Rp(i),t.flags|=256,An(e,t,n,r),t.child}var Th={dehydrated:null,treeContext:null,retryLane:0};function Rh(e){return{baseLanes:e,cachePool:null,transitions:null}}function I0(e,t,n){var r=t.pendingProps,i=Ot.current,a=!1,o=(t.flags&128)!==0,u;if((u=o)||(u=e!==null&&e.memoizedState===null?!1:(i&2)!==0),u?(a=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),wt(Ot,i&1),e===null)return Sh(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,a?(r=t.mode,a=t.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=pu(o,r,0,null),e=ws(e,r,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Rh(n),t.memoizedState=Th,e):qp(t,o));if(i=e.memoizedState,i!==null&&(u=i.dehydrated,u!==null))return Qw(e,t,o,r,u,i,n);if(a){a=r.fallback,o=t.mode,i=e.child,u=i.sibling;var p={mode:"hidden",children:r.children};return!(o&1)&&t.child!==i?(r=t.child,r.childLanes=0,r.pendingProps=p,t.deletions=null):(r=Gi(i,p),r.subtreeFlags=i.subtreeFlags&14680064),u!==null?a=Gi(u,a):(a=ws(a,o,n,null),a.flags|=2),a.return=t,r.return=t,r.sibling=a,t.child=r,r=a,a=t.child,o=e.child.memoizedState,o=o===null?Rh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=e.childLanes&~n,t.memoizedState=Th,r}return a=e.child,e=a.sibling,r=Gi(a,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function qp(e,t){return t=pu({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function jc(e,t,n,r){return r!==null&&Rp(r),ma(t,e.child,null,n),e=qp(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Qw(e,t,n,r,i,a,o){if(n)return t.flags&256?(t.flags&=-257,r=kd(Error(Re(422))),jc(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=pu({mode:"visible",children:r.children},i,0,null),a=ws(a,i,o,null),a.flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,t.mode&1&&ma(t,e.child,null,o),t.child.memoizedState=Rh(o),t.memoizedState=Th,a);if(!(t.mode&1))return jc(e,t,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var u=r.dgst;return r=u,a=Error(Re(419)),r=kd(a,r,void 0),jc(e,t,o,r)}if(u=(o&e.childLanes)!==0,$n||u){if(r=an,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==a.retryLane&&(a.retryLane=i,vi(e,i),jr(r,e,i,-1))}return Zp(),r=kd(Error(Re(421))),jc(e,t,o,r)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=ux.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,rr=zi(i.nextSibling),ir=t,At=!0,Or=null,e!==null&&(gr[vr++]=hi,gr[vr++]=pi,gr[vr++]=Ps,hi=e.id,pi=e.overflow,Ps=t),t=qp(t,r.children),t.flags|=4096,t)}function Um(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),wh(e.return,t,n)}function Td(e,t,n,r,i){var a=e.memoizedState;a===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i)}function F0(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(An(e,t,r.children,n),r=Ot.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Um(e,n,t);else if(e.tag===19)Um(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(wt(Ot,r),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&Ml(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Td(t,!1,i,n,a);break;case"backwards":for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Ml(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Td(t,!0,n,null,a);break;case"together":Td(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function nl(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function yi(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Ts|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Re(153));if(t.child!==null){for(e=t.child,n=Gi(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=Gi(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Xw(e,t,n){switch(t.tag){case 3:A0(t),fa();break;case 5:i0(t);break;case 1:Gn(t.type)&&Al(t);break;case 4:Op(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;wt(Dl,r._currentValue),r._currentValue=i;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(wt(Ot,Ot.current&1),t.flags|=128,null):n&t.child.childLanes?I0(e,t,n):(wt(Ot,Ot.current&1),e=yi(e,t,n),e!==null?e.sibling:null);wt(Ot,Ot.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return F0(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),wt(Ot,Ot.current),r)break;return null;case 22:case 23:return t.lanes=0,T0(e,t,n)}return yi(e,t,n)}var D0,Ah,N0,O0;D0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ah=function(){};N0=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,vs(ri.current);var a=null;switch(n){case"input":i=Xd(e,i),r=Xd(e,r),a=[];break;case"select":i=Lt({},i,{value:void 0}),r=Lt({},r,{value:void 0}),a=[];break;case"textarea":i=th(e,i),r=th(e,r),a=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Tl)}rh(n,r);var o;n=null;for(h in i)if(!r.hasOwnProperty(h)&&i.hasOwnProperty(h)&&i[h]!=null)if(h==="style"){var u=i[h];for(o in u)u.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(_o.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in r){var p=r[h];if(u=i!=null?i[h]:void 0,r.hasOwnProperty(h)&&p!==u&&(p!=null||u!=null))if(h==="style")if(u){for(o in u)!u.hasOwnProperty(o)||p&&p.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in p)p.hasOwnProperty(o)&&u[o]!==p[o]&&(n||(n={}),n[o]=p[o])}else n||(a||(a=[]),a.push(h,n)),n=p;else h==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,u=u?u.__html:void 0,p!=null&&u!==p&&(a=a||[]).push(h,p)):h==="children"?typeof p!="string"&&typeof p!="number"||(a=a||[]).push(h,""+p):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(_o.hasOwnProperty(h)?(p!=null&&h==="onScroll"&&Pt("scroll",e),a||u===p||(a=[])):(a=a||[]).push(h,p))}n&&(a=a||[]).push("style",n);var h=a;(t.updateQueue=h)&&(t.flags|=4)}};O0=function(e,t,n,r){n!==r&&(t.flags|=4)};function Ga(e,t){if(!At)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function yn(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Yw(e,t,n){var r=t.pendingProps;switch(Tp(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yn(t),null;case 1:return Gn(t.type)&&Rl(),yn(t),null;case 3:return r=t.stateNode,ga(),kt(Wn),kt(xn),Lp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Mc(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Or!==null&&(jh(Or),Or=null))),Ah(e,t),yn(t),null;case 5:Mp(t);var i=vs(Io.current);if(n=t.type,e!==null&&t.stateNode!=null)N0(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Re(166));return yn(t),null}if(e=vs(ri.current),Mc(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[ti]=t,r[Ro]=a,e=(t.mode&1)!==0,n){case"dialog":Pt("cancel",r),Pt("close",r);break;case"iframe":case"object":case"embed":Pt("load",r);break;case"video":case"audio":for(i=0;i<ao.length;i++)Pt(ao[i],r);break;case"source":Pt("error",r);break;case"img":case"image":case"link":Pt("error",r),Pt("load",r);break;case"details":Pt("toggle",r);break;case"input":Zf(r,a),Pt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Pt("invalid",r);break;case"textarea":Qf(r,a),Pt("invalid",r)}rh(n,a),i=null;for(var o in a)if(a.hasOwnProperty(o)){var u=a[o];o==="children"?typeof u=="string"?r.textContent!==u&&(a.suppressHydrationWarning!==!0&&Oc(r.textContent,u,e),i=["children",u]):typeof u=="number"&&r.textContent!==""+u&&(a.suppressHydrationWarning!==!0&&Oc(r.textContent,u,e),i=["children",""+u]):_o.hasOwnProperty(o)&&u!=null&&o==="onScroll"&&Pt("scroll",r)}switch(n){case"input":kc(r),Jf(r,a,!0);break;case"textarea":kc(r),Xf(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Tl)}r=i,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=lv(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[ti]=t,e[Ro]=r,D0(e,t,!1,!1),t.stateNode=e;e:{switch(o=ih(n,r),n){case"dialog":Pt("cancel",e),Pt("close",e),i=r;break;case"iframe":case"object":case"embed":Pt("load",e),i=r;break;case"video":case"audio":for(i=0;i<ao.length;i++)Pt(ao[i],e);i=r;break;case"source":Pt("error",e),i=r;break;case"img":case"image":case"link":Pt("error",e),Pt("load",e),i=r;break;case"details":Pt("toggle",e),i=r;break;case"input":Zf(e,r),i=Xd(e,r),Pt("invalid",e);break;case"option":i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=Lt({},r,{value:void 0}),Pt("invalid",e);break;case"textarea":Qf(e,r),i=th(e,r),Pt("invalid",e);break;default:i=r}rh(n,i),u=i;for(a in u)if(u.hasOwnProperty(a)){var p=u[a];a==="style"?hv(e,p):a==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,p!=null&&uv(e,p)):a==="children"?typeof p=="string"?(n!=="textarea"||p!=="")&&bo(e,p):typeof p=="number"&&bo(e,""+p):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(_o.hasOwnProperty(a)?p!=null&&a==="onScroll"&&Pt("scroll",e):p!=null&&pp(e,a,p,o))}switch(n){case"input":kc(e),Jf(e,r,!1);break;case"textarea":kc(e),Xf(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Zi(r.value));break;case"select":e.multiple=!!r.multiple,a=r.value,a!=null?ia(e,!!r.multiple,a,!1):r.defaultValue!=null&&ia(e,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=Tl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return yn(t),null;case 6:if(e&&t.stateNode!=null)O0(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Re(166));if(n=vs(Io.current),vs(ri.current),Mc(t)){if(r=t.stateNode,n=t.memoizedProps,r[ti]=t,(a=r.nodeValue!==n)&&(e=ir,e!==null))switch(e.tag){case 3:Oc(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Oc(r.nodeValue,n,(e.mode&1)!==0)}a&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ti]=t,t.stateNode=r}return yn(t),null;case 13:if(kt(Ot),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(At&&rr!==null&&t.mode&1&&!(t.flags&128))Yv(),fa(),t.flags|=98560,a=!1;else if(a=Mc(t),r!==null&&r.dehydrated!==null){if(e===null){if(!a)throw Error(Re(318));if(a=t.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Re(317));a[ti]=t}else fa(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;yn(t),a=!1}else Or!==null&&(jh(Or),Or=null),a=!0;if(!a)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Ot.current&1?Yt===0&&(Yt=3):Zp())),t.updateQueue!==null&&(t.flags|=4),yn(t),null);case 4:return ga(),Ah(e,t),e===null&&ko(t.stateNode.containerInfo),yn(t),null;case 10:return Fp(t.type._context),yn(t),null;case 17:return Gn(t.type)&&Rl(),yn(t),null;case 19:if(kt(Ot),a=t.memoizedState,a===null)return yn(t),null;if(r=(t.flags&128)!==0,o=a.rendering,o===null)if(r)Ga(a,!1);else{if(Yt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=Ml(e),o!==null){for(t.flags|=128,Ga(a,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)a=n,e=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,e=o.dependencies,a.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return wt(Ot,Ot.current&1|2),t.child}e=e.sibling}a.tail!==null&&qt()>ya&&(t.flags|=128,r=!0,Ga(a,!1),t.lanes=4194304)}else{if(!r)if(e=Ml(o),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Ga(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!At)return yn(t),null}else 2*qt()-a.renderingStartTime>ya&&n!==1073741824&&(t.flags|=128,r=!0,Ga(a,!1),t.lanes=4194304);a.isBackwards?(o.sibling=t.child,t.child=o):(n=a.last,n!==null?n.sibling=o:t.child=o,a.last=o)}return a.tail!==null?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=qt(),t.sibling=null,n=Ot.current,wt(Ot,r?n&1|2:n&1),t):(yn(t),null);case 22:case 23:return Gp(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?tr&1073741824&&(yn(t),t.subtreeFlags&6&&(t.flags|=8192)):yn(t),null;case 24:return null;case 25:return null}throw Error(Re(156,t.tag))}function ex(e,t){switch(Tp(t),t.tag){case 1:return Gn(t.type)&&Rl(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return ga(),kt(Wn),kt(xn),Lp(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Mp(t),null;case 13:if(kt(Ot),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Re(340));fa()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return kt(Ot),null;case 4:return ga(),null;case 10:return Fp(t.type._context),null;case 22:case 23:return Gp(),null;case 24:return null;default:return null}}var Bc=!1,Sn=!1,tx=typeof WeakSet=="function"?WeakSet:Set,Le=null;function ta(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Ht(e,t,r)}else n.current=null}function Ih(e,t,n){try{n()}catch(r){Ht(e,t,r)}}var Hm=!1;function nx(e,t){if(fh=El,e=Uv(),Pp(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,u=-1,p=-1,h=0,y=0,f=e,_=null;t:for(;;){for(var w;f!==n||i!==0&&f.nodeType!==3||(u=o+i),f!==a||r!==0&&f.nodeType!==3||(p=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(w=f.firstChild)!==null;)_=f,f=w;for(;;){if(f===e)break t;if(_===n&&++h===i&&(u=o),_===a&&++y===r&&(p=o),(w=f.nextSibling)!==null)break;f=_,_=f.parentNode}f=w}n=u===-1||p===-1?null:{start:u,end:p}}else n=null}n=n||{start:0,end:0}}else n=null;for(mh={focusedElem:e,selectionRange:n},El=!1,Le=t;Le!==null;)if(t=Le,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Le=e;else for(;Le!==null;){t=Le;try{var R=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var F=R.memoizedProps,S=R.memoizedState,b=t.stateNode,x=b.getSnapshotBeforeUpdate(t.elementType===t.type?F:Fr(t.type,F),S);b.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var k=t.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Re(163))}}catch(L){Ht(t,t.return,L)}if(e=t.sibling,e!==null){e.return=t.return,Le=e;break}Le=t.return}return R=Hm,Hm=!1,R}function mo(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var a=i.destroy;i.destroy=void 0,a!==void 0&&Ih(t,n,a)}i=i.next}while(i!==r)}}function du(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Fh(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function M0(e){var t=e.alternate;t!==null&&(e.alternate=null,M0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ti],delete t[Ro],delete t[yh],delete t[jw],delete t[Bw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function L0(e){return e.tag===5||e.tag===3||e.tag===4}function Vm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||L0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Dh(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Tl));else if(r!==4&&(e=e.child,e!==null))for(Dh(e,t,n),e=e.sibling;e!==null;)Dh(e,t,n),e=e.sibling}function Nh(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(Nh(e,t,n),e=e.sibling;e!==null;)Nh(e,t,n),e=e.sibling}var dn=null,Nr=!1;function ki(e,t,n){for(n=n.child;n!==null;)j0(e,t,n),n=n.sibling}function j0(e,t,n){if(ni&&typeof ni.onCommitFiberUnmount=="function")try{ni.onCommitFiberUnmount(ru,n)}catch{}switch(n.tag){case 5:Sn||ta(n,t);case 6:var r=dn,i=Nr;dn=null,ki(e,t,n),dn=r,Nr=i,dn!==null&&(Nr?(e=dn,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):dn.removeChild(n.stateNode));break;case 18:dn!==null&&(Nr?(e=dn,n=n.stateNode,e.nodeType===8?Sd(e.parentNode,n):e.nodeType===1&&Sd(e,n),Co(e)):Sd(dn,n.stateNode));break;case 4:r=dn,i=Nr,dn=n.stateNode.containerInfo,Nr=!0,ki(e,t,n),dn=r,Nr=i;break;case 0:case 11:case 14:case 15:if(!Sn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var a=i,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&Ih(n,t,o),i=i.next}while(i!==r)}ki(e,t,n);break;case 1:if(!Sn&&(ta(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(u){Ht(n,t,u)}ki(e,t,n);break;case 21:ki(e,t,n);break;case 22:n.mode&1?(Sn=(r=Sn)||n.memoizedState!==null,ki(e,t,n),Sn=r):ki(e,t,n);break;default:ki(e,t,n)}}function qm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new tx),t.forEach(function(r){var i=dx.bind(null,e,r);n.has(r)||(n.add(r),r.then(i,i))})}}function kr(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,o=t,u=o;e:for(;u!==null;){switch(u.tag){case 5:dn=u.stateNode,Nr=!1;break e;case 3:dn=u.stateNode.containerInfo,Nr=!0;break e;case 4:dn=u.stateNode.containerInfo,Nr=!0;break e}u=u.return}if(dn===null)throw Error(Re(160));j0(a,o,i),dn=null,Nr=!1;var p=i.alternate;p!==null&&(p.return=null),i.return=null}catch(h){Ht(i,t,h)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)B0(t,e),t=t.sibling}function B0(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(kr(t,e),Qr(e),r&4){try{mo(3,e,e.return),du(3,e)}catch(F){Ht(e,e.return,F)}try{mo(5,e,e.return)}catch(F){Ht(e,e.return,F)}}break;case 1:kr(t,e),Qr(e),r&512&&n!==null&&ta(n,n.return);break;case 5:if(kr(t,e),Qr(e),r&512&&n!==null&&ta(n,n.return),e.flags&32){var i=e.stateNode;try{bo(i,"")}catch(F){Ht(e,e.return,F)}}if(r&4&&(i=e.stateNode,i!=null)){var a=e.memoizedProps,o=n!==null?n.memoizedProps:a,u=e.type,p=e.updateQueue;if(e.updateQueue=null,p!==null)try{u==="input"&&a.type==="radio"&&a.name!=null&&ov(i,a),ih(u,o);var h=ih(u,a);for(o=0;o<p.length;o+=2){var y=p[o],f=p[o+1];y==="style"?hv(i,f):y==="dangerouslySetInnerHTML"?uv(i,f):y==="children"?bo(i,f):pp(i,y,f,h)}switch(u){case"input":Yd(i,a);break;case"textarea":cv(i,a);break;case"select":var _=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var w=a.value;w!=null?ia(i,!!a.multiple,w,!1):_!==!!a.multiple&&(a.defaultValue!=null?ia(i,!!a.multiple,a.defaultValue,!0):ia(i,!!a.multiple,a.multiple?[]:"",!1))}i[Ro]=a}catch(F){Ht(e,e.return,F)}}break;case 6:if(kr(t,e),Qr(e),r&4){if(e.stateNode===null)throw Error(Re(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(F){Ht(e,e.return,F)}}break;case 3:if(kr(t,e),Qr(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Co(t.containerInfo)}catch(F){Ht(e,e.return,F)}break;case 4:kr(t,e),Qr(e);break;case 13:kr(t,e),Qr(e),i=e.child,i.flags&8192&&(a=i.memoizedState!==null,i.stateNode.isHidden=a,!a||i.alternate!==null&&i.alternate.memoizedState!==null||($p=qt())),r&4&&qm(e);break;case 22:if(y=n!==null&&n.memoizedState!==null,e.mode&1?(Sn=(h=Sn)||y,kr(t,e),Sn=h):kr(t,e),Qr(e),r&8192){if(h=e.memoizedState!==null,(e.stateNode.isHidden=h)&&!y&&e.mode&1)for(Le=e,y=e.child;y!==null;){for(f=Le=y;Le!==null;){switch(_=Le,w=_.child,_.tag){case 0:case 11:case 14:case 15:mo(4,_,_.return);break;case 1:ta(_,_.return);var R=_.stateNode;if(typeof R.componentWillUnmount=="function"){r=_,n=_.return;try{t=r,R.props=t.memoizedProps,R.state=t.memoizedState,R.componentWillUnmount()}catch(F){Ht(r,n,F)}}break;case 5:ta(_,_.return);break;case 22:if(_.memoizedState!==null){Km(f);continue}}w!==null?(w.return=_,Le=w):Km(f)}y=y.sibling}e:for(y=null,f=e;;){if(f.tag===5){if(y===null){y=f;try{i=f.stateNode,h?(a=i.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(u=f.stateNode,p=f.memoizedProps.style,o=p!=null&&p.hasOwnProperty("display")?p.display:null,u.style.display=dv("display",o))}catch(F){Ht(e,e.return,F)}}}else if(f.tag===6){if(y===null)try{f.stateNode.nodeValue=h?"":f.memoizedProps}catch(F){Ht(e,e.return,F)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;y===f&&(y=null),f=f.return}y===f&&(y=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:kr(t,e),Qr(e),r&4&&qm(e);break;case 21:break;default:kr(t,e),Qr(e)}}function Qr(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(L0(n)){var r=n;break e}n=n.return}throw Error(Re(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(bo(i,""),r.flags&=-33);var a=Vm(e);Nh(e,a,i);break;case 3:case 4:var o=r.stateNode.containerInfo,u=Vm(e);Dh(e,u,o);break;default:throw Error(Re(161))}}catch(p){Ht(e,e.return,p)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function rx(e,t,n){Le=e,U0(e)}function U0(e,t,n){for(var r=(e.mode&1)!==0;Le!==null;){var i=Le,a=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Bc;if(!o){var u=i.alternate,p=u!==null&&u.memoizedState!==null||Sn;u=Bc;var h=Sn;if(Bc=o,(Sn=p)&&!h)for(Le=i;Le!==null;)o=Le,p=o.child,o.tag===22&&o.memoizedState!==null?$m(i):p!==null?(p.return=o,Le=p):$m(i);for(;a!==null;)Le=a,U0(a),a=a.sibling;Le=i,Bc=u,Sn=h}zm(e)}else i.subtreeFlags&8772&&a!==null?(a.return=i,Le=a):zm(e)}}function zm(e){for(;Le!==null;){var t=Le;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Sn||du(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Sn)if(n===null)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:Fr(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;a!==null&&Tm(t,a,r);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Tm(t,o,n)}break;case 5:var u=t.stateNode;if(n===null&&t.flags&4){n=u;var p=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":p.autoFocus&&n.focus();break;case"img":p.src&&(n.src=p.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var h=t.alternate;if(h!==null){var y=h.memoizedState;if(y!==null){var f=y.dehydrated;f!==null&&Co(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Re(163))}Sn||t.flags&512&&Fh(t)}catch(_){Ht(t,t.return,_)}}if(t===e){Le=null;break}if(n=t.sibling,n!==null){n.return=t.return,Le=n;break}Le=t.return}}function Km(e){for(;Le!==null;){var t=Le;if(t===e){Le=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Le=n;break}Le=t.return}}function $m(e){for(;Le!==null;){var t=Le;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{du(4,t)}catch(p){Ht(t,n,p)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var i=t.return;try{r.componentDidMount()}catch(p){Ht(t,i,p)}}var a=t.return;try{Fh(t)}catch(p){Ht(t,a,p)}break;case 5:var o=t.return;try{Fh(t)}catch(p){Ht(t,o,p)}}}catch(p){Ht(t,t.return,p)}if(t===e){Le=null;break}var u=t.sibling;if(u!==null){u.return=t.return,Le=u;break}Le=t.return}}var ix=Math.ceil,Bl=Si.ReactCurrentDispatcher,zp=Si.ReactCurrentOwner,_r=Si.ReactCurrentBatchConfig,ct=0,an=null,Gt=null,hn=0,tr=0,na=ts(0),Yt=0,Oo=null,Ts=0,hu=0,Kp=0,go=null,zn=null,$p=0,ya=1/0,li=null,Ul=!1,Oh=null,$i=null,Uc=!1,Ui=null,Hl=0,vo=0,Mh=null,rl=-1,il=0;function Dn(){return ct&6?qt():rl!==-1?rl:rl=qt()}function Wi(e){return e.mode&1?ct&2&&hn!==0?hn&-hn:Hw.transition!==null?(il===0&&(il=Cv()),il):(e=vt,e!==0||(e=window.event,e=e===void 0?16:Iv(e.type)),e):1}function jr(e,t,n,r){if(50<vo)throw vo=0,Mh=null,Error(Re(185));ec(e,n,r),(!(ct&2)||e!==an)&&(e===an&&(!(ct&2)&&(hu|=n),Yt===4&&Mi(e,hn)),Zn(e,r),n===1&&ct===0&&!(t.mode&1)&&(ya=qt()+500,cu&&ns()))}function Zn(e,t){var n=e.callbackNode;HS(e,t);var r=Cl(e,e===an?hn:0);if(r===0)n!==null&&tm(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&tm(n),t===1)e.tag===0?Uw(Wm.bind(null,e)):Jv(Wm.bind(null,e)),Mw(function(){!(ct&6)&&ns()}),n=null;else{switch(Ev(r)){case 1:n=yp;break;case 4:n=wv;break;case 16:n=xl;break;case 536870912:n=xv;break;default:n=xl}n=G0(n,H0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function H0(e,t){if(rl=-1,il=0,ct&6)throw Error(Re(327));var n=e.callbackNode;if(la()&&e.callbackNode!==n)return null;var r=Cl(e,e===an?hn:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Vl(e,r);else{t=r;var i=ct;ct|=2;var a=q0();(an!==e||hn!==t)&&(li=null,ya=qt()+500,Ss(e,t));do try{ox();break}catch(u){V0(e,u)}while(!0);Ip(),Bl.current=a,ct=i,Gt!==null?t=0:(an=null,hn=0,t=Yt)}if(t!==0){if(t===2&&(i=lh(e),i!==0&&(r=i,t=Lh(e,i))),t===1)throw n=Oo,Ss(e,0),Mi(e,r),Zn(e,qt()),n;if(t===6)Mi(e,r);else{if(i=e.current.alternate,!(r&30)&&!sx(i)&&(t=Vl(e,r),t===2&&(a=lh(e),a!==0&&(r=a,t=Lh(e,a))),t===1))throw n=Oo,Ss(e,0),Mi(e,r),Zn(e,qt()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(Re(345));case 2:hs(e,zn,li);break;case 3:if(Mi(e,r),(r&130023424)===r&&(t=$p+500-qt(),10<t)){if(Cl(e,0)!==0)break;if(i=e.suspendedLanes,(i&r)!==r){Dn(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=vh(hs.bind(null,e,zn,li),t);break}hs(e,zn,li);break;case 4:if(Mi(e,r),(r&4194240)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-Lr(r);a=1<<o,o=t[o],o>i&&(i=o),r&=~a}if(r=i,r=qt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ix(r/1960))-r,10<r){e.timeoutHandle=vh(hs.bind(null,e,zn,li),r);break}hs(e,zn,li);break;case 5:hs(e,zn,li);break;default:throw Error(Re(329))}}}return Zn(e,qt()),e.callbackNode===n?H0.bind(null,e):null}function Lh(e,t){var n=go;return e.current.memoizedState.isDehydrated&&(Ss(e,t).flags|=256),e=Vl(e,t),e!==2&&(t=zn,zn=n,t!==null&&jh(t)),e}function jh(e){zn===null?zn=e:zn.push.apply(zn,e)}function sx(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],a=i.getSnapshot;i=i.value;try{if(!Hr(a(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Mi(e,t){for(t&=~Kp,t&=~hu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Lr(t),r=1<<n;e[n]=-1,t&=~r}}function Wm(e){if(ct&6)throw Error(Re(327));la();var t=Cl(e,0);if(!(t&1))return Zn(e,qt()),null;var n=Vl(e,t);if(e.tag!==0&&n===2){var r=lh(e);r!==0&&(t=r,n=Lh(e,r))}if(n===1)throw n=Oo,Ss(e,0),Mi(e,t),Zn(e,qt()),n;if(n===6)throw Error(Re(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,hs(e,zn,li),Zn(e,qt()),null}function Wp(e,t){var n=ct;ct|=1;try{return e(t)}finally{ct=n,ct===0&&(ya=qt()+500,cu&&ns())}}function Rs(e){Ui!==null&&Ui.tag===0&&!(ct&6)&&la();var t=ct;ct|=1;var n=_r.transition,r=vt;try{if(_r.transition=null,vt=1,e)return e()}finally{vt=r,_r.transition=n,ct=t,!(ct&6)&&ns()}}function Gp(){tr=na.current,kt(na)}function Ss(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Ow(n)),Gt!==null)for(n=Gt.return;n!==null;){var r=n;switch(Tp(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Rl();break;case 3:ga(),kt(Wn),kt(xn),Lp();break;case 5:Mp(r);break;case 4:ga();break;case 13:kt(Ot);break;case 19:kt(Ot);break;case 10:Fp(r.type._context);break;case 22:case 23:Gp()}n=n.return}if(an=e,Gt=e=Gi(e.current,null),hn=tr=t,Yt=0,Oo=null,Kp=hu=Ts=0,zn=go=null,gs!==null){for(t=0;t<gs.length;t++)if(n=gs[t],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=i,r.next=o}n.pending=r}gs=null}return e}function V0(e,t){do{var n=Gt;try{if(Ip(),el.current=jl,Ll){for(var r=Mt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Ll=!1}if(ks=0,sn=Xt=Mt=null,fo=!1,Fo=0,zp.current=null,n===null||n.return===null){Yt=1,Oo=t,Gt=null;break}e:{var a=e,o=n.return,u=n,p=t;if(t=hn,u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){var h=p,y=u,f=y.tag;if(!(y.mode&1)&&(f===0||f===11||f===15)){var _=y.alternate;_?(y.updateQueue=_.updateQueue,y.memoizedState=_.memoizedState,y.lanes=_.lanes):(y.updateQueue=null,y.memoizedState=null)}var w=Nm(o);if(w!==null){w.flags&=-257,Om(w,o,u,a,t),w.mode&1&&Dm(a,h,t),t=w,p=h;var R=t.updateQueue;if(R===null){var F=new Set;F.add(p),t.updateQueue=F}else R.add(p);break e}else{if(!(t&1)){Dm(a,h,t),Zp();break e}p=Error(Re(426))}}else if(At&&u.mode&1){var S=Nm(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),Om(S,o,u,a,t),Rp(va(p,u));break e}}a=p=va(p,u),Yt!==4&&(Yt=2),go===null?go=[a]:go.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t;var b=E0(a,p,t);km(a,b);break e;case 1:u=p;var x=a.type,k=a.stateNode;if(!(a.flags&128)&&(typeof x.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&($i===null||!$i.has(k)))){a.flags|=65536,t&=-t,a.lanes|=t;var L=P0(a,u,t);km(a,L);break e}}a=a.return}while(a!==null)}K0(n)}catch(G){t=G,Gt===n&&n!==null&&(Gt=n=n.return);continue}break}while(!0)}function q0(){var e=Bl.current;return Bl.current=jl,e===null?jl:e}function Zp(){(Yt===0||Yt===3||Yt===2)&&(Yt=4),an===null||!(Ts&268435455)&&!(hu&268435455)||Mi(an,hn)}function Vl(e,t){var n=ct;ct|=2;var r=q0();(an!==e||hn!==t)&&(li=null,Ss(e,t));do try{ax();break}catch(i){V0(e,i)}while(!0);if(Ip(),ct=n,Bl.current=r,Gt!==null)throw Error(Re(261));return an=null,hn=0,Yt}function ax(){for(;Gt!==null;)z0(Gt)}function ox(){for(;Gt!==null&&!FS();)z0(Gt)}function z0(e){var t=W0(e.alternate,e,tr);e.memoizedProps=e.pendingProps,t===null?K0(e):Gt=t,zp.current=null}function K0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=ex(n,t),n!==null){n.flags&=32767,Gt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Yt=6,Gt=null;return}}else if(n=Yw(n,t,tr),n!==null){Gt=n;return}if(t=t.sibling,t!==null){Gt=t;return}Gt=t=e}while(t!==null);Yt===0&&(Yt=5)}function hs(e,t,n){var r=vt,i=_r.transition;try{_r.transition=null,vt=1,cx(e,t,n,r)}finally{_r.transition=i,vt=r}return null}function cx(e,t,n,r){do la();while(Ui!==null);if(ct&6)throw Error(Re(327));n=e.finishedWork;var i=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Re(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(VS(e,a),e===an&&(Gt=an=null,hn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Uc||(Uc=!0,G0(xl,function(){return la(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=_r.transition,_r.transition=null;var o=vt;vt=1;var u=ct;ct|=4,zp.current=null,nx(e,n),B0(n,e),Tw(mh),El=!!fh,mh=fh=null,e.current=n,rx(n),DS(),ct=u,vt=o,_r.transition=a}else e.current=n;if(Uc&&(Uc=!1,Ui=e,Hl=i),a=e.pendingLanes,a===0&&($i=null),MS(n.stateNode),Zn(e,qt()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ul)throw Ul=!1,e=Oh,Oh=null,e;return Hl&1&&e.tag!==0&&la(),a=e.pendingLanes,a&1?e===Mh?vo++:(vo=0,Mh=e):vo=0,ns(),null}function la(){if(Ui!==null){var e=Ev(Hl),t=_r.transition,n=vt;try{if(_r.transition=null,vt=16>e?16:e,Ui===null)var r=!1;else{if(e=Ui,Ui=null,Hl=0,ct&6)throw Error(Re(331));var i=ct;for(ct|=4,Le=e.current;Le!==null;){var a=Le,o=a.child;if(Le.flags&16){var u=a.deletions;if(u!==null){for(var p=0;p<u.length;p++){var h=u[p];for(Le=h;Le!==null;){var y=Le;switch(y.tag){case 0:case 11:case 15:mo(8,y,a)}var f=y.child;if(f!==null)f.return=y,Le=f;else for(;Le!==null;){y=Le;var _=y.sibling,w=y.return;if(M0(y),y===h){Le=null;break}if(_!==null){_.return=w,Le=_;break}Le=w}}}var R=a.alternate;if(R!==null){var F=R.child;if(F!==null){R.child=null;do{var S=F.sibling;F.sibling=null,F=S}while(F!==null)}}Le=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,Le=o;else e:for(;Le!==null;){if(a=Le,a.flags&2048)switch(a.tag){case 0:case 11:case 15:mo(9,a,a.return)}var b=a.sibling;if(b!==null){b.return=a.return,Le=b;break e}Le=a.return}}var x=e.current;for(Le=x;Le!==null;){o=Le;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,Le=k;else e:for(o=x;Le!==null;){if(u=Le,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:du(9,u)}}catch(G){Ht(u,u.return,G)}if(u===o){Le=null;break e}var L=u.sibling;if(L!==null){L.return=u.return,Le=L;break e}Le=u.return}}if(ct=i,ns(),ni&&typeof ni.onPostCommitFiberRoot=="function")try{ni.onPostCommitFiberRoot(ru,e)}catch{}r=!0}return r}finally{vt=n,_r.transition=t}}return!1}function Gm(e,t,n){t=va(n,t),t=E0(e,t,1),e=Ki(e,t,1),t=Dn(),e!==null&&(ec(e,1,t),Zn(e,t))}function Ht(e,t,n){if(e.tag===3)Gm(e,e,n);else for(;t!==null;){if(t.tag===3){Gm(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&($i===null||!$i.has(r))){e=va(n,e),e=P0(t,e,1),t=Ki(t,e,1),e=Dn(),t!==null&&(ec(t,1,e),Zn(t,e));break}}t=t.return}}function lx(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Dn(),e.pingedLanes|=e.suspendedLanes&n,an===e&&(hn&n)===n&&(Yt===4||Yt===3&&(hn&130023424)===hn&&500>qt()-$p?Ss(e,0):Kp|=n),Zn(e,t)}function $0(e,t){t===0&&(e.mode&1?(t=Ac,Ac<<=1,!(Ac&130023424)&&(Ac=4194304)):t=1);var n=Dn();e=vi(e,t),e!==null&&(ec(e,t,n),Zn(e,n))}function ux(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),$0(e,n)}function dx(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Re(314))}r!==null&&r.delete(t),$0(e,n)}var W0;W0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Wn.current)$n=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return $n=!1,Xw(e,t,n);$n=!!(e.flags&131072)}else $n=!1,At&&t.flags&1048576&&Qv(t,Fl,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;nl(e,t),e=t.pendingProps;var i=pa(t,xn.current);ca(t,n),i=Bp(null,t,r,e,i,n);var a=Up();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Gn(r)?(a=!0,Al(t)):a=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Np(t),i.updater=uu,t.stateNode=i,i._reactInternals=t,Ch(t,r,e,n),t=kh(null,t,r,!0,a,n)):(t.tag=0,At&&a&&kp(t),An(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(nl(e,t),e=t.pendingProps,i=r._init,r=i(r._payload),t.type=r,i=t.tag=px(r),e=Fr(r,e),i){case 0:t=Ph(null,t,r,e,n);break e;case 1:t=jm(null,t,r,e,n);break e;case 11:t=Mm(null,t,r,e,n);break e;case 14:t=Lm(null,t,r,Fr(r.type,e),n);break e}throw Error(Re(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Fr(r,i),Ph(e,t,r,i,n);case 1:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Fr(r,i),jm(e,t,r,i,n);case 3:e:{if(A0(t),e===null)throw Error(Re(387));r=t.pendingProps,a=t.memoizedState,i=a.element,r0(e,t),Ol(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,t.flags&256){i=va(Error(Re(423)),t),t=Bm(e,t,r,n,i);break e}else if(r!==i){i=va(Error(Re(424)),t),t=Bm(e,t,r,n,i);break e}else for(rr=zi(t.stateNode.containerInfo.firstChild),ir=t,At=!0,Or=null,n=t0(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(fa(),r===i){t=yi(e,t,n);break e}An(e,t,r,n)}t=t.child}return t;case 5:return i0(t),e===null&&Sh(t),r=t.type,i=t.pendingProps,a=e!==null?e.memoizedProps:null,o=i.children,gh(r,i)?o=null:a!==null&&gh(r,a)&&(t.flags|=32),R0(e,t),An(e,t,o,n),t.child;case 6:return e===null&&Sh(t),null;case 13:return I0(e,t,n);case 4:return Op(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=ma(t,null,r,n):An(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Fr(r,i),Mm(e,t,r,i,n);case 7:return An(e,t,t.pendingProps,n),t.child;case 8:return An(e,t,t.pendingProps.children,n),t.child;case 12:return An(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,wt(Dl,r._currentValue),r._currentValue=o,a!==null)if(Hr(a.value,o)){if(a.children===i.children&&!Wn.current){t=yi(e,t,n);break e}}else for(a=t.child,a!==null&&(a.return=t);a!==null;){var u=a.dependencies;if(u!==null){o=a.child;for(var p=u.firstContext;p!==null;){if(p.context===r){if(a.tag===1){p=fi(-1,n&-n),p.tag=2;var h=a.updateQueue;if(h!==null){h=h.shared;var y=h.pending;y===null?p.next=p:(p.next=y.next,y.next=p),h.pending=p}}a.lanes|=n,p=a.alternate,p!==null&&(p.lanes|=n),wh(a.return,n,t),u.lanes|=n;break}p=p.next}}else if(a.tag===10)o=a.type===t.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(Re(341));o.lanes|=n,u=o.alternate,u!==null&&(u.lanes|=n),wh(o,n,t),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===t){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}An(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,ca(t,n),i=br(i),r=r(i),t.flags|=1,An(e,t,r,n),t.child;case 14:return r=t.type,i=Fr(r,t.pendingProps),i=Fr(r.type,i),Lm(e,t,r,i,n);case 15:return k0(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Fr(r,i),nl(e,t),t.tag=1,Gn(r)?(e=!0,Al(t)):e=!1,ca(t,n),C0(t,r,i),Ch(t,r,i,n),kh(null,t,r,!0,e,n);case 19:return F0(e,t,n);case 22:return T0(e,t,n)}throw Error(Re(156,t.tag))};function G0(e,t){return Sv(e,t)}function hx(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yr(e,t,n,r){return new hx(e,t,n,r)}function Jp(e){return e=e.prototype,!(!e||!e.isReactComponent)}function px(e){if(typeof e=="function")return Jp(e)?1:0;if(e!=null){if(e=e.$$typeof,e===mp)return 11;if(e===gp)return 14}return 2}function Gi(e,t){var n=e.alternate;return n===null?(n=yr(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function sl(e,t,n,r,i,a){var o=2;if(r=e,typeof e=="function")Jp(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case $s:return ws(n.children,i,a,t);case fp:o=8,i|=8;break;case Gd:return e=yr(12,n,t,i|2),e.elementType=Gd,e.lanes=a,e;case Zd:return e=yr(13,n,t,i),e.elementType=Zd,e.lanes=a,e;case Jd:return e=yr(19,n,t,i),e.elementType=Jd,e.lanes=a,e;case iv:return pu(n,i,a,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case nv:o=10;break e;case rv:o=9;break e;case mp:o=11;break e;case gp:o=14;break e;case Di:o=16,r=null;break e}throw Error(Re(130,e==null?e:typeof e,""))}return t=yr(o,n,t,i),t.elementType=e,t.type=r,t.lanes=a,t}function ws(e,t,n,r){return e=yr(7,e,r,t),e.lanes=n,e}function pu(e,t,n,r){return e=yr(22,e,r,t),e.elementType=iv,e.lanes=n,e.stateNode={isHidden:!1},e}function Rd(e,t,n){return e=yr(6,e,null,t),e.lanes=n,e}function Ad(e,t,n){return t=yr(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function fx(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ud(0),this.expirationTimes=ud(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ud(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Qp(e,t,n,r,i,a,o,u,p){return e=new fx(e,t,n,u,p),t===1?(t=1,a===!0&&(t|=8)):t=0,a=yr(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Np(a),e}function mx(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ks,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function Z0(e){if(!e)return Ji;e=e._reactInternals;e:{if(Ns(e)!==e||e.tag!==1)throw Error(Re(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Gn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Re(171))}if(e.tag===1){var n=e.type;if(Gn(n))return Zv(e,n,t)}return t}function J0(e,t,n,r,i,a,o,u,p){return e=Qp(n,r,!0,e,i,a,o,u,p),e.context=Z0(null),n=e.current,r=Dn(),i=Wi(n),a=fi(r,i),a.callback=t??null,Ki(n,a,i),e.current.lanes=i,ec(e,i,r),Zn(e,r),e}function fu(e,t,n,r){var i=t.current,a=Dn(),o=Wi(i);return n=Z0(n),t.context===null?t.context=n:t.pendingContext=n,t=fi(a,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Ki(i,t,o),e!==null&&(jr(e,i,o,a),Yc(e,i,o)),o}function ql(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Zm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Xp(e,t){Zm(e,t),(e=e.alternate)&&Zm(e,t)}function gx(){return null}var Q0=typeof reportError=="function"?reportError:function(e){console.error(e)};function Yp(e){this._internalRoot=e}mu.prototype.render=Yp.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Re(409));fu(e,t,null,null)};mu.prototype.unmount=Yp.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Rs(function(){fu(null,e,null,null)}),t[gi]=null}};function mu(e){this._internalRoot=e}mu.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tv();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Oi.length&&t!==0&&t<Oi[n].priority;n++);Oi.splice(n,0,e),n===0&&Av(e)}};function ef(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function gu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Jm(){}function vx(e,t,n,r,i){if(i){if(typeof r=="function"){var a=r;r=function(){var h=ql(o);a.call(h)}}var o=J0(t,r,e,0,null,!1,!1,"",Jm);return e._reactRootContainer=o,e[gi]=o.current,ko(e.nodeType===8?e.parentNode:e),Rs(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof r=="function"){var u=r;r=function(){var h=ql(p);u.call(h)}}var p=Qp(e,0,!1,null,null,!1,!1,"",Jm);return e._reactRootContainer=p,e[gi]=p.current,ko(e.nodeType===8?e.parentNode:e),Rs(function(){fu(t,p,n,r)}),p}function vu(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a;if(typeof i=="function"){var u=i;i=function(){var p=ql(o);u.call(p)}}fu(t,o,e,i)}else o=vx(n,t,e,i,r);return ql(o)}Pv=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=so(t.pendingLanes);n!==0&&(_p(t,n|1),Zn(t,qt()),!(ct&6)&&(ya=qt()+500,ns()))}break;case 13:Rs(function(){var r=vi(e,1);if(r!==null){var i=Dn();jr(r,e,1,i)}}),Xp(e,1)}};bp=function(e){if(e.tag===13){var t=vi(e,134217728);if(t!==null){var n=Dn();jr(t,e,134217728,n)}Xp(e,134217728)}};kv=function(e){if(e.tag===13){var t=Wi(e),n=vi(e,t);if(n!==null){var r=Dn();jr(n,e,t,r)}Xp(e,t)}};Tv=function(){return vt};Rv=function(e,t){var n=vt;try{return vt=e,t()}finally{vt=n}};ah=function(e,t,n){switch(t){case"input":if(Yd(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ou(r);if(!i)throw Error(Re(90));av(r),Yd(r,i)}}}break;case"textarea":cv(e,n);break;case"select":t=n.value,t!=null&&ia(e,!!n.multiple,t,!1)}};mv=Wp;gv=Rs;var yx={usingClientEntryPoint:!1,Events:[nc,Js,ou,pv,fv,Wp]},Za={findFiberByHostInstance:ms,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_x={bundleType:Za.bundleType,version:Za.version,rendererPackageName:Za.rendererPackageName,rendererConfig:Za.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Si.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=_v(e),e===null?null:e.stateNode},findFiberByHostInstance:Za.findFiberByHostInstance||gx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hc.isDisabled&&Hc.supportsFiber)try{ru=Hc.inject(_x),ni=Hc}catch{}}ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yx;ar.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ef(t))throw Error(Re(200));return mx(e,t,null,n)};ar.createRoot=function(e,t){if(!ef(e))throw Error(Re(299));var n=!1,r="",i=Q0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=Qp(e,1,!1,null,null,n,!1,r,i),e[gi]=t.current,ko(e.nodeType===8?e.parentNode:e),new Yp(t)};ar.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Re(188)):(e=Object.keys(e).join(","),Error(Re(268,e)));return e=_v(t),e=e===null?null:e.stateNode,e};ar.flushSync=function(e){return Rs(e)};ar.hydrate=function(e,t,n){if(!gu(t))throw Error(Re(200));return vu(null,e,t,!0,n)};ar.hydrateRoot=function(e,t,n){if(!ef(e))throw Error(Re(405));var r=n!=null&&n.hydratedSources||null,i=!1,a="",o=Q0;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=J0(t,null,e,1,n??null,i,!1,a,o),e[gi]=t.current,ko(e),r)for(e=0;e<r.length;e++)n=r[e],i=n._getVersion,i=i(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new mu(t)};ar.render=function(e,t,n){if(!gu(t))throw Error(Re(200));return vu(null,e,t,!1,n)};ar.unmountComponentAtNode=function(e){if(!gu(e))throw Error(Re(40));return e._reactRootContainer?(Rs(function(){vu(null,null,e,!1,function(){e._reactRootContainer=null,e[gi]=null})}),!0):!1};ar.unstable_batchedUpdates=Wp;ar.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!gu(n))throw Error(Re(200));if(e==null||e._reactInternals===void 0)throw Error(Re(38));return vu(e,t,n,!1,r)};ar.version="18.3.1-next-f1338f8080-20240426";function X0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(X0)}catch(e){console.error(e)}}X0(),qg.exports=ar;var bx=qg.exports,Y0,Qm=bx;Y0=Qm.createRoot,Qm.hydrateRoot;var Sx=Object.create,yu=Object.defineProperty,wx=Object.defineProperties,xx=Object.getOwnPropertyDescriptor,Cx=Object.getOwnPropertyDescriptors,tf=Object.getOwnPropertyNames,Xm=Object.getOwnPropertySymbols,Ex=Object.getPrototypeOf,ey=Object.prototype.hasOwnProperty,Px=Object.prototype.propertyIsEnumerable,ua=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),nf=e=>{throw TypeError(e)},_i=Math.pow,Bh=(e,t,n)=>t in e?yu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ee=(e,t)=>{for(var n in t||(t={}))ey.call(t,n)&&Bh(e,n,t[n]);if(Xm)for(var n of Xm(t))Px.call(t,n)&&Bh(e,n,t[n]);return e},de=(e,t)=>wx(e,Cx(t)),kx=(e,t)=>function(){return e&&(t=(0,e[tf(e)[0]])(e=0)),t},fe=(e,t)=>function(){return t||(0,e[tf(e)[0]])((t={exports:{}}).exports,t),t.exports},ty=(e,t)=>{for(var n in t)yu(e,n,{get:t[n],enumerable:!0})},Tx=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of tf(t))!ey.call(e,i)&&i!==n&&yu(e,i,{get:()=>t[i],enumerable:!(r=xx(t,i))||r.enumerable});return e},Xn=(e,t,n)=>(n=e!=null?Sx(Ex(e)):{},Tx(!e||!e.__esModule?yu(n,"default",{value:e,enumerable:!0}):n,e)),ce=(e,t,n)=>Bh(e,typeof t!="symbol"?t+"":t,n),ny=(e,t,n)=>t.has(e)||nf("Cannot "+n),Je=(e,t,n)=>(ny(e,t,"read from private field"),n?n.call(e):t.get(e)),_n=(e,t,n)=>t.has(e)?nf("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Rt=(e,t,n,r)=>(ny(e,t,"write to private field"),t.set(e,n),n),B=(e,t,n)=>new Promise((r,i)=>{var a=p=>{try{u(n.next(p))}catch(h){i(h)}},o=p=>{try{u(n.throw(p))}catch(h){i(h)}},u=p=>p.done?r(p.value):Promise.resolve(p.value).then(a,o);u((n=n.apply(e,t)).next())}),_a=function(e,t){this[0]=e,this[1]=t},ry=(e,t,n)=>{var r=(o,u,p,h)=>{try{var y=n[o](u),f=(u=y.value)instanceof _a,_=y.done;Promise.resolve(f?u[0]:u).then(w=>f?r(o==="return"?o:"next",u[1]?{done:w.done,value:w.value}:w,p,h):p({value:w,done:_})).catch(w=>r("throw",w,p,h))}catch(w){h(w)}},i=o=>a[o]=u=>new Promise((p,h)=>r(o,u,p,h)),a={};return n=n.apply(e,t),a[ua("asyncIterator")]=()=>a,i("next"),i("throw"),i("return"),a},iy=e=>{var t=e[ua("asyncIterator")],n=!1,r,i={};return t==null?(t=e[ua("iterator")](),r=a=>i[a]=o=>t[a](o)):(t=t.call(e),r=a=>i[a]=o=>{if(n){if(n=!1,a==="throw")throw o;return o}return n=!0,{done:!1,value:new _a(new Promise(u=>{var p=t[a](o);p instanceof Object||nf("Object expected"),u(p)}),1)}}),i[ua("iterator")]=()=>i,r("next"),"throw"in t?r("throw"):i.throw=a=>{throw a},"return"in t&&r("return"),i},Rx=(e,t,n)=>(t=e[ua("asyncIterator")])?t.call(e):(e=e[ua("iterator")](),t={},n=(r,i)=>(i=e[r])&&(t[r]=a=>new Promise((o,u,p)=>(a=i.call(e,a),p=a.done,Promise.resolve(a.value).then(h=>o({value:h,done:p}),u)))),n("next"),n("return"),t),da,W=kx({"shims/process.js"(){da=void 0}}),Ax=fe({"../../node_modules/.pnpm/bowser@2.11.0/node_modules/bowser/es5.js"(e,t){W(),function(n,r){typeof e=="object"&&typeof t=="object"?t.exports=r():typeof define=="function"&&define.amd?define([],r):typeof e=="object"?e.bowser=r():n.bowser=r()}(e,function(){return function(n){var r={};function i(a){if(r[a])return r[a].exports;var o=r[a]={i:a,l:!1,exports:{}};return n[a].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=n,i.c=r,i.d=function(a,o,u){i.o(a,o)||Object.defineProperty(a,o,{enumerable:!0,get:u})},i.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},i.t=function(a,o){if(1&o&&(a=i(a)),8&o||4&o&&typeof a=="object"&&a&&a.__esModule)return a;var u=Object.create(null);if(i.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:a}),2&o&&typeof a!="string")for(var p in a)i.d(u,p,(function(h){return a[h]}).bind(null,p));return u},i.n=function(a){var o=a&&a.__esModule?function(){return a.default}:function(){return a};return i.d(o,"a",o),o},i.o=function(a,o){return Object.prototype.hasOwnProperty.call(a,o)},i.p="",i(i.s=90)}({17:function(n,r,i){r.__esModule=!0,r.default=void 0;var a=i(18),o=function(){function u(){}return u.getFirstMatch=function(p,h){var y=h.match(p);return y&&y.length>0&&y[1]||""},u.getSecondMatch=function(p,h){var y=h.match(p);return y&&y.length>1&&y[2]||""},u.matchAndReturnConst=function(p,h,y){if(p.test(h))return y},u.getWindowsVersionName=function(p){switch(p){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},u.getMacOSVersionName=function(p){var h=p.split(".").splice(0,2).map(function(y){return parseInt(y,10)||0});if(h.push(0),h[0]===10)switch(h[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},u.getAndroidVersionName=function(p){var h=p.split(".").splice(0,2).map(function(y){return parseInt(y,10)||0});if(h.push(0),!(h[0]===1&&h[1]<5))return h[0]===1&&h[1]<6?"Cupcake":h[0]===1&&h[1]>=6?"Donut":h[0]===2&&h[1]<2?"Eclair":h[0]===2&&h[1]===2?"Froyo":h[0]===2&&h[1]>2?"Gingerbread":h[0]===3?"Honeycomb":h[0]===4&&h[1]<1?"Ice Cream Sandwich":h[0]===4&&h[1]<4?"Jelly Bean":h[0]===4&&h[1]>=4?"KitKat":h[0]===5?"Lollipop":h[0]===6?"Marshmallow":h[0]===7?"Nougat":h[0]===8?"Oreo":h[0]===9?"Pie":void 0},u.getVersionPrecision=function(p){return p.split(".").length},u.compareVersions=function(p,h,y){y===void 0&&(y=!1);var f=u.getVersionPrecision(p),_=u.getVersionPrecision(h),w=Math.max(f,_),R=0,F=u.map([p,h],function(S){var b=w-u.getVersionPrecision(S),x=S+new Array(b+1).join(".0");return u.map(x.split("."),function(k){return new Array(20-k.length).join("0")+k}).reverse()});for(y&&(R=w-Math.min(f,_)),w-=1;w>=R;){if(F[0][w]>F[1][w])return 1;if(F[0][w]===F[1][w]){if(w===R)return 0;w-=1}else if(F[0][w]<F[1][w])return-1}},u.map=function(p,h){var y,f=[];if(Array.prototype.map)return Array.prototype.map.call(p,h);for(y=0;y<p.length;y+=1)f.push(h(p[y]));return f},u.find=function(p,h){var y,f;if(Array.prototype.find)return Array.prototype.find.call(p,h);for(y=0,f=p.length;y<f;y+=1){var _=p[y];if(h(_,y))return _}},u.assign=function(p){for(var h,y,f=p,_=arguments.length,w=new Array(_>1?_-1:0),R=1;R<_;R++)w[R-1]=arguments[R];if(Object.assign)return Object.assign.apply(Object,[p].concat(w));var F=function(){var S=w[h];typeof S=="object"&&S!==null&&Object.keys(S).forEach(function(b){f[b]=S[b]})};for(h=0,y=w.length;h<y;h+=1)F();return p},u.getBrowserAlias=function(p){return a.BROWSER_ALIASES_MAP[p]},u.getBrowserTypeByAlias=function(p){return a.BROWSER_MAP[p]||""},u}();r.default=o,n.exports=r.default},18:function(n,r,i){r.__esModule=!0,r.ENGINE_MAP=r.OS_MAP=r.PLATFORMS_MAP=r.BROWSER_MAP=r.BROWSER_ALIASES_MAP=void 0,r.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},r.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},r.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},r.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},r.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(n,r,i){r.__esModule=!0,r.default=void 0;var a,o=(a=i(91))&&a.__esModule?a:{default:a},u=i(18);function p(y,f){for(var _=0;_<f.length;_++){var w=f[_];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(y,w.key,w)}}var h=function(){function y(){}var f,_,w;return y.getParser=function(R,F){if(F===void 0&&(F=!1),typeof R!="string")throw new Error("UserAgent should be a string");return new o.default(R,F)},y.parse=function(R){return new o.default(R).getResult()},f=y,w=[{key:"BROWSER_MAP",get:function(){return u.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return u.ENGINE_MAP}},{key:"OS_MAP",get:function(){return u.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return u.PLATFORMS_MAP}}],(_=null)&&p(f.prototype,_),w&&p(f,w),y}();r.default=h,n.exports=r.default},91:function(n,r,i){r.__esModule=!0,r.default=void 0;var a=y(i(92)),o=y(i(93)),u=y(i(94)),p=y(i(95)),h=y(i(17));function y(_){return _&&_.__esModule?_:{default:_}}var f=function(){function _(R,F){if(F===void 0&&(F=!1),R==null||R==="")throw new Error("UserAgent parameter can't be empty");this._ua=R,this.parsedResult={},F!==!0&&this.parse()}var w=_.prototype;return w.getUA=function(){return this._ua},w.test=function(R){return R.test(this._ua)},w.parseBrowser=function(){var R=this;this.parsedResult.browser={};var F=h.default.find(a.default,function(S){if(typeof S.test=="function")return S.test(R);if(S.test instanceof Array)return S.test.some(function(b){return R.test(b)});throw new Error("Browser's test function is not valid")});return F&&(this.parsedResult.browser=F.describe(this.getUA())),this.parsedResult.browser},w.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},w.getBrowserName=function(R){return R?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},w.getBrowserVersion=function(){return this.getBrowser().version},w.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},w.parseOS=function(){var R=this;this.parsedResult.os={};var F=h.default.find(o.default,function(S){if(typeof S.test=="function")return S.test(R);if(S.test instanceof Array)return S.test.some(function(b){return R.test(b)});throw new Error("Browser's test function is not valid")});return F&&(this.parsedResult.os=F.describe(this.getUA())),this.parsedResult.os},w.getOSName=function(R){var F=this.getOS().name;return R?String(F).toLowerCase()||"":F||""},w.getOSVersion=function(){return this.getOS().version},w.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},w.getPlatformType=function(R){R===void 0&&(R=!1);var F=this.getPlatform().type;return R?String(F).toLowerCase()||"":F||""},w.parsePlatform=function(){var R=this;this.parsedResult.platform={};var F=h.default.find(u.default,function(S){if(typeof S.test=="function")return S.test(R);if(S.test instanceof Array)return S.test.some(function(b){return R.test(b)});throw new Error("Browser's test function is not valid")});return F&&(this.parsedResult.platform=F.describe(this.getUA())),this.parsedResult.platform},w.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},w.getEngineName=function(R){return R?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},w.parseEngine=function(){var R=this;this.parsedResult.engine={};var F=h.default.find(p.default,function(S){if(typeof S.test=="function")return S.test(R);if(S.test instanceof Array)return S.test.some(function(b){return R.test(b)});throw new Error("Browser's test function is not valid")});return F&&(this.parsedResult.engine=F.describe(this.getUA())),this.parsedResult.engine},w.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},w.getResult=function(){return h.default.assign({},this.parsedResult)},w.satisfies=function(R){var F=this,S={},b=0,x={},k=0;if(Object.keys(R).forEach(function(ne){var oe=R[ne];typeof oe=="string"?(x[ne]=oe,k+=1):typeof oe=="object"&&(S[ne]=oe,b+=1)}),b>0){var L=Object.keys(S),G=h.default.find(L,function(ne){return F.isOS(ne)});if(G){var K=this.satisfies(S[G]);if(K!==void 0)return K}var z=h.default.find(L,function(ne){return F.isPlatform(ne)});if(z){var U=this.satisfies(S[z]);if(U!==void 0)return U}}if(k>0){var J=Object.keys(x),Q=h.default.find(J,function(ne){return F.isBrowser(ne,!0)});if(Q!==void 0)return this.compareVersion(x[Q])}},w.isBrowser=function(R,F){F===void 0&&(F=!1);var S=this.getBrowserName().toLowerCase(),b=R.toLowerCase(),x=h.default.getBrowserTypeByAlias(b);return F&&x&&(b=x.toLowerCase()),b===S},w.compareVersion=function(R){var F=[0],S=R,b=!1,x=this.getBrowserVersion();if(typeof x=="string")return R[0]===">"||R[0]==="<"?(S=R.substr(1),R[1]==="="?(b=!0,S=R.substr(2)):F=[],R[0]===">"?F.push(1):F.push(-1)):R[0]==="="?S=R.substr(1):R[0]==="~"&&(b=!0,S=R.substr(1)),F.indexOf(h.default.compareVersions(x,S,b))>-1},w.isOS=function(R){return this.getOSName(!0)===String(R).toLowerCase()},w.isPlatform=function(R){return this.getPlatformType(!0)===String(R).toLowerCase()},w.isEngine=function(R){return this.getEngineName(!0)===String(R).toLowerCase()},w.is=function(R,F){return F===void 0&&(F=!1),this.isBrowser(R,F)||this.isOS(R)||this.isPlatform(R)},w.some=function(R){var F=this;return R===void 0&&(R=[]),R.some(function(S){return F.is(S)})},_}();r.default=f,n.exports=r.default},92:function(n,r,i){r.__esModule=!0,r.default=void 0;var a,o=(a=i(17))&&a.__esModule?a:{default:a},u=/version\/(\d+(\.?_?\d+)+)/i,p=[{test:[/googlebot/i],describe:function(h){var y={name:"Googlebot"},f=o.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/opera/i],describe:function(h){var y={name:"Opera"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/opr\/|opios/i],describe:function(h){var y={name:"Opera"},f=o.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/SamsungBrowser/i],describe:function(h){var y={name:"Samsung Internet for Android"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/Whale/i],describe:function(h){var y={name:"NAVER Whale Browser"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/MZBrowser/i],describe:function(h){var y={name:"MZ Browser"},f=o.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/focus/i],describe:function(h){var y={name:"Focus"},f=o.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/swing/i],describe:function(h){var y={name:"Swing"},f=o.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/coast/i],describe:function(h){var y={name:"Opera Coast"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(h){var y={name:"Opera Touch"},f=o.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/yabrowser/i],describe:function(h){var y={name:"Yandex Browser"},f=o.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/ucbrowser/i],describe:function(h){var y={name:"UC Browser"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/Maxthon|mxios/i],describe:function(h){var y={name:"Maxthon"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/epiphany/i],describe:function(h){var y={name:"Epiphany"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/puffin/i],describe:function(h){var y={name:"Puffin"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/sleipnir/i],describe:function(h){var y={name:"Sleipnir"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/k-meleon/i],describe:function(h){var y={name:"K-Meleon"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/micromessenger/i],describe:function(h){var y={name:"WeChat"},f=o.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/qqbrowser/i],describe:function(h){var y={name:/qqbrowserlite/i.test(h)?"QQ Browser Lite":"QQ Browser"},f=o.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/msie|trident/i],describe:function(h){var y={name:"Internet Explorer"},f=o.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/\sedg\//i],describe:function(h){var y={name:"Microsoft Edge"},f=o.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/edg([ea]|ios)/i],describe:function(h){var y={name:"Microsoft Edge"},f=o.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/vivaldi/i],describe:function(h){var y={name:"Vivaldi"},f=o.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/seamonkey/i],describe:function(h){var y={name:"SeaMonkey"},f=o.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/sailfish/i],describe:function(h){var y={name:"Sailfish"},f=o.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,h);return f&&(y.version=f),y}},{test:[/silk/i],describe:function(h){var y={name:"Amazon Silk"},f=o.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/phantom/i],describe:function(h){var y={name:"PhantomJS"},f=o.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/slimerjs/i],describe:function(h){var y={name:"SlimerJS"},f=o.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(h){var y={name:"BlackBerry"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/(web|hpw)[o0]s/i],describe:function(h){var y={name:"WebOS Browser"},f=o.default.getFirstMatch(u,h)||o.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/bada/i],describe:function(h){var y={name:"Bada"},f=o.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/tizen/i],describe:function(h){var y={name:"Tizen"},f=o.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/qupzilla/i],describe:function(h){var y={name:"QupZilla"},f=o.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/firefox|iceweasel|fxios/i],describe:function(h){var y={name:"Firefox"},f=o.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/electron/i],describe:function(h){var y={name:"Electron"},f=o.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/MiuiBrowser/i],describe:function(h){var y={name:"Miui"},f=o.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/chromium/i],describe:function(h){var y={name:"Chromium"},f=o.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,h)||o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/chrome|crios|crmo/i],describe:function(h){var y={name:"Chrome"},f=o.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/GSA/i],describe:function(h){var y={name:"Google Search"},f=o.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:function(h){var y=!h.test(/like android/i),f=h.test(/android/i);return y&&f},describe:function(h){var y={name:"Android Browser"},f=o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/playstation 4/i],describe:function(h){var y={name:"PlayStation 4"},f=o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/safari|applewebkit/i],describe:function(h){var y={name:"Safari"},f=o.default.getFirstMatch(u,h);return f&&(y.version=f),y}},{test:[/.*/i],describe:function(h){var y=h.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:o.default.getFirstMatch(y,h),version:o.default.getSecondMatch(y,h)}}}];r.default=p,n.exports=r.default},93:function(n,r,i){r.__esModule=!0,r.default=void 0;var a,o=(a=i(17))&&a.__esModule?a:{default:a},u=i(18),p=[{test:[/Roku\/DVP/],describe:function(h){var y=o.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,h);return{name:u.OS_MAP.Roku,version:y}}},{test:[/windows phone/i],describe:function(h){var y=o.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,h);return{name:u.OS_MAP.WindowsPhone,version:y}}},{test:[/windows /i],describe:function(h){var y=o.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,h),f=o.default.getWindowsVersionName(y);return{name:u.OS_MAP.Windows,version:y,versionName:f}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(h){var y={name:u.OS_MAP.iOS},f=o.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,h);return f&&(y.version=f),y}},{test:[/macintosh/i],describe:function(h){var y=o.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,h).replace(/[_\s]/g,"."),f=o.default.getMacOSVersionName(y),_={name:u.OS_MAP.MacOS,version:y};return f&&(_.versionName=f),_}},{test:[/(ipod|iphone|ipad)/i],describe:function(h){var y=o.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,h).replace(/[_\s]/g,".");return{name:u.OS_MAP.iOS,version:y}}},{test:function(h){var y=!h.test(/like android/i),f=h.test(/android/i);return y&&f},describe:function(h){var y=o.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,h),f=o.default.getAndroidVersionName(y),_={name:u.OS_MAP.Android,version:y};return f&&(_.versionName=f),_}},{test:[/(web|hpw)[o0]s/i],describe:function(h){var y=o.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,h),f={name:u.OS_MAP.WebOS};return y&&y.length&&(f.version=y),f}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(h){var y=o.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,h)||o.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,h)||o.default.getFirstMatch(/\bbb(\d+)/i,h);return{name:u.OS_MAP.BlackBerry,version:y}}},{test:[/bada/i],describe:function(h){var y=o.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,h);return{name:u.OS_MAP.Bada,version:y}}},{test:[/tizen/i],describe:function(h){var y=o.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,h);return{name:u.OS_MAP.Tizen,version:y}}},{test:[/linux/i],describe:function(){return{name:u.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:u.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(h){var y=o.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,h);return{name:u.OS_MAP.PlayStation4,version:y}}}];r.default=p,n.exports=r.default},94:function(n,r,i){r.__esModule=!0,r.default=void 0;var a,o=(a=i(17))&&a.__esModule?a:{default:a},u=i(18),p=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(h){var y=o.default.getFirstMatch(/(can-l01)/i,h)&&"Nova",f={type:u.PLATFORMS_MAP.mobile,vendor:"Huawei"};return y&&(f.model=y),f}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet}}},{test:function(h){var y=h.test(/ipod|iphone/i),f=h.test(/like (ipod|iphone)/i);return y&&!f},describe:function(h){var y=o.default.getFirstMatch(/(ipod|iphone)/i,h);return{type:u.PLATFORMS_MAP.mobile,vendor:"Apple",model:y}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:u.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:u.PLATFORMS_MAP.mobile}}},{test:function(h){return h.getBrowserName(!0)==="blackberry"},describe:function(){return{type:u.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(h){return h.getBrowserName(!0)==="bada"},describe:function(){return{type:u.PLATFORMS_MAP.mobile}}},{test:function(h){return h.getBrowserName()==="windows phone"},describe:function(){return{type:u.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(h){var y=Number(String(h.getOSVersion()).split(".")[0]);return h.getOSName(!0)==="android"&&y>=3},describe:function(){return{type:u.PLATFORMS_MAP.tablet}}},{test:function(h){return h.getOSName(!0)==="android"},describe:function(){return{type:u.PLATFORMS_MAP.mobile}}},{test:function(h){return h.getOSName(!0)==="macos"},describe:function(){return{type:u.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(h){return h.getOSName(!0)==="windows"},describe:function(){return{type:u.PLATFORMS_MAP.desktop}}},{test:function(h){return h.getOSName(!0)==="linux"},describe:function(){return{type:u.PLATFORMS_MAP.desktop}}},{test:function(h){return h.getOSName(!0)==="playstation 4"},describe:function(){return{type:u.PLATFORMS_MAP.tv}}},{test:function(h){return h.getOSName(!0)==="roku"},describe:function(){return{type:u.PLATFORMS_MAP.tv}}}];r.default=p,n.exports=r.default},95:function(n,r,i){r.__esModule=!0,r.default=void 0;var a,o=(a=i(17))&&a.__esModule?a:{default:a},u=i(18),p=[{test:function(h){return h.getBrowserName(!0)==="microsoft edge"},describe:function(h){if(/\sedg\//i.test(h))return{name:u.ENGINE_MAP.Blink};var y=o.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,h);return{name:u.ENGINE_MAP.EdgeHTML,version:y}}},{test:[/trident/i],describe:function(h){var y={name:u.ENGINE_MAP.Trident},f=o.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:function(h){return h.test(/presto/i)},describe:function(h){var y={name:u.ENGINE_MAP.Presto},f=o.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:function(h){var y=h.test(/gecko/i),f=h.test(/like gecko/i);return y&&!f},describe:function(h){var y={name:u.ENGINE_MAP.Gecko},f=o.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:u.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(h){var y={name:u.ENGINE_MAP.WebKit},f=o.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,h);return f&&(y.version=f),y}}];r.default=p,n.exports=r.default}})})}}),rf=fe({"../../node_modules/.pnpm/sdp-transform@2.15.0/node_modules/sdp-transform/lib/grammar.js"(e,t){W();var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(r){return r.encoding?"rtpmap:%d %s/%s/%s":r.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(r){return r.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(r){return r.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(r){return"extmap:%d"+(r.direction?"/%s":"%v")+(r["encrypt-uri"]?" %s":"%v")+" %s"+(r.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(r){return r.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(r){var i="candidate:%s %d %s %d %s %d typ %s";return i+=r.raddr!=null?" raddr %s rport %d":"%v%v",i+=r.tcptype!=null?" tcptype %s":"%v",r.generation!=null&&(i+=" generation %d"),i+=r["network-id"]!=null?" network-id %d":"%v",i+=r["network-cost"]!=null?" network-cost %d":"%v",i}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(r){var i="ssrc:%d";return r.attribute!=null&&(i+=" %s",r.value!=null&&(i+=":%s")),i}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(r){return r.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(r){return r.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(r){return"imageattr:%s %s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(r){return"simulcast:%s %s"+(r.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(r){return"ts-refclk:%s"+(r.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(r){var i="mediaclk:";return i+=r.id!=null?"id=%s %s":"%v%s",i+=r.mediaClockValue!=null?"=%s":"",i+=r.rateNumerator!=null?" rate=%s":"",i+=r.rateDenominator!=null?"/%s":"",i}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(r){var i=n[r];i.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})})}}),Ix=fe({"../../node_modules/.pnpm/sdp-transform@2.15.0/node_modules/sdp-transform/lib/parser.js"(e){W();var t=function(u){return String(Number(u))===u?Number(u):u},n=function(u,p,h,y){if(y&&!h)p[y]=t(u[1]);else for(var f=0;f<h.length;f+=1)u[f+1]!=null&&(p[h[f]]=t(u[f+1]))},r=function(u,p,h){var y=u.name&&u.names;u.push&&!p[u.push]?p[u.push]=[]:y&&!p[u.name]&&(p[u.name]={});var f=u.push?{}:y?p[u.name]:p;n(h.match(u.reg),f,u.names,u.name),u.push&&p[u.push].push(f)},i=rf(),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(u){var p={},h=[],y=p;return u.split(/(\r\n|\r|\n)/).filter(a).forEach(function(f){var _=f[0],w=f.slice(2);_==="m"&&(h.push({rtp:[],fmtp:[]}),y=h[h.length-1]);for(var R=0;R<(i[_]||[]).length;R+=1){var F=i[_][R];if(F.reg.test(w))return r(F,y,w)}}),p.media=h,p};var o=function(u,p){var h=p.split(/=(.+)/,2);return h.length===2?u[h[0]]=t(h[1]):h.length===1&&p.length>1&&(u[h[0]]=void 0),u};e.parseParams=function(u){return u.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(u){return u.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(u){for(var p=[],h=u.split(" ").map(t),y=0;y<h.length;y+=3)p.push({component:h[y],ip:h[y+1],port:h[y+2]});return p},e.parseImageAttributes=function(u){return u.split(" ").map(function(p){return p.substring(1,p.length-1).split(",").reduce(o,{})})},e.parseSimulcastStreamList=function(u){return u.split(";").map(function(p){return p.split(",").map(function(h){var y,f=!1;return h[0]!=="~"?y=t(h):(y=t(h.substring(1,h.length)),f=!0),{scid:y,paused:f}})})}}}),Fx=fe({"../../node_modules/.pnpm/sdp-transform@2.15.0/node_modules/sdp-transform/lib/writer.js"(e,t){W();var n=rf(),r=/%[sdv%]/g,i=function(p){var h=1,y=arguments,f=y.length;return p.replace(r,function(_){if(h>=f)return _;var w=y[h];switch(h+=1,_){case"%%":return"%";case"%s":return String(w);case"%d":return Number(w);case"%v":return""}})},a=function(p,h,y){var f=h.format instanceof Function?h.format(h.push?y:y[h.name]):h.format,_=[p+"="+f];if(h.names)for(var w=0;w<h.names.length;w+=1){var R=h.names[w];h.name?_.push(y[h.name][R]):_.push(y[h.names[w]])}else _.push(y[h.name]);return i.apply(null,_)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];t.exports=function(p,h){h=h||{},p.version==null&&(p.version=0),p.name==null&&(p.name=" "),p.media.forEach(function(w){w.payloads==null&&(w.payloads="")});var y=h.outerOrder||o,f=h.innerOrder||u,_=[];return y.forEach(function(w){n[w].forEach(function(R){R.name in p&&p[R.name]!=null?_.push(a(w,R,p)):R.push in p&&p[R.push]!=null&&p[R.push].forEach(function(F){_.push(a(w,R,F))})})}),p.media.forEach(function(w){_.push(a("m",n.m[0],w)),f.forEach(function(R){n[R].forEach(function(F){F.name in w&&w[F.name]!=null?_.push(a(R,F,w)):F.push in w&&w[F.push]!=null&&w[F.push].forEach(function(S){_.push(a(R,F,S))})})})}),_.join(`\r
`)+`\r
`}}}),qr=fe({"../../node_modules/.pnpm/sdp-transform@2.15.0/node_modules/sdp-transform/lib/index.js"(e){W();var t=Ix(),n=Fx(),r=rf();e.grammar=r,e.write=n,e.parse=t.parse,e.parseParams=t.parseParams,e.parseFmtpConfig=t.parseFmtpConfig,e.parsePayloads=t.parsePayloads,e.parseRemoteCandidates=t.parseRemoteCandidates,e.parseImageAttributes=t.parseImageAttributes,e.parseSimulcastStreamList=t.parseSimulcastStreamList}}),sy=fe({"../../node_modules/.pnpm/ua-parser-js@1.0.40/node_modules/ua-parser-js/src/ua-parser.js"(e,t){W(),function(n,r){var i="1.0.40",a="",o="?",u="function",p="undefined",h="object",y="string",f="major",_="model",w="name",R="type",F="vendor",S="version",b="architecture",x="console",k="mobile",L="tablet",G="smarttv",K="wearable",z="embedded",U=500,J="Amazon",Q="Apple",ne="ASUS",oe="BlackBerry",he="Browser",X="Chrome",_e="Edge",Pe="Firefox",xe="Google",ge="Huawei",ye="LG",Ee="Microsoft",Ne="Motorola",Ye="Opera",zt="Samsung",jt="Sharp",en="Sony",Tt="Xiaomi",et="Zebra",dt="Facebook",on="Chromium OS",fn="Mac OS",Wr=" Browser",Uu=function(tt,ot){var Ge={};for(var yt in tt)ot[yt]&&ot[yt].length%2===0?Ge[yt]=ot[yt].concat(tt[yt]):Ge[yt]=tt[yt];return Ge},Ms=function(tt){for(var ot={},Ge=0;Ge<tt.length;Ge++)ot[tt[Ge].toUpperCase()]=tt[Ge];return ot},uc=function(tt,ot){return typeof tt===y?Ln(ot).indexOf(Ln(tt))!==-1:!1},Ln=function(tt){return tt.toLowerCase()},Hu=function(tt){return typeof tt===y?tt.replace(/[^\d\.]/g,a).split(".")[0]:r},Na=function(tt,ot){if(typeof tt===y)return tt=tt.replace(/^\s\s*/,a),typeof ot===p?tt:tt.substring(0,U)},ss=function(tt,ot){for(var Ge=0,yt,xr,ur,lt,ze,dr;Ge<ot.length&&!ze;){var Oa=ot[Ge],pc=ot[Ge+1];for(yt=xr=0;yt<Oa.length&&!ze&&Oa[yt];)if(ze=Oa[yt++].exec(tt),ze)for(ur=0;ur<pc.length;ur++)dr=ze[++xr],lt=pc[ur],typeof lt===h&&lt.length>0?lt.length===2?typeof lt[1]==u?this[lt[0]]=lt[1].call(this,dr):this[lt[0]]=lt[1]:lt.length===3?typeof lt[1]===u&&!(lt[1].exec&&lt[1].test)?this[lt[0]]=dr?lt[1].call(this,dr,lt[2]):r:this[lt[0]]=dr?dr.replace(lt[1],lt[2]):r:lt.length===4&&(this[lt[0]]=dr?lt[3].call(this,dr.replace(lt[1],lt[2])):r):this[lt]=dr||r;Ge+=2}},Ls=function(tt,ot){for(var Ge in ot)if(typeof ot[Ge]===h&&ot[Ge].length>0){for(var yt=0;yt<ot[Ge].length;yt++)if(uc(ot[Ge][yt],tt))return Ge===o?r:Ge}else if(uc(ot[Ge],tt))return Ge===o?r:Ge;return ot.hasOwnProperty("*")?ot["*"]:tt},Vu={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},dc={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},hc={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[w,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[w,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[w,S],[/opios[\/ ]+([\w\.]+)/i],[S,[w,Ye+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[S,[w,Ye+" GX"]],[/\bopr\/([\w\.]+)/i],[S,[w,Ye]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[S,[w,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[S,[w,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[w,S],[/quark(?:pc)?\/([-\w\.]+)/i],[S,[w,"Quark"]],[/\bddg\/([\w\.]+)/i],[S,[w,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[w,"UC"+he]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[S,[w,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[w,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[w,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[S,[w,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[S,[w,"Smart Lenovo "+he]],[/(avast|avg)\/([\w\.]+)/i],[[w,/(.+)/,"$1 Secure "+he],S],[/\bfocus\/([\w\.]+)/i],[S,[w,Pe+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[w,Ye+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[w,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[w,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[w,Ye+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[w,"MIUI"+Wr]],[/fxios\/([\w\.-]+)/i],[S,[w,Pe]],[/\bqihoobrowser\/?([\w\.]*)/i],[S,[w,"360"]],[/\b(qq)\/([\w\.]+)/i],[[w,/(.+)/,"$1Browser"],S],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[w,/(.+)/,"$1"+Wr],S],[/samsungbrowser\/([\w\.]+)/i],[S,[w,zt+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[S,[w,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[w,"Sogou Mobile"],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[w,S],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[w],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[S,w],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[w,dt],S],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[w,S],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[w,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[S,[w,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[w,X+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[w,X+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[w,"Android "+he]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[w,S],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[S,[w,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[S,w],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[w,[S,Ls,Vu]],[/(webkit|khtml)\/([\w\.]+)/i],[w,S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[w,"Netscape"],S],[/(wolvic|librewolf)\/([\w\.]+)/i],[w,S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[w,Pe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[w,[S,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[w,[S,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,Ln]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[b,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[b,"armhf"]],[/windows (ce|mobile); ppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[b,/ower/,a,Ln]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[b,Ln]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[F,zt],[R,L]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[_,[F,zt],[R,k]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[_,[F,Q],[R,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[F,Q],[R,L]],[/(macintosh);/i],[_,[F,Q]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[F,jt],[R,k]],[/(?:honor)([-\w ]+)[;\)]/i],[_,[F,"Honor"],[R,k]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[F,ge],[R,L]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[F,ge],[R,k]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[_,/_/g," "],[F,Tt],[R,k]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[F,Tt],[R,L]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[F,"OPPO"],[R,k]],[/\b(opd2\d{3}a?) bui/i],[_,[F,"OPPO"],[R,L]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[F,"Vivo"],[R,k]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[_,[F,"Realme"],[R,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[F,Ne],[R,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[F,Ne],[R,L]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[F,ye],[R,L]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[F,ye],[R,k]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[F,"Lenovo"],[R,L]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[F,"Nokia"],[R,k]],[/(pixel c)\b/i],[_,[F,xe],[R,L]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[F,xe],[R,k]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[F,en],[R,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[F,en],[R,L]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[F,"OnePlus"],[R,k]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[F,J],[R,L]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[F,J],[R,k]],[/(playbook);[-\w\),; ]+(rim)/i],[_,F,[R,L]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[F,oe],[R,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[F,ne],[R,L]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[F,ne],[R,k]],[/(nexus 9)/i],[_,[F,"HTC"],[R,L]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[F,[_,/_/g," "],[R,k]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[_,[F,"TCL"],[R,L]],[/(itel) ((\w+))/i],[[F,Ln],_,[R,Ls,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[F,"Acer"],[R,L]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[F,"Meizu"],[R,k]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[_,[F,"Ulefone"],[R,k]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[_,[F,"Energizer"],[R,k]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[_,[F,"Cat"],[R,k]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[_,[F,"Smartfren"],[R,k]],[/droid.+; (a(?:015|06[35]|142p?))/i],[_,[F,"Nothing"],[R,k]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[F,_,[R,k]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[F,_,[R,L]],[/(surface duo)/i],[_,[F,Ee],[R,L]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[F,"Fairphone"],[R,k]],[/(u304aa)/i],[_,[F,"AT&T"],[R,k]],[/\bsie-(\w*)/i],[_,[F,"Siemens"],[R,k]],[/\b(rct\w+) b/i],[_,[F,"RCA"],[R,L]],[/\b(venue[\d ]{2,7}) b/i],[_,[F,"Dell"],[R,L]],[/\b(q(?:mv|ta)\w+) b/i],[_,[F,"Verizon"],[R,L]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[F,"Barnes & Noble"],[R,L]],[/\b(tm\d{3}\w+) b/i],[_,[F,"NuVision"],[R,L]],[/\b(k88) b/i],[_,[F,"ZTE"],[R,L]],[/\b(nx\d{3}j) b/i],[_,[F,"ZTE"],[R,k]],[/\b(gen\d{3}) b.+49h/i],[_,[F,"Swiss"],[R,k]],[/\b(zur\d{3}) b/i],[_,[F,"Swiss"],[R,L]],[/\b((zeki)?tb.*\b) b/i],[_,[F,"Zeki"],[R,L]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[F,"Dragon Touch"],_,[R,L]],[/\b(ns-?\w{0,9}) b/i],[_,[F,"Insignia"],[R,L]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[F,"NextBook"],[R,L]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[F,"Voice"],_,[R,k]],[/\b(lvtel\-)?(v1[12]) b/i],[[F,"LvTel"],_,[R,k]],[/\b(ph-1) /i],[_,[F,"Essential"],[R,k]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[F,"Envizen"],[R,L]],[/\b(trio[-\w\. ]+) b/i],[_,[F,"MachSpeed"],[R,L]],[/\btu_(1491) b/i],[_,[F,"Rotor"],[R,L]],[/(shield[\w ]+) b/i],[_,[F,"Nvidia"],[R,L]],[/(sprint) (\w+)/i],[F,_,[R,k]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[F,Ee],[R,k]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[F,et],[R,L]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[F,et],[R,k]],[/smart-tv.+(samsung)/i],[F,[R,G]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[F,zt],[R,G]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[F,ye],[R,G]],[/(apple) ?tv/i],[F,[_,Q+" TV"],[R,G]],[/crkey/i],[[_,X+"cast"],[F,xe],[R,G]],[/droid.+aft(\w+)( bui|\))/i],[_,[F,J],[R,G]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[F,jt],[R,G]],[/(bravia[\w ]+)( bui|\))/i],[_,[F,en],[R,G]],[/(mitv-\w{5}) bui/i],[_,[F,Tt],[R,G]],[/Hbbtv.*(technisat) (.*);/i],[F,_,[R,G]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[F,Na],[_,Na],[R,G]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,G]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[F,_,[R,x]],[/droid.+; (shield) bui/i],[_,[F,"Nvidia"],[R,x]],[/(playstation [345portablevi]+)/i],[_,[F,en],[R,x]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[F,Ee],[R,x]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[_,[F,zt],[R,K]],[/((pebble))app/i],[F,_,[R,K]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[F,Q],[R,K]],[/droid.+; (glass) \d/i],[_,[F,xe],[R,K]],[/droid.+; (wt63?0{2,3})\)/i],[_,[F,et],[R,K]],[/droid.+; (glass) \d/i],[_,[F,xe],[R,K]],[/(pico) (4|neo3(?: link|pro)?)/i],[F,_,[R,K]],[/; (quest( \d| pro)?)/i],[_,[F,dt],[R,K]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[F,[R,z]],[/(aeobc)\b/i],[_,[F,J],[R,z]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[_,[R,k]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[R,L]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,L]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,k]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[F,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[w,_e+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[w,S],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[w,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[w,S],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,w]],os:[[/microsoft (windows) (vista|xp)/i],[w,S],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[w,[S,Ls,dc]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,Ls,dc],[w,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[w,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[w,fn],[S,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[S,w],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[w,S],[/\(bb(10);/i],[S,[w,oe]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[S,[w,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[w,Pe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[S,[w,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[w,"watchOS"]],[/crkey\/([\d\.]+)/i],[S,[w,X+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[w,on],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[w,S],[/(sunos) ?([\w\.\d]*)/i],[[w,"Solaris"],S],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[w,S]]},Cn=function(tt,ot){if(typeof tt===h&&(ot=tt,tt=r),!(this instanceof Cn))return new Cn(tt,ot).getResult();var Ge=typeof n!==p&&n.navigator?n.navigator:r,yt=tt||(Ge&&Ge.userAgent?Ge.userAgent:a),xr=Ge&&Ge.userAgentData?Ge.userAgentData:r,ur=ot?Uu(hc,ot):hc,lt=Ge&&Ge.userAgent==yt;return this.getBrowser=function(){var ze={};return ze[w]=r,ze[S]=r,ss.call(ze,yt,ur.browser),ze[f]=Hu(ze[S]),lt&&Ge&&Ge.brave&&typeof Ge.brave.isBrave==u&&(ze[w]="Brave"),ze},this.getCPU=function(){var ze={};return ze[b]=r,ss.call(ze,yt,ur.cpu),ze},this.getDevice=function(){var ze={};return ze[F]=r,ze[_]=r,ze[R]=r,ss.call(ze,yt,ur.device),lt&&!ze[R]&&xr&&xr.mobile&&(ze[R]=k),lt&&ze[_]=="Macintosh"&&Ge&&typeof Ge.standalone!==p&&Ge.maxTouchPoints&&Ge.maxTouchPoints>2&&(ze[_]="iPad",ze[R]=L),ze},this.getEngine=function(){var ze={};return ze[w]=r,ze[S]=r,ss.call(ze,yt,ur.engine),ze},this.getOS=function(){var ze={};return ze[w]=r,ze[S]=r,ss.call(ze,yt,ur.os),lt&&!ze[w]&&xr&&xr.platform&&xr.platform!="Unknown"&&(ze[w]=xr.platform.replace(/chrome os/i,on).replace(/macos/i,fn)),ze},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return yt},this.setUA=function(ze){return yt=typeof ze===y&&ze.length>U?Na(ze,U):ze,this},this.setUA(yt),this};Cn.VERSION=i,Cn.BROWSER=Ms([w,S,f]),Cn.CPU=Ms([b]),Cn.DEVICE=Ms([_,F,R,x,k,G,L,K,z]),Cn.ENGINE=Cn.OS=Ms([w,S]),typeof e!==p?(typeof t!==p&&t.exports&&(e=t.exports=Cn),e.UAParser=Cn):typeof define===u&&define.amd?define(function(){return Cn}):typeof n!==p&&(n.UAParser=Cn);var Ci=typeof n!==p&&(n.jQuery||n.Zepto);if(Ci&&!Ci.ua){var js=new Cn;Ci.ua=js.getResult(),Ci.ua.get=function(){return js.getUA()},Ci.ua.set=function(tt){js.setUA(tt);var ot=js.getResult();for(var Ge in ot)Ci.ua[Ge]=ot[Ge]}}}(typeof window=="object"?window:e)}}),Dx=fe({"../../node_modules/.pnpm/jsrsasign@11.1.0/node_modules/jsrsasign/lib/jsrsasign.js"(e){W();var t={};t.userAgent=!1;var n={},r="11.1.0",i="jsrsasign(all) 11.1.0 (2024-02-01) (c) 2010-2023 Kenji Urushima | kjur.github.io/jsrsasign/license",a=a||function(s,c){var l={},d=l.lib={},g=d.Base=function(){function C(){}return{extend:function(I){C.prototype=this;var T=new C;return I&&T.mixIn(I),T.hasOwnProperty("init")||(T.init=function(){T.$super.init.apply(this,arguments)}),T.init.prototype=T,T.$super=this,T},create:function(){var I=this.extend();return I.init.apply(I,arguments),I},init:function(){},mixIn:function(I){for(var T in I)I.hasOwnProperty(T)&&(this[T]=I[T]);I.hasOwnProperty("toString")&&(this.toString=I.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),m=d.WordArray=g.extend({init:function(C,I){C=this.words=C||[],I!=c?this.sigBytes=I:this.sigBytes=C.length*4},toString:function(C){return(C||E).stringify(this)},concat:function(C){var I=this.words,T=C.words,D=this.sigBytes,M=C.sigBytes;if(this.clamp(),D%4)for(var H=0;H<M;H++){var te=T[H>>>2]>>>24-H%4*8&255;I[D+H>>>2]|=te<<24-(D+H)%4*8}else for(var H=0;H<M;H+=4)I[D+H>>>2]=T[H>>>2];return this.sigBytes+=M,this},clamp:function(){var C=this.words,I=this.sigBytes;C[I>>>2]&=4294967295<<32-I%4*8,C.length=s.ceil(I/4)},clone:function(){var C=g.clone.call(this);return C.words=this.words.slice(0),C},random:function(C){for(var I=[],T=0;T<C;T+=4)I.push(s.random()*4294967296|0);return new m.init(I,C)}}),P=l.enc={},E=P.Hex={stringify:function(C){for(var I=C.words,T=C.sigBytes,D=[],M=0;M<T;M++){var H=I[M>>>2]>>>24-M%4*8&255;D.push((H>>>4).toString(16)),D.push((H&15).toString(16))}return D.join("")},parse:function(C){for(var I=C.length,T=[],D=0;D<I;D+=2)T[D>>>3]|=parseInt(C.substr(D,2),16)<<24-D%8*4;return new m.init(T,I/2)}},N=P.Latin1={stringify:function(C){for(var I=C.words,T=C.sigBytes,D=[],M=0;M<T;M++){var H=I[M>>>2]>>>24-M%4*8&255;D.push(String.fromCharCode(H))}return D.join("")},parse:function(C){for(var I=C.length,T=[],D=0;D<I;D++)T[D>>>2]|=(C.charCodeAt(D)&255)<<24-D%4*8;return new m.init(T,I)}},A=P.Utf8={stringify:function(C){try{return decodeURIComponent(escape(N.stringify(C)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(C){return N.parse(unescape(encodeURIComponent(C)))}},j=d.BufferedBlockAlgorithm=g.extend({reset:function(){this._data=new m.init,this._nDataBytes=0},_append:function(C){typeof C=="string"&&(C=A.parse(C)),this._data.concat(C),this._nDataBytes+=C.sigBytes},_process:function(C){var I=this._data,T=I.words,D=I.sigBytes,M=this.blockSize,H=M*4,te=D/H;C?te=s.ceil(te):te=s.max((te|0)-this._minBufferSize,0);var ie=te*M,re=s.min(ie*4,D);if(ie){for(var ae=0;ae<ie;ae+=M)this._doProcessBlock(T,ae);var V=T.splice(0,ie);I.sigBytes-=re}return new m.init(V,re)},clone:function(){var C=g.clone.call(this);return C._data=this._data.clone(),C},_minBufferSize:0});d.Hasher=j.extend({cfg:g.extend(),init:function(C){this.cfg=this.cfg.extend(C),this.reset()},reset:function(){j.reset.call(this),this._doReset()},update:function(C){return this._append(C),this._process(),this},finalize:function(C){C&&this._append(C);var I=this._doFinalize();return I},blockSize:512/32,_createHelper:function(C){return function(I,T){return new C.init(T).finalize(I)}},_createHmacHelper:function(C){return function(I,T){return new O.HMAC.init(C,T).finalize(I)}}});var O=l.algo={};return l}(Math);(function(s){var g=a,c=g.lib,l=c.Base,d=c.WordArray,g=g.x64={};g.Word=l.extend({init:function(m,P){this.high=m,this.low=P}}),g.WordArray=l.extend({init:function(m,P){m=this.words=m||[],this.sigBytes=P!=s?P:8*m.length},toX32:function(){for(var m=this.words,P=m.length,E=[],N=0;N<P;N++){var A=m[N];E.push(A.high),E.push(A.low)}return d.create(E,this.sigBytes)},clone:function(){for(var m=l.clone.call(this),P=m.words=this.words.slice(0),E=P.length,N=0;N<E;N++)P[N]=P[N].clone();return m}})})(),a.lib.Cipher||function(s){var I=a,c=I.lib,l=c.Base,d=c.WordArray,g=c.BufferedBlockAlgorithm,m=I.enc.Base64,P=I.algo.EvpKDF,E=c.Cipher=g.extend({cfg:l.extend(),createEncryptor:function(D,M){return this.create(this._ENC_XFORM_MODE,D,M)},createDecryptor:function(D,M){return this.create(this._DEC_XFORM_MODE,D,M)},init:function(D,M,H){this.cfg=this.cfg.extend(H),this._xformMode=D,this._key=M,this.reset()},reset:function(){g.reset.call(this),this._doReset()},process:function(D){return this._append(D),this._process()},finalize:function(D){return D&&this._append(D),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(D){return{encrypt:function(M,H,te){return(typeof H=="string"?T:C).encrypt(D,M,H,te)},decrypt:function(M,H,te){return(typeof H=="string"?T:C).decrypt(D,M,H,te)}}}});c.StreamCipher=E.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var O=I.mode={},N=function(D,M,H){var te=this._iv;te?this._iv=s:te=this._prevBlock;for(var ie=0;ie<H;ie++)D[M+ie]^=te[ie]},A=(c.BlockCipherMode=l.extend({createEncryptor:function(D,M){return this.Encryptor.create(D,M)},createDecryptor:function(D,M){return this.Decryptor.create(D,M)},init:function(D,M){this._cipher=D,this._iv=M}})).extend();A.Encryptor=A.extend({processBlock:function(D,M){var H=this._cipher,te=H.blockSize;N.call(this,D,M,te),H.encryptBlock(D,M),this._prevBlock=D.slice(M,M+te)}}),A.Decryptor=A.extend({processBlock:function(D,M){var H=this._cipher,te=H.blockSize,ie=D.slice(M,M+te);H.decryptBlock(D,M),N.call(this,D,M,te),this._prevBlock=ie}}),O=O.CBC=A,A=(I.pad={}).Pkcs7={pad:function(D,M){for(var H=4*M,H=H-D.sigBytes%H,te=H<<24|H<<16|H<<8|H,ie=[],re=0;re<H;re+=4)ie.push(te);H=d.create(ie,H),D.concat(H)},unpad:function(D){D.sigBytes-=D.words[D.sigBytes-1>>>2]&255}},c.BlockCipher=E.extend({cfg:E.cfg.extend({mode:O,padding:A}),reset:function(){E.reset.call(this);var M=this.cfg,D=M.iv,M=M.mode;if(this._xformMode==this._ENC_XFORM_MODE)var H=M.createEncryptor;else H=M.createDecryptor,this._minBufferSize=1;this._mode=H.call(M,this,D&&D.words)},_doProcessBlock:function(D,M){this._mode.processBlock(D,M)},_doFinalize:function(){var D=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){D.pad(this._data,this.blockSize);var M=this._process(!0)}else M=this._process(!0),D.unpad(M);return M},blockSize:4});var j=c.CipherParams=l.extend({init:function(D){this.mixIn(D)},toString:function(D){return(D||this.formatter).stringify(this)}}),O=(I.format={}).OpenSSL={stringify:function(D){var M=D.ciphertext;return D=D.salt,(D?d.create([1398893684,1701076831]).concat(D).concat(M):M).toString(m)},parse:function(D){D=m.parse(D);var M=D.words;if(M[0]==1398893684&&M[1]==1701076831){var H=d.create(M.slice(2,4));M.splice(0,4),D.sigBytes-=16}return j.create({ciphertext:D,salt:H})}},C=c.SerializableCipher=l.extend({cfg:l.extend({format:O}),encrypt:function(D,M,H,te){te=this.cfg.extend(te);var ie=D.createEncryptor(H,te);return M=ie.finalize(M),ie=ie.cfg,j.create({ciphertext:M,key:H,iv:ie.iv,algorithm:D,mode:ie.mode,padding:ie.padding,blockSize:D.blockSize,formatter:te.format})},decrypt:function(D,M,H,te){return te=this.cfg.extend(te),M=this._parse(M,te.format),D.createDecryptor(H,te).finalize(M.ciphertext)},_parse:function(D,M){return typeof D=="string"?M.parse(D,this):D}}),I=(I.kdf={}).OpenSSL={execute:function(D,M,H,te){return te||(te=d.random(8)),D=P.create({keySize:M+H}).compute(D,te),H=d.create(D.words.slice(M),4*H),D.sigBytes=4*M,j.create({key:D,iv:H,salt:te})}},T=c.PasswordBasedCipher=C.extend({cfg:C.cfg.extend({kdf:I}),encrypt:function(D,M,H,te){return te=this.cfg.extend(te),H=te.kdf.execute(H,D.keySize,D.ivSize),te.iv=H.iv,D=C.encrypt.call(this,D,M,H.key,te),D.mixIn(H),D},decrypt:function(D,M,H,te){return te=this.cfg.extend(te),M=this._parse(M,te.format),H=te.kdf.execute(H,D.keySize,D.ivSize,M.salt),te.iv=H.iv,C.decrypt.call(this,D,M,H.key,te)}})}(),function(){for(var s=a,c=s.lib.BlockCipher,V=s.algo,l=[],d=[],g=[],m=[],P=[],E=[],N=[],A=[],j=[],O=[],C=[],I=0;256>I;I++)C[I]=128>I?I<<1:I<<1^283;for(var T=0,D=0,I=0;256>I;I++){var M=D^D<<1^D<<2^D<<3^D<<4,M=M>>>8^M&255^99;l[T]=M,d[M]=T;var H=C[T],te=C[H],ie=C[te],re=257*C[M]^16843008*M;g[T]=re<<24|re>>>8,m[T]=re<<16|re>>>16,P[T]=re<<8|re>>>24,E[T]=re,re=16843009*ie^65537*te^257*H^16843008*T,N[M]=re<<24|re>>>8,A[M]=re<<16|re>>>16,j[M]=re<<8|re>>>24,O[M]=re,T?(T=H^C[C[C[ie^H]]],D^=C[C[D]]):T=D=1}var ae=[0,1,2,4,8,16,32,64,128,27,54],V=V.AES=c.extend({_doReset:function(){for(var q=this._key,$=q.words,Z=q.sigBytes/4,q=4*((this._nRounds=Z+6)+1),Y=this._keySchedule=[],se=0;se<q;se++)if(se<Z)Y[se]=$[se];else{var ue=Y[se-1];se%Z?6<Z&&se%Z==4&&(ue=l[ue>>>24]<<24|l[ue>>>16&255]<<16|l[ue>>>8&255]<<8|l[ue&255]):(ue=ue<<8|ue>>>24,ue=l[ue>>>24]<<24|l[ue>>>16&255]<<16|l[ue>>>8&255]<<8|l[ue&255],ue^=ae[se/Z|0]<<24),Y[se]=Y[se-Z]^ue}for($=this._invKeySchedule=[],Z=0;Z<q;Z++)se=q-Z,ue=Z%4?Y[se]:Y[se-4],$[Z]=4>Z||4>=se?ue:N[l[ue>>>24]]^A[l[ue>>>16&255]]^j[l[ue>>>8&255]]^O[l[ue&255]]},encryptBlock:function($,Z){this._doCryptBlock($,Z,this._keySchedule,g,m,P,E,l)},decryptBlock:function($,Z){var q=$[Z+1];$[Z+1]=$[Z+3],$[Z+3]=q,this._doCryptBlock($,Z,this._invKeySchedule,N,A,j,O,d),q=$[Z+1],$[Z+1]=$[Z+3],$[Z+3]=q},_doCryptBlock:function($,Z,q,Y,se,ue,be,le){for(var pe=this._nRounds,nn=$[Z]^q[0],cn=$[Z+1]^q[1],rn=$[Z+2]^q[2],Kt=$[Z+3]^q[3],Se=4,Ce=1;Ce<pe;Ce++)var gn=Y[nn>>>24]^se[cn>>>16&255]^ue[rn>>>8&255]^be[Kt&255]^q[Se++],It=Y[cn>>>24]^se[rn>>>16&255]^ue[Kt>>>8&255]^be[nn&255]^q[Se++],St=Y[rn>>>24]^se[Kt>>>16&255]^ue[nn>>>8&255]^be[cn&255]^q[Se++],Kt=Y[Kt>>>24]^se[nn>>>16&255]^ue[cn>>>8&255]^be[rn&255]^q[Se++],nn=gn,cn=It,rn=St;gn=(le[nn>>>24]<<24|le[cn>>>16&255]<<16|le[rn>>>8&255]<<8|le[Kt&255])^q[Se++],It=(le[cn>>>24]<<24|le[rn>>>16&255]<<16|le[Kt>>>8&255]<<8|le[nn&255])^q[Se++],St=(le[rn>>>24]<<24|le[Kt>>>16&255]<<16|le[nn>>>8&255]<<8|le[cn&255])^q[Se++],Kt=(le[Kt>>>24]<<24|le[nn>>>16&255]<<16|le[cn>>>8&255]<<8|le[rn&255])^q[Se++],$[Z]=gn,$[Z+1]=It,$[Z+2]=St,$[Z+3]=Kt},keySize:8});s.AES=c._createHelper(V)}(),function(){function s(C,I){var T=(this._lBlock>>>C^this._rBlock)&I;this._rBlock^=T,this._lBlock^=T<<C}function c(C,I){var T=(this._rBlock>>>C^this._lBlock)&I;this._lBlock^=T,this._rBlock^=T<<C}var l=a,g=l.lib,d=g.WordArray,g=g.BlockCipher,m=l.algo,P=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],E=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],N=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],A=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],j=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],O=m.DES=g.extend({_doReset:function(){for(var C=this._key.words,I=[],T=0;56>T;T++){var D=P[T]-1;I[T]=C[D>>>5]>>>31-D%32&1}for(C=this._subKeys=[],D=0;16>D;D++){for(var M=C[D]=[],H=N[D],T=0;24>T;T++)M[T/6|0]|=I[(E[T]-1+H)%28]<<31-T%6,M[4+(T/6|0)]|=I[28+(E[T+24]-1+H)%28]<<31-T%6;for(M[0]=M[0]<<1|M[0]>>>31,T=1;7>T;T++)M[T]>>>=4*(T-1)+3;M[7]=M[7]<<5|M[7]>>>27}for(I=this._invSubKeys=[],T=0;16>T;T++)I[T]=C[15-T]},encryptBlock:function(C,I){this._doCryptBlock(C,I,this._subKeys)},decryptBlock:function(C,I){this._doCryptBlock(C,I,this._invSubKeys)},_doCryptBlock:function(C,I,T){this._lBlock=C[I],this._rBlock=C[I+1],s.call(this,4,252645135),s.call(this,16,65535),c.call(this,2,858993459),c.call(this,8,16711935),s.call(this,1,1431655765);for(var D=0;16>D;D++){for(var M=T[D],H=this._lBlock,te=this._rBlock,ie=0,re=0;8>re;re++)ie|=A[re][((te^M[re])&j[re])>>>0];this._lBlock=te,this._rBlock=H^ie}T=this._lBlock,this._lBlock=this._rBlock,this._rBlock=T,s.call(this,1,1431655765),c.call(this,8,16711935),c.call(this,2,858993459),s.call(this,16,65535),s.call(this,4,252645135),C[I]=this._lBlock,C[I+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});l.DES=g._createHelper(O),m=m.TripleDES=g.extend({_doReset:function(){var C=this._key.words;this._des1=O.createEncryptor(d.create(C.slice(0,2))),this._des2=O.createEncryptor(d.create(C.slice(2,4))),this._des3=O.createEncryptor(d.create(C.slice(4,6)))},encryptBlock:function(C,I){this._des1.encryptBlock(C,I),this._des2.decryptBlock(C,I),this._des3.encryptBlock(C,I)},decryptBlock:function(C,I){this._des3.decryptBlock(C,I),this._des2.encryptBlock(C,I),this._des1.decryptBlock(C,I)},keySize:6,ivSize:2,blockSize:2}),l.TripleDES=g._createHelper(m)}(),function(){var s=a,c=s.lib.WordArray;s.enc.Base64={stringify:function(l){var d=l.words,g=l.sigBytes,m=this._map;l.clamp(),l=[];for(var P=0;P<g;P+=3)for(var E=(d[P>>>2]>>>24-8*(P%4)&255)<<16|(d[P+1>>>2]>>>24-8*((P+1)%4)&255)<<8|d[P+2>>>2]>>>24-8*((P+2)%4)&255,N=0;4>N&&P+.75*N<g;N++)l.push(m.charAt(E>>>6*(3-N)&63));if(d=m.charAt(64))for(;l.length%4;)l.push(d);return l.join("")},parse:function(l){var d=l.length,g=this._map,m=g.charAt(64);m&&(m=l.indexOf(m),m!=-1&&(d=m));for(var m=[],P=0,E=0;E<d;E++)if(E%4){var N=g.indexOf(l.charAt(E-1))<<2*(E%4),A=g.indexOf(l.charAt(E))>>>6-2*(E%4);m[P>>>2]|=(N|A)<<24-8*(P%4),P++}return c.create(m,P)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(s){function c(O,C,I,T,D,M,H){return O=O+(C&I|~C&T)+D+H,(O<<M|O>>>32-M)+C}function l(O,C,I,T,D,M,H){return O=O+(C&T|I&~T)+D+H,(O<<M|O>>>32-M)+C}function d(O,C,I,T,D,M,H){return O=O+(C^I^T)+D+H,(O<<M|O>>>32-M)+C}function g(O,C,I,T,D,M,H){return O=O+(I^(C|~T))+D+H,(O<<M|O>>>32-M)+C}for(var m=a,N=m.lib,P=N.WordArray,E=N.Hasher,N=m.algo,A=[],j=0;64>j;j++)A[j]=4294967296*s.abs(s.sin(j+1))|0;N=N.MD5=E.extend({_doReset:function(){this._hash=new P.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(O,C){for(var I=0;16>I;I++){var T=C+I,D=O[T];O[T]=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360}var I=this._hash.words,T=O[C+0],D=O[C+1],M=O[C+2],H=O[C+3],te=O[C+4],ie=O[C+5],re=O[C+6],ae=O[C+7],V=O[C+8],$=O[C+9],Z=O[C+10],q=O[C+11],Y=O[C+12],se=O[C+13],ue=O[C+14],be=O[C+15],le=I[0],Ce=I[1],Se=I[2],pe=I[3],le=c(le,Ce,Se,pe,T,7,A[0]),pe=c(pe,le,Ce,Se,D,12,A[1]),Se=c(Se,pe,le,Ce,M,17,A[2]),Ce=c(Ce,Se,pe,le,H,22,A[3]),le=c(le,Ce,Se,pe,te,7,A[4]),pe=c(pe,le,Ce,Se,ie,12,A[5]),Se=c(Se,pe,le,Ce,re,17,A[6]),Ce=c(Ce,Se,pe,le,ae,22,A[7]),le=c(le,Ce,Se,pe,V,7,A[8]),pe=c(pe,le,Ce,Se,$,12,A[9]),Se=c(Se,pe,le,Ce,Z,17,A[10]),Ce=c(Ce,Se,pe,le,q,22,A[11]),le=c(le,Ce,Se,pe,Y,7,A[12]),pe=c(pe,le,Ce,Se,se,12,A[13]),Se=c(Se,pe,le,Ce,ue,17,A[14]),Ce=c(Ce,Se,pe,le,be,22,A[15]),le=l(le,Ce,Se,pe,D,5,A[16]),pe=l(pe,le,Ce,Se,re,9,A[17]),Se=l(Se,pe,le,Ce,q,14,A[18]),Ce=l(Ce,Se,pe,le,T,20,A[19]),le=l(le,Ce,Se,pe,ie,5,A[20]),pe=l(pe,le,Ce,Se,Z,9,A[21]),Se=l(Se,pe,le,Ce,be,14,A[22]),Ce=l(Ce,Se,pe,le,te,20,A[23]),le=l(le,Ce,Se,pe,$,5,A[24]),pe=l(pe,le,Ce,Se,ue,9,A[25]),Se=l(Se,pe,le,Ce,H,14,A[26]),Ce=l(Ce,Se,pe,le,V,20,A[27]),le=l(le,Ce,Se,pe,se,5,A[28]),pe=l(pe,le,Ce,Se,M,9,A[29]),Se=l(Se,pe,le,Ce,ae,14,A[30]),Ce=l(Ce,Se,pe,le,Y,20,A[31]),le=d(le,Ce,Se,pe,ie,4,A[32]),pe=d(pe,le,Ce,Se,V,11,A[33]),Se=d(Se,pe,le,Ce,q,16,A[34]),Ce=d(Ce,Se,pe,le,ue,23,A[35]),le=d(le,Ce,Se,pe,D,4,A[36]),pe=d(pe,le,Ce,Se,te,11,A[37]),Se=d(Se,pe,le,Ce,ae,16,A[38]),Ce=d(Ce,Se,pe,le,Z,23,A[39]),le=d(le,Ce,Se,pe,se,4,A[40]),pe=d(pe,le,Ce,Se,T,11,A[41]),Se=d(Se,pe,le,Ce,H,16,A[42]),Ce=d(Ce,Se,pe,le,re,23,A[43]),le=d(le,Ce,Se,pe,$,4,A[44]),pe=d(pe,le,Ce,Se,Y,11,A[45]),Se=d(Se,pe,le,Ce,be,16,A[46]),Ce=d(Ce,Se,pe,le,M,23,A[47]),le=g(le,Ce,Se,pe,T,6,A[48]),pe=g(pe,le,Ce,Se,ae,10,A[49]),Se=g(Se,pe,le,Ce,ue,15,A[50]),Ce=g(Ce,Se,pe,le,ie,21,A[51]),le=g(le,Ce,Se,pe,Y,6,A[52]),pe=g(pe,le,Ce,Se,H,10,A[53]),Se=g(Se,pe,le,Ce,Z,15,A[54]),Ce=g(Ce,Se,pe,le,D,21,A[55]),le=g(le,Ce,Se,pe,V,6,A[56]),pe=g(pe,le,Ce,Se,be,10,A[57]),Se=g(Se,pe,le,Ce,re,15,A[58]),Ce=g(Ce,Se,pe,le,se,21,A[59]),le=g(le,Ce,Se,pe,te,6,A[60]),pe=g(pe,le,Ce,Se,q,10,A[61]),Se=g(Se,pe,le,Ce,M,15,A[62]),Ce=g(Ce,Se,pe,le,$,21,A[63]);I[0]=I[0]+le|0,I[1]=I[1]+Ce|0,I[2]=I[2]+Se|0,I[3]=I[3]+pe|0},_doFinalize:function(){var O=this._data,C=O.words,I=8*this._nDataBytes,T=8*O.sigBytes;C[T>>>5]|=128<<24-T%32;var D=s.floor(I/4294967296);for(C[(T+64>>>9<<4)+15]=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360,C[(T+64>>>9<<4)+14]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,O.sigBytes=4*(C.length+1),this._process(),O=this._hash,C=O.words,I=0;4>I;I++)T=C[I],C[I]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360;return O},clone:function(){var O=E.clone.call(this);return O._hash=this._hash.clone(),O}}),m.MD5=E._createHelper(N),m.HmacMD5=E._createHmacHelper(N)}(Math),function(){var s=a,g=s.lib,c=g.WordArray,l=g.Hasher,d=[],g=s.algo.SHA1=l.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(m,P){for(var E=this._hash.words,N=E[0],A=E[1],j=E[2],O=E[3],C=E[4],I=0;80>I;I++){if(16>I)d[I]=m[P+I]|0;else{var T=d[I-3]^d[I-8]^d[I-14]^d[I-16];d[I]=T<<1|T>>>31}T=(N<<5|N>>>27)+C+d[I],T=20>I?T+((A&j|~A&O)+1518500249):40>I?T+((A^j^O)+1859775393):60>I?T+((A&j|A&O|j&O)-1894007588):T+((A^j^O)-899497514),C=O,O=j,j=A<<30|A>>>2,A=N,N=T}E[0]=E[0]+N|0,E[1]=E[1]+A|0,E[2]=E[2]+j|0,E[3]=E[3]+O|0,E[4]=E[4]+C|0},_doFinalize:function(){var m=this._data,P=m.words,E=8*this._nDataBytes,N=8*m.sigBytes;return P[N>>>5]|=128<<24-N%32,P[(N+64>>>9<<4)+14]=Math.floor(E/4294967296),P[(N+64>>>9<<4)+15]=E,m.sigBytes=4*P.length,this._process(),this._hash},clone:function(){var m=l.clone.call(this);return m._hash=this._hash.clone(),m}});s.SHA1=l._createHelper(g),s.HmacSHA1=l._createHmacHelper(g)}(),function(s){for(var c=a,I=c.lib,l=I.WordArray,d=I.Hasher,I=c.algo,g=[],m=[],P=function(D){return 4294967296*(D-(D|0))|0},E=2,N=0;64>N;){var A;e:{A=E;for(var j=s.sqrt(A),O=2;O<=j;O++)if(!(A%O)){A=!1;break e}A=!0}A&&(8>N&&(g[N]=P(s.pow(E,.5))),m[N]=P(s.pow(E,1/3)),N++),E++}var C=[],I=I.SHA256=d.extend({_doReset:function(){this._hash=new l.init(g.slice(0))},_doProcessBlock:function(T,D){for(var M=this._hash.words,H=M[0],te=M[1],ie=M[2],re=M[3],ae=M[4],V=M[5],$=M[6],Z=M[7],q=0;64>q;q++){if(16>q)C[q]=T[D+q]|0;else{var Y=C[q-15],se=C[q-2];C[q]=((Y<<25|Y>>>7)^(Y<<14|Y>>>18)^Y>>>3)+C[q-7]+((se<<15|se>>>17)^(se<<13|se>>>19)^se>>>10)+C[q-16]}Y=Z+((ae<<26|ae>>>6)^(ae<<21|ae>>>11)^(ae<<7|ae>>>25))+(ae&V^~ae&$)+m[q]+C[q],se=((H<<30|H>>>2)^(H<<19|H>>>13)^(H<<10|H>>>22))+(H&te^H&ie^te&ie),Z=$,$=V,V=ae,ae=re+Y|0,re=ie,ie=te,te=H,H=Y+se|0}M[0]=M[0]+H|0,M[1]=M[1]+te|0,M[2]=M[2]+ie|0,M[3]=M[3]+re|0,M[4]=M[4]+ae|0,M[5]=M[5]+V|0,M[6]=M[6]+$|0,M[7]=M[7]+Z|0},_doFinalize:function(){var T=this._data,D=T.words,M=8*this._nDataBytes,H=8*T.sigBytes;return D[H>>>5]|=128<<24-H%32,D[(H+64>>>9<<4)+14]=s.floor(M/4294967296),D[(H+64>>>9<<4)+15]=M,T.sigBytes=4*D.length,this._process(),this._hash},clone:function(){var T=d.clone.call(this);return T._hash=this._hash.clone(),T}});c.SHA256=d._createHelper(I),c.HmacSHA256=d._createHmacHelper(I)}(Math),function(){var s=a,c=s.lib.WordArray,d=s.algo,l=d.SHA256,d=d.SHA224=l.extend({_doReset:function(){this._hash=new c.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var g=l._doFinalize.call(this);return g.sigBytes-=4,g}});s.SHA224=l._createHelper(d),s.HmacSHA224=l._createHmacHelper(d)}(),function(){function s(){return d.create.apply(d,arguments)}for(var c=a,l=c.lib.Hasher,m=c.x64,d=m.Word,g=m.WordArray,m=c.algo,P=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],E=[],N=0;80>N;N++)E[N]=s();m=m.SHA512=l.extend({_doReset:function(){this._hash=new g.init([new d.init(1779033703,4089235720),new d.init(3144134277,2227873595),new d.init(1013904242,4271175723),new d.init(2773480762,1595750129),new d.init(1359893119,2917565137),new d.init(2600822924,725511199),new d.init(528734635,4215389547),new d.init(1541459225,327033209)])},_doProcessBlock:function(A,j){for(var te=this._hash.words,O=te[0],C=te[1],I=te[2],T=te[3],D=te[4],M=te[5],H=te[6],te=te[7],ie=O.high,re=O.low,ae=C.high,V=C.low,$=I.high,Z=I.low,q=T.high,Y=T.low,se=D.high,ue=D.low,be=M.high,le=M.low,pe=H.high,Se=H.low,Ce=te.high,gn=te.low,It=ie,St=re,Kt=ae,nn=V,cn=$,rn=Z,Ua=q,Pn=Y,st=se,gt=ue,Ft=be,Dt=le,Hn=pe,Ut=Se,Ha=Ce,as=gn,Pr=0;80>Pr;Pr++){var Pi=E[Pr];if(16>Pr)var hr=Pi.high=A[j+2*Pr]|0,ht=Pi.low=A[j+2*Pr+1]|0;else{var hr=E[Pr-15],ht=hr.high,Zr=hr.low,hr=(ht>>>1|Zr<<31)^(ht>>>8|Zr<<24)^ht>>>7,Zr=(Zr>>>1|ht<<31)^(Zr>>>8|ht<<24)^(Zr>>>7|ht<<25),os=E[Pr-2],ht=os.high,Ct=os.low,os=(ht>>>19|Ct<<13)^(ht<<3|Ct>>>29)^ht>>>6,Ct=(Ct>>>19|ht<<13)^(Ct<<3|ht>>>29)^(Ct>>>6|ht<<26),ht=E[Pr-7],id=ht.high,Ei=E[Pr-16],Jr=Ei.high,Ei=Ei.low,ht=Zr+ht.low,hr=hr+id+(ht>>>0<Zr>>>0?1:0),ht=ht+Ct,hr=hr+os+(ht>>>0<Ct>>>0?1:0),ht=ht+Ei,hr=hr+Jr+(ht>>>0<Ei>>>0?1:0);Pi.high=hr,Pi.low=ht}var id=st&Ft^~st&Hn,Ei=gt&Dt^~gt&Ut,Pi=It&Kt^It&cn^Kt&cn,Yb=St&nn^St&rn^nn&rn,Zr=(It>>>28|St<<4)^(It<<30|St>>>2)^(It<<25|St>>>7),os=(St>>>28|It<<4)^(St<<30|It>>>2)^(St<<25|It>>>7),Ct=P[Pr],eS=Ct.high,Vf=Ct.low,Ct=as+((gt>>>14|st<<18)^(gt>>>18|st<<14)^(gt<<23|st>>>9)),Jr=Ha+((st>>>14|gt<<18)^(st>>>18|gt<<14)^(st<<23|gt>>>9))+(Ct>>>0<as>>>0?1:0),Ct=Ct+Ei,Jr=Jr+id+(Ct>>>0<Ei>>>0?1:0),Ct=Ct+Vf,Jr=Jr+eS+(Ct>>>0<Vf>>>0?1:0),Ct=Ct+ht,Jr=Jr+hr+(Ct>>>0<ht>>>0?1:0),ht=os+Yb,Pi=Zr+Pi+(ht>>>0<os>>>0?1:0),Ha=Hn,as=Ut,Hn=Ft,Ut=Dt,Ft=st,Dt=gt,gt=Pn+Ct|0,st=Ua+Jr+(gt>>>0<Pn>>>0?1:0)|0,Ua=cn,Pn=rn,cn=Kt,rn=nn,Kt=It,nn=St,St=Ct+ht|0,It=Jr+Pi+(St>>>0<Ct>>>0?1:0)|0}re=O.low=re+St,O.high=ie+It+(re>>>0<St>>>0?1:0),V=C.low=V+nn,C.high=ae+Kt+(V>>>0<nn>>>0?1:0),Z=I.low=Z+rn,I.high=$+cn+(Z>>>0<rn>>>0?1:0),Y=T.low=Y+Pn,T.high=q+Ua+(Y>>>0<Pn>>>0?1:0),ue=D.low=ue+gt,D.high=se+st+(ue>>>0<gt>>>0?1:0),le=M.low=le+Dt,M.high=be+Ft+(le>>>0<Dt>>>0?1:0),Se=H.low=Se+Ut,H.high=pe+Hn+(Se>>>0<Ut>>>0?1:0),gn=te.low=gn+as,te.high=Ce+Ha+(gn>>>0<as>>>0?1:0)},_doFinalize:function(){var A=this._data,j=A.words,O=8*this._nDataBytes,C=8*A.sigBytes;return j[C>>>5]|=128<<24-C%32,j[(C+128>>>10<<5)+30]=Math.floor(O/4294967296),j[(C+128>>>10<<5)+31]=O,A.sigBytes=4*j.length,this._process(),this._hash.toX32()},clone:function(){var A=l.clone.call(this);return A._hash=this._hash.clone(),A},blockSize:32}),c.SHA512=l._createHelper(m),c.HmacSHA512=l._createHmacHelper(m)}(),function(){var s=a,g=s.x64,c=g.Word,l=g.WordArray,g=s.algo,d=g.SHA512,g=g.SHA384=d.extend({_doReset:function(){this._hash=new l.init([new c.init(3418070365,3238371032),new c.init(1654270250,914150663),new c.init(2438529370,812702999),new c.init(355462360,4144912697),new c.init(1731405415,4290775857),new c.init(2394180231,1750603025),new c.init(3675008525,1694076839),new c.init(1203062813,3204075428)])},_doFinalize:function(){var m=d._doFinalize.call(this);return m.sigBytes-=16,m}});s.SHA384=d._createHelper(g),s.HmacSHA384=d._createHmacHelper(g)}(),function(){var s=a,A=s.lib,c=A.WordArray,l=A.Hasher,A=s.algo,d=c.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),g=c.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),m=c.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),P=c.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),E=c.create([0,1518500249,1859775393,2400959708,2840853838]),N=c.create([1352829926,1548603684,1836072691,2053994217,0]),A=A.RIPEMD160=l.extend({_doReset:function(){this._hash=c.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(j,O){for(var C=0;16>C;C++){var I=O+C,T=j[I];j[I]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360}var I=this._hash.words,T=E.words,D=N.words,M=d.words,H=g.words,te=m.words,ie=P.words,re,ae,V,$,Z,q,Y,se,ue,be;q=re=I[0],Y=ae=I[1],se=V=I[2],ue=$=I[3],be=Z=I[4];for(var le,C=0;80>C;C+=1)le=re+j[O+M[C]]|0,le=16>C?le+((ae^V^$)+T[0]):32>C?le+((ae&V|~ae&$)+T[1]):48>C?le+(((ae|~V)^$)+T[2]):64>C?le+((ae&$|V&~$)+T[3]):le+((ae^(V|~$))+T[4]),le|=0,le=le<<te[C]|le>>>32-te[C],le=le+Z|0,re=Z,Z=$,$=V<<10|V>>>22,V=ae,ae=le,le=q+j[O+H[C]]|0,le=16>C?le+((Y^(se|~ue))+D[0]):32>C?le+((Y&ue|se&~ue)+D[1]):48>C?le+(((Y|~se)^ue)+D[2]):64>C?le+((Y&se|~Y&ue)+D[3]):le+((Y^se^ue)+D[4]),le|=0,le=le<<ie[C]|le>>>32-ie[C],le=le+be|0,q=be,be=ue,ue=se<<10|se>>>22,se=Y,Y=le;le=I[1]+V+ue|0,I[1]=I[2]+$+be|0,I[2]=I[3]+Z+q|0,I[3]=I[4]+re+Y|0,I[4]=I[0]+ae+se|0,I[0]=le},_doFinalize:function(){var j=this._data,O=j.words,C=8*this._nDataBytes,I=8*j.sigBytes;for(O[I>>>5]|=128<<24-I%32,O[(I+64>>>9<<4)+14]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,j.sigBytes=4*(O.length+1),this._process(),j=this._hash,O=j.words,C=0;5>C;C++)I=O[C],O[C]=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360;return j},clone:function(){var j=l.clone.call(this);return j._hash=this._hash.clone(),j}});s.RIPEMD160=l._createHelper(A),s.HmacRIPEMD160=l._createHmacHelper(A)}(),function(){var s=a,c=s.enc.Utf8;s.algo.HMAC=s.lib.Base.extend({init:function(l,d){l=this._hasher=new l.init,typeof d=="string"&&(d=c.parse(d));var g=l.blockSize,m=4*g;d.sigBytes>m&&(d=l.finalize(d)),d.clamp();for(var P=this._oKey=d.clone(),E=this._iKey=d.clone(),N=P.words,A=E.words,j=0;j<g;j++)N[j]^=1549556828,A[j]^=909522486;P.sigBytes=E.sigBytes=m,this.reset()},reset:function(){var l=this._hasher;l.reset(),l.update(this._iKey)},update:function(l){return this._hasher.update(l),this},finalize:function(l){var d=this._hasher;return l=d.finalize(l),d.reset(),d.finalize(this._oKey.clone().concat(l))}})}(),function(){var s=a,d=s.lib,c=d.Base,l=d.WordArray,d=s.algo,g=d.HMAC,m=d.PBKDF2=c.extend({cfg:c.extend({keySize:4,hasher:d.SHA1,iterations:1}),init:function(P){this.cfg=this.cfg.extend(P)},compute:function(P,E){for(var T=this.cfg,N=g.create(T.hasher,P),A=l.create(),j=l.create([1]),O=A.words,C=j.words,I=T.keySize,T=T.iterations;O.length<I;){var D=N.update(E).finalize(j);N.reset();for(var M=D.words,H=M.length,te=D,ie=1;ie<T;ie++){te=N.finalize(te),N.reset();for(var re=te.words,ae=0;ae<H;ae++)M[ae]^=re[ae]}A.concat(D),C[0]++}return A.sigBytes=4*I,A}});s.PBKDF2=function(P,E,N){return m.create(N).compute(P,E)}}();var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u="=";function p(s){var c,l,d="";for(c=0;c+3<=s.length;c+=3)l=parseInt(s.substring(c,c+3),16),d+=o.charAt(l>>6)+o.charAt(l&63);for(c+1==s.length?(l=parseInt(s.substring(c,c+1),16),d+=o.charAt(l<<2)):c+2==s.length&&(l=parseInt(s.substring(c,c+2),16),d+=o.charAt(l>>2)+o.charAt((l&3)<<4));(d.length&3)>0;)d+=u;return d}function h(s){var c="",l,d=0,g,m;for(l=0;l<s.length&&s.charAt(l)!=u;++l)m=o.indexOf(s.charAt(l)),!(m<0)&&(d==0?(c+=K(m>>2),g=m&3,d=1):d==1?(c+=K(g<<2|m>>4),g=m&15,d=2):d==2?(c+=K(g),c+=K(m>>2),g=m&3,d=3):(c+=K(g<<2|m>>4),c+=K(m&15),d=0));return d==1&&(c+=K(g<<2)),c}function y(s){var c=h(s),l,d=new Array;for(l=0;2*l<c.length;++l)d[l]=parseInt(c.substring(2*l,2*l+2),16);return d}var f;function _(s,c,l){s!=null&&(typeof s=="number"?this.fromNumber(s,c,l):c==null&&typeof s!="string"?this.fromString(s,256):this.fromString(s,c))}function w(){return new _(null)}function R(s,c,l,d,g,m){for(;--m>=0;){var P=c*this[s++]+l[d]+g;g=Math.floor(P/67108864),l[d++]=P&67108863}return g}function F(s,c,l,d,g,m){for(var P=c&32767,E=c>>15;--m>=0;){var N=this[s]&32767,A=this[s++]>>15,j=E*N+A*P;N=P*N+((j&32767)<<15)+l[d]+(g&1073741823),g=(N>>>30)+(j>>>15)+E*A+(g>>>30),l[d++]=N&1073741823}return g}function S(s,c,l,d,g,m){for(var P=c&16383,E=c>>14;--m>=0;){var N=this[s]&16383,A=this[s++]>>14,j=E*N+A*P;N=P*N+((j&16383)<<14)+l[d]+g,g=(N>>28)+(j>>14)+E*A,l[d++]=N&268435455}return g}t.appName=="Microsoft Internet Explorer"?(_.prototype.am=F,f=30):t.appName!="Netscape"?(_.prototype.am=R,f=26):(_.prototype.am=S,f=28),_.prototype.DB=f,_.prototype.DM=(1<<f)-1,_.prototype.DV=1<<f;var b=52;_.prototype.FV=Math.pow(2,b),_.prototype.F1=b-f,_.prototype.F2=2*f-b;var x="0123456789abcdefghijklmnopqrstuvwxyz",k=new Array,L,G;for(L=48,G=0;G<=9;++G)k[L++]=G;for(L=97,G=10;G<36;++G)k[L++]=G;for(L=65,G=10;G<36;++G)k[L++]=G;function K(s){return x.charAt(s)}function z(s,c){var l=k[s.charCodeAt(c)];return l??-1}function U(s){for(var c=this.t-1;c>=0;--c)s[c]=this[c];s.t=this.t,s.s=this.s}function J(s){this.t=1,this.s=s<0?-1:0,s>0?this[0]=s:s<-1?this[0]=s+this.DV:this.t=0}function Q(s){var c=w();return c.fromInt(s),c}function ne(s,c){var l;if(c==16)l=4;else if(c==8)l=3;else if(c==256)l=8;else if(c==2)l=1;else if(c==32)l=5;else if(c==4)l=2;else{this.fromRadix(s,c);return}this.t=0,this.s=0;for(var d=s.length,g=!1,m=0;--d>=0;){var P=l==8?s[d]&255:z(s,d);if(P<0){s.charAt(d)=="-"&&(g=!0);continue}g=!1,m==0?this[this.t++]=P:m+l>this.DB?(this[this.t-1]|=(P&(1<<this.DB-m)-1)<<m,this[this.t++]=P>>this.DB-m):this[this.t-1]|=P<<m,m+=l,m>=this.DB&&(m-=this.DB)}l==8&&s[0]&128&&(this.s=-1,m>0&&(this[this.t-1]|=(1<<this.DB-m)-1<<m)),this.clamp(),g&&_.ZERO.subTo(this,this)}function oe(){for(var s=this.s&this.DM;this.t>0&&this[this.t-1]==s;)--this.t}function he(s){if(this.s<0)return"-"+this.negate().toString(s);var c;if(s==16)c=4;else if(s==8)c=3;else if(s==2)c=1;else if(s==32)c=5;else if(s==4)c=2;else return this.toRadix(s);var l=(1<<c)-1,d,g=!1,m="",P=this.t,E=this.DB-P*this.DB%c;if(P-- >0)for(E<this.DB&&(d=this[P]>>E)>0&&(g=!0,m=K(d));P>=0;)E<c?(d=(this[P]&(1<<E)-1)<<c-E,d|=this[--P]>>(E+=this.DB-c)):(d=this[P]>>(E-=c)&l,E<=0&&(E+=this.DB,--P)),d>0&&(g=!0),g&&(m+=K(d));return g?m:"0"}function X(){var s=w();return _.ZERO.subTo(this,s),s}function _e(){return this.s<0?this.negate():this}function Pe(s){var c=this.s-s.s;if(c!=0)return c;var l=this.t;if(c=l-s.t,c!=0)return this.s<0?-c:c;for(;--l>=0;)if((c=this[l]-s[l])!=0)return c;return 0}function xe(s){var c=1,l;return(l=s>>>16)!=0&&(s=l,c+=16),(l=s>>8)!=0&&(s=l,c+=8),(l=s>>4)!=0&&(s=l,c+=4),(l=s>>2)!=0&&(s=l,c+=2),(l=s>>1)!=0&&(s=l,c+=1),c}function ge(){return this.t<=0?0:this.DB*(this.t-1)+xe(this[this.t-1]^this.s&this.DM)}function ye(s,c){var l;for(l=this.t-1;l>=0;--l)c[l+s]=this[l];for(l=s-1;l>=0;--l)c[l]=0;c.t=this.t+s,c.s=this.s}function Ee(s,c){for(var l=s;l<this.t;++l)c[l-s]=this[l];c.t=Math.max(this.t-s,0),c.s=this.s}function Ne(s,c){var l=s%this.DB,d=this.DB-l,g=(1<<d)-1,m=Math.floor(s/this.DB),P=this.s<<l&this.DM,E;for(E=this.t-1;E>=0;--E)c[E+m+1]=this[E]>>d|P,P=(this[E]&g)<<l;for(E=m-1;E>=0;--E)c[E]=0;c[m]=P,c.t=this.t+m+1,c.s=this.s,c.clamp()}function Ye(s,c){c.s=this.s;var l=Math.floor(s/this.DB);if(l>=this.t){c.t=0;return}var d=s%this.DB,g=this.DB-d,m=(1<<d)-1;c[0]=this[l]>>d;for(var P=l+1;P<this.t;++P)c[P-l-1]|=(this[P]&m)<<g,c[P-l]=this[P]>>d;d>0&&(c[this.t-l-1]|=(this.s&m)<<g),c.t=this.t-l,c.clamp()}function zt(s,c){for(var l=0,d=0,g=Math.min(s.t,this.t);l<g;)d+=this[l]-s[l],c[l++]=d&this.DM,d>>=this.DB;if(s.t<this.t){for(d-=s.s;l<this.t;)d+=this[l],c[l++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;l<s.t;)d-=s[l],c[l++]=d&this.DM,d>>=this.DB;d-=s.s}c.s=d<0?-1:0,d<-1?c[l++]=this.DV+d:d>0&&(c[l++]=d),c.t=l,c.clamp()}function jt(s,c){var l=this.abs(),d=s.abs(),g=l.t;for(c.t=g+d.t;--g>=0;)c[g]=0;for(g=0;g<d.t;++g)c[g+l.t]=l.am(0,d[g],c,g,0,l.t);c.s=0,c.clamp(),this.s!=s.s&&_.ZERO.subTo(c,c)}function en(s){for(var c=this.abs(),l=s.t=2*c.t;--l>=0;)s[l]=0;for(l=0;l<c.t-1;++l){var d=c.am(l,c[l],s,2*l,0,1);(s[l+c.t]+=c.am(l+1,2*c[l],s,2*l+1,d,c.t-l-1))>=c.DV&&(s[l+c.t]-=c.DV,s[l+c.t+1]=1)}s.t>0&&(s[s.t-1]+=c.am(l,c[l],s,2*l,0,1)),s.s=0,s.clamp()}function Tt(s,c,l){var d=s.abs();if(!(d.t<=0)){var g=this.abs();if(g.t<d.t){c!=null&&c.fromInt(0),l!=null&&this.copyTo(l);return}l==null&&(l=w());var m=w(),P=this.s,E=s.s,N=this.DB-xe(d[d.t-1]);N>0?(d.lShiftTo(N,m),g.lShiftTo(N,l)):(d.copyTo(m),g.copyTo(l));var A=m.t,j=m[A-1];if(j!=0){var O=j*(1<<this.F1)+(A>1?m[A-2]>>this.F2:0),C=this.FV/O,I=(1<<this.F1)/O,T=1<<this.F2,D=l.t,M=D-A,H=c??w();for(m.dlShiftTo(M,H),l.compareTo(H)>=0&&(l[l.t++]=1,l.subTo(H,l)),_.ONE.dlShiftTo(A,H),H.subTo(m,m);m.t<A;)m[m.t++]=0;for(;--M>=0;){var te=l[--D]==j?this.DM:Math.floor(l[D]*C+(l[D-1]+T)*I);if((l[D]+=m.am(0,te,l,M,0,A))<te)for(m.dlShiftTo(M,H),l.subTo(H,l);l[D]<--te;)l.subTo(H,l)}c!=null&&(l.drShiftTo(A,c),P!=E&&_.ZERO.subTo(c,c)),l.t=A,l.clamp(),N>0&&l.rShiftTo(N,l),P<0&&_.ZERO.subTo(l,l)}}}function et(s){var c=w();return this.abs().divRemTo(s,null,c),this.s<0&&c.compareTo(_.ZERO)>0&&s.subTo(c,c),c}function dt(s){this.m=s}function on(s){return s.s<0||s.compareTo(this.m)>=0?s.mod(this.m):s}function fn(s){return s}function Wr(s){s.divRemTo(this.m,null,s)}function Uu(s,c,l){s.multiplyTo(c,l),this.reduce(l)}function Ms(s,c){s.squareTo(c),this.reduce(c)}dt.prototype.convert=on,dt.prototype.revert=fn,dt.prototype.reduce=Wr,dt.prototype.mulTo=Uu,dt.prototype.sqrTo=Ms;function uc(){if(this.t<1)return 0;var s=this[0];if(!(s&1))return 0;var c=s&3;return c=c*(2-(s&15)*c)&15,c=c*(2-(s&255)*c)&255,c=c*(2-((s&65535)*c&65535))&65535,c=c*(2-s*c%this.DV)%this.DV,c>0?this.DV-c:-c}function Ln(s){this.m=s,this.mp=s.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<s.DB-15)-1,this.mt2=2*s.t}function Hu(s){var c=w();return s.abs().dlShiftTo(this.m.t,c),c.divRemTo(this.m,null,c),s.s<0&&c.compareTo(_.ZERO)>0&&this.m.subTo(c,c),c}function Na(s){var c=w();return s.copyTo(c),this.reduce(c),c}function ss(s){for(;s.t<=this.mt2;)s[s.t++]=0;for(var c=0;c<this.m.t;++c){var l=s[c]&32767,d=l*this.mpl+((l*this.mph+(s[c]>>15)*this.mpl&this.um)<<15)&s.DM;for(l=c+this.m.t,s[l]+=this.m.am(0,d,s,c,0,this.m.t);s[l]>=s.DV;)s[l]-=s.DV,s[++l]++}s.clamp(),s.drShiftTo(this.m.t,s),s.compareTo(this.m)>=0&&s.subTo(this.m,s)}function Ls(s,c){s.squareTo(c),this.reduce(c)}function Vu(s,c,l){s.multiplyTo(c,l),this.reduce(l)}Ln.prototype.convert=Hu,Ln.prototype.revert=Na,Ln.prototype.reduce=ss,Ln.prototype.mulTo=Vu,Ln.prototype.sqrTo=Ls;function dc(){return(this.t>0?this[0]&1:this.s)==0}function hc(s,c){if(s>4294967295||s<1)return _.ONE;var l=w(),d=w(),g=c.convert(this),m=xe(s)-1;for(g.copyTo(l);--m>=0;)if(c.sqrTo(l,d),(s&1<<m)>0)c.mulTo(d,g,l);else{var P=l;l=d,d=P}return c.revert(l)}function Cn(s,c){var l;return s<256||c.isEven()?l=new dt(c):l=new Ln(c),this.exp(s,l)}_.prototype.copyTo=U,_.prototype.fromInt=J,_.prototype.fromString=ne,_.prototype.clamp=oe,_.prototype.dlShiftTo=ye,_.prototype.drShiftTo=Ee,_.prototype.lShiftTo=Ne,_.prototype.rShiftTo=Ye,_.prototype.subTo=zt,_.prototype.multiplyTo=jt,_.prototype.squareTo=en,_.prototype.divRemTo=Tt,_.prototype.invDigit=uc,_.prototype.isEven=dc,_.prototype.exp=hc,_.prototype.toString=he,_.prototype.negate=X,_.prototype.abs=_e,_.prototype.compareTo=Pe,_.prototype.bitLength=ge,_.prototype.mod=et,_.prototype.modPowInt=Cn,_.ZERO=Q(0),_.ONE=Q(1);function Ci(){var s=w();return this.copyTo(s),s}function js(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function tt(){return this.t==0?this.s:this[0]<<24>>24}function ot(){return this.t==0?this.s:this[0]<<16>>16}function Ge(s){return Math.floor(Math.LN2*this.DB/Math.log(s))}function yt(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function xr(s){if(s==null&&(s=10),this.signum()==0||s<2||s>36)return"0";var c=this.chunkSize(s),l=Math.pow(s,c),d=Q(l),g=w(),m=w(),P="";for(this.divRemTo(d,g,m);g.signum()>0;)P=(l+m.intValue()).toString(s).substr(1)+P,g.divRemTo(d,g,m);return m.intValue().toString(s)+P}function ur(s,c){this.fromInt(0),c==null&&(c=10);for(var l=this.chunkSize(c),d=Math.pow(c,l),g=!1,m=0,P=0,E=0;E<s.length;++E){var N=z(s,E);if(N<0){s.charAt(E)=="-"&&this.signum()==0&&(g=!0);continue}P=c*P+N,++m>=l&&(this.dMultiply(d),this.dAddOffset(P,0),m=0,P=0)}m>0&&(this.dMultiply(Math.pow(c,m)),this.dAddOffset(P,0)),g&&_.ZERO.subTo(this,this)}function lt(s,c,l){if(typeof c=="number")if(s<2)this.fromInt(1);else for(this.fromNumber(s,l),this.testBit(s-1)||this.bitwiseTo(_.ONE.shiftLeft(s-1),qu,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>s&&this.subTo(_.ONE.shiftLeft(s-1),this);else{var d=new Array,g=s&7;d.length=(s>>3)+1,c.nextBytes(d),g>0?d[0]&=(1<<g)-1:d[0]=0,this.fromString(d,256)}}function ze(){var s=this.t,c=new Array;c[0]=this.s;var l=this.DB-s*this.DB%8,d,g=0;if(s-- >0)for(l<this.DB&&(d=this[s]>>l)!=(this.s&this.DM)>>l&&(c[g++]=d|this.s<<this.DB-l);s>=0;)l<8?(d=(this[s]&(1<<l)-1)<<8-l,d|=this[--s]>>(l+=this.DB-8)):(d=this[s]>>(l-=8)&255,l<=0&&(l+=this.DB,--s)),d&128&&(d|=-256),g==0&&(this.s&128)!=(d&128)&&++g,(g>0||d!=this.s)&&(c[g++]=d);return c}function dr(s){return this.compareTo(s)==0}function Oa(s){return this.compareTo(s)<0?this:s}function pc(s){return this.compareTo(s)>0?this:s}function s1(s,c,l){var d,g,m=Math.min(s.t,this.t);for(d=0;d<m;++d)l[d]=c(this[d],s[d]);if(s.t<this.t){for(g=s.s&this.DM,d=m;d<this.t;++d)l[d]=c(this[d],g);l.t=this.t}else{for(g=this.s&this.DM,d=m;d<s.t;++d)l[d]=c(g,s[d]);l.t=s.t}l.s=c(this.s,s.s),l.clamp()}function a1(s,c){return s&c}function o1(s){var c=w();return this.bitwiseTo(s,a1,c),c}function qu(s,c){return s|c}function c1(s){var c=w();return this.bitwiseTo(s,qu,c),c}function wf(s,c){return s^c}function l1(s){var c=w();return this.bitwiseTo(s,wf,c),c}function xf(s,c){return s&~c}function u1(s){var c=w();return this.bitwiseTo(s,xf,c),c}function d1(){for(var s=w(),c=0;c<this.t;++c)s[c]=this.DM&~this[c];return s.t=this.t,s.s=~this.s,s}function h1(s){var c=w();return s<0?this.rShiftTo(-s,c):this.lShiftTo(s,c),c}function p1(s){var c=w();return s<0?this.lShiftTo(-s,c):this.rShiftTo(s,c),c}function f1(s){if(s==0)return-1;var c=0;return s&65535||(s>>=16,c+=16),s&255||(s>>=8,c+=8),s&15||(s>>=4,c+=4),s&3||(s>>=2,c+=2),s&1||++c,c}function m1(){for(var s=0;s<this.t;++s)if(this[s]!=0)return s*this.DB+f1(this[s]);return this.s<0?this.t*this.DB:-1}function g1(s){for(var c=0;s!=0;)s&=s-1,++c;return c}function v1(){for(var s=0,c=this.s&this.DM,l=0;l<this.t;++l)s+=g1(this[l]^c);return s}function y1(s){var c=Math.floor(s/this.DB);return c>=this.t?this.s!=0:(this[c]&1<<s%this.DB)!=0}function _1(s,c){var l=_.ONE.shiftLeft(s);return this.bitwiseTo(l,c,l),l}function b1(s){return this.changeBit(s,qu)}function S1(s){return this.changeBit(s,xf)}function w1(s){return this.changeBit(s,wf)}function x1(s,c){for(var l=0,d=0,g=Math.min(s.t,this.t);l<g;)d+=this[l]+s[l],c[l++]=d&this.DM,d>>=this.DB;if(s.t<this.t){for(d+=s.s;l<this.t;)d+=this[l],c[l++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;l<s.t;)d+=s[l],c[l++]=d&this.DM,d>>=this.DB;d+=s.s}c.s=d<0?-1:0,d>0?c[l++]=d:d<-1&&(c[l++]=this.DV+d),c.t=l,c.clamp()}function C1(s){var c=w();return this.addTo(s,c),c}function E1(s){var c=w();return this.subTo(s,c),c}function P1(s){var c=w();return this.multiplyTo(s,c),c}function k1(){var s=w();return this.squareTo(s),s}function T1(s){var c=w();return this.divRemTo(s,c,null),c}function R1(s){var c=w();return this.divRemTo(s,null,c),c}function A1(s){var c=w(),l=w();return this.divRemTo(s,c,l),new Array(c,l)}function I1(s){this[this.t]=this.am(0,s-1,this,0,0,this.t),++this.t,this.clamp()}function F1(s,c){if(s!=0){for(;this.t<=c;)this[this.t++]=0;for(this[c]+=s;this[c]>=this.DV;)this[c]-=this.DV,++c>=this.t&&(this[this.t++]=0),++this[c]}}function Ma(){}function Cf(s){return s}function D1(s,c,l){s.multiplyTo(c,l)}function N1(s,c){s.squareTo(c)}Ma.prototype.convert=Cf,Ma.prototype.revert=Cf,Ma.prototype.mulTo=D1,Ma.prototype.sqrTo=N1;function O1(s){return this.exp(s,new Ma)}function M1(s,c,l){var d=Math.min(this.t+s.t,c);for(l.s=0,l.t=d;d>0;)l[--d]=0;var g;for(g=l.t-this.t;d<g;++d)l[d+this.t]=this.am(0,s[d],l,d,0,this.t);for(g=Math.min(s.t,c);d<g;++d)this.am(0,s[d],l,d,0,c-d);l.clamp()}function L1(s,c,l){--c;var d=l.t=this.t+s.t-c;for(l.s=0;--d>=0;)l[d]=0;for(d=Math.max(c-this.t,0);d<s.t;++d)l[this.t+d-c]=this.am(c-d,s[d],l,0,0,this.t+d-c);l.clamp(),l.drShiftTo(1,l)}function Bs(s){this.r2=w(),this.q3=w(),_.ONE.dlShiftTo(2*s.t,this.r2),this.mu=this.r2.divide(s),this.m=s}function j1(s){if(s.s<0||s.t>2*this.m.t)return s.mod(this.m);if(s.compareTo(this.m)<0)return s;var c=w();return s.copyTo(c),this.reduce(c),c}function B1(s){return s}function U1(s){for(s.drShiftTo(this.m.t-1,this.r2),s.t>this.m.t+1&&(s.t=this.m.t+1,s.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);s.compareTo(this.r2)<0;)s.dAddOffset(1,this.m.t+1);for(s.subTo(this.r2,s);s.compareTo(this.m)>=0;)s.subTo(this.m,s)}function H1(s,c){s.squareTo(c),this.reduce(c)}function V1(s,c,l){s.multiplyTo(c,l),this.reduce(l)}Bs.prototype.convert=j1,Bs.prototype.revert=B1,Bs.prototype.reduce=U1,Bs.prototype.mulTo=V1,Bs.prototype.sqrTo=H1;function q1(s,c){var l=s.bitLength(),d,g=Q(1),m;if(l<=0)return g;l<18?d=1:l<48?d=3:l<144?d=4:l<768?d=5:d=6,l<8?m=new dt(c):c.isEven()?m=new Bs(c):m=new Ln(c);var P=new Array,E=3,N=d-1,A=(1<<d)-1;if(P[1]=m.convert(this),d>1){var j=w();for(m.sqrTo(P[1],j);E<=A;)P[E]=w(),m.mulTo(j,P[E-2],P[E]),E+=2}var O=s.t-1,C,I=!0,T=w(),D;for(l=xe(s[O])-1;O>=0;){for(l>=N?C=s[O]>>l-N&A:(C=(s[O]&(1<<l+1)-1)<<N-l,O>0&&(C|=s[O-1]>>this.DB+l-N)),E=d;!(C&1);)C>>=1,--E;if((l-=E)<0&&(l+=this.DB,--O),I)P[C].copyTo(g),I=!1;else{for(;E>1;)m.sqrTo(g,T),m.sqrTo(T,g),E-=2;E>0?m.sqrTo(g,T):(D=g,g=T,T=D),m.mulTo(T,P[C],g)}for(;O>=0&&!(s[O]&1<<l);)m.sqrTo(g,T),D=g,g=T,T=D,--l<0&&(l=this.DB-1,--O)}return m.revert(g)}function z1(s){var c=this.s<0?this.negate():this.clone(),l=s.s<0?s.negate():s.clone();if(c.compareTo(l)<0){var d=c;c=l,l=d}var g=c.getLowestSetBit(),m=l.getLowestSetBit();if(m<0)return c;for(g<m&&(m=g),m>0&&(c.rShiftTo(m,c),l.rShiftTo(m,l));c.signum()>0;)(g=c.getLowestSetBit())>0&&c.rShiftTo(g,c),(g=l.getLowestSetBit())>0&&l.rShiftTo(g,l),c.compareTo(l)>=0?(c.subTo(l,c),c.rShiftTo(1,c)):(l.subTo(c,l),l.rShiftTo(1,l));return m>0&&l.lShiftTo(m,l),l}function K1(s){if(s<=0)return 0;var c=this.DV%s,l=this.s<0?s-1:0;if(this.t>0)if(c==0)l=this[0]%s;else for(var d=this.t-1;d>=0;--d)l=(c*l+this[d])%s;return l}function $1(s){var c=s.isEven();if(this.isEven()&&c||s.signum()==0)return _.ZERO;for(var l=s.clone(),d=this.clone(),g=Q(1),m=Q(0),P=Q(0),E=Q(1);l.signum()!=0;){for(;l.isEven();)l.rShiftTo(1,l),c?((!g.isEven()||!m.isEven())&&(g.addTo(this,g),m.subTo(s,m)),g.rShiftTo(1,g)):m.isEven()||m.subTo(s,m),m.rShiftTo(1,m);for(;d.isEven();)d.rShiftTo(1,d),c?((!P.isEven()||!E.isEven())&&(P.addTo(this,P),E.subTo(s,E)),P.rShiftTo(1,P)):E.isEven()||E.subTo(s,E),E.rShiftTo(1,E);l.compareTo(d)>=0?(l.subTo(d,l),c&&g.subTo(P,g),m.subTo(E,m)):(d.subTo(l,d),c&&P.subTo(g,P),E.subTo(m,E))}if(d.compareTo(_.ONE)!=0)return _.ZERO;if(E.compareTo(s)>=0)return E.subtract(s);if(E.signum()<0)E.addTo(s,E);else return E;return E.signum()<0?E.add(s):E}var En=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],W1=(1<<26)/En[En.length-1];function G1(s){var c,l=this.abs();if(l.t==1&&l[0]<=En[En.length-1]){for(c=0;c<En.length;++c)if(l[0]==En[c])return!0;return!1}if(l.isEven())return!1;for(c=1;c<En.length;){for(var d=En[c],g=c+1;g<En.length&&d<W1;)d*=En[g++];for(d=l.modInt(d);c<g;)if(d%En[c++]==0)return!1}return l.millerRabin(s)}function Z1(s){var c=this.subtract(_.ONE),l=c.getLowestSetBit();if(l<=0)return!1;var d=c.shiftRight(l);s=s+1>>1,s>En.length&&(s=En.length);for(var g=w(),m=0;m<s;++m){g.fromInt(En[Math.floor(Math.random()*En.length)]);var P=g.modPow(d,this);if(P.compareTo(_.ONE)!=0&&P.compareTo(c)!=0){for(var E=1;E++<l&&P.compareTo(c)!=0;)if(P=P.modPowInt(2,this),P.compareTo(_.ONE)==0)return!1;if(P.compareTo(c)!=0)return!1}}return!0}_.prototype.chunkSize=Ge,_.prototype.toRadix=xr,_.prototype.fromRadix=ur,_.prototype.fromNumber=lt,_.prototype.bitwiseTo=s1,_.prototype.changeBit=_1,_.prototype.addTo=x1,_.prototype.dMultiply=I1,_.prototype.dAddOffset=F1,_.prototype.multiplyLowerTo=M1,_.prototype.multiplyUpperTo=L1,_.prototype.modInt=K1,_.prototype.millerRabin=Z1,_.prototype.clone=Ci,_.prototype.intValue=js,_.prototype.byteValue=tt,_.prototype.shortValue=ot,_.prototype.signum=yt,_.prototype.toByteArray=ze,_.prototype.equals=dr,_.prototype.min=Oa,_.prototype.max=pc,_.prototype.and=o1,_.prototype.or=c1,_.prototype.xor=l1,_.prototype.andNot=u1,_.prototype.not=d1,_.prototype.shiftLeft=h1,_.prototype.shiftRight=p1,_.prototype.getLowestSetBit=m1,_.prototype.bitCount=v1,_.prototype.testBit=y1,_.prototype.setBit=b1,_.prototype.clearBit=S1,_.prototype.flipBit=w1,_.prototype.add=C1,_.prototype.subtract=E1,_.prototype.multiply=P1,_.prototype.divide=T1,_.prototype.remainder=R1,_.prototype.divideAndRemainder=A1,_.prototype.modPow=q1,_.prototype.modInverse=$1,_.prototype.pow=O1,_.prototype.gcd=z1,_.prototype.isProbablePrime=G1,_.prototype.square=k1;function zu(){this.i=0,this.j=0,this.S=new Array}function J1(s){var c,l,d;for(c=0;c<256;++c)this.S[c]=c;for(l=0,c=0;c<256;++c)l=l+this.S[c]+s[c%s.length]&255,d=this.S[c],this.S[c]=this.S[l],this.S[l]=d;this.i=0,this.j=0}function Q1(){var s;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,s=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=s,this.S[s+this.S[this.i]&255]}zu.prototype.init=J1,zu.prototype.next=Q1;function X1(){return new zu}var Ku=256,fc,er,tn;function Y1(s){er[tn++]^=s&255,er[tn++]^=s>>8&255,er[tn++]^=s>>16&255,er[tn++]^=s>>24&255,tn>=Ku&&(tn-=Ku)}function $u(){Y1(new Date().getTime())}if(er==null){if(er=new Array,tn=0,n!==void 0&&(n.crypto!==void 0||n.msCrypto!==void 0)){if(Wu=n.crypto||n.msCrypto,Wu.getRandomValues)for(Gu=new Uint8Array(32),Wu.getRandomValues(Gu),Cr=0;Cr<32;++Cr)er[tn++]=Gu[Cr];else if(t.appName=="Netscape"&&t.appVersion<"5")for(Zu=n.crypto.random(32),Cr=0;Cr<Zu.length;++Cr)er[tn++]=Zu.charCodeAt(Cr)&255}for(;tn<Ku;)Cr=Math.floor(65536*Math.random()),er[tn++]=Cr>>>8,er[tn++]=Cr&255;tn=0,$u()}var Cr,Wu,Gu,Zu;function eb(){if(fc==null){for($u(),fc=X1(),fc.init(er),tn=0;tn<er.length;++tn)er[tn]=0;tn=0}return fc.next()}function tb(s){var c;for(c=0;c<s.length;++c)s[c]=eb()}function Us(){}Us.prototype.nextBytes=tb;function jn(s,c){return new _(s,c)}function Ke(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function nb(s,c){if(this.isPublic=!0,this.isPrivate=!1,typeof s!="string")this.n=s,this.e=c;else if(s!=null&&c!=null&&s.length>0&&c.length>0)this.n=jn(s,16),this.e=parseInt(c,16);else throw"Invalid RSA public key"}function rb(s){return s.modPowInt(this.e,this.n)}Ke.prototype.doPublic=rb,Ke.prototype.setPublic=nb,Ke.prototype.type="RSA";function ib(s,c,l){if(this.isPrivate=!0,typeof s!="string")this.n=s,this.e=c,this.d=l;else if(s!=null&&c!=null&&s.length>0&&c.length>0)this.n=jn(s,16),this.e=parseInt(c,16),this.d=jn(l,16);else throw"Invalid RSA private key"}function sb(s,c,l,d,g,m,P,E){if(this.isPrivate=!0,this.isPublic=!1,s==null)throw"RSASetPrivateEx N == null";if(c==null)throw"RSASetPrivateEx E == null";if(s.length==0)throw"RSASetPrivateEx N.length == 0";if(c.length==0)throw"RSASetPrivateEx E.length == 0";if(s!=null&&c!=null&&s.length>0&&c.length>0)this.n=jn(s,16),this.e=parseInt(c,16),this.d=jn(l,16),this.p=jn(d,16),this.q=jn(g,16),this.dmp1=jn(m,16),this.dmq1=jn(P,16),this.coeff=jn(E,16);else throw"Invalid RSA private key in RSASetPrivateEx"}function ab(s,c){var l=new Us,d=s>>1;this.e=parseInt(c,16);for(var g=new _(c,16),m=s/2-100,P=_.ONE.shiftLeft(m);;){for(;this.p=new _(s-d,1,l),!(this.p.subtract(_.ONE).gcd(g).compareTo(_.ONE)==0&&this.p.isProbablePrime(10)););for(;this.q=new _(d,1,l),!(this.q.subtract(_.ONE).gcd(g).compareTo(_.ONE)==0&&this.q.isProbablePrime(10)););if(this.p.compareTo(this.q)<=0){var E=this.p;this.p=this.q,this.q=E}var N=this.q.subtract(this.p).abs();if(!(N.bitLength()<m||N.compareTo(P)<=0)){var A=this.p.subtract(_.ONE),j=this.q.subtract(_.ONE),O=A.multiply(j);if(O.gcd(g).compareTo(_.ONE)==0&&(this.n=this.p.multiply(this.q),this.n.bitLength()==s)){this.d=g.modInverse(O),this.dmp1=this.d.mod(A),this.dmq1=this.d.mod(j),this.coeff=this.q.modInverse(this.p);break}}}this.isPrivate=!0}function ob(s){if(this.p==null||this.q==null)return s.modPow(this.d,this.n);for(var c=s.mod(this.p).modPow(this.dmp1,this.p),l=s.mod(this.q).modPow(this.dmq1,this.q);c.compareTo(l)<0;)c=c.add(this.p);return c.subtract(l).multiply(this.coeff).mod(this.p).multiply(this.q).add(l)}Ke.prototype.doPrivate=ob,Ke.prototype.setPrivate=ib,Ke.prototype.setPrivateEx=sb,Ke.prototype.generate=ab;function Jt(s,c){this.x=c,this.q=s}function cb(s){return s==this?!0:this.q.equals(s.q)&&this.x.equals(s.x)}function lb(){return this.x}function ub(){return new Jt(this.q,this.x.negate().mod(this.q))}function db(s){return new Jt(this.q,this.x.add(s.toBigInteger()).mod(this.q))}function hb(s){return new Jt(this.q,this.x.subtract(s.toBigInteger()).mod(this.q))}function pb(s){return new Jt(this.q,this.x.multiply(s.toBigInteger()).mod(this.q))}function fb(){return new Jt(this.q,this.x.square().mod(this.q))}function mb(s){return new Jt(this.q,this.x.multiply(s.toBigInteger().modInverse(this.q)).mod(this.q))}Jt.prototype.equals=cb,Jt.prototype.toBigInteger=lb,Jt.prototype.negate=ub,Jt.prototype.add=db,Jt.prototype.subtract=hb,Jt.prototype.multiply=pb,Jt.prototype.square=fb,Jt.prototype.divide=mb,Jt.prototype.sqrt=function(){return new Jt(this.q,this.x.sqrt().mod(this.q))};function ut(s,c,l,d){this.curve=s,this.x=c,this.y=l,d==null?this.z=_.ONE:this.z=d,this.zinv=null}function gb(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function vb(){return this.zinv==null&&(this.zinv=this.z.modInverse(this.curve.q)),this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function yb(s){if(s==this)return!0;if(this.isInfinity())return s.isInfinity();if(s.isInfinity())return this.isInfinity();var c,l;return c=s.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(s.z)).mod(this.curve.q),c.equals(_.ZERO)?(l=s.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(s.z)).mod(this.curve.q),l.equals(_.ZERO)):!1}function _b(){return this.x==null&&this.y==null?!0:this.z.equals(_.ZERO)&&!this.y.toBigInteger().equals(_.ZERO)}function bb(){return new ut(this.curve,this.x,this.y.negate(),this.z)}function Sb(s){if(this.isInfinity())return s;if(s.isInfinity())return this;var c=s.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(s.z)).mod(this.curve.q),l=s.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(s.z)).mod(this.curve.q);if(_.ZERO.equals(l))return _.ZERO.equals(c)?this.twice():this.curve.getInfinity();var d=new _("3"),g=this.x.toBigInteger(),m=this.y.toBigInteger();s.x.toBigInteger(),s.y.toBigInteger();var P=l.square(),E=P.multiply(l),N=g.multiply(P),A=c.square().multiply(this.z),j=A.subtract(N.shiftLeft(1)).multiply(s.z).subtract(E).multiply(l).mod(this.curve.q),O=N.multiply(d).multiply(c).subtract(m.multiply(E)).subtract(A.multiply(c)).multiply(s.z).add(c.multiply(E)).mod(this.curve.q),C=E.multiply(this.z).multiply(s.z).mod(this.curve.q);return new ut(this.curve,this.curve.fromBigInteger(j),this.curve.fromBigInteger(O),C)}function wb(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var s=new _("3"),c=this.x.toBigInteger(),l=this.y.toBigInteger(),d=l.multiply(this.z),g=d.multiply(l).mod(this.curve.q),m=this.curve.a.toBigInteger(),P=c.square().multiply(s);_.ZERO.equals(m)||(P=P.add(this.z.square().multiply(m))),P=P.mod(this.curve.q);var E=P.square().subtract(c.shiftLeft(3).multiply(g)).shiftLeft(1).multiply(d).mod(this.curve.q),N=P.multiply(s).multiply(c).subtract(g.shiftLeft(1)).shiftLeft(2).multiply(g).subtract(P.square().multiply(P)).mod(this.curve.q),A=d.square().multiply(d).shiftLeft(3).mod(this.curve.q);return new ut(this.curve,this.curve.fromBigInteger(E),this.curve.fromBigInteger(N),A)}function xb(s){if(this.isInfinity())return this;if(s.signum()==0)return this.curve.getInfinity();var c=s,l=c.multiply(new _("3")),d=this.negate(),g=this,m=this.curve.q.subtract(s),P=m.multiply(new _("3")),E=new ut(this.curve,this.x,this.y),N=E.negate(),A;for(A=l.bitLength()-2;A>0;--A){g=g.twice();var j=l.testBit(A),O=c.testBit(A);j!=O&&(g=g.add(j?this:d))}for(A=P.bitLength()-2;A>0;--A){E=E.twice();var C=P.testBit(A),I=m.testBit(A);C!=I&&(E=E.add(C?E:N))}return g}function Cb(s,c,l){var d;s.bitLength()>l.bitLength()?d=s.bitLength()-1:d=l.bitLength()-1;for(var g=this.curve.getInfinity(),m=this.add(c);d>=0;)g=g.twice(),s.testBit(d)?l.testBit(d)?g=g.add(m):g=g.add(this):l.testBit(d)&&(g=g.add(c)),--d;return g}ut.prototype.getX=gb,ut.prototype.getY=vb,ut.prototype.equals=yb,ut.prototype.isInfinity=_b,ut.prototype.negate=bb,ut.prototype.add=Sb,ut.prototype.twice=wb,ut.prototype.multiply=xb,ut.prototype.multiplyTwo=Cb;function oi(s,c,l){this.q=s,this.a=this.fromBigInteger(c),this.b=this.fromBigInteger(l),this.infinity=new ut(this,null,null)}function Eb(){return this.q}function Pb(){return this.a}function kb(){return this.b}function Tb(s){return s==this?!0:this.q.equals(s.q)&&this.a.equals(s.a)&&this.b.equals(s.b)}function Rb(){return this.infinity}function Ab(s){return new Jt(this.q,s)}function Ib(s){switch(parseInt(s.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:var c=s.substr(0,2);s.substr(2);var l=this.fromBigInteger(new _(N,16)),d=this.getA(),g=this.getB(),m=l.square().add(d).multiply(l).add(g),P=m.sqrt();return c=="03"&&(P=P.negate()),new ut(this,l,P);case 4:case 6:case 7:var E=(s.length-2)/2,N=s.substr(2,E),A=s.substr(E+2,E);return new ut(this,this.fromBigInteger(new _(N,16)),this.fromBigInteger(new _(A,16)));default:return null}}oi.prototype.getQ=Eb,oi.prototype.getA=Pb,oi.prototype.getB=kb,oi.prototype.equals=Tb,oi.prototype.getInfinity=Rb,oi.prototype.fromBigInteger=Ab,oi.prototype.decodePointHex=Ib,Jt.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)},ut.prototype.getEncoded=function(s){var c=function(m,P){var E=m.toByteArrayUnsigned();if(P<E.length)E=E.slice(E.length-P);else for(;P>E.length;)E.unshift(0);return E},l=this.getX().toBigInteger(),d=this.getY().toBigInteger(),g=c(l,32);return s?d.isEven()?g.unshift(2):g.unshift(3):(g.unshift(4),g=g.concat(c(d,32))),g},ut.decodeFrom=function(s,c){c[0];var l=c.length-1,d=c.slice(1,1+l/2),g=c.slice(1+l/2,1+l);d.unshift(0),g.unshift(0);var m=new _(d),P=new _(g);return new ut(s,s.fromBigInteger(m),s.fromBigInteger(P))},ut.decodeFromHex=function(s,c){c.substr(0,2);var l=c.length-2,d=c.substr(2,l/2),g=c.substr(2+l/2,l/2),m=new _(d,16),P=new _(g,16);return new ut(s,s.fromBigInteger(m),s.fromBigInteger(P))},ut.prototype.add2D=function(s){if(this.isInfinity())return s;if(s.isInfinity())return this;if(this.x.equals(s.x))return this.y.equals(s.y)?this.twice():this.curve.getInfinity();var c=s.x.subtract(this.x),l=s.y.subtract(this.y),d=l.divide(c),g=d.square().subtract(this.x).subtract(s.x),m=d.multiply(this.x.subtract(g)).subtract(this.y);return new ut(this.curve,g,m)},ut.prototype.twice2D=function(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var s=this.curve.fromBigInteger(_.valueOf(2)),c=this.curve.fromBigInteger(_.valueOf(3)),l=this.x.square().multiply(c).add(this.curve.a).divide(this.y.multiply(s)),d=l.square().subtract(this.x.multiply(s)),g=l.multiply(this.x.subtract(d)).subtract(this.y);return new ut(this.curve,d,g)},ut.prototype.multiply2D=function(s){if(this.isInfinity())return this;if(s.signum()==0)return this.curve.getInfinity();var c=s,l=c.multiply(new _("3")),d=this.negate(),g=this,m;for(m=l.bitLength()-2;m>0;--m){g=g.twice();var P=l.testBit(m),E=c.testBit(m);P!=E&&(g=g.add2D(P?this:d))}return g},ut.prototype.isOnCurve=function(){var s=this.getX().toBigInteger(),c=this.getY().toBigInteger(),l=this.curve.getA().toBigInteger(),d=this.curve.getB().toBigInteger(),g=this.curve.getQ(),m=c.multiply(c).mod(g),P=s.multiply(s).multiply(s).add(l.multiply(s)).add(d).mod(g);return m.equals(P)},ut.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"},ut.prototype.validate=function(){var s=this.curve.getQ();if(this.isInfinity())throw new Error("Point is at infinity.");var c=this.getX().toBigInteger(),l=this.getY().toBigInteger();if(c.compareTo(_.ONE)<0||c.compareTo(s.subtract(_.ONE))>0)throw new Error("x coordinate out of bounds");if(l.compareTo(_.ONE)<0||l.compareTo(s.subtract(_.ONE))>0)throw new Error("y coordinate out of bounds");if(!this.isOnCurve())throw new Error("Point is not on the curve.");if(this.multiply(s).isInfinity())throw new Error("Point is not a scalar multiple of G.");return!0};var Ef=function(){var s="(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)",c='(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))',l='(?:"'+c+'*")',d=new RegExp("(?:false|true|null|[\\{\\}\\[\\]]|"+s+"|"+l+")","g"),g=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),m={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};function P(j,O,C){return O?m[O]:String.fromCharCode(parseInt(C,16))}var E=new String(""),N="\\",A=Object.hasOwnProperty;return function(j,O){var C=j.match(d),I,T=C[0],D=!1;T==="{"?I={}:T==="["?I=[]:(I=[],D=!0);for(var M,H=[I],te=1-D,ie=C.length;te<ie;++te){T=C[te];var re;switch(T.charCodeAt(0)){default:re=H[0],re[M||re.length]=+T,M=void 0;break;case 34:if(T=T.substring(1,T.length-1),T.indexOf(N)!==-1&&(T=T.replace(g,P)),re=H[0],!M)if(re instanceof Array)M=re.length;else{M=T||E;break}re[M]=T,M=void 0;break;case 91:re=H[0],H.unshift(re[M||re.length]=[]),M=void 0;break;case 93:H.shift();break;case 102:re=H[0],re[M||re.length]=!1,M=void 0;break;case 110:re=H[0],re[M||re.length]=null,M=void 0;break;case 116:re=H[0],re[M||re.length]=!0,M=void 0;break;case 123:re=H[0],H.unshift(re[M||re.length]={}),M=void 0;break;case 125:H.shift();break}}if(D){if(H.length!==1)throw new Error;I=I[0]}else if(H.length)throw new Error;if(O){var ae=function(V,$){var Z=V[$];if(Z&&typeof Z=="object"){var q=null;for(var Y in Z)if(A.call(Z,Y)&&Z!==V){var se=ae(Z,Y);se!==void 0?Z[Y]=se:(q||(q=[]),q.push(Y))}if(q)for(var ue=q.length;--ue>=0;)delete Z[q[ue]]}return O.call(V,$,Z)};I=ae({"":I},"")}return I}}();(typeof v>"u"||!v)&&(v={}),(typeof v.asn1>"u"||!v.asn1)&&(v.asn1={}),v.asn1.ASN1Util=new function(){this.integerToByteHex=function(s){var c=s.toString(16);return c.length%2==1&&(c="0"+c),c},this.bigIntToMinTwosComplementsHex=function(s){return Ba(s)},this.getPEMStringFromHex=function(s,c){return mn(s,c)},this.newObject=function(s){var c=v,l=c.asn1,d=l.ASN1Object,g=l.DERBoolean,m=l.DERInteger,P=l.DERBitString,E=l.DEROctetString,N=l.DERNull,A=l.DERObjectIdentifier,j=l.DEREnumerated,O=l.DERUTF8String,C=l.DERNumericString,I=l.DERPrintableString,T=l.DERTeletexString,D=l.DERIA5String,M=l.DERUTCTime,H=l.DERGeneralizedTime,te=l.DERVisibleString,ie=l.DERBMPString,re=l.DERSequence,ae=l.DERSet,V=l.DERTaggedObject,$=l.ASN1Util.newObject;if(s instanceof l.ASN1Object)return s;var Z=Object.keys(s);if(Z.length!=1)throw new Error("key of param shall be only one.");var q=Z[0];if(":asn1:bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:visstr:bmpstr:seq:set:tag:".indexOf(":"+q+":")==-1)throw new Error("undefined key: "+q);if(q=="bool")return new g(s[q]);if(q=="int")return new m(s[q]);if(q=="bitstr")return new P(s[q]);if(q=="octstr")return new E(s[q]);if(q=="null")return new N(s[q]);if(q=="oid")return new A(s[q]);if(q=="enum")return new j(s[q]);if(q=="utf8str")return new O(s[q]);if(q=="numstr")return new C(s[q]);if(q=="prnstr")return new I(s[q]);if(q=="telstr")return new T(s[q]);if(q=="ia5str")return new D(s[q]);if(q=="utctime")return new M(s[q]);if(q=="gentime")return new H(s[q]);if(q=="visstr")return new te(s[q]);if(q=="bmpstr")return new ie(s[q]);if(q=="asn1")return new d(s[q]);if(q=="seq"){for(var Y=s[q],se=[],ue=0;ue<Y.length;ue++){var be=$(Y[ue]);se.push(be)}return new re({array:se})}if(q=="set"){for(var Y=s[q],se=[],ue=0;ue<Y.length;ue++){var be=$(Y[ue]);se.push(be)}return new ae({array:se})}if(q=="tag"){var le=s[q];if(Object.prototype.toString.call(le)==="[object Array]"&&le.length==3){var pe=$(le[2]);return new V({tag:le[0],explicit:le[1],obj:pe})}else return new V(le)}},this.jsonToASN1HEX=function(s){var c=this.newObject(s);return c.tohex()}},v.asn1.ASN1Util.oidHexToInt=function(s){for(var g="",c=parseInt(s.substr(0,2),16),l=Math.floor(c/40),d=c%40,g=l+"."+d,m="",P=2;P<s.length;P+=2){var E=parseInt(s.substr(P,2),16),N=("00000000"+E.toString(2)).slice(-8);if(m=m+N.substr(1,7),N.substr(0,1)=="0"){var A=new _(m,2);g=g+"."+A.toString(10),m=""}}return g},v.asn1.ASN1Util.oidIntToHex=function(s){var c=function(E){var N=E.toString(16);return N.length==1&&(N="0"+N),N},l=function(E){var N="",A=new _(E,10),j=A.toString(2),O=7-j.length%7;O==7&&(O=0);for(var C="",I=0;I<O;I++)C+="0";j=C+j;for(var I=0;I<j.length-1;I+=7){var T=j.substr(I,7);I!=j.length-7&&(T="1"+T),N+=c(parseInt(T,2))}return N};if(!s.match(/^[0-9.]+$/))throw"malformed oid string: "+s;var d="",g=s.split("."),m=parseInt(g[0])*40+parseInt(g[1]);d+=c(m),g.splice(0,2);for(var P=0;P<g.length;P++)d+=l(g[P]);return d},v.asn1.ASN1Object=function(s){var c="";this.params=null,this.getLengthHexFromValue=function(){if(typeof this.hV>"u"||this.hV==null)throw new Error("this.hV is null or undefined");if(this.hV.length%2==1)throw new Error("value hex must be even length: n="+c.length+",v="+this.hV);var l=this.hV.length/2,d=l.toString(16);if(d.length%2==1&&(d="0"+d),l<128)return d;var g=d.length/2;if(g>15)throw new Error("ASN.1 length too long to represent by 8x: n = "+l.toString(16));var m=128+g;return m.toString(16)+d},this.tohex=function(){return(this.hTLV==null||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.getValueHex=function(){return this.tohex(),this.hV},this.getFreshValueHex=function(){return""},this.setByParam=function(l){this.params=l},s!=null&&s.tlv!=null&&(this.hTLV=s.tlv,this.isModified=!1)},v.asn1.DERAbstractString=function(s){v.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(c){this.hTLV=null,this.isModified=!0,this.s=c,this.hV=gc(this.s).toLowerCase()},this.setStringHex=function(c){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=c},this.getFreshValueHex=function(){return this.hV},typeof s<"u"&&(typeof s=="string"?this.setString(s):typeof s.str<"u"?this.setString(s.str):typeof s.hex<"u"&&this.setStringHex(s.hex))},ve(v.asn1.DERAbstractString,v.asn1.ASN1Object),v.asn1.DERAbstractTime=function(s){v.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(c){var l=c.getTime()+c.getTimezoneOffset()*6e4,d=new Date(l);return d},this.formatDate=function(c,l,d){var g=this.zeroPadding,m=this.localDateToUTC(c),P=String(m.getFullYear());l=="utc"&&(P=P.substr(2,2));var E=g(String(m.getMonth()+1),2),N=g(String(m.getDate()),2),A=g(String(m.getHours()),2),j=g(String(m.getMinutes()),2),O=g(String(m.getSeconds()),2),C=P+E+N+A+j+O;if(d===!0){var I=m.getMilliseconds();if(I!=0){var T=g(String(I),3);T=T.replace(/[0]+$/,""),C=C+"."+T}}return C+"Z"},this.zeroPadding=function(c,l){return c.length>=l?c:new Array(l-c.length+1).join("0")+c},this.setByParam=function(c){this.hV=null,this.hTLV=null,this.params=c},this.getString=function(){},this.setString=function(c){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.str=c},this.setByDate=function(c){this.hTLV=null,this.isModified=!0,this.params==null&&(this.params={}),this.params.date=c},this.setByDateValue=function(c,l,d,g,m,P){var E=new Date(Date.UTC(c,l-1,d,g,m,P,0));this.setByDate(E)},this.getFreshValueHex=function(){return this.hV}},ve(v.asn1.DERAbstractTime,v.asn1.ASN1Object),v.asn1.DERAbstractStructured=function(s){v.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(c){this.hTLV=null,this.isModified=!0,this.asn1Array=c},this.appendASN1Object=function(c){this.hTLV=null,this.isModified=!0,this.asn1Array.push(c)},this.asn1Array=new Array,typeof s<"u"&&typeof s.array<"u"&&(this.asn1Array=s.array)},ve(v.asn1.DERAbstractStructured,v.asn1.ASN1Object),v.asn1.DERBoolean=function(s){v.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",s==!1?this.hTLV="010100":this.hTLV="0101ff"},ve(v.asn1.DERBoolean,v.asn1.ASN1Object),v.asn1.DERInteger=function(s){v.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.params=null;var c=Ba;this.setByBigInteger=function(l){this.isModified=!0,this.params={bigint:l}},this.setByInteger=function(l){this.isModified=!0,this.params=l},this.setValueHex=function(l){this.isModified=!0,this.params={hex:l}},this.getFreshValueHex=function(){var l=this.params,d=null;if(l==null)throw new Error("value not set");if(typeof l=="object"&&l.hex!=null)return this.hV=l.hex,this.hV;if(typeof l=="number")d=new _(String(l),10);else if(l.int!=null)d=new _(String(l.int),10);else if(l.bigint!=null)d=l.bigint;else throw new Error("wrong parameter");return this.hV=c(d),this.hV},s!=null&&(this.params=s)},ve(v.asn1.DERInteger,v.asn1.ASN1Object),v.asn1.DERBitString=function(s){if(s!==void 0&&typeof s.obj<"u"){var c=v.asn1.ASN1Util.newObject(s.obj);s.hex="00"+c.tohex()}v.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(l){this.hTLV=null,this.isModified=!0,this.hV=l},this.setUnusedBitsAndHexValue=function(l,d){if(l<0||7<l)throw"unused bits shall be from 0 to 7: u = "+l;var g="0"+l;this.hTLV=null,this.isModified=!0,this.hV=g+d},this.setByBinaryString=function(l){l=l.replace(/0+$/,"");var d=8-l.length%8;d==8&&(d=0),l+="0000000".substr(0,d);for(var g="",m=0;m<l.length-1;m+=8){var P=l.substr(m,8),E=parseInt(P,2).toString(16);E.length==1&&(E="0"+E),g+=E}this.hTLV=null,this.isModified=!0,this.hV="0"+d+g},this.setByBooleanArray=function(l){for(var d="",g=0;g<l.length;g++)l[g]==!0?d+="1":d+="0";this.setByBinaryString(d)},this.newFalseArray=function(l){for(var d=new Array(l),g=0;g<l;g++)d[g]=!1;return d},this.getFreshValueHex=function(){return this.hV},typeof s<"u"&&(typeof s=="string"&&s.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(s):typeof s.hex<"u"?this.setHexValueIncludingUnusedBits(s.hex):typeof s.bin<"u"?this.setByBinaryString(s.bin):typeof s.array<"u"&&this.setByBooleanArray(s.array))},ve(v.asn1.DERBitString,v.asn1.ASN1Object),v.asn1.DEROctetString=function(s){if(s!==void 0&&typeof s.obj<"u"){var c=v.asn1.ASN1Util.newObject(s.obj);s.hex=c.tohex()}v.asn1.DEROctetString.superclass.constructor.call(this,s),this.hT="04"},ve(v.asn1.DEROctetString,v.asn1.DERAbstractString),v.asn1.DERNull=function(){v.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},ve(v.asn1.DERNull,v.asn1.ASN1Object),v.asn1.DERObjectIdentifier=function(s){v.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(c){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=c},this.setValueOidString=function(c){var l=Nf(c);if(l==null)throw new Error("malformed oid string: "+c);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=l},this.setValueName=function(c){var l=v.asn1.x509.OID.name2oid(c);if(l!=="")this.setValueOidString(l);else throw new Error("DERObjectIdentifier oidName undefined: "+c)},this.setValueNameOrOid=function(c){c.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(c):this.setValueName(c)},this.getFreshValueHex=function(){return this.hV},this.setByParam=function(c){typeof c=="string"?this.setValueNameOrOid(c):c.oid!==void 0?this.setValueNameOrOid(c.oid):c.name!==void 0?this.setValueNameOrOid(c.name):c.hex!==void 0&&this.setValueHex(c.hex)},s!==void 0&&this.setByParam(s)},ve(v.asn1.DERObjectIdentifier,v.asn1.ASN1Object),v.asn1.DEREnumerated=function(s){v.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(c){this.hTLV=null,this.isModified=!0,this.hV=Ba(c)},this.setByInteger=function(c){var l=new _(String(c),10);this.setByBigInteger(l)},this.setValueHex=function(c){this.hV=c},this.getFreshValueHex=function(){return this.hV},typeof s<"u"&&(typeof s.int<"u"?this.setByInteger(s.int):typeof s=="number"?this.setByInteger(s):typeof s.hex<"u"&&this.setValueHex(s.hex))},ve(v.asn1.DEREnumerated,v.asn1.ASN1Object),v.asn1.DERUTF8String=function(s){v.asn1.DERUTF8String.superclass.constructor.call(this,s),this.hT="0c"},ve(v.asn1.DERUTF8String,v.asn1.DERAbstractString),v.asn1.DERNumericString=function(s){v.asn1.DERNumericString.superclass.constructor.call(this,s),this.hT="12"},ve(v.asn1.DERNumericString,v.asn1.DERAbstractString),v.asn1.DERPrintableString=function(s){v.asn1.DERPrintableString.superclass.constructor.call(this,s),this.hT="13"},ve(v.asn1.DERPrintableString,v.asn1.DERAbstractString),v.asn1.DERTeletexString=function(s){v.asn1.DERTeletexString.superclass.constructor.call(this,s),this.hT="14"},ve(v.asn1.DERTeletexString,v.asn1.DERAbstractString),v.asn1.DERIA5String=function(s){v.asn1.DERIA5String.superclass.constructor.call(this,s),this.hT="16"},ve(v.asn1.DERIA5String,v.asn1.DERAbstractString),v.asn1.DERVisibleString=function(s){v.asn1.DERIA5String.superclass.constructor.call(this,s),this.hT="1a"},ve(v.asn1.DERVisibleString,v.asn1.DERAbstractString),v.asn1.DERBMPString=function(s){v.asn1.DERBMPString.superclass.constructor.call(this,s),this.hT="1e"},ve(v.asn1.DERBMPString,v.asn1.DERAbstractString),v.asn1.DERUTCTime=function(s){v.asn1.DERUTCTime.superclass.constructor.call(this,s),this.hT="17",this.params=void 0,this.getFreshValueHex=function(){var c=this.params;if(this.params==null&&(c={date:new Date}),typeof c=="string")if(c.match(/^[0-9]{12}Z$/)||c.match(/^[0-9]{12}\.[0-9]+Z$/))this.hV=Bn(c);else throw new Error("malformed string for UTCTime: "+c);else if(c.str!=null)this.hV=Bn(c.str);else if(c.date==null&&c.millis==!0){var l=new Date;this.hV=Bn(this.formatDate(l,"utc",!0))}else if(c.date!=null&&c.date instanceof Date){var d=c.millis===!0;this.hV=Bn(this.formatDate(c.date,"utc",d))}else c instanceof Date&&(this.hV=Bn(this.formatDate(c,"utc")));if(this.hV==null)throw new Error("parameter not specified properly for UTCTime");return this.hV},s!=null&&this.setByParam(s)},ve(v.asn1.DERUTCTime,v.asn1.DERAbstractTime),v.asn1.DERGeneralizedTime=function(s){v.asn1.DERGeneralizedTime.superclass.constructor.call(this,s),this.hT="18",this.params=s,this.getFreshValueHex=function(){var c=this.params;if(this.params==null&&(c={date:new Date}),typeof c=="string")if(c.match(/^[0-9]{14}Z$/)||c.match(/^[0-9]{14}\.[0-9]+Z$/))this.hV=Bn(c);else throw new Error("malformed string for GeneralizedTime: "+c);else if(c.str!=null)this.hV=Bn(c.str);else if(c.date==null&&c.millis==!0){var l=new Date;this.hV=Bn(this.formatDate(l,"gen",!0))}else if(c.date!=null&&c.date instanceof Date){var d=c.millis===!0;this.hV=Bn(this.formatDate(c.date,"gen",d))}else c instanceof Date&&(this.hV=Bn(this.formatDate(c,"gen")));if(this.hV==null)throw new Error("parameter not specified properly for GeneralizedTime");return this.hV},s!=null&&this.setByParam(s)},ve(v.asn1.DERGeneralizedTime,v.asn1.DERAbstractTime),v.asn1.DERSequence=function(s){v.asn1.DERSequence.superclass.constructor.call(this,s),this.hT="30",this.getFreshValueHex=function(){for(var c="",l=0;l<this.asn1Array.length;l++){var d=this.asn1Array[l];c+=d.tohex()}return this.hV=c,this.hV}},ve(v.asn1.DERSequence,v.asn1.DERAbstractStructured),v.asn1.DERSet=function(s){v.asn1.DERSet.superclass.constructor.call(this,s),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var c=new Array,l=0;l<this.asn1Array.length;l++){var d=this.asn1Array[l];c.push(d.tohex())}return this.sortFlag==!0&&c.sort(),this.hV=c.join(""),this.hV},typeof s<"u"&&typeof s.sortflag<"u"&&s.sortflag==!1&&(this.sortFlag=!1)},ve(v.asn1.DERSet,v.asn1.DERAbstractStructured),v.asn1.DERTaggedObject=function(s){v.asn1.DERTaggedObject.superclass.constructor.call(this);var c=v.asn1,l=ke,d=l.getV;l.isASN1HEX;var g=c.ASN1Util.newObject;this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.params={tag:"a0",explicit:!0},this.setASN1Object=function(m,P,E){this.params={tag:P,explicit:m,obj:E}},this.getFreshValueHex=function(){var m=this.params;if(m.explicit==null&&(m.explicit=!0),m.tage!=null&&(m.tag=m.tage,m.explicit=!0),m.tagi!=null&&(m.tag=m.tagi,m.explicit=!1),m.str!=null)this.hV=gc(m.str);else if(m.hex!=null)this.hV=m.hex;else if(m.obj!=null){var P;m.obj instanceof c.ASN1Object?P=m.obj.tohex():typeof m.obj=="object"&&(P=g(m.obj).tohex()),m.explicit?this.hV=P:this.hV=d(P,0)}else throw new Error("str, hex nor obj not specified");return m.tag==null&&(m.tag="a0"),this.hT=m.tag,this.hTLV=null,this.isModified=!0,this.hV},this.setByParam=function(m){this.params=m},s!==void 0&&this.setByParam(s)},ve(v.asn1.DERTaggedObject,v.asn1.ASN1Object);var ke=new function(){};ke.getLblen=function(s,c){if(s.substr(c+2,1)!="8")return 1;var l=parseInt(s.substr(c+3,1));return l==0?-1:0<l&&l<10?l+1:-2},ke.getL=function(s,c){var l=ke.getLblen(s,c);return l<1?"":s.substr(c+2,l*2)},ke.getVblen=function(s,c){var l,d;return l=ke.getL(s,c),l==""?-1:(l.substr(0,1)==="8"?d=new _(l.substr(2),16):d=new _(l,16),d.intValue())},ke.getVidx=function(s,c){var l=ke.getLblen(s,c);return l<0?l:c+(l+1)*2},ke.getV=function(s,c){var l=ke.getVidx(s,c),d=ke.getVblen(s,c);return s.substr(l,d*2)},ke.getTLV=function(s,c){return s.substr(c,2)+ke.getL(s,c)+ke.getV(s,c)},ke.getTLVblen=function(s,c){return 2+ke.getLblen(s,c)*2+ke.getVblen(s,c)*2},ke.getNextSiblingIdx=function(s,c){var l=ke.getVidx(s,c),d=ke.getVblen(s,c);return l+d*2},ke.getChildIdx=function(s,c){var l=ke,d=[],g,m,P;g=l.getVidx(s,c),m=l.getVblen(s,c)*2,s.substr(c,2)=="03"&&(g+=2,m-=2),P=0;for(var E=g;P<=m;){var N=l.getTLVblen(s,E);if(P+=N,P<=m&&d.push(E),E+=N,P>=m)break}return d},ke.getNthChildIdx=function(s,c,l){var d=ke.getChildIdx(s,c);return d[l]},ke.getIdxbyList=function(s,c,l,d){var g=ke,m,P;return l.length==0?d!==void 0&&s.substr(c,2)!==d?-1:c:(m=l.shift(),P=g.getChildIdx(s,c),m>=P.length?-1:g.getIdxbyList(s,P[m],l,d))},ke.getIdxbyListEx=function(s,c,l,d){var g=ke,m,P;if(l.length==0)return d!==void 0&&s.substr(c,2)!==d?-1:c;m=l.shift(),P=g.getChildIdx(s,c);for(var E=0,N=0;N<P.length;N++){var A=s.substr(P[N],2);if(typeof m=="number"&&!g.isContextTag(A)&&E==m||typeof m=="string"&&g.isContextTag(A,m))return g.getIdxbyListEx(s,P[N],l,d);g.isContextTag(A)||E++}return-1},ke.getTLVbyList=function(s,c,l,d){var g=ke,m=g.getIdxbyList(s,c,l,d);return m==-1||m>=s.length?null:g.getTLV(s,m)},ke.getTLVbyListEx=function(s,c,l,d){var g=ke,m=g.getIdxbyListEx(s,c,l,d);return m==-1?null:g.getTLV(s,m)},ke.getVbyList=function(s,c,l,d,g){var m=ke,P,E;return P=m.getIdxbyList(s,c,l,d),P==-1||P>=s.length?null:(E=m.getV(s,P),g===!0&&(E=E.substr(2)),E)},ke.getVbyListEx=function(s,c,l,d,g){var m=ke,P,E;return P=m.getIdxbyListEx(s,c,l,d),P==-1?null:(E=m.getV(s,P),s.substr(P,2)=="03"&&g!==!1&&(E=E.substr(2)),E)},ke.getInt=function(s,c,l){l==null&&(l=-1);try{var d=s.substr(c,2);if(d!="02"&&d!="03")return l;var g=ke.getV(s,c);return d=="02"?parseInt(g,16):Mf(g)}catch{return l}},ke.getOID=function(s,c,l){l==null&&(l=null);try{if(s.substr(c,2)!="06")return l;var d=ke.getV(s,c);return wc(d)}catch{return l}},ke.getOIDName=function(s,c,l){l==null&&(l=null);try{var d=ke.getOID(s,c,l);if(d==l)return l;var g=v.asn1.x509.OID.oid2name(d);return g==""?d:g}catch{return l}},ke.getString=function(s,c,l){l==null&&(l=null);try{var d=ke.getV(s,c);return Un(d)}catch{return l}},ke.hextooidstr=function(s){var c=function(O,C){return O.length>=C?O:new Array(C-O.length+1).join("0")+O},l=[],d=s.substr(0,2),g=parseInt(d,16);l[0]=new String(Math.floor(g/40)),l[1]=new String(g%40);for(var m=s.substr(2),P=[],E=0;E<m.length/2;E++)P.push(parseInt(m.substr(E*2,2),16));for(var N=[],A="",E=0;E<P.length;E++)P[E]&128?A=A+c((P[E]&127).toString(2),7):(A=A+c((P[E]&127).toString(2),7),N.push(new String(parseInt(A,2))),A="");var j=l.join(".");return N.length>0&&(j=j+"."+N.join(".")),j},ke.dump=function(s,c,l,d){var g=ke,m=g.getV,P=g.dump,E=g.getChildIdx,N=s;s instanceof v.asn1.ASN1Object&&(N=s.tohex());var A=function($,Z){if($.length<=Z*2)return $;var q=$.substr(0,Z)+"..(total "+$.length/2+"bytes).."+$.substr($.length-Z,Z);return q};c===void 0&&(c={ommit_long_octet:32}),l===void 0&&(l=0),d===void 0&&(d="");var j=c.ommit_long_octet,ae=N.substr(l,2);if(ae=="01"){var O=m(N,l);return O=="00"?d+`BOOLEAN FALSE
`:d+`BOOLEAN TRUE
`}if(ae=="02"){var O=m(N,l);return d+"INTEGER "+A(O,j)+`
`}if(ae=="03"){var O=m(N,l);if(g.isASN1HEX(O.substr(2))){var C=d+`BITSTRING, encapsulates
`;return C=C+P(O.substr(2),c,0,d+"  "),C}else return d+"BITSTRING "+A(O,j)+`
`}if(ae=="04"){var O=m(N,l);if(g.isASN1HEX(O)){var C=d+`OCTETSTRING, encapsulates
`;return C=C+P(O,c,0,d+"  "),C}else return d+"OCTETSTRING "+A(O,j)+`
`}if(ae=="05")return d+`NULL
`;if(ae=="06"){var I=m(N,l),T=v.asn1.ASN1Util.oidHexToInt(I),D=v.asn1.x509.OID.oid2name(T),M=T.replace(/\./g," ");return D!=""?d+"ObjectIdentifier "+D+" ("+M+`)
`:d+"ObjectIdentifier ("+M+`)
`}if(ae=="0a")return d+"ENUMERATED "+parseInt(m(N,l))+`
`;if(ae=="0c")return d+"UTF8String '"+ft(m(N,l))+`'
`;if(ae=="13")return d+"PrintableString '"+ft(m(N,l))+`'
`;if(ae=="14")return d+"TeletexString '"+ft(m(N,l))+`'
`;if(ae=="16")return d+"IA5String '"+ft(m(N,l))+`'
`;if(ae=="17")return d+"UTCTime "+ft(m(N,l))+`
`;if(ae=="18")return d+"GeneralizedTime "+ft(m(N,l))+`
`;if(ae=="1a")return d+"VisualString '"+ft(m(N,l))+`'
`;if(ae=="1e")return d+"BMPString '"+td(m(N,l))+`'
`;if(ae=="30"){if(N.substr(l,4)=="3000")return d+`SEQUENCE {}
`;var C=d+`SEQUENCE
`,H=E(N,l),te=c;if((H.length==2||H.length==3)&&N.substr(H[0],2)=="06"&&N.substr(H[H.length-1],2)=="04"){var D=g.oidname(m(N,H[0])),ie=JSON.parse(JSON.stringify(c));ie.x509ExtName=D,te=ie}for(var re=0;re<H.length;re++)C=C+P(N,te,H[re],d+"  ");return C}if(ae=="31"){for(var C=d+`SET
`,H=E(N,l),re=0;re<H.length;re++)C=C+P(N,c,H[re],d+"  ");return C}var ae=parseInt(ae,16);if(ae&128){var V=ae&31;if(ae&32){for(var C=d+"["+V+`]
`,H=E(N,l),re=0;re<H.length;re++)C=C+P(N,c,H[re],d+"  ");return C}else{var O=m(N,l);if(ke.isASN1HEX(O)){var C=d+"["+V+`]
`;return C=C+P(O,c,0,d+"  "),C}else(O.substr(0,8)=="68747470"||c.x509ExtName==="subjectAltName"&&V==2)&&(O=ft(O));var C=d+"["+V+"] "+O+`
`;return C}}return d+"UNKNOWN("+ae+") "+m(N,l)+`
`},ke.parse=function(s){var c=ke,l=c.parse,d=c.isASN1HEX,g=c.getV,m=c.getTLV,P=c.getChildIdx,E=v.asn1,N=E.ASN1Util.oidHexToInt,A=E.x509.OID.oid2name,j=ft,O=td,C=Lb,I={"0c":"utf8str",12:"numstr",13:"prnstr",14:"telstr",16:"ia5str",17:"utctime",18:"gentime","1a":"visstr","1e":"bmpstr",30:"seq",31:"set"},T=function(q){for(var Y=[],se=P(q,0),ue=0;ue<se.length;ue++){var be=se[ue],le=m(q,be),pe=l(le);Y.push(pe)}return Y},D=s.substr(0,2),M={},H=g(s,0);if(D=="01")return s=="0101ff"?{bool:!0}:{bool:!1};if(D=="02")return{int:{hex:H}};if(D=="03")try{if(H.substr(0,2)!="00")throw"not encap";var te=H.substr(2);if(!d(te))throw"not encap";return{bitstr:{obj:l(te)}}}catch{var ie=null;return H.length<=10&&(ie=jf(H)),ie==null?{bitstr:{hex:H}}:{bitstr:{bin:ie}}}else if(D=="04")try{if(!d(H))throw"not encap";return{octstr:{obj:l(H)}}}catch{return{octstr:{hex:H}}}else{if(D=="05")return{null:""};if(D=="06"){var re=N(H),ae=A(re);return ae==""?{oid:re}:{oid:ae}}else{if(D=="0a")return H.length>4?{enum:{hex:H}}:{enum:parseInt(H,16)};if(D=="30"||D=="31")return M[I[D]]=T(s),M;if(D=="14"){var V=C(H);return M[I[D]]={str:V},M}else if(D=="1e"){var V=O(H);return M[I[D]]={str:V},M}else if(":0c:12:13:16:17:18:1a:".indexOf(D)!=-1){var V=j(H);return M[I[D]]={str:V},M}else if(D.match(/^8[0-9]$/)){var V=j(H);return V==null|V==""?{tag:{tag:D,explicit:!1,hex:H}}:V.match(/[\x00-\x1F\x7F-\x9F]/)!=null||V.match(/[\u0000-\u001F\u0080–\u009F]/)!=null?{tag:{tag:D,explicit:!1,hex:H}}:{tag:{tag:D,explicit:!1,str:V}}}else if(D.match(/^a[0-9]$/))try{if(!d(H))throw new Error("not encap");return{tag:{tag:D,explicit:!0,obj:l(H)}}}catch{return{tag:{tag:D,explicit:!0,hex:H}}}else{var $=new v.asn1.ASN1Object;$.hV=H;var Z=$.getLengthHexFromValue();return{asn1:{tlv:D+Z+H}}}}}},ke.isContextTag=function(s,c){s=s.toLowerCase();var l,d;try{l=parseInt(s,16)}catch{return-1}if(c===void 0)return(l&192)==128;try{var g=c.match(/^\[[0-9]+\]$/);return g==null||(d=parseInt(c.substr(1,c.length-1),10),d>31)?!1:(l&192)==128&&(l&31)==d}catch{return!1}},ke.isASN1HEX=function(s){var c=ke;if(s.length%2==1)return!1;var l=c.getVblen(s,0),d=s.substr(0,2),g=c.getL(s,0),m=s.length-d.length-g.length;return m==l*2},ke.checkStrictDER=function(s,c,l,d,g){var m=ke;if(l===void 0){if(typeof s!="string")throw new Error("not hex string");if(s=s.toLowerCase(),!v.lang.String.isHex(s))throw new Error("not hex string");l=s.length,d=s.length/2,d<128?g=1:g=Math.ceil(d.toString(16))+1}var P=m.getL(s,c);if(P.length>g*2)throw new Error("L of TLV too long: idx="+c);var E=m.getVblen(s,c);if(E>d)throw new Error("value of L too long than hex: idx="+c);var N=m.getTLV(s,c),A=N.length-2-m.getL(s,c).length;if(A!==E*2)throw new Error("V string length and L's value not the same:"+A+"/"+E*2);if(c===0&&s.length!=N.length)throw new Error("total length and TLV length unmatch:"+s.length+"!="+N.length);var j=s.substr(c,2);if(j==="02"){var O=m.getVidx(s,c);if(s.substr(O,2)=="00"&&s.charCodeAt(O+2)<56)throw new Error("not least zeros for DER INTEGER")}if(parseInt(j,16)&32){for(var C=m.getVblen(s,c),I=0,T=m.getChildIdx(s,c),D=0;D<T.length;D++){var M=m.getTLV(s,T[D]);I+=M.length,m.checkStrictDER(s,T[D],l,d,g)}if(C*2!=I)throw new Error("sum of children's TLV length and L unmatch: "+C*2+"!="+I)}},ke.oidname=function(s){var c=v.asn1;v.lang.String.isHex(s)&&(s=c.ASN1Util.oidHexToInt(s));var l=c.x509.OID.oid2name(s);return l===""&&(l=s),l},(typeof v>"u"||!v)&&(v={}),(typeof v.asn1>"u"||!v.asn1)&&(v.asn1={}),(typeof v.asn1.x509>"u"||!v.asn1.x509)&&(v.asn1.x509={}),v.asn1.x509.Certificate=function(s){v.asn1.x509.Certificate.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERBitString,g=l.DERSequence,m=l.x509,P=m.TBSCertificate,E=m.AlgorithmIdentifier;this.params=void 0,this.setByParam=function(N){this.params=N},this.sign=function(){var N=this.params,A=N.sigalg;N.sigalg.name!=null&&(A=N.sigalg.name);var j=N.tbsobj.tohex(),O=new v.crypto.Signature({alg:A});O.init(N.cakey),O.updateHex(j),N.sighex=O.sign()},this.getPEM=function(){return mn(this.tohex(),"CERTIFICATE")},this.tohex=function(){var N=this.params;if((N.tbsobj==null||N.tbsobj==null)&&(N.tbsobj=new P(N)),N.sighex==null&&N.cakey!=null&&this.sign(),N.sighex==null)throw new Error("sighex or cakey parameter not defined");var A=[];A.push(N.tbsobj),A.push(new E({name:N.sigalg})),A.push(new d({hex:"00"+N.sighex}));var j=new g({array:A});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&(this.params=s)},ve(v.asn1.x509.Certificate,v.asn1.ASN1Object),v.asn1.x509.TBSCertificate=function(s){v.asn1.x509.TBSCertificate.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.x509,g=l.DERTaggedObject,m=l.DERInteger,P=l.DERSequence,E=d.AlgorithmIdentifier,N=d.Time,A=d.X500Name,j=d.Extensions,O=d.SubjectPublicKeyInfo;this.params=null,this.setByParam=function(C){this.params=C},this.tohex=function(){var C=[],I=this.params;if(I.version!=null||I.version!=1){var T=2;I.version!=null&&(T=I.version-1);var D=new g({obj:new m({int:T})});C.push(D)}C.push(new m(I.serial)),C.push(new E({name:I.sigalg})),C.push(new A(I.issuer)),C.push(new P({array:[new N(I.notbefore),new N(I.notafter)]})),C.push(new A(I.subject)),C.push(new O(nt.getKey(I.sbjpubkey))),I.ext!==void 0&&I.ext.length>0&&C.push(new g({tag:"a3",obj:new j(I.ext)}));var M=new v.asn1.DERSequence({array:C});return M.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.TBSCertificate,v.asn1.ASN1Object),v.asn1.x509.Extensions=function(s){v.asn1.x509.Extensions.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERSequence,g=l.x509;this.aParam=[],this.setByParam=function(m){this.aParam=m},this.tohex=function(){for(var m=[],P=0;P<this.aParam.length;P++){var E=this.aParam[P],N=E.extname,A=null;if(E.extn!=null)A=new g.PrivateExtension(E);else if(N=="subjectKeyIdentifier")A=new g.SubjectKeyIdentifier(E);else if(N=="keyUsage")A=new g.KeyUsage(E);else if(N=="subjectAltName")A=new g.SubjectAltName(E);else if(N=="issuerAltName")A=new g.IssuerAltName(E);else if(N=="basicConstraints")A=new g.BasicConstraints(E);else if(N=="nameConstraints")A=new g.NameConstraints(E);else if(N=="cRLDistributionPoints")A=new g.CRLDistributionPoints(E);else if(N=="certificatePolicies")A=new g.CertificatePolicies(E);else if(N=="policyMappings")A=new g.PolicyMappings(E);else if(N=="policyConstraints")A=new g.PolicyConstraints(E);else if(N=="inhibitAnyPolicy")A=new g.InhibitAnyPolicy(E);else if(N=="authorityKeyIdentifier")A=new g.AuthorityKeyIdentifier(E);else if(N=="extKeyUsage")A=new g.ExtKeyUsage(E);else if(N=="authorityInfoAccess")A=new g.AuthorityInfoAccess(E);else if(N=="cRLNumber")A=new g.CRLNumber(E);else if(N=="cRLReason")A=new g.CRLReason(E);else if(N=="ocspNonce")A=new g.OCSPNonce(E);else if(N=="ocspNoCheck")A=new g.OCSPNoCheck(E);else if(N=="adobeTimeStamp")A=new g.AdobeTimeStamp(E);else if(N=="subjectDirectoryAttributes")A=new g.SubjectDirectoryAttributes(E);else throw new Error("extension not supported:"+JSON.stringify(E));A!=null&&m.push(A)}var j=new d({array:m});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.x509.Extensions,v.asn1.ASN1Object),v.asn1.x509.Extension=function(s){v.asn1.x509.Extension.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERObjectIdentifier,g=l.DEROctetString;l.DERBitString;var m=l.DERBoolean,P=l.DERSequence;this.tohex=function(){var E=new d({oid:this.oid}),N=new g({hex:this.getExtnValueHex()}),A=new Array;A.push(E),this.critical&&A.push(new m),A.push(N);var j=new P({array:A});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},this.critical=!1,s!==void 0&&s.critical!==void 0&&(this.critical=s.critical)},ve(v.asn1.x509.Extension,v.asn1.ASN1Object),v.asn1.x509.KeyUsage=function(s){v.asn1.x509.KeyUsage.superclass.constructor.call(this,s);var c=Error,l={digitalSignature:0,nonRepudiation:1,keyEncipherment:2,dataEncipherment:3,keyAgreement:4,keyCertSign:5,cRLSign:6,encipherOnly:7,decipherOnly:8};this.getExtnValueHex=function(){var d=this.getBinValue();return this.asn1ExtnValue=new v.asn1.DERBitString({bin:d}),this.asn1ExtnValue.tohex()},this.getBinValue=function(){var d=this.params;if(typeof d!="object"||typeof d.names!="object"&&typeof d.bin!="string")throw new c("parameter not yet set");if(d.names!=null)return Cc(d.names,l);if(d.bin!=null)return d.bin;throw new c("parameter not set properly")},this.oid="2.5.29.15",s!==void 0&&(this.params=s)},ve(v.asn1.x509.KeyUsage,v.asn1.x509.Extension),v.asn1.x509.BasicConstraints=function(s){v.asn1.x509.BasicConstraints.superclass.constructor.call(this,s);var c=v.asn1,l=c.DERBoolean,d=c.DERInteger,g=c.DERSequence;this.getExtnValueHex=function(){var m=new Array;this.cA&&m.push(new l),this.pathLen>-1&&m.push(new d({int:this.pathLen}));var P=new g({array:m});return this.asn1ExtnValue=P,this.asn1ExtnValue.tohex()},this.oid="2.5.29.19",this.cA=!1,this.pathLen=-1,s!==void 0&&(s.cA!==void 0&&(this.cA=s.cA),s.pathLen!==void 0&&(this.pathLen=s.pathLen))},ve(v.asn1.x509.BasicConstraints,v.asn1.x509.Extension),v.asn1.x509.CRLDistributionPoints=function(s){v.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,s);var c=v,l=c.asn1,d=l.x509;this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.setByDPArray=function(g){for(var m=[],P=0;P<g.length;P++)if(g[P]instanceof v.asn1.ASN1Object)m.push(g[P]);else{var E=new d.DistributionPoint(g[P]);m.push(E)}this.asn1ExtnValue=new l.DERSequence({array:m})},this.setByOneURI=function(g){var m=new d.DistributionPoint({fulluri:g});this.setByDPArray([m])},this.oid="2.5.29.31",s!==void 0&&(s.array!==void 0?this.setByDPArray(s.array):s.uri!==void 0&&this.setByOneURI(s.uri))},ve(v.asn1.x509.CRLDistributionPoints,v.asn1.x509.Extension),v.asn1.x509.DistributionPoint=function(s){v.asn1.x509.DistributionPoint.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.x509.DistributionPointName;this.tohex=function(){var g=new l.DERSequence;if(this.asn1DP!=null){var m=new l.DERTaggedObject({explicit:!0,tag:"a0",obj:this.asn1DP});g.appendASN1Object(m)}return this.hTLV=g.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&(s.dpobj!==void 0?this.asn1DP=s.dpobj:s.dpname!==void 0?this.asn1DP=new d(s.dpname):s.fulluri!==void 0&&(this.asn1DP=new d({full:[{uri:s.fulluri}]})))},ve(v.asn1.x509.DistributionPoint,v.asn1.ASN1Object),v.asn1.x509.DistributionPointName=function(s){v.asn1.x509.DistributionPointName.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERTaggedObject;if(this.tohex=function(){if(this.type!="full")throw new Error("currently type shall be 'full': "+this.type);return this.asn1Obj=new d({explicit:!1,tag:this.tag,obj:this.asn1V}),this.hTLV=this.asn1Obj.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0)if(l.x509.GeneralNames.prototype.isPrototypeOf(s))this.type="full",this.tag="a0",this.asn1V=s;else if(s.full!==void 0)this.type="full",this.tag="a0",this.asn1V=new l.x509.GeneralNames(s.full);else throw new Error("This class supports GeneralNames only as argument")},ve(v.asn1.x509.DistributionPointName,v.asn1.ASN1Object),v.asn1.x509.CertificatePolicies=function(s){v.asn1.x509.CertificatePolicies.superclass.constructor.call(this,s);var c=v,l=c.asn1,d=l.x509,g=l.DERSequence,m=d.PolicyInformation;this.params=null,this.getExtnValueHex=function(){for(var P=[],E=0;E<this.params.array.length;E++)P.push(new m(this.params.array[E]));var N=new g({array:P});return this.asn1ExtnValue=N,this.asn1ExtnValue.tohex()},this.oid="2.5.29.32",s!==void 0&&(this.params=s)},ve(v.asn1.x509.CertificatePolicies,v.asn1.x509.Extension),v.asn1.x509.PolicyInformation=function(s){v.asn1.x509.PolicyInformation.superclass.constructor.call(this,s);var c=v.asn1,l=c.DERSequence,d=c.DERObjectIdentifier,g=c.x509.PolicyQualifierInfo;this.params=null,this.tohex=function(){if(this.params.policyoid===void 0&&this.params.array===void 0)throw new Error("parameter oid and array missing");var m=[new d(this.params.policyoid)];if(this.params.array!==void 0){for(var P=[],E=0;E<this.params.array.length;E++)P.push(new g(this.params.array[E]));P.length>0&&m.push(new l({array:P}))}var N=new l({array:m});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&(this.params=s)},ve(v.asn1.x509.PolicyInformation,v.asn1.ASN1Object),v.asn1.x509.PolicyQualifierInfo=function(s){v.asn1.x509.PolicyQualifierInfo.superclass.constructor.call(this,s);var c=v.asn1,l=c.DERSequence,d=c.DERIA5String,g=c.DERObjectIdentifier,m=c.x509.UserNotice;this.params=null,this.tohex=function(){if(this.params.cps!==void 0){var P=new l({array:[new g({oid:"1.3.6.1.5.5.7.2.1"}),new d({str:this.params.cps})]});return P.tohex()}if(this.params.unotice!=null){var P=new l({array:[new g({oid:"1.3.6.1.5.5.7.2.2"}),new m(this.params.unotice)]});return P.tohex()}},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&(this.params=s)},ve(v.asn1.x509.PolicyQualifierInfo,v.asn1.ASN1Object),v.asn1.x509.UserNotice=function(s){v.asn1.x509.UserNotice.superclass.constructor.call(this,s);var c=v.asn1.DERSequence;v.asn1.DERInteger;var l=v.asn1.x509.DisplayText,d=v.asn1.x509.NoticeReference;this.params=null,this.tohex=function(){var g=[];this.params.noticeref!==void 0&&g.push(new d(this.params.noticeref)),this.params.exptext!==void 0&&g.push(new l(this.params.exptext));var m=new c({array:g});return m.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&(this.params=s)},ve(v.asn1.x509.UserNotice,v.asn1.ASN1Object),v.asn1.x509.NoticeReference=function(s){v.asn1.x509.NoticeReference.superclass.constructor.call(this,s);var c=v.asn1.DERSequence,l=v.asn1.DERInteger,d=v.asn1.x509.DisplayText;this.params=null,this.tohex=function(){var g=[];if(this.params.org!==void 0&&g.push(new d(this.params.org)),this.params.noticenum!==void 0){for(var m=[],P=this.params.noticenum,E=0;E<P.length;E++)m.push(new l(P[E]));g.push(new c({array:m}))}if(g.length==0)throw new Error("parameter is empty");var N=new c({array:g});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&(this.params=s)},ve(v.asn1.x509.NoticeReference,v.asn1.ASN1Object),v.asn1.x509.DisplayText=function(s){v.asn1.x509.DisplayText.superclass.constructor.call(this,s),this.hT="0c",s!==void 0&&(s.type==="ia5"?this.hT="16":s.type==="vis"?this.hT="1a":s.type==="bmp"&&(this.hT="1e"))},ve(v.asn1.x509.DisplayText,v.asn1.DERAbstractString),v.asn1.x509.PolicyMappings=function(s){v.asn1.x509.PolicyMappings.superclass.constructor.call(this,s);var c=v,l=c.asn1;l.x509;var d=l.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){for(var g=this.params,m=[],P=0;P<g.array.length;P++){var E=g.array[P];m.push({seq:[{oid:E[0]},{oid:E[1]}]})}return this.asn1ExtnValue=d({seq:m}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.33",s!==void 0&&(this.params=s)},ve(v.asn1.x509.PolicyMappings,v.asn1.x509.Extension),v.asn1.x509.PolicyConstraints=function(s){v.asn1.x509.PolicyConstraints.superclass.constructor.call(this,s);var c=v,l=c.asn1;l.x509;var d=l.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){var g=this.params,m=[];return g.reqexp!=null&&m.push({tag:{tagi:"80",obj:{int:g.reqexp}}}),g.inhibit!=null&&m.push({tag:{tagi:"81",obj:{int:g.inhibit}}}),this.asn1ExtnValue=d({seq:m}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.36",s!==void 0&&(this.params=s)},ve(v.asn1.x509.PolicyConstraints,v.asn1.x509.Extension),v.asn1.x509.InhibitAnyPolicy=function(s){v.asn1.x509.InhibitAnyPolicy.superclass.constructor.call(this,s);var c=v,l=c.asn1;l.x509;var d=l.ASN1Util.newObject;this.params=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=d({int:this.params.skip}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.54",s!==void 0&&(this.params=s)},ve(v.asn1.x509.InhibitAnyPolicy,v.asn1.x509.Extension),v.asn1.x509.NameConstraints=function(s){v.asn1.x509.NameConstraints.superclass.constructor.call(this,s);var c=v,l=c.asn1,d=l.x509,g=l.ASN1Util.newObject,m=d.GeneralSubtree;this.params=null,this.getExtnValueHex=function(){var P=this.params,E=[];if(P.permit!=null&&P.permit.length!=null){for(var N=[],A=0;A<P.permit.length;A++)N.push(new m(P.permit[A]));E.push({tag:{tagi:"a0",obj:{seq:N}}})}if(P.exclude!=null&&P.exclude.length!=null){for(var j=[],A=0;A<P.exclude.length;A++)j.push(new m(P.exclude[A]));E.push({tag:{tagi:"a1",obj:{seq:j}}})}return this.asn1ExtnValue=g({seq:E}),this.asn1ExtnValue.tohex()},this.oid="2.5.29.30",s!==void 0&&(this.params=s)},ve(v.asn1.x509.NameConstraints,v.asn1.x509.Extension),v.asn1.x509.GeneralSubtree=function(s){v.asn1.x509.GeneralSubtree.superclass.constructor.call(this);var c=v.asn1,l=c.x509,d=l.GeneralName,g=c.ASN1Util.newObject;this.params=null,this.setByParam=function(m){this.params=m},this.tohex=function(){var m=this.params,P=[new d(m)];m.min!=null&&P.push({tag:{tagi:"80",obj:{int:m.min}}}),m.max!=null&&P.push({tag:{tagi:"81",obj:{int:m.max}}});var E=g({seq:P});return E.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.GeneralSubtree,v.asn1.ASN1Object),v.asn1.x509.ExtKeyUsage=function(s){v.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,s);var c=v,l=c.asn1;this.setPurposeArray=function(d){this.asn1ExtnValue=new l.DERSequence;for(var g=0;g<d.length;g++){var m=new l.DERObjectIdentifier(d[g]);this.asn1ExtnValue.appendASN1Object(m)}},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.37",s!==void 0&&s.array!==void 0&&this.setPurposeArray(s.array)},ve(v.asn1.x509.ExtKeyUsage,v.asn1.x509.Extension),v.asn1.x509.AuthorityKeyIdentifier=function(s){v.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,s);var c=v,l=c.asn1,d=l.DERTaggedObject,g=l.x509.GeneralNames;c.crypto.Util.isKey,this.asn1KID=null,this.asn1CertIssuer=null,this.asn1CertSN=null,this.getExtnValueHex=function(){var m=new Array;this.asn1KID&&m.push(new d({explicit:!1,tag:"80",obj:this.asn1KID})),this.asn1CertIssuer&&m.push(new d({explicit:!1,tag:"a1",obj:new g([{dn:this.asn1CertIssuer}])})),this.asn1CertSN&&m.push(new d({explicit:!1,tag:"82",obj:this.asn1CertSN}));var P=new l.DERSequence({array:m});return this.asn1ExtnValue=P,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(m){if(m.str!==void 0||m.hex!==void 0)this.asn1KID=new v.asn1.DEROctetString(m);else if(typeof m=="object"&&v.crypto.Util.isKey(m)||typeof m=="string"&&m.indexOf("BEGIN ")!=-1){var P=m;typeof m=="string"&&(P=nt.getKey(m));var E=nt.getKeyID(P);this.asn1KID=new v.asn1.DEROctetString({hex:E})}},this.setCertIssuerByParam=function(m){m.str!==void 0||m.ldapstr!==void 0||m.hex!==void 0||m.certsubject!==void 0||m.certissuer!==void 0?this.asn1CertIssuer=new v.asn1.x509.X500Name(m):typeof m=="string"&&m.indexOf("BEGIN ")!=-1&&m.indexOf("CERTIFICATE")!=-1&&(this.asn1CertIssuer=new v.asn1.x509.X500Name({certissuer:m}))},this.setCertSNByParam=function(m){if(m.str!==void 0||m.bigint!==void 0||m.hex!==void 0)this.asn1CertSN=new v.asn1.DERInteger(m);else if(typeof m=="string"&&m.indexOf("BEGIN ")!=-1&&m.indexOf("CERTIFICATE")){var P=new He;P.readCertPEM(m);var E=P.getSerialNumberHex();this.asn1CertSN=new v.asn1.DERInteger({hex:E})}},this.oid="2.5.29.35",s!==void 0&&(s.kid!==void 0&&this.setKIDByParam(s.kid),s.issuer!==void 0&&this.setCertIssuerByParam(s.issuer),s.sn!==void 0&&this.setCertSNByParam(s.sn),s.issuersn!==void 0&&typeof s.issuersn=="string"&&s.issuersn.indexOf("BEGIN ")!=-1&&s.issuersn.indexOf("CERTIFICATE")&&(this.setCertSNByParam(s.issuersn),this.setCertIssuerByParam(s.issuersn)))},ve(v.asn1.x509.AuthorityKeyIdentifier,v.asn1.x509.Extension),v.asn1.x509.SubjectKeyIdentifier=function(s){v.asn1.x509.SubjectKeyIdentifier.superclass.constructor.call(this,s);var c=v,l=c.asn1,d=l.DEROctetString;this.asn1KID=null,this.getExtnValueHex=function(){return this.asn1ExtnValue=this.asn1KID,this.asn1ExtnValue.tohex()},this.setKIDByParam=function(g){if(g.str!==void 0||g.hex!==void 0)this.asn1KID=new d(g);else if(typeof g=="object"&&v.crypto.Util.isKey(g)||typeof g=="string"&&g.indexOf("BEGIN")!=-1){var m=g;typeof g=="string"&&(m=nt.getKey(g));var P=nt.getKeyID(m);this.asn1KID=new v.asn1.DEROctetString({hex:P})}},this.oid="2.5.29.14",s!==void 0&&s.kid!==void 0&&this.setKIDByParam(s.kid)},ve(v.asn1.x509.SubjectKeyIdentifier,v.asn1.x509.Extension),v.asn1.x509.AuthorityInfoAccess=function(s){v.asn1.x509.AuthorityInfoAccess.superclass.constructor.call(this,s),this.setAccessDescriptionArray=function(c){for(var l=new Array,d=v,g=d.asn1,m=g.DERSequence,P=g.DERObjectIdentifier,E=g.x509.GeneralName,N=0;N<c.length;N++){var A,j=c[N];if(j.ocsp!==void 0)A=new m({array:[new P({oid:"1.3.6.1.5.5.7.48.1"}),new E({uri:j.ocsp})]});else if(j.caissuer!==void 0)A=new m({array:[new P({oid:"1.3.6.1.5.5.7.48.2"}),new E({uri:j.caissuer})]});else throw new Error("unknown AccessMethod parameter: "+JSON.stringify(j));l.push(A)}this.asn1ExtnValue=new m({array:l})},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.1.1",s!==void 0&&s.array!==void 0&&this.setAccessDescriptionArray(s.array)},ve(v.asn1.x509.AuthorityInfoAccess,v.asn1.x509.Extension),v.asn1.x509.SubjectAltName=function(s){v.asn1.x509.SubjectAltName.superclass.constructor.call(this,s),this.setNameArray=function(c){this.asn1ExtnValue=new v.asn1.x509.GeneralNames(c)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.17",s!==void 0&&s.array!==void 0&&this.setNameArray(s.array)},ve(v.asn1.x509.SubjectAltName,v.asn1.x509.Extension),v.asn1.x509.IssuerAltName=function(s){v.asn1.x509.IssuerAltName.superclass.constructor.call(this,s),this.setNameArray=function(c){this.asn1ExtnValue=new v.asn1.x509.GeneralNames(c)},this.getExtnValueHex=function(){return this.asn1ExtnValue.tohex()},this.oid="2.5.29.18",s!==void 0&&s.array!==void 0&&this.setNameArray(s.array)},ve(v.asn1.x509.IssuerAltName,v.asn1.x509.Extension),v.asn1.x509.SubjectDirectoryAttributes=function(s){v.asn1.x509.SubjectDirectoryAttributes.superclass.constructor.call(this,s);var c=v.asn1,l=c.DERSequence,d=c.ASN1Util.newObject,g=c.x509.OID.name2oid;this.params=null,this.getExtnValueHex=function(){for(var m=[],P=0;P<this.params.array.length;P++){var E=this.params.array[P];if(E.attr!=null&&E.array!=null){var N={seq:[{oid:E.attr},{set:E.array}]};m.push(d(N));continue}var A={seq:[{oid:"1.2.3.4"},{set:[{utf8str:"DE"}]}]};if(E.attr=="dateOfBirth")A.seq[0].oid=g(E.attr),A.seq[1].set[0]={gentime:E.str};else if(E.attr=="placeOfBirth")A.seq[0].oid=g(E.attr),A.seq[1].set[0]={utf8str:E.str};else if(E.attr=="gender")A.seq[0].oid=g(E.attr),A.seq[1].set[0]={prnstr:E.str};else if(E.attr=="countryOfCitizenship")A.seq[0].oid=g(E.attr),A.seq[1].set[0]={prnstr:E.str};else if(E.attr=="countryOfResidence")A.seq[0].oid=g(E.attr),A.seq[1].set[0]={prnstr:E.str};else throw new Error("unsupported attribute: "+E.attr);m.push(new d(A))}var j=new l({array:m});return this.asn1ExtnValue=j,this.asn1ExtnValue.tohex()},this.oid="2.5.29.9",s!==void 0&&(this.params=s)},ve(v.asn1.x509.SubjectDirectoryAttributes,v.asn1.x509.Extension),v.asn1.x509.PrivateExtension=function(s){v.asn1.x509.PrivateExtension.superclass.constructor.call(this,s);var c=v,l=c.lang.String.isHex,d=c.asn1,g=d.x509.OID.name2oid,m=d.ASN1Util.newObject;this.params=null,this.setByParam=function(P){this.oid=g(P.extname),this.params=P},this.getExtnValueHex=function(){if(this.params.extname==null||this.params.extn==null)throw new Error("extname or extnhex not specified");var P=this.params.extn;if(typeof P=="string"&&l(P))return P;if(typeof P=="object")try{return m(P).tohex()}catch{}throw new Error("unsupported extn value")},s!=null&&this.setByParam(s)},ve(v.asn1.x509.PrivateExtension,v.asn1.x509.Extension),v.asn1.x509.CRL=function(s){v.asn1.x509.CRL.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERSequence,g=l.DERBitString,m=l.x509,P=m.AlgorithmIdentifier,E=m.TBSCertList;this.params=void 0,this.setByParam=function(N){this.params=N},this.sign=function(){var N=new E(this.params).tohex(),A=new v.crypto.Signature({alg:this.params.sigalg});A.init(this.params.cakey),A.updateHex(N);var j=A.sign();this.params.sighex=j},this.getPEM=function(){return mn(this.tohex(),"X509 CRL")},this.tohex=function(){var N=this.params;if(N.tbsobj==null&&(N.tbsobj=new E(N)),N.sighex==null&&N.cakey!=null&&this.sign(),N.sighex==null)throw new Error("sighex or cakey parameter not defined");var A=[];A.push(N.tbsobj),A.push(new P({name:N.sigalg})),A.push(new g({hex:"00"+N.sighex}));var j=new d({array:A});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&(this.params=s)},ve(v.asn1.x509.CRL,v.asn1.ASN1Object),v.asn1.x509.TBSCertList=function(s){v.asn1.x509.TBSCertList.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERInteger,g=l.DERSequence,m=l.DERTaggedObject;l.DERObjectIdentifier;var P=l.x509,E=P.AlgorithmIdentifier,N=P.Time,A=P.Extensions,j=P.X500Name;this.params=null,this.setByParam=function(O){this.params=O},this.getRevCertSequence=function(){for(var O=[],C=this.params.revcert,I=0;I<C.length;I++){var T=[new d(C[I].sn),new N(C[I].date)];C[I].ext!=null&&T.push(new A(C[I].ext)),O.push(new g({array:T}))}return new g({array:O})},this.tohex=function(){var O=[],C=this.params;if(C.version!=null){var I=C.version-1,T=new d({int:I});O.push(T)}if(O.push(new E({name:C.sigalg})),O.push(new j(C.issuer)),O.push(new N(C.thisupdate)),C.nextupdate!=null&&O.push(new N(C.nextupdate)),C.revcert!=null&&O.push(this.getRevCertSequence()),C.ext!=null){var D=new A(C.ext);O.push(new m({tag:"a0",explicit:!0,obj:D}))}var M=new g({array:O});return M.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.TBSCertList,v.asn1.ASN1Object),v.asn1.x509.CRLEntry=function(s){v.asn1.x509.CRLEntry.superclass.constructor.call(this);var c=v,l=c.asn1;this.setCertSerial=function(d){this.sn=new l.DERInteger(d)},this.setRevocationDate=function(d){this.time=new l.x509.Time(d)},this.tohex=function(){var d=new l.DERSequence({array:[this.sn,this.time]});return this.TLV=d.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&(s.time!==void 0&&this.setRevocationDate(s.time),s.sn!==void 0&&this.setCertSerial(s.sn))},ve(v.asn1.x509.CRLEntry,v.asn1.ASN1Object),v.asn1.x509.CRLNumber=function(s){v.asn1.x509.CRLNumber.superclass.constructor.call(this,s),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new v.asn1.DERInteger(this.params.num),this.asn1ExtnValue.tohex()},this.oid="2.5.29.20",s!=null&&(this.params=s)},ve(v.asn1.x509.CRLNumber,v.asn1.x509.Extension),v.asn1.x509.CRLReason=function(s){v.asn1.x509.CRLReason.superclass.constructor.call(this,s),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new v.asn1.DEREnumerated(this.params.code),this.asn1ExtnValue.tohex()},this.oid="2.5.29.21",s!=null&&(this.params=s)},ve(v.asn1.x509.CRLReason,v.asn1.x509.Extension),v.asn1.x509.OCSPNonce=function(s){v.asn1.x509.OCSPNonce.superclass.constructor.call(this,s),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new v.asn1.DEROctetString(this.params),this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.2",s!=null&&(this.params=s)},ve(v.asn1.x509.OCSPNonce,v.asn1.x509.Extension),v.asn1.x509.OCSPNoCheck=function(s){v.asn1.x509.OCSPNoCheck.superclass.constructor.call(this,s),this.params=void 0,this.getExtnValueHex=function(){return this.asn1ExtnValue=new v.asn1.DERNull,this.asn1ExtnValue.tohex()},this.oid="1.3.6.1.5.5.7.48.1.5",s!=null&&(this.params=s)},ve(v.asn1.x509.OCSPNoCheck,v.asn1.x509.Extension),v.asn1.x509.AdobeTimeStamp=function(s){v.asn1.x509.AdobeTimeStamp.superclass.constructor.call(this,s);var c=v,l=c.asn1,d=l.DERInteger,g=l.DERBoolean,m=l.DERSequence,P=l.x509.GeneralName;this.params=null,this.getExtnValueHex=function(){var E=this.params,N=[new d(1)];return N.push(new P({uri:E.uri})),E.reqauth!=null&&N.push(new g(E.reqauth)),this.asn1ExtnValue=new m({array:N}),this.asn1ExtnValue.tohex()},this.oid="1.2.840.113583.1.1.9.1",s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.AdobeTimeStamp,v.asn1.x509.Extension),v.asn1.x509.X500Name=function(s){v.asn1.x509.X500Name.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var c=v,l=c.asn1,d=l.x509,g=d.RDN;this.setByString=function(m,P){P!==void 0&&(this.sRule=P);var E=m.split("/");E.shift();for(var N=[],A=0;A<E.length;A++)if(E[A].match(/^[^=]+=.+$/))N.push(E[A]);else{var j=N.length-1;N[j]=N[j]+"/"+E[A]}for(var A=0;A<N.length;A++)this.asn1Array.push(new g({str:N[A],rule:this.sRule}))},this.setByLdapString=function(m,P){P!==void 0&&(this.sRule=P);var E=d.X500Name.ldapToCompat(m);this.setByString(E,P)},this.setByObject=function(m,P){P!==void 0&&(this.sRule=P);for(var E in m)if(m.hasOwnProperty(E)){var N=new g({str:E+"="+m[E],rule:this.sRule});this.asn1Array?this.asn1Array.push(N):this.asn1Array=[N]}},this.setByParam=function(m){if(m.rule!==void 0&&(this.sRule=m.rule),m.array!==void 0)this.paramArray=m.array;else if(m.str!==void 0)this.setByString(m.str);else if(m.ldapstr!==void 0)this.setByLdapString(m.ldapstr);else if(m.hex!==void 0)this.hTLV=m.hex;else if(m.certissuer!==void 0){var P=new He;P.readCertPEM(m.certissuer),this.hTLV=P.getIssuerHex()}else if(m.certsubject!==void 0){var P=new He;P.readCertPEM(m.certsubject),this.hTLV=P.getSubjectHex()}else typeof m=="object"&&m.certsubject===void 0&&m.certissuer===void 0&&this.setByObject(m)},this.tohex=function(){if(typeof this.hTLV=="string")return this.hTLV;if(this.asn1Array.length==0&&this.paramArray.length>0)for(var m=0;m<this.paramArray.length;m++){var P={array:this.paramArray[m]};this.sRule!="utf8"&&(P.rule=this.sRule);var E=new g(P);this.asn1Array.push(E)}var N=new l.DERSequence({array:this.asn1Array});return this.hTLV=N.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.X500Name,v.asn1.ASN1Object),v.asn1.x509.X500Name.compatToLDAP=function(s){if(s.substr(0,1)!=="/")throw"malformed input";s=s.substr(1);var c=s.split("/");return c.reverse(),c=c.map(function(l){return l.replace(/,/,"\\,")}),c.join(",")},v.asn1.x509.X500Name.onelineToLDAP=function(s){return v.asn1.x509.X500Name.compatToLDAP(s)},v.asn1.x509.X500Name.ldapToCompat=function(s){for(var c=s.split(","),l=!1,d=[],g=0;c.length>0;g++){var m=c.shift();if(l===!0){var P=d.pop(),E=(P+","+m).replace(/\\,/g,",");d.push(E),l=!1}else d.push(m);m.substr(-1,1)==="\\"&&(l=!0)}return d=d.map(function(N){return N.replace("/","\\/")}),d.reverse(),"/"+d.join("/")},v.asn1.x509.X500Name.ldapToOneline=function(s){return v.asn1.x509.X500Name.ldapToCompat(s)},v.asn1.x509.RDN=function(s){v.asn1.x509.RDN.superclass.constructor.call(this),this.asn1Array=[],this.paramArray=[],this.sRule="utf8";var c=v.asn1.x509.AttributeTypeAndValue;this.setByParam=function(l){l.rule!==void 0&&(this.sRule=l.rule),l.str!==void 0&&this.addByMultiValuedString(l.str),l.array!==void 0&&(this.paramArray=l.array)},this.addByString=function(l){this.asn1Array.push(new v.asn1.x509.AttributeTypeAndValue({str:l,rule:this.sRule}))},this.addByMultiValuedString=function(l){for(var d=v.asn1.x509.RDN.parseString(l),g=0;g<d.length;g++)this.addByString(d[g])},this.tohex=function(){if(this.asn1Array.length==0&&this.paramArray.length>0)for(var l=0;l<this.paramArray.length;l++){var d=this.paramArray[l];d.rule!==void 0&&this.sRule!="utf8"&&(d.rule=this.sRule);var g=new c(d);this.asn1Array.push(g)}var m=new v.asn1.DERSet({array:this.asn1Array});return this.TLV=m.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.RDN,v.asn1.ASN1Object),v.asn1.x509.RDN.parseString=function(s){for(var c=s.split(/\+/),l=!1,d=[],g=0;c.length>0;g++){var m=c.shift();if(l===!0){var P=d.pop(),E=(P+"+"+m).replace(/\\\+/g,"+");d.push(E),l=!1}else d.push(m);m.substr(-1,1)==="\\"&&(l=!0)}for(var N=!1,A=[],g=0;d.length>0;g++){var m=d.shift();if(N===!0){var j=A.pop();if(m.match(/"$/)){var E=(j+"+"+m).replace(/^([^=]+)="(.*)"$/,"$1=$2");A.push(E),N=!1}else A.push(j+"+"+m)}else A.push(m);m.match(/^[^=]+="/)&&(N=!0)}return A},v.asn1.x509.AttributeTypeAndValue=function(s){v.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this),this.sRule="utf8",this.sType=null,this.sValue=null,this.dsType=null;var c=v,l=c.asn1,d=l.DERSequence,g=l.DERUTF8String,m=l.DERPrintableString,P=l.DERTeletexString,E=l.DERIA5String,N=l.DERVisibleString,A=l.DERBMPString,j=c.lang.String.isMail,O=c.lang.String.isPrintable;this.setByParam=function(C){if(C.rule!==void 0&&(this.sRule=C.rule),C.ds!==void 0&&(this.dsType=C.ds),C.value===void 0&&C.str!==void 0){var I=C.str,T=I.match(/^([^=]+)=(.+)$/);if(T)this.sType=T[1],this.sValue=T[2];else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)}else this.sType=C.type,this.sValue=C.value},this.setByString=function(C,I){I!==void 0&&(this.sRule=I);var T=C.match(/^([^=]+)=(.+)$/);if(T)this.setByAttrTypeAndValueStr(T[1],T[2]);else throw new Error("malformed attrTypeAndValueStr: "+attrTypeAndValueStr)},this._getDsType=function(){var C=this.sType,I=this.sValue,T=this.sRule;return T==="prn"?C=="CN"&&j(I)?"ia5":O(I)?"prn":"utf8":T==="utf8"?C=="CN"&&j(I)?"ia5":C=="C"?"prn":"utf8":"utf8"},this.setByAttrTypeAndValueStr=function(C,I,T){T!==void 0&&(this.sRule=T),this.sType=C,this.sValue=I},this.getValueObj=function(C,I){if(C=="utf8")return new g({str:I});if(C=="prn")return new m({str:I});if(C=="tel")return new P({str:I});if(C=="ia5")return new E({str:I});if(C=="vis")return new N({str:I});if(C=="bmp")return new A({str:I});throw new Error("unsupported directory string type: type="+C+" value="+I)},this.tohex=function(){this.dsType==null&&(this.dsType=this._getDsType());var C=v.asn1.x509.OID.atype2obj(this.sType),I=this.getValueObj(this.dsType,this.sValue),T=new d({array:[C,I]});return this.TLV=T.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.AttributeTypeAndValue,v.asn1.ASN1Object),v.asn1.x509.SubjectPublicKeyInfo=function(s){v.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERInteger,g=l.DERBitString,m=l.DERObjectIdentifier,P=l.DERSequence,E=l.ASN1Util.newObject,N=l.x509,A=N.AlgorithmIdentifier,j=c.crypto;j.ECDSA,j.DSA,this.getASN1Object=function(){if(this.asn1AlgId==null||this.asn1SubjPKey==null)throw"algId and/or subjPubKey not set";var O=new P({array:[this.asn1AlgId,this.asn1SubjPKey]});return O},this.tohex=function(){var O=this.getASN1Object();return this.hTLV=O.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},this.setPubKey=function(O){try{if(O instanceof Ke){var C=E({seq:[{int:{bigint:O.n}},{int:{int:O.e}}]}),I=C.tohex();this.asn1AlgId=new A({name:"rsaEncryption"}),this.asn1SubjPKey=new g({hex:"00"+I})}}catch{}try{if(O instanceof v.crypto.ECDSA){var T=new m({name:O.curveName});this.asn1AlgId=new A({name:"ecPublicKey",asn1params:T}),this.asn1SubjPKey=new g({hex:"00"+O.pubKeyHex})}}catch{}try{if(O instanceof v.crypto.DSA){var T=new E({seq:[{int:{bigint:O.p}},{int:{bigint:O.q}},{int:{bigint:O.g}}]});this.asn1AlgId=new A({name:"dsa",asn1params:T});var D=new d({bigint:O.y});this.asn1SubjPKey=new g({hex:"00"+D.tohex()})}}catch{}},s!==void 0&&this.setPubKey(s)},ve(v.asn1.x509.SubjectPublicKeyInfo,v.asn1.ASN1Object),v.asn1.x509.Time=function(s){v.asn1.x509.Time.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERUTCTime,g=l.DERGeneralizedTime;this.params=null,this.type=null,this.setTimeParams=function(m){this.timeParams=m},this.setByParam=function(m){this.params=m},this.getType=function(m){return m.match(/^[0-9]{12}Z$/)?"utc":m.match(/^[0-9]{14}Z$/)?"gen":m.match(/^[0-9]{12}\.[0-9]+Z$/)?"utc":m.match(/^[0-9]{14}\.[0-9]+Z$/)?"gen":null},this.tohex=function(){var m=this.params,P=null;if(typeof m=="string"&&(m={str:m}),m!=null&&m.str&&(m.type==null||m.type==null)&&(m.type=this.getType(m.str)),m!=null&&m.str?(m.type=="utc"&&(P=new d(m.str)),m.type=="gen"&&(P=new g(m.str))):this.type=="gen"?P=new g:P=new d,P==null)throw new Error("wrong setting for Time");return this.TLV=P.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},v.asn1.x509.Time_bak=function(s){v.asn1.x509.Time_bak.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERUTCTime,g=l.DERGeneralizedTime;this.setTimeParams=function(m){this.timeParams=m},this.tohex=function(){var m=null;return this.timeParams!=null?this.type=="utc"?m=new d(this.timeParams):m=new g(this.timeParams):this.type=="utc"?m=new d:m=new g,this.TLV=m.tohex(),this.TLV},this.getEncodedHex=function(){return this.tohex()},this.type="utc",s!==void 0&&(s.type!==void 0?this.type=s.type:s.str!==void 0&&(s.str.match(/^[0-9]{12}Z$/)&&(this.type="utc"),s.str.match(/^[0-9]{14}Z$/)&&(this.type="gen")),this.timeParams=s)},ve(v.asn1.x509.Time,v.asn1.ASN1Object),v.asn1.x509.AlgorithmIdentifier=function(s){v.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this),this.nameAlg=null,this.asn1Alg=null,this.asn1Params=null,this.paramEmpty=!1;var c=v,l=c.asn1,d=l.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV;if(this.tohex=function(){if(this.nameAlg===null&&this.asn1Alg===null)throw new Error("algorithm not specified");if(this.nameAlg!==null){var m=null;for(var P in d)P===this.nameAlg&&(m=d[P]);if(m!==null)return this.hTLV=m,this.hTLV}this.nameAlg!==null&&this.asn1Alg===null&&(this.asn1Alg=l.x509.OID.name2obj(this.nameAlg));var E=[this.asn1Alg];this.asn1Params!==null&&E.push(this.asn1Params);var N=new l.DERSequence({array:E});return this.hTLV=N.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&(s.name!==void 0&&(this.nameAlg=s.name),s.asn1params!==void 0&&(this.asn1Params=s.asn1params),s.paramempty!==void 0&&(this.paramEmpty=s.paramempty)),this.asn1Params===null&&this.paramEmpty===!1&&this.nameAlg!==null){this.nameAlg.name!==void 0&&(this.nameAlg=this.nameAlg.name);var g=this.nameAlg.toLowerCase();g.substr(-7,7)!=="withdsa"&&g.substr(-9,9)!=="withecdsa"&&(this.asn1Params=new l.DERNull)}},ve(v.asn1.x509.AlgorithmIdentifier,v.asn1.ASN1Object),v.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV={SHAwithRSAandMGF1:"300d06092a864886f70d01010a3000",SHA256withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040201a11a301806092a864886f70d010108300b0609608648016503040201a203020120",SHA384withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040202a11a301806092a864886f70d010108300b0609608648016503040202a203020130",SHA512withRSAandMGF1:"303d06092a864886f70d01010a3030a00d300b0609608648016503040203a11a301806092a864886f70d010108300b0609608648016503040203a203020140"},v.asn1.x509.GeneralName=function(s){v.asn1.x509.GeneralName.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.x509,g=d.X500Name,m=d.OtherName,P=l.DERIA5String;l.DERPrintableString;var E=l.DEROctetString,N=l.DERTaggedObject,A=l.ASN1Object,j=Error;this.params=null,this.setByParam=function(O){this.params=O},this.tohex=function(){var O=this.params,C,T,I,T=!1;if(O.other!==void 0)C="a0",I=new m(O.other);else if(O.rfc822!==void 0)C="81",I=new P({str:O.rfc822});else if(O.dns!==void 0)C="82",I=new P({str:O.dns});else if(O.dn!==void 0)C="a4",T=!0,typeof O.dn=="string"?I=new g({str:O.dn}):O.dn instanceof v.asn1.x509.X500Name?I=O.dn:I=new g(O.dn);else if(O.ldapdn!==void 0)C="a4",T=!0,I=new g({ldapstr:O.ldapdn});else if(O.certissuer!==void 0||O.certsubj!==void 0){C="a4",T=!0;var D,M,H=null;if(O.certsubj!==void 0?(D=!1,M=O.certsubj):(D=!0,M=O.certissuer),M.match(/^[0-9A-Fa-f]+$/),M.indexOf("-----BEGIN ")!=-1&&(H=Bt(M)),H==null)throw new Error("certsubj/certissuer not cert");var te=new He;te.hex=H;var ie;D?ie=te.getIssuerHex():ie=te.getSubjectHex(),I=new A,I.hTLV=ie}else if(O.uri!==void 0)C="86",I=new P({str:O.uri});else if(O.ip!==void 0){C="87";var re,ae=O.ip;try{if(ae.match(/^[0-9a-f]+$/)){var V=ae.length;if(V==8||V==16||V==32||V==64)re=ae;else throw"err"}else re=ed(ae)}catch(Z){throw new j("malformed IP address: "+O.ip+":"+Z.message)}I=new E({hex:re})}else throw new j("improper params");var $=new N({tag:C,explicit:T,obj:I});return $.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.GeneralName,v.asn1.ASN1Object),v.asn1.x509.GeneralNames=function(s){v.asn1.x509.GeneralNames.superclass.constructor.call(this);var c=v,l=c.asn1;this.setByParamArray=function(d){for(var g=0;g<d.length;g++){var m=new l.x509.GeneralName(d[g]);this.asn1Array.push(m)}},this.tohex=function(){var d=new l.DERSequence({array:this.asn1Array});return d.tohex()},this.getEncodedHex=function(){return this.tohex()},this.asn1Array=new Array,typeof s<"u"&&this.setByParamArray(s)},ve(v.asn1.x509.GeneralNames,v.asn1.ASN1Object),v.asn1.x509.OtherName=function(s){v.asn1.x509.OtherName.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DERObjectIdentifier,g=l.DERSequence,m=l.ASN1Util.newObject;this.params=null,this.setByParam=function(P){this.params=P},this.tohex=function(){var P=this.params;if(P.oid==null||P.value==null)throw new Error("oid or value not specified");var E=new d({oid:P.oid}),N=m({tag:{tag:"a0",explicit:!0,obj:P.value}}),A=new g({array:[E,N]});return A.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.x509.OtherName,v.asn1.ASN1Object),v.asn1.x509.OID=new function(){var s=v.asn1.DERObjectIdentifier;this.name2oidList={"aes128-CBC":"2.16.840.1.101.3.4.1.2","aes256-CBC":"2.16.840.1.101.3.4.1.42",sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",hmacWithSHA1:"1.2.840.113549.2.7",hmacWithSHA224:"1.2.840.113549.2.8",hmacWithSHA256:"1.2.840.113549.2.9",hmacWithSHA384:"1.2.840.113549.2.10",hmacWithSHA512:"1.2.840.113549.2.11",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5","pkcs1-MGF":"1.2.840.113549.1.1.8",rsaPSS:"1.2.840.113549.1.1.10",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",commonName:"2.5.4.3",countryName:"2.5.4.6",localityName:"2.5.4.7",stateOrProvinceName:"2.5.4.8",streetAddress:"2.5.4.9",organizationName:"2.5.4.10",organizationalUnitName:"2.5.4.11",domainComponent:"0.9.2342.19200300.100.1.25",userId:"0.9.2342.19200300.100.1.1",surname:"2.5.4.4",givenName:"2.5.4.42",title:"2.5.4.12",distinguishedName:"2.5.4.49",emailAddress:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3",subjectDirectoryAttributes:"2.5.29.9",subjectKeyIdentifier:"2.5.29.14",keyUsage:"2.5.29.15",subjectAltName:"2.5.29.17",issuerAltName:"2.5.29.18",basicConstraints:"2.5.29.19",cRLNumber:"2.5.29.20",cRLReason:"2.5.29.21",nameConstraints:"2.5.29.30",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",anyPolicy:"2.5.29.32.0",policyMappings:"2.5.29.33",authorityKeyIdentifier:"2.5.29.35",policyConstraints:"2.5.29.36",extKeyUsage:"2.5.29.37",inhibitAnyPolicy:"2.5.29.54",authorityInfoAccess:"1.3.6.1.5.5.7.1.1",ocsp:"1.3.6.1.5.5.7.48.1",ocspBasic:"1.3.6.1.5.5.7.48.1.1",ocspNonce:"1.3.6.1.5.5.7.48.1.2",ocspNoCheck:"1.3.6.1.5.5.7.48.1.5",caIssuers:"1.3.6.1.5.5.7.48.2",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",smtpUTF8Mailbox:"1.3.6.1.5.5.7.8.9",dateOfBirth:"1.3.6.1.5.5.7.9.1",placeOfBirth:"1.3.6.1.5.5.7.9.2",gender:"1.3.6.1.5.5.7.9.3",countryOfCitizenship:"1.3.6.1.5.5.7.9.4",countryOfResidence:"1.3.6.1.5.5.7.9.5",ecPublicKey:"1.2.840.10045.2.1","P-256":"1.2.840.10045.3.1.7",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",secp521r1:"1.3.132.0.35",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4",signingCertificate:"1.2.840.113549.1.9.16.2.12",timeStampToken:"1.2.840.113549.1.9.16.2.14",signaturePolicyIdentifier:"1.2.840.113549.1.9.16.2.15",etsArchiveTimeStamp:"1.2.840.113549.1.9.16.2.27",signingCertificateV2:"1.2.840.113549.1.9.16.2.47",etsArchiveTimeStampV2:"1.2.840.113549.1.9.16.2.48",extensionRequest:"1.2.840.113549.1.9.14",contentType:"1.2.840.113549.1.9.3",messageDigest:"1.2.840.113549.1.9.4",signingTime:"1.2.840.113549.1.9.5",counterSignature:"1.2.840.113549.1.9.6",archiveTimeStampV3:"0.4.0.1733.2.4",pdfRevocationInfoArchival:"1.2.840.113583.1.1.8",adobeTimeStamp:"1.2.840.113583.1.1.9.1",smimeMailboxLegacy:"2.23.140.1.5.1.1",smimeMailboxMulti:"2.23.140.1.5.1.2",smimeMailboxStrict:"2.23.140.1.5.1.3",smimeOrganizationLegacy:"2.23.140.1.5.2.1",smimeOrganizationMulti:"2.23.140.1.5.2.2",smimeOrganizationStrict:"2.23.140.1.5.2.3",smimeSponsorLegacy:"2.23.140.1.5.3.1",smimeSponsorMulti:"2.23.140.1.5.3.2",smimeSponsorStrict:"2.23.140.1.5.3.3",smimeIndividualLegacy:"2.23.140.1.5.4.1",smimeIndividualMulti:"2.23.140.1.5.4.2",smimeIndividualStrict:"2.23.140.1.5.4.3"},this.atype2oidList={CN:"2.5.4.3",L:"2.5.4.7",ST:"2.5.4.8",O:"2.5.4.10",OU:"2.5.4.11",C:"2.5.4.6",STREET:"2.5.4.9",DC:"0.9.2342.19200300.100.1.25",UID:"0.9.2342.19200300.100.1.1",SN:"2.5.4.4",T:"2.5.4.12",GN:"2.5.4.42",DN:"2.5.4.49",E:"1.2.840.113549.1.9.1",description:"2.5.4.13",businessCategory:"2.5.4.15",postalCode:"2.5.4.17",serialNumber:"2.5.4.5",uniqueIdentifier:"2.5.4.45",organizationIdentifier:"2.5.4.97",jurisdictionOfIncorporationL:"1.3.6.1.4.1.311.60.2.1.1",jurisdictionOfIncorporationSP:"1.3.6.1.4.1.311.60.2.1.2",jurisdictionOfIncorporationC:"1.3.6.1.4.1.311.60.2.1.3"},this.objCache={},this.name2obj=function(c){if(typeof this.objCache[c]<"u")return this.objCache[c];if(typeof this.name2oidList[c]>"u")throw"Name of ObjectIdentifier not defined: "+c;var l=this.name2oidList[c],d=new s({oid:l});return this.objCache[c]=d,d},this.atype2obj=function(c){if(this.objCache[c]!==void 0)return this.objCache[c];var l;if(c.match(/^\d+\.\d+\.[0-9.]+$/))l=c;else if(this.atype2oidList[c]!==void 0)l=this.atype2oidList[c];else if(this.name2oidList[c]!==void 0)l=this.name2oidList[c];else throw new Error("AttributeType name undefined: "+c);var d=new s({oid:l});return this.objCache[c]=d,d},this.registerOIDs=function(c){if(this.checkOIDs(c))for(var l in c)this.name2oidList[l]=c[l]},this.checkOIDs=function(c){try{var l=Object.keys(c);return l.length==0?!1:(l.map(function(d,g,m){var P=this[d];if(!P.match(/^[0-2]\.[0-9.]+$/))throw new Error("value is not OID")},c),!0)}catch{return!1}}},v.asn1.x509.OID.oid2name=function(s){var c=v.asn1.x509.OID.name2oidList;for(var l in c)if(c[l]==s)return l;return""},v.asn1.x509.OID.oid2atype=function(s){var c=v.asn1.x509.OID.atype2oidList;for(var l in c)if(c[l]==s)return l;return s},v.asn1.x509.OID.name2oid=function(s){if(s.match(/^[0-9.]+$/))return s;var c=v.asn1.x509.OID.name2oidList;return c[s]===void 0?"":c[s]},v.asn1.x509.X509Util={},v.asn1.x509.X509Util.newCertPEM=function(s){var c=v.asn1.x509;c.TBSCertificate;var l=c.Certificate,d=new l(s);return d.getPEM()},(typeof v>"u"||!v)&&(v={}),(typeof v.asn1>"u"||!v.asn1)&&(v.asn1={}),(typeof v.asn1.cms>"u"||!v.asn1.cms)&&(v.asn1.cms={}),v.asn1.cms.Attribute=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSequence,m=d.DERSet,P=d.DERObjectIdentifier;this.params=null,this.typeOid=null,this.setByParam=function(E){this.params=E},this.getValueArray=function(){throw new c("not yet implemented abstract")},this.tohex=function(){var E=new P({oid:this.typeOid}),N=new m({array:this.getValueArray()}),A=new g({array:[E,N]});return A.tohex()},this.getEncodedHex=function(){return this.tohex()}},ve(v.asn1.cms.Attribute,v.asn1.ASN1Object),v.asn1.cms.ContentType=function(s){var c=v,l=c.asn1;l.cms.ContentType.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.3",this.getValueArray=function(){var d=new l.DERObjectIdentifier(this.params.type);return[d]},s!=null&&this.setByParam(s)},ve(v.asn1.cms.ContentType,v.asn1.cms.Attribute),v.asn1.cms.MessageDigest=function(s){var c=v,l=c.asn1,d=l.DEROctetString,g=l.cms;g.MessageDigest.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.4",this.getValueArray=function(){var m=new d(this.params);return[m]},s!=null&&this.setByParam(s)},ve(v.asn1.cms.MessageDigest,v.asn1.cms.Attribute),v.asn1.cms.SigningTime=function(s){var c=v,l=c.asn1;l.cms.SigningTime.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.5",this.getValueArray=function(){var d=new l.x509.Time(this.params);return[d]},s!=null&&this.setByParam(s)},ve(v.asn1.cms.SigningTime,v.asn1.cms.Attribute),v.asn1.cms.SigningCertificate=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSequence,m=d.cms,P=m.ESSCertID;l.crypto,m.SigningCertificate.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.12",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new c("parameter 'array' not specified");for(var E=this.params.array,N=[],A=0;A<E.length;A++){var j=E[A];s.hasis==!1&&typeof j=="string"&&(j.indexOf("-----BEGIN")!=-1||ke.isASN1HEX(j))&&(j={cert:j}),j.hasis!=!1&&s.hasis==!1&&(j.hasis=!1),N.push(new P(j))}var O=new g({array:N}),C=new g({array:[O]});return[C]},s!=null&&this.setByParam(s)},ve(v.asn1.cms.SigningCertificate,v.asn1.cms.Attribute),v.asn1.cms.ESSCertID=function(s){v.asn1.cms.ESSCertID.superclass.constructor.call(this);var c=Error,l=v,d=l.asn1,g=d.DEROctetString,m=d.DERSequence,P=d.cms.IssuerSerial;this.params=null,this.getCertHash=function(E,N){if(E.hash!=null)return E.hash;if(typeof E=="string"&&E.indexOf("-----BEGIN")==-1&&!ke.isASN1HEX(E))return E;var A;if(typeof E=="string")A=E;else if(E.cert!=null)A=E.cert;else throw new c("hash nor cert unspecified");var j;A.indexOf("-----BEGIN")!=-1?j=Bt(A):j=A,typeof E=="string"&&(E.indexOf("-----BEGIN")!=-1?j=Bt(E):ke.isASN1HEX(E)&&(j=E));var O;if(E.alg!=null)O=E.alg;else if(N!=null)O=N;else throw new c("hash alg unspecified");return l.crypto.Util.hashHex(j,O)},this.tohex=function(){var E=this.params,N=this.getCertHash(E,"sha1"),A=[];A.push(new g({hex:N})),(typeof E=="string"&&E.indexOf("-----BEGIN")!=-1||E.cert!=null&&E.hasis!=!1||E.issuer!=null&&E.serial!=null)&&A.push(new P(E));var j=new m({array:A});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.ESSCertID,v.asn1.ASN1Object),v.asn1.cms.SigningCertificateV2=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSequence;d.x509;var m=d.cms,P=m.ESSCertIDv2;l.crypto,m.SigningCertificateV2.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.47",this.getValueArray=function(){if(this.params==null||this.params==null||this.params.array==null)throw new c("parameter 'array' not specified");for(var E=this.params.array,N=[],A=0;A<E.length;A++){var j=E[A];(s.alg!=null||s.hasis==!1)&&typeof j=="string"&&(j.indexOf("-----BEGIN")!=-1||ke.isASN1HEX(j))&&(j={cert:j}),j.alg==null&&s.alg!=null&&(j.alg=s.alg),j.hasis!=!1&&s.hasis==!1&&(j.hasis=!1),N.push(new P(j))}var O=new g({array:N}),C=new g({array:[O]});return[C]},s!=null&&this.setByParam(s)},ve(v.asn1.cms.SigningCertificateV2,v.asn1.cms.Attribute),v.asn1.cms.ESSCertIDv2=function(s){v.asn1.cms.ESSCertIDv2.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.DEROctetString,g=l.DERSequence,m=l.cms.IssuerSerial,P=l.x509.AlgorithmIdentifier;this.params=null,this.tohex=function(){var E=this.params,N=this.getCertHash(E,"sha256"),A=[];E.alg!=null&&E.alg!="sha256"&&A.push(new P({name:E.alg})),A.push(new d({hex:N})),(typeof E=="string"&&E.indexOf("-----BEGIN")!=-1||E.cert!=null&&E.hasis!=!1||E.issuer!=null&&E.serial!=null)&&A.push(new m(E));var j=new g({array:A});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.ESSCertIDv2,v.asn1.cms.ESSCertID),v.asn1.cms.IssuerSerial=function(s){var c=Error,l=v,d=l.asn1,g=d.DERInteger,m=d.DERSequence,P=d.cms,E=d.x509,N=E.GeneralNames,A=He;P.IssuerSerial.superclass.constructor.call(this),this.setByParam=function(j){this.params=j},this.tohex=function(){var j=this.params,O,C;if(typeof j=="string"&&j.indexOf("-----BEGIN")!=-1||j.cert!=null){var I;j.cert!=null?I=j.cert:I=j;var T=new A;T.readCertPEM(I),O=T.getIssuer(),C={hex:T.getSerialNumberHex()}}else if(j.issuer!=null&&j.serial)O=j.issuer,C=j.serial;else throw new c("cert or issuer and serial parameter not specified");var D=new N([{dn:O}]),M=new g(C),H=new m({array:[D,M]});return H.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.IssuerSerial,v.asn1.ASN1Object),v.asn1.cms.SignerIdentifier=function(s){var c=v,l=c.asn1;l.DERInteger,l.DERSequence;var d=l.cms,g=d.IssuerAndSerialNumber,m=d.SubjectKeyIdentifier,P=l.x509;P.X500Name,d.SignerIdentifier.superclass.constructor.call(this),this.params=null,this.tohex=function(){var E=this.params;if(E.type=="isssn"){var N=new g(E);return N.tohex()}else if(E.type=="skid"){var A=new m(E);return A.tohex()}else throw new Error("wrong property for isssn or skid")},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.SignerIdentifier,v.asn1.ASN1Object),v.asn1.cms.IssuerAndSerialNumber=function(s){var c=v,l=c.asn1,d=l.DERInteger,g=l.DERSequence,m=l.cms,P=l.x509,E=P.X500Name,N=He,A=Error;m.IssuerAndSerialNumber.superclass.constructor.call(this),this.params=null,this.tohex=function(){var j=this.params,O,C;if(typeof j=="string"&&j.indexOf("-----BEGIN")!=-1||j.cert!=null){var I;j.cert!=null?I=j.cert:I=j;var T=new N;T.readCertPEM(I),O=T.getIssuer(),C={hex:T.getSerialNumberHex()}}else if(j.issuer!=null&&j.serial)O=j.issuer,C=j.serial;else throw new A("cert or issuer and serial parameter not specified");var D=new E(O),M=new d(C),H=new g({array:[D,M]});return H.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(j){this.params=j},s!=null&&this.setByParam(s)},ve(v.asn1.cms.IssuerAndSerialNumber,v.asn1.ASN1Object),v.asn1.cms.SubjectKeyIdentifier=function(s){var c=v,l=c.asn1;l.DERInteger,l.DERSequence;var d=l.ASN1Util.newObject,g=l.cms;g.IssuerAndSerialName,g.SubjectKeyIdentifier;var m=l.x509;m.X500Name;var P=He,E=Error;g.SubjectKeyIdentifier.superclass.constructor.call(this),this.tohex=function(){var N=this.params;if(N.cert==null&&N.skid==null)throw new E("property cert nor skid undefined");var A;if(N.cert!=null){var j=new P(N.cert),O=j.getExtSubjectKeyIdentifier();A=O.kid.hex}else N.skid!=null&&(A=N.skid);var C=d({tag:{tage:"a0",obj:{octstr:{hex:A}}}});return C.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.SubjectKeyIdentifier,v.asn1.ASN1Object),v.asn1.cms.AttributeList=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSet,m=d.cms;m.AttributeList.superclass.constructor.call(this),this.params=null,this.hTLV=null,this.setByParam=function(P){this.params=P},this.tohex=function(){var P=this.params;if(this.hTLV!=null)return this.hTLV;var E=!0;P.sortflag!=null&&(E=P.sortflag);for(var N=P.array,A=[],j=0;j<N.length;j++){var O=N[j],C=O.attr;if(C=="contentType")A.push(new m.ContentType(O));else if(C=="messageDigest")A.push(new m.MessageDigest(O));else if(C=="signingTime")A.push(new m.SigningTime(O));else if(C=="signingCertificate")A.push(new m.SigningCertificate(O));else if(C=="signingCertificateV2")A.push(new m.SigningCertificateV2(O));else if(C=="signaturePolicyIdentifier")A.push(new v.asn1.cades.SignaturePolicyIdentifier(O));else if(C=="signatureTimeStamp"||C=="timeStampToken")A.push(new v.asn1.cades.SignatureTimeStamp(O));else throw new c("unknown attr: "+C)}var I=new g({array:A,sortflag:E});return this.hTLV=I.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.AttributeList,v.asn1.ASN1Object),v.asn1.cms.SignerInfo=function(s){var c=Error,l=v,d=l.asn1,g=d.DERInteger,m=d.DEROctetString,P=d.DERSequence,E=d.DERTaggedObject,N=d.cms,A=N.SignerIdentifier,j=N.AttributeList;N.ContentType,N.EncapsulatedContentInfo,N.MessageDigest,N.SignedData;var O=d.x509,C=O.AlgorithmIdentifier,I=l.crypto,T=nt;N.SignerInfo.superclass.constructor.call(this),this.params=null,this.sign=function(){var D=this.params,M=D.sigalg,H=new j(D.sattrs).tohex(),te=T.getKey(D.signkey),ie=new I.Signature({alg:M});ie.init(te),ie.updateHex(H);var re=ie.sign();D.sighex=re},this.tohex=function(){var D=this.params,M=[];if(M.push(new g({int:D.version})),M.push(new A(D.id)),M.push(new C({name:D.hashalg})),D.sattrs!=null){var H=new j(D.sattrs);try{M.push(new E({tag:"a0",explicit:!1,obj:H}))}catch(ie){throw new c("si sattr error: "+ie)}}if(D.sigalgfield!=null?M.push(new C({name:D.sigalgfield})):M.push(new C({name:D.sigalg})),D.sighex==null&&D.signkey!=null&&this.sign(),M.push(new m({hex:D.sighex})),D.uattrs!=null){var H=new j(D.uattrs);try{M.push(new E({tag:"a1",explicit:!1,obj:H}))}catch(re){throw new c("si uattr error: "+re)}}var te=new P({array:M});return te.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.SignerInfo,v.asn1.ASN1Object),v.asn1.cms.EncapsulatedContentInfo=function(s){var c=v,l=c.asn1,d=l.DERTaggedObject,g=l.DERSequence,m=l.DERObjectIdentifier,P=l.DEROctetString,E=l.cms;E.EncapsulatedContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var N=this.params,A=[];if(A.push(new m(N.type)),N.content!=null&&(N.content.hex!=null||N.content.str!=null)&&N.isDetached!=!0){var j=new P(N.content),O=new d({tag:"a0",explicit:!0,obj:j});A.push(O)}var C=new g({array:A});return C.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(N){this.params=N},s!=null&&this.setByParam(s)},ve(v.asn1.cms.EncapsulatedContentInfo,v.asn1.ASN1Object),v.asn1.cms.ContentInfo=function(s){var c=v,l=c.asn1,d=l.DERTaggedObject,g=l.DERSequence,m=l.DERObjectIdentifier,P=l.x509;P.OID.name2obj,v.asn1.cms.ContentInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var E=this.params,N=[];N.push(new m(E.type));var A=new d({tag:"a0",explicit:!0,obj:E.obj});N.push(A);var j=new g({array:N});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(E){this.params=E},s!=null&&this.setByParam(s)},ve(v.asn1.cms.ContentInfo,v.asn1.ASN1Object),v.asn1.cms.SignedData=function(s){var c=v,l=c.asn1;l.ASN1Object;var d=l.DERInteger,g=l.DERSet,m=l.DERSequence;l.DERTaggedObject;var P=l.cms,E=P.EncapsulatedContentInfo,N=P.SignerInfo,A=P.ContentInfo,j=P.CertificateSet,O=P.RevocationInfoChoices,C=l.x509,I=C.AlgorithmIdentifier;v.asn1.cms.SignedData.superclass.constructor.call(this),this.params=null,this.checkAndFixParam=function(){var T=this.params;this._setDigestAlgs(T),this._setContentTypeByEContent(T),this._setMessageDigestByEContent(T),this._setSignerInfoVersion(T),this._setSignedDataVersion(T)},this._setDigestAlgs=function(T){for(var D={},M=T.sinfos,H=0;H<M.length;H++){var te=M[H];D[te.hashalg]=1}T.hashalgs=Object.keys(D).sort()},this._setContentTypeByEContent=function(T){for(var D=T.econtent.type,M=T.sinfos,H=0;H<M.length;H++){var te=M[H],ie=this._getAttrParamByName(te,"contentType");ie.type=D}},this._setMessageDigestByEContent=function(T){var D=T.econtent;T.econtent.type;var M=D.content.hex;M==null&&D.type=="data"&&D.content.str!=null&&(M=Gr(D.content.str));for(var H=T.sinfos,te=0;te<H.length;te++){var ie=H[te],re=ie.hashalg,ae=this._getAttrParamByName(ie,"messageDigest"),V=v.crypto.Util.hashHex(M,re);ae.hex=V}},this._getAttrParamByName=function(T,D){for(var M=T.sattrs.array,H=0;H<M.length;H++)if(M[H].attr==D)return M[H]},this._setSignerInfoVersion=function(T){for(var D=T.sinfos,M=0;M<D.length;M++){var H=D[M],te=1;H.id.type=="skid"&&(te=3),H.version=te}},this._setSignedDataVersion=function(T){var D=this._getSignedDataVersion(T);T.version=D},this._getSignedDataVersion=function(T){if(T.revinfos!=null)for(var D=T.revinfos,M=0;M<D.length;M++){var H=D[M];if(H.ocsp!=null)return 5}for(var te=T.sinfos,M=0;M<te.length;M++){var ie=T.sinfos[M];if(ie.version==3)return 3}return T.econtent.type!="data"?3:1},this.tohex=function(){var T=this.params;this.getEncodedHexPrepare!=null&&this.getEncodedHexPrepare(),T.fixed!=!0&&this.checkAndFixParam();var D=[];D.push(new d({int:T.version}));for(var M=[],H=0;H<T.hashalgs.length;H++){var te=T.hashalgs[H];M.push(new I({name:te}))}D.push(new g({array:M})),D.push(new E(T.econtent)),T.certs!=null&&D.push(new j(T.certs)),T.revinfos!=null&&D.push(new O(T.revinfos));for(var ie=[],H=0;H<T.sinfos.length;H++){var re=T.sinfos[H];ie.push(new N(re))}D.push(new g({array:ie}));var ae=new m({array:D});return ae.tohex()},this.getEncodedHex=function(){return this.tohex()},this.getContentInfo=function(){var T=new A({type:"signed-data",obj:this});return T},this.getContentInfoEncodedHex=function(){return this.getContentInfo().tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.SignedData,v.asn1.ASN1Object),v.asn1.cms.CertificateSet=function(s){v.asn1.cms.CertificateSet.superclass.constructor.call(this);var c=Error,l=v.asn1,d=l.DERTaggedObject,g=l.DERSet,m=l.ASN1Object;this.params=null,this.tohex=function(){var P=this.params,E=[],N;if(P instanceof Array)N=P;else if(P.array!=null)N=P.array;else throw new c("cert array not specified");for(var A=0;A<N.length;A++){var j=N[A],O=Bt(j),C=new m;C.hTLV=O,E.push(C)}var I={array:E};P.sortflag==!1&&(I.sortflag=!1);var T=new g(I),D=new d({tag:"a0",explicit:!1,obj:T});return D.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.CertificateSet,v.asn1.ASN1Object),v.asn1.cms.RevocationInfoChoices=function(s){v.asn1.cms.RevocationInfoChoices.superclass.constructor.call(this),this.params=null,this.tohex=function(){var c=this.params;if(!c instanceof Array)throw new Error("params is not array");for(var l=[],d=0;d<c.length;d++)l.push(new v.asn1.cms.RevocationInfoChoice(c[d]));var g=v.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:{set:l}}});return g.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.RevocationInfoChoices,v.asn1.ASN1Object),v.asn1.cms.RevocationInfoChoice=function(s){v.asn1.cms.RevocationInfoChoice.superclass.constructor.call(this),this.params=null,this.tohex=function(){var c=this.params;if(c.crl!=null&&typeof c.crl=="string"){var l=c.crl;return c.crl.indexOf("-----BEGIN")!=-1&&(l=Bt(c.crl)),l}else if(c.ocsp!=null){var d=v.asn1.ASN1Util.newObject({tag:{tagi:"a1",obj:new v.asn1.cms.OtherRevocationFormat(c)}});return d.tohex()}else throw new Error("property crl or ocsp undefined")},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.RevocationInfoChoice,v.asn1.ASN1Object),v.asn1.cms.OtherRevocationFormat=function(s){v.asn1.cms.OtherRevocationFormat.superclass.constructor.call(this);var c=Error,l=v,d=l.asn1,g=d.ASN1Util.newObject,m=l.lang.String.isHex;this.params=null,this.tohex=function(){var P=this.params;if(P.ocsp==null)throw new c("property ocsp not specified");if(!m(P.ocsp)||!ke.isASN1HEX(P.ocsp))throw new c("ocsp value not ASN.1 hex string");var E=g({seq:[{oid:"1.3.6.1.5.5.7.16.2"},{asn1:{tlv:P.ocsp}}]});return E.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cms.OtherRevocationFormat,v.asn1.ASN1Object),v.asn1.cms.CMSUtil=new function(){},v.asn1.cms.CMSUtil.newSignedData=function(s){return new v.asn1.cms.SignedData(s)},v.asn1.cms.CMSUtil.verifySignedData=function(s){var c=v,l=c.asn1,d=l.cms;d.SignerInfo,d.SignedData,d.SigningTime,d.SigningCertificate,d.SigningCertificateV2;var g=l.cades;g.SignaturePolicyIdentifier;var m=c.lang.String.isHex,P=ke,E=P.getVbyList,N=P.getTLVbyList,A=P.getIdxbyList,j=P.getChildIdx,O=P.getTLV,C=P.oidname,I=c.crypto.Util.hashHex;s.cms===void 0&&m(s.cms);var T=s.cms,D=function(Z,q){for(var Y,se=3;se<6;se++)if(Y=A(Z,0,[1,0,se]),Y!==void 0){var ue=Z.substr(Y,2);ue==="a0"&&(q.certsIdx=Y),ue==="a1"&&(q.revinfosIdx=Y),ue==="31"&&(q.signerinfosIdx=Y)}},M=function(Z,q){var Y=q.signerinfosIdx;if(Y!==void 0){var se=j(Z,Y);q.signerInfoIdxList=se;for(var ue=0;ue<se.length;ue++){var be=se[ue],le={idx:be};H(Z,le),q.signerInfos.push(le)}}},H=function(Z,q){var Y=q.idx;q.signerid_issuer1=N(Z,Y,[1,0],"30"),q.signerid_serial1=E(Z,Y,[1,1],"02"),q.hashalg=C(E(Z,Y,[2,0],"06"));var se=A(Z,Y,[3],"a0");q.idxSignedAttrs=se,te(Z,q,se);var ue=j(Z,Y),be=ue.length;if(be<6)throw"malformed SignerInfo";q.sigalg=C(E(Z,Y,[be-2,0],"06")),q.sigval=E(Z,Y,[be-1],"04")},te=function(Z,q,Y){var se=j(Z,Y);q.signedAttrIdxList=se;for(var ue=0;ue<se.length;ue++){var be=se[ue],le=E(Z,be,[0],"06"),pe;le==="2a864886f70d010905"?(pe=ft(E(Z,be,[1,0])),q.saSigningTime=pe):le==="2a864886f70d010904"&&(pe=E(Z,be,[1,0],"04"),q.saMessageDigest=pe)}},ie=function(Z,q){if(E(Z,0,[0],"06")!=="2a864886f70d010702")return q;q.cmsType="signedData",q.econtent=E(Z,0,[1,0,2,1,0]),D(Z,q),q.signerInfos=[],M(Z,q)},re=function(Z,q){for(var Y=q.parse.signerInfos,se=Y.length,ue=!0,be=0;be<se;be++){var le=Y[be];V(Z,q,le),le.isValid||(ue=!1)}q.isValid=ue},ae=function(Z,q,Y,se){var ue=q.parse.certsIdx,be;if(q.certs===void 0){be=[],q.certkeys=[];for(var le=j(Z,ue),pe=0;pe<le.length;pe++){var Se=O(Z,le[pe]),Ce=new He;Ce.readCertHex(Se),be[pe]=Ce,q.certkeys[pe]=Ce.getPublicKey()}q.certs=be}else be=q.certs;q.cccc=be.length,q.cccci=le.length;for(var pe=0;pe<be.length;pe++){var gn=Ce.getIssuerHex(),It=Ce.getSerialNumberHex();Y.signerid_issuer1===gn&&Y.signerid_serial1===It&&(Y.certkey_idx=pe)}},V=function(Z,q,Y,se){Y.verifyDetail={};var ue=Y.verifyDetail,be=q.parse.econtent,le=Y.hashalg,pe=Y.saMessageDigest;ue.validMessageDigest=!1,I(be,le)===pe&&(ue.validMessageDigest=!0),ae(Z,q,Y),ue.validSignatureValue=!1;var Se=Y.sigalg,Ce="31"+O(Z,Y.idxSignedAttrs).substr(2);Y.signedattrshex=Ce;var gn=q.certs[Y.certkey_idx].getPublicKey(),It=new v.crypto.Signature({alg:Se});It.init(gn),It.updateHex(Ce);var St=It.verify(Y.sigval);ue.validSignatureValue_isValid=St,St===!0&&(ue.validSignatureValue=!0),Y.isValid=!1,ue.validMessageDigest&&ue.validSignatureValue&&(Y.isValid=!0)},$={isValid:!1,parse:{}};return ie(T,$.parse),re(T,$),$},v.asn1.cms.CMSParser=function(){var s=Error,c=He,l=new c,d=ke,g=d.getV,m=d.getTLV;d.getIdxbyList;var P=d.getTLVbyList,E=d.getTLVbyListEx,N=d.getVbyList,A=d.getVbyListEx,j=d.getChildIdx;this.getCMSSignedData=function(O){var C=P(O,0,[1,0]),I=this.getSignedData(C);return I},this.getSignedData=function(O){var C=j(O,0),I={},T=g(O,C[0]),D=parseInt(T,16);I.version=D;var M=m(O,C[1]);I.hashalgs=this.getHashAlgArray(M);var H=m(O,C[2]);I.econtent=this.getEContent(H);var te=E(O,0,["[0]"]);te!=null&&(I.certs=this.getCertificateSet(te)),E(O,0,["[1]"]);var ie=E(O,0,[3]);return I.sinfos=this.getSignerInfos(ie),I},this.getHashAlgArray=function(O){for(var C=j(O,0),I=new c,T=[],D=0;D<C.length;D++){var M=m(O,C[D]),H=I.getAlgorithmIdentifierName(M);T.push(H)}return T},this.getEContent=function(O){var C={},I=N(O,0,[0]),T=N(O,0,[1,0]);return C.type=v.asn1.x509.OID.oid2name(ke.hextooidstr(I)),C.content={hex:T},C},this.getSignerInfos=function(O){for(var C=[],I=j(O,0),T=0;T<I.length;T++){var D=m(O,I[T]),M=this.getSignerInfo(D);C.push(M)}return C},this.getSignerInfo=function(O){var C={},I=j(O,0),T=d.getInt(O,I[0],-1);T!=-1&&(C.version=T);var D=m(O,I[1]),M=this.getIssuerAndSerialNumber(D);C.id=M;var H=m(O,I[2]),te=l.getAlgorithmIdentifierName(H);C.hashalg=te;var ie=E(O,0,["[0]"]);if(ie!=null){var re=this.getAttributeList(ie);C.sattrs=re}var ae=E(O,0,[3]),V=l.getAlgorithmIdentifierName(ae);C.sigalg=V;var $=A(O,0,[4]);C.sighex=$;var Z=E(O,0,["[1]"]);if(Z!=null){var q=this.getAttributeList(Z);C.uattrs=q}return C},this.getSignerIdentifier=function(O){if(O.substr(0,2)=="30")return this.getIssuerAndSerialNumber(O);throw new Error("SKID of signerIdentifier not supported")},this.getIssuerAndSerialNumber=function(O){var C={type:"isssn"},I=j(O,0),T=m(O,I[0]);C.issuer=l.getX500Name(T);var D=g(O,I[1]);return C.serial={hex:D},C},this.getAttributeList=function(O){for(var C=[],I=j(O,0),T=0;T<I.length;T++){var D=m(O,I[T]),M=this.getAttribute(D);C.push(M)}return{array:C}},this.getAttribute=function(O){var C={},I=j(O,0),T=d.getOID(O,I[0]),D=v.asn1.x509.OID.oid2name(T);C.attr=D;var M=m(O,I[1]),H=j(M,0);if(H.length==1)C.valhex=m(M,H[0]);else{for(var te=[],ie=0;ie<H.length;ie++)te.push(m(M,H[ie]));C.valhex=te}return D=="contentType"?this.setContentType(C):D=="messageDigest"?this.setMessageDigest(C):D=="signingTime"?this.setSigningTime(C):D=="signingCertificate"?this.setSigningCertificate(C):D=="signingCertificateV2"?this.setSigningCertificateV2(C):D=="signaturePolicyIdentifier"&&this.setSignaturePolicyIdentifier(C),C},this.setContentType=function(O){var C=d.getOIDName(O.valhex,0,null);C!=null&&(O.type=C,delete O.valhex)},this.setSigningTime=function(O){var C=g(O.valhex,0),I=ft(C);O.str=I,delete O.valhex},this.setMessageDigest=function(O){var C=g(O.valhex,0);O.hex=C,delete O.valhex},this.setSigningCertificate=function(O){var C=j(O.valhex,0);if(C.length>0){for(var I=m(O.valhex,C[0]),T=j(I,0),D=[],M=0;M<T.length;M++){var H=m(I,T[M]),te=this.getESSCertID(H);D.push(te)}O.array=D}if(C.length>1){var ie=m(O.valhex,C[1]);O.polhex=ie}delete O.valhex},this.setSignaturePolicyIdentifier=function(O){var C=j(O.valhex,0);if(C.length>0){var I=d.getOID(O.valhex,C[0]);O.oid=I}if(C.length>1){var T=new c,D=j(O.valhex,C[1]),M=m(O.valhex,D[0]),H=T.getAlgorithmIdentifierName(M);O.alg=H;var te=g(O.valhex,D[1]);O.hash=te}delete O.valhex},this.setSigningCertificateV2=function(O){var C=j(O.valhex,0);if(C.length>0){for(var I=m(O.valhex,C[0]),T=j(I,0),D=[],M=0;M<T.length;M++){var H=m(I,T[M]),te=this.getESSCertIDv2(H);D.push(te)}O.array=D}if(C.length>1){var ie=m(O.valhex,C[1]);O.polhex=ie}delete O.valhex},this.getESSCertID=function(O){var C={},I=j(O,0);if(I.length>0){var T=g(O,I[0]);C.hash=T}if(I.length>1){var D=m(O,I[1]),M=this.getIssuerSerial(D);M.serial!=null&&(C.serial=M.serial),M.issuer!=null&&(C.issuer=M.issuer)}return C},this.getESSCertIDv2=function(O){var C={},I=j(O,0);if(I.length<1||3<I.length)throw new s("wrong number of elements");var T=0;if(O.substr(I[0],2)=="30"){var D=m(O,I[0]);C.alg=l.getAlgorithmIdentifierName(D),T++}else C.alg="sha256";var M=g(O,I[T]);if(C.hash=M,I.length>T+1){var H=m(O,I[T+1]),te=this.getIssuerSerial(H);C.issuer=te.issuer,C.serial=te.serial}return C},this.getIssuerSerial=function(O){var C={},I=j(O,0),T=m(O,I[0]),D=l.getGeneralNames(T),M=D[0].dn;C.issuer=M;var H=g(O,I[1]);return C.serial={hex:H},C},this.getCertificateSet=function(O){for(var C=j(O,0),I=[],T=0;T<C.length;T++){var D=m(O,C[T]);if(D.substr(0,2)=="30"){var M=mn(D,"CERTIFICATE");I.push(M)}}return{array:I,sortflag:!1}}},(typeof v>"u"||!v)&&(v={}),(typeof v.asn1>"u"||!v.asn1)&&(v.asn1={}),(typeof v.asn1.tsp>"u"||!v.asn1.tsp)&&(v.asn1.tsp={}),v.asn1.tsp.TimeStampToken=function(s){var c=v,l=c.asn1,d=l.tsp;d.TimeStampToken.superclass.constructor.call(this),this.params=null,this.getEncodedHexPrepare=function(){var g=new d.TSTInfo(this.params.econtent.content);this.params.econtent.content.hex=g.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.tsp.TimeStampToken,v.asn1.cms.SignedData),v.asn1.tsp.TSTInfo=function(s){var c=v,l=c.asn1,d=l.DERSequence,g=l.DERInteger,m=l.DERBoolean,P=l.DERGeneralizedTime,E=l.DERObjectIdentifier,N=l.DERTaggedObject,A=l.tsp,j=A.MessageImprint,O=A.Accuracy;l.x509.X500Name;var C=l.x509.GeneralName;if(A.TSTInfo.superclass.constructor.call(this),this.dVersion=new g({int:1}),this.dPolicy=null,this.dMessageImprint=null,this.dSerial=null,this.dGenTime=null,this.dAccuracy=null,this.dOrdering=null,this.dNonce=null,this.dTsa=null,this.tohex=function(){var I=[this.dVersion];if(this.dPolicy==null)throw new Error("policy shall be specified.");if(I.push(this.dPolicy),this.dMessageImprint==null)throw new Error("messageImprint shall be specified.");if(I.push(this.dMessageImprint),this.dSerial==null)throw new Error("serialNumber shall be specified.");if(I.push(this.dSerial),this.dGenTime==null)throw new Error("genTime shall be specified.");I.push(this.dGenTime),this.dAccuracy!=null&&I.push(this.dAccuracy),this.dOrdering!=null&&I.push(this.dOrdering),this.dNonce!=null&&I.push(this.dNonce),this.dTsa!=null&&I.push(this.dTsa);var T=new d({array:I});return this.hTLV=T.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0){if(typeof s.policy=="string"){if(!s.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new E({oid:s.policy})}s.messageImprint!==void 0&&(this.dMessageImprint=new j(s.messageImprint)),s.serial!==void 0&&(this.dSerial=new g(s.serial)),s.genTime!==void 0&&(this.dGenTime=new P(s.genTime)),s.accuracy!==void 0&&(this.dAccuracy=new O(s.accuracy)),s.ordering!==void 0&&s.ordering==!0&&(this.dOrdering=new m),s.nonce!==void 0&&(this.dNonce=new g(s.nonce)),s.tsa!==void 0&&(this.dTsa=new N({tag:"a0",explicit:!0,obj:new C({dn:s.tsa})}))}},ve(v.asn1.tsp.TSTInfo,v.asn1.ASN1Object),v.asn1.tsp.Accuracy=function(s){var c=v,l=c.asn1,d=l.ASN1Util.newObject;l.tsp.Accuracy.superclass.constructor.call(this),this.params=null,this.tohex=function(){var g=this.params,m=[];return g.seconds!=null&&typeof g.seconds=="number"&&m.push({int:g.seconds}),g.millis!=null&&typeof g.millis=="number"&&m.push({tag:{tagi:"80",obj:{int:g.millis}}}),g.micros!=null&&typeof g.micros=="number"&&m.push({tag:{tagi:"81",obj:{int:g.micros}}}),d({seq:m}).tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.tsp.Accuracy,v.asn1.ASN1Object),v.asn1.tsp.MessageImprint=function(s){var c=v,l=c.asn1,d=l.DERSequence,g=l.DEROctetString,m=l.x509,P=m.AlgorithmIdentifier;l.tsp.MessageImprint.superclass.constructor.call(this),this.params=null,this.tohex=function(){var E=this.params,N=new P({name:E.alg}),A=new g({hex:E.hash}),j=new d({array:[N,A]});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.tsp.MessageImprint,v.asn1.ASN1Object),v.asn1.tsp.TimeStampReq=function(s){var c=v,l=c.asn1,d=l.DERSequence,g=l.DERInteger,m=l.DERBoolean;l.ASN1Object;var P=l.DERObjectIdentifier,E=l.tsp,N=E.MessageImprint;E.TimeStampReq.superclass.constructor.call(this),this.params=null,this.tohex=function(){var A=this.params,j=[];j.push(new g({int:1})),A.messageImprint instanceof v.asn1.ASN1Object?j.push(A.messageImprint):j.push(new N(A.messageImprint)),A.policy!=null&&j.push(new P(A.policy)),A.nonce!=null&&j.push(new g(A.nonce)),A.certreq==!0&&j.push(new m);var O=new d({array:j});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.tsp.TimeStampReq,v.asn1.ASN1Object),v.asn1.tsp.TimeStampResp=function(s){var c=v,l=c.asn1,d=l.DERSequence;l.ASN1Object;var g=l.tsp,m=g.PKIStatusInfo;g.TimeStampResp.superclass.constructor.call(this),this.params=null,this.tohex=function(){var P=this.params,E=[];if(P.econtent!=null||P.tst!=null)if(P.statusinfo!=null?E.push(new m(P.statusinfo)):E.push(new m("granted")),P.econtent!=null)E.push(new g.TimeStampToken(P).getContentInfo());else if(P.tst instanceof l.ASN1Object)E.push(P.tst);else throw new Error("improper member tst value");else if(P.statusinfo!=null)E.push(new m(P.statusinfo));else throw new Error("parameter for token nor statusinfo not specified");var N=new d({array:E});return N.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.tsp.TimeStampResp,v.asn1.ASN1Object),v.asn1.tsp.PKIStatusInfo=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSequence,m=d.tsp,P=m.PKIStatus,E=m.PKIFreeText,N=m.PKIFailureInfo;m.PKIStatusInfo.superclass.constructor.call(this),this.params=null,this.tohex=function(){var A=this.params,j=[];if(typeof A=="string")j.push(new P(A));else{if(A.status==null)throw new c("property 'status' unspecified");j.push(new P(A.status)),A.statusstr!=null&&j.push(new E(A.statusstr)),A.failinfo!=null&&j.push(new N(A.failinfo))}var O=new g({array:j});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.tsp.PKIStatusInfo,v.asn1.ASN1Object),v.asn1.tsp.PKIStatus=function(s){var c=Error,l=v,d=l.asn1,g=d.DERInteger,m=d.tsp;m.PKIStatus.superclass.constructor.call(this);var P={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};this.params=null,this.tohex=function(){var E=this.params,N;if(typeof E=="string")try{N=P[E]}catch{throw new c("undefined name: "+E)}else if(typeof E=="number")N=E;else throw new c("unsupported params");return new g({int:N}).tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.tsp.PKIStatus,v.asn1.ASN1Object),v.asn1.tsp.PKIFreeText=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSequence,m=d.DERUTF8String,P=d.tsp;P.PKIFreeText.superclass.constructor.call(this),this.params=null,this.tohex=function(){var E=this.params;if(!E instanceof Array)throw new c("wrong params: not array");for(var N=[],A=0;A<E.length;A++)N.push(new m({str:E[A]}));var j=new g({array:N});return j.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.tsp.PKIFreeText,v.asn1.ASN1Object),v.asn1.tsp.PKIFailureInfo=function(s){var c=Error,l=v,d=l.asn1,g=d.DERBitString,m=d.tsp,P=m.PKIFailureInfo,E={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};P.superclass.constructor.call(this),this.params=null,this.getBinValue=function(){var N=this.params,A=0;if(typeof N=="number"&&0<=N&&N<=25){A|=1<<N;for(var j=A.toString(2),O="",C=j.length-1;C>=0;C--)O+=j[C];return O}else{if(typeof N=="string"&&E[N]!=null)return Cc([N],E);if(typeof N=="object"&&N.length!=null)return Cc(N,E);throw new c("wrong params")}},this.tohex=function(){this.params;var N=this.getBinValue();return new g({bin:N}).tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.tsp.PKIFailureInfo,v.asn1.ASN1Object),v.asn1.tsp.AbstractTSAAdapter=function(s){this.getTSTHex=function(c,l){throw"not implemented yet"}},v.asn1.tsp.SimpleTSAAdapter=function(s){var c=v,l=c.asn1,d=l.tsp,g=c.crypto.Util.hashHex;d.SimpleTSAAdapter.superclass.constructor.call(this),this.params=null,this.serial=0,this.getTSTHex=function(m,P){var E=g(m,P);this.params.econtent.content.messageImprint={alg:P,hash:E},this.params.econtent.content.serial={int:this.serial++};var N=Math.floor(Math.random()*1e9);this.params.econtent.content.nonce={int:N};var A=new d.TimeStampToken(this.params);return A.getContentInfoEncodedHex()},s!==void 0&&(this.params=s)},ve(v.asn1.tsp.SimpleTSAAdapter,v.asn1.tsp.AbstractTSAAdapter),v.asn1.tsp.FixedTSAAdapter=function(s){var c=v,l=c.asn1,d=l.tsp,g=c.crypto.Util.hashHex;d.FixedTSAAdapter.superclass.constructor.call(this),this.params=null,this.getTSTHex=function(m,P){var E=g(m,P);this.params.econtent.content.messageImprint={alg:P,hash:E};var N=new d.TimeStampToken(this.params);return N.getContentInfoEncodedHex()},s!==void 0&&(this.params=s)},ve(v.asn1.tsp.FixedTSAAdapter,v.asn1.tsp.AbstractTSAAdapter),v.asn1.tsp.TSPUtil=new function(){},v.asn1.tsp.TSPUtil.newTimeStampToken=function(s){return new v.asn1.tsp.TimeStampToken(s)},v.asn1.tsp.TSPUtil.parseTimeStampReq=function(s){var c=new v.asn1.tsp.TSPParser;return c.getTimeStampReq(s)},v.asn1.tsp.TSPUtil.parseMessageImprint=function(s){var c=new v.asn1.tsp.TSPParser;return c.getMessageImprint(s)},v.asn1.tsp.TSPParser=function(){var s=He,c=new s,l=ke,d=l.getV,g=l.getTLV,m=l.getIdxbyList;l.getTLVbyListEx;var P=l.getChildIdx,E=["granted","grantedWithMods","rejection","waiting","revocationWarning","revocationNotification"],N={0:"badAlg",2:"badRequest",5:"badDataFormat",14:"timeNotAvailable",15:"unacceptedPolicy",16:"unacceptedExtension",17:"addInfoNotAvailable",25:"systemFailure"};this.getResponse=function(A){var j=P(A,0);if(j.length==1)return this.getPKIStatusInfo(g(A,j[0]));if(j.length>1){var O=this.getPKIStatusInfo(g(A,j[0])),C=g(A,j[1]),I=this.getToken(C);return I.statusinfo=O,I}},this.getToken=function(A){var j=new v.asn1.cms.CMSParser,O=j.getCMSSignedData(A);return this.setTSTInfo(O),O},this.setTSTInfo=function(A){var j=A.econtent;if(j.type=="tstinfo"){var O=j.content.hex,C=this.getTSTInfo(O);j.content=C}},this.getTSTInfo=function(A){var j={},O=P(A,0),C=d(A,O[1]);j.policy=wc(C);var I=g(A,O[2]);j.messageImprint=this.getMessageImprint(I);var T=d(A,O[3]);j.serial={hex:T};var D=d(A,O[4]);j.genTime={str:ft(D)};var M=0;if(O.length>5&&A.substr(O[5],2)=="30"){var H=g(A,O[5]);j.accuracy=this.getAccuracy(H),M++}if(O.length>5+M&&A.substr(O[5+M],2)=="01"){var te=d(A,O[5+M]);te=="ff"&&(j.ordering=!0),M++}if(O.length>5+M&&A.substr(O[5+M],2)=="02"){var ie=d(A,O[5+M]);j.nonce={hex:ie},M++}if(O.length>5+M&&A.substr(O[5+M],2)=="a0"){var re=g(A,O[5+M]);re="30"+re.substr(2),pGeneralNames=c.getGeneralNames(re);var ae=pGeneralNames[0].dn;j.tsa=ae,M++}if(O.length>5+M&&A.substr(O[5+M],2)=="a1"){var V=g(A,O[5+M]);V="30"+V.substr(2);var $=c.getExtParamArray(V);j.ext=$,M++}return j},this.getAccuracy=function(A){for(var j={},O=P(A,0),C=0;C<O.length;C++){var I=A.substr(O[C],2),T=d(A,O[C]),D=parseInt(T,16);I=="02"?j.seconds=D:I=="80"?j.millis=D:I=="81"&&(j.micros=D)}return j},this.getMessageImprint=function(A){if(A.substr(0,2)!="30")throw new Error("head of messageImprint hex shall be x30");var j={};P(A,0);var O=m(A,0,[0,0]),C=d(A,O),I=l.hextooidstr(C),T=v.asn1.x509.OID.oid2name(I);if(T=="")throw new Error("hashAlg name undefined: "+I);var D=T,M=m(A,0,[1]);return j.alg=D,j.hash=d(A,M),j},this.getPKIStatusInfo=function(A){var j={},O=P(A,0),C=0;try{var I=d(A,O[0]),T=parseInt(I,16);j.status=E[T]}catch{}if(O.length>1&&A.substr(O[1],2)=="30"){var D=g(A,O[1]);j.statusstr=this.getPKIFreeText(D),C++}if(O.length>C&&A.substr(O[1+C],2)=="03"){var M=g(A,O[1+C]);j.failinfo=this.getPKIFailureInfo(M)}return j},this.getPKIFreeText=function(A){for(var j=[],O=P(A,0),C=0;C<O.length;C++)j.push(l.getString(A,O[C]));return j},this.getPKIFailureInfo=function(A){var j=l.getInt(A,0);return N[j]!=null?N[j]:j},this.getTimeStampReq=function(A){var j={};j.certreq=!1;var O=P(A,0);if(O.length<2)throw new Error("TimeStampReq must have at least 2 items");var C=g(A,O[1]);j.messageImprint=v.asn1.tsp.TSPUtil.parseMessageImprint(C);for(var I=2;I<O.length;I++){var T=O[I],D=A.substr(T,2);if(D=="06"){var M=d(A,T);j.policy=l.hextooidstr(M)}D=="02"&&(j.nonce=d(A,T)),D=="01"&&(j.certreq=!0)}return j}},(typeof v>"u"||!v)&&(v={}),(typeof v.asn1>"u"||!v.asn1)&&(v.asn1={}),(typeof v.asn1.cades>"u"||!v.asn1.cades)&&(v.asn1.cades={}),v.asn1.cades.SignaturePolicyIdentifier=function(s){var c=v,l=c.asn1,d=l.cades,g=d.SignaturePolicyId;d.SignaturePolicyIdentifier.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.15",this.params=null,this.getValueArray=function(){return[new g(this.params)]},this.setByParam=function(m){this.params=m},s!=null&&this.setByParam(s)},ve(v.asn1.cades.SignaturePolicyIdentifier,v.asn1.cms.Attribute),v.asn1.cades.SignaturePolicyId=function(s){var c=v,l=c.asn1,d=l.DERSequence,g=l.DERObjectIdentifier,m=l.x509;m.AlgorithmIdentifier;var P=l.cades,E=P.SignaturePolicyId,N=P.OtherHashAlgAndValue;E.superclass.constructor.call(this),this.params=null,this.tohex=function(){var A=this.params,j=[];j.push(new g(A.oid)),j.push(new N(A));var O=new d({array:j});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(A){this.params=A},s!=null&&this.setByParam(s)},ve(v.asn1.cades.SignaturePolicyId,v.asn1.ASN1Object),v.asn1.cades.OtherHashAlgAndValue=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSequence,m=d.DEROctetString,P=d.x509,E=P.AlgorithmIdentifier,N=d.cades,A=N.OtherHashAlgAndValue;A.superclass.constructor.call(this),this.params=null,this.tohex=function(){var j=this.params;if(j.alg==null)throw new c("property 'alg' not specified");if(j.hash==null&&j.cert==null)throw new c("property 'hash' nor 'cert' not specified");var O=null;if(j.hash!=null)O=j.hash;else if(j.cert!=null){if(typeof j.cert!="string")throw new c("cert not string");var C=j.cert;j.cert.indexOf("-----BEGIN")!=-1&&(C=Bt(j.cert)),O=v.crypto.Util.hashHex(C,j.alg)}var I=[];I.push(new E({name:j.alg})),I.push(new m({hex:O}));var T=new g({array:I});return T.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cades.OtherHashAlgAndValue,v.asn1.ASN1Object),v.asn1.cades.OtherHashValue=function(s){v.asn1.cades.OtherHashValue.superclass.constructor.call(this);var c=Error,l=v;l.lang.String.isHex;var d=l.asn1,g=d.DEROctetString;l.crypto.Util.hashHex,this.params=null,this.tohex=function(){var m=this.params;if(m.hash==null&&m.cert==null)throw new c("hash or cert not specified");var P=null;if(m.hash!=null)P=m.hash;else if(m.cert!=null){if(typeof m.cert!="string")throw new c("cert not string");var E=m.cert;m.cert.indexOf("-----BEGIN")!=-1&&(E=Bt(m.cert)),P=v.crypto.Util.hashHex(E,"sha1")}return new g({hex:P}).tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cades.OtherHashValue,v.asn1.ASN1Object),v.asn1.cades.SignatureTimeStamp=function(s){var c=Error,l=v,d=l.lang.String.isHex,g=l.asn1,m=g.ASN1Object;g.x509;var P=g.cades;P.SignatureTimeStamp.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.14",this.params=null,this.getValueArray=function(){var E=this.params;if(E.tst!=null)if(d(E.tst)){var N=new m;return N.hTLV=E.tst,[N]}else{if(E.tst instanceof m)return[E.tst];throw new c("params.tst has wrong value")}else if(E.res!=null){var A=E.res;if(A instanceof m&&(A=A.tohex()),typeof A!="string"||!d(A))throw new c("params.res has wrong value");ke.getTLVbyList(A,0,[1]);var N=new m;return N.hTLV=E.tst,[N]}},s!=null&&this.setByParam(s)},ve(v.asn1.cades.SignatureTimeStamp,v.asn1.cms.Attribute),v.asn1.cades.CompleteCertificateRefs=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSequence,m=d.cades,P=m.OtherCertID,E=l.lang.String.isHex;m.CompleteCertificateRefs.superclass.constructor.call(this),this.typeOid="1.2.840.113549.1.9.16.2.21",this.params=null,this.getValueArray=function(){for(var N=this.params,A=[],j=0;j<N.array.length;j++){var O=N.array[j];if(typeof O=="string")if(O.indexOf("-----BEGIN")!=-1)O={cert:O};else if(E(O))O={hash:O};else throw new c("unsupported value: "+O);N.alg!=null&&O.alg==null&&(O.alg=N.alg),N.hasis!=null&&O.hasis==null&&(O.hasis=N.hasis);var C=new P(O);A.push(C)}var I=new g({array:A});return[I]},s!=null&&this.setByParam(s)},ve(v.asn1.cades.CompleteCertificateRefs,v.asn1.cms.Attribute),v.asn1.cades.OtherCertID=function(s){var c=v,l=c.asn1,d=l.DERSequence,g=l.cms,m=g.IssuerSerial,P=l.cades,E=P.OtherHashValue,N=P.OtherHashAlgAndValue;P.OtherCertID.superclass.constructor.call(this),this.params=s,this.tohex=function(){var A=this.params;typeof A=="string"&&(A.indexOf("-----BEGIN")!=-1?A={cert:A}:_isHex(A)&&(A={hash:A}));var j=[],O=null;if(A.alg!=null?O=new N(A):O=new E(A),j.push(O),A.cert!=null&&A.hasis==!0||A.issuer!=null&&A.serial!=null){var C=new m(A);j.push(C)}var I=new d({array:j});return I.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cades.OtherCertID,v.asn1.ASN1Object),v.asn1.cades.OtherHash=function(s){var c=v,l=c.asn1;l.cms;var d=l.cades,g=d.OtherHashAlgAndValue,m=d.OtherHashValue;c.crypto.Util.hashHex;var P=c.lang.String.isHex;d.OtherHash.superclass.constructor.call(this),this.params=null,this.tohex=function(){var E=this.params;typeof E=="string"&&(E.indexOf("-----BEGIN")!=-1?E={cert:E}:P(E)&&(E={hash:E}));var N=null;return E.alg!=null?N=new g(E):N=new m(E),N.tohex()},this.getEncodedHex=function(){return this.tohex()},s!=null&&this.setByParam(s)},ve(v.asn1.cades.OtherHash,v.asn1.ASN1Object),v.asn1.cades.CAdESUtil=new function(){},v.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(s){var c=new v.asn1.cms.CMSParser,l=c.getCMSSignedData(s);return l},v.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(s,c,l){var d=ke,g=d.getChildIdx,m=d.getTLV,P=d.getV,E=v,N=E.asn1,A=N.ASN1Object,j=N.cms,O=j.AttributeList,C=j.SignerInfo,I={},T=g(s,c);if(T.length!=6)throw"not supported items for SignerInfo (!=6)";var D=T.shift();I.version=m(s,D);var M=T.shift();I.si=m(s,M);var H=T.shift();I.digalg=m(s,H);var te=T.shift();I.sattrs=m(s,te);var ie=T.shift();I.sigalg=m(s,ie);var re=T.shift();I.sig=m(s,re),I.sigval=P(s,re);var ae=null;return I.obj=new C,ae=new A,ae.hTLV=I.version,I.obj.dCMSVersion=ae,ae=new A,ae.hTLV=I.si,I.obj.dSignerIdentifier=ae,ae=new A,ae.hTLV=I.digalg,I.obj.dDigestAlgorithm=ae,ae=new A,ae.hTLV=I.sattrs,I.obj.dSignedAttrs=ae,ae=new A,ae.hTLV=I.sigalg,I.obj.dSigAlg=ae,ae=new A,ae.hTLV=I.sig,I.obj.dSig=ae,I.obj.dUnsignedAttrs=new O,I},(typeof v.asn1.csr>"u"||!v.asn1.csr)&&(v.asn1.csr={}),v.asn1.csr.CertificationRequest=function(s){var c=v,l=c.asn1,d=l.DERBitString,g=l.DERSequence,m=l.csr;l.x509;var P=m.CertificationRequestInfo;m.CertificationRequest.superclass.constructor.call(this),this.setByParam=function(E){this.params=E},this.sign=function(){var E=new P(this.params).tohex(),N=new v.crypto.Signature({alg:this.params.sigalg});N.init(this.params.sbjprvkey),N.updateHex(E);var A=N.sign();this.params.sighex=A},this.getPEM=function(){return mn(this.tohex(),"CERTIFICATE REQUEST")},this.tohex=function(){var E=this.params,N=new v.asn1.csr.CertificationRequestInfo(this.params),A=new v.asn1.x509.AlgorithmIdentifier({name:E.sigalg});if(E.sighex==null&&E.sbjprvkey!=null&&this.sign(),E.sighex==null)throw new Error("sighex or sbjprvkey parameter not defined");var j=new d({hex:"00"+E.sighex}),O=new g({array:[N,A,j]});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.csr.CertificationRequest,v.asn1.ASN1Object),v.asn1.csr.CertificationRequestInfo=function(s){var c=v,l=c.asn1;l.DERBitString;var d=l.DERSequence,g=l.DERInteger,m=l.DERUTF8String,P=l.DERTaggedObject,E=l.ASN1Util.newObject,N=l.csr,A=l.x509,j=A.X500Name,O=A.Extensions,C=A.SubjectPublicKeyInfo;N.AttributeList,N.CertificationRequestInfo.superclass.constructor.call(this),this.params=null,this.setByParam=function(T){T!=null&&(this.params=T)},this.tohex=function(){var T=this.params,D=[];if(D.push(new g({int:0})),D.push(new j(T.subject)),D.push(new C(nt.getKey(T.sbjpubkey))),T.attrs!=null){var M=I(T.attrs),H=E({tag:{tage:"a0",obj:M}});D.push(H)}else if(T.extreq!=null){var te=new O(T.extreq),H=E({tag:{tage:"a0",obj:{seq:[{oid:"1.2.840.113549.1.9.14"},{set:[te]}]}}});D.push(H)}else D.push(new P({tag:"a0",explicit:!1,obj:new m({str:""})}));var ie=new d({array:D});return ie.tohex()},this.getEncodedHex=function(){return this.tohex()};function I(T){for(var D=Error,M=v.asn1.x509.Extensions,H=[],te=0;te<T.length;te++){var ie=T[te],re=ie.attr;if(re=="extensionRequest"){var ae=new M(ie.ext),V={seq:[{oid:"1.2.840.113549.1.9.14"},{set:[ae]}]};H.push(V)}else if(re=="unstructuredName"){var V={seq:[{oid:"1.2.840.113549.1.9.2"},{set:ie.names}]};H.push(V)}else if(re=="challengePassword"){var V={seq:[{oid:"1.2.840.113549.1.9.7"},{set:[{utf8str:ie.password}]}]};H.push(V)}else throw new D("unknown CSR attribute")}return{set:H}}s!=null&&this.setByParam(s)},ve(v.asn1.csr.CertificationRequestInfo,v.asn1.ASN1Object),v.asn1.csr.AttributeList=function(s){},ve(v.asn1.csr.AttributeList,v.asn1.ASN1Object),v.asn1.csr.CSRUtil=new function(){},v.asn1.csr.CSRUtil.newCSRPEM=function(s){var c=v.asn1.csr,l=new c.CertificationRequest(s),d=l.getPEM();return d},v.asn1.csr.CSRUtil.getParam=function(s,c){var l=ke,d=l.getV,g=l.getIdxbyList,m=l.getTLVbyList,P=l.getTLVbyListEx,E=l.getVbyListEx,N=function(te){var ie=g(te,0,[0,3,0,0],"06");return d(te,ie)!="2a864886f70d01090e"?null:m(te,0,[0,3,0,1,0],"30")},A={};if(s.indexOf("-----BEGIN CERTIFICATE REQUEST")==-1)throw new Error("argument is not PEM file");var j=Bt(s,"CERTIFICATE REQUEST");c&&(A.tbs=m(j,0,[0]));try{var O=P(j,0,[0,1]);if(O=="3000")A.subject={};else{var D=new He;A.subject=D.getX500Name(O)}}catch{}var C=P(j,0,[0,2]),I=nt.getKey(C,null,"pkcs8pub");A.sbjpubkey=nt.getPEM(I,"PKCS8PUB");var T=N(j),D=new He;T!=null&&(A.extreq=D.getExtParamArray(T));try{var M=P(j,0,[1],"30"),D=new He;A.sigalg=D.getAlgorithmIdentifierName(M)}catch{}try{var H=E(j,0,[2]);A.sighex=H}catch{}return A},v.asn1.csr.CSRUtil.verifySignature=function(s){try{var c=null;if(typeof s=="string"&&s.indexOf("-----BEGIN CERTIFICATE REQUEST")!=-1?c=v.asn1.csr.CSRUtil.getParam(s,!0):typeof s=="object"&&s.sbjpubkey!=null&&s.sigalg!=null&&s.sighex!=null&&s.tbs!=null&&(c=s),c==null)return!1;var l=new v.crypto.Signature({alg:c.sigalg});return l.init(c.sbjpubkey),l.updateHex(c.tbs),l.verify(c.sighex)}catch(d){return alert(d),!1}},(typeof v>"u"||!v)&&(v={}),(typeof v.asn1>"u"||!v.asn1)&&(v.asn1={}),(typeof v.asn1.ocsp>"u"||!v.asn1.ocsp)&&(v.asn1.ocsp={}),v.asn1.ocsp.DEFAULT_HASH="sha1",v.asn1.ocsp.OCSPResponse=function(s){v.asn1.ocsp.OCSPResponse.superclass.constructor.call(this),v.asn1.DEREnumerated;var c=v.asn1.ASN1Util.newObject,l=v.asn1.ocsp.ResponseBytes,d=["successful","malformedRequest","internalError","tryLater","_not_used_","sigRequired","unauthorized"];this.params=null,this._getStatusCode=function(){var g=this.params.resstatus;return typeof g=="number"?g:typeof g!="string"?-1:d.indexOf(g)},this.setByParam=function(g){this.params=g},this.tohex=function(){var g=this.params,m=this._getStatusCode();if(m==-1)throw new Error("responseStatus not supported: "+g.resstatus);if(m!=0)return c({seq:[{enum:{int:m}}]}).tohex();var P=new l(g);return c({seq:[{enum:{int:0}},{tag:{tag:"a0",explicit:!0,obj:P}}]}).tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.OCSPResponse,v.asn1.ASN1Object),v.asn1.ocsp.ResponseBytes=function(s){v.asn1.ocsp.ResponseBytes.superclass.constructor.call(this);var c=v.asn1,l=c.DERSequence,d=c.DERObjectIdentifier,g=c.DEROctetString,m=c.ocsp.BasicOCSPResponse;this.params=null,this.setByParam=function(P){this.params=P},this.tohex=function(){var P=this.params;if(P.restype!="ocspBasic")throw new Error("not supported responseType: "+P.restype);var E=new m(P),N=[];N.push(new d({name:"ocspBasic"})),N.push(new g({hex:E.tohex()}));var A=new l({array:N});return A.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.ResponseBytes,v.asn1.ASN1Object),v.asn1.ocsp.BasicOCSPResponse=function(s){v.asn1.ocsp.BasicOCSPResponse.superclass.constructor.call(this);var c=Error,l=v.asn1,d=l.ASN1Object,g=l.DERSequence;l.DERGeneralizedTime;var m=l.DERTaggedObject,P=l.DERBitString;l.x509.Extensions;var E=l.x509.AlgorithmIdentifier,N=l.ocsp;N.ResponderID,_SingleResponseList=N.SingleResponseList,_ResponseData=N.ResponseData,this.params=null,this.setByParam=function(A){this.params=A},this.sign=function(){var A=this.params,j=A.tbsresp.tohex(),O=new v.crypto.Signature({alg:A.sigalg});O.init(A.reskey),O.updateHex(j),A.sighex=O.sign()},this.tohex=function(){var A=this.params;A.tbsresp==null&&(A.tbsresp=new _ResponseData(A)),A.sighex==null&&A.reskey!=null&&this.sign();var j=[];if(j.push(A.tbsresp),j.push(new E({name:A.sigalg})),j.push(new P({hex:"00"+A.sighex})),A.certs!=null&&A.certs.length!=null){for(var O=[],C=0;C<A.certs.length;C++){var I=A.certs[C],T=null;if(ke.isASN1HEX(I))T=I;else if(I.match(/-----BEGIN/))T=Bt(I);else throw new c("certs["+C+"] not hex or PEM");O.push(new d({tlv:T}))}var D=new g({array:O});j.push(new m({tag:"a0",explicit:!0,obj:D}))}var M=new g({array:j});return M.tohex()},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.BasicOCSPResponse,v.asn1.ASN1Object),v.asn1.ocsp.ResponseData=function(s){v.asn1.ocsp.ResponseData.superclass.constructor.call(this);var c=v.asn1,l=c.DERSequence,d=c.DERGeneralizedTime,g=c.DERTaggedObject,m=c.x509.Extensions,P=c.ocsp,E=P.ResponderID;_SingleResponseList=P.SingleResponseList,this.params=null,this.tohex=function(){var N=this.params;N.respid!=null,N.prodat!=null,N.array!=null;var A=[];if(A.push(new E(N.respid)),A.push(new d(N.prodat)),A.push(new _SingleResponseList(N.array)),N.ext!=null){var j=new m(N.ext);A.push(new g({tag:"a1",explicit:!0,obj:j}))}var O=new l({array:A});return O.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(N){this.params=N},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.ResponseData,v.asn1.ASN1Object),v.asn1.ocsp.ResponderID=function(s){v.asn1.ocsp.ResponderID.superclass.constructor.call(this);var c=v,l=c.asn1,d=l.ASN1Util.newObject,g=l.x509.X500Name,m=c.lang.String.isHex,P=Error;this.params=null,this.tohex=function(){var E=this.params;if(E.key!=null){var N=null;if(typeof E.key=="string"){if(m(E.key)&&(N=E.key),E.key.match(/-----BEGIN CERTIFICATE/)){var A=new He(E.key),j=A.getExtSubjectKeyIdentifier();j!=null&&(N=j.kid.hex)}}else if(E.key instanceof He){var j=E.key.getExtSubjectKeyIdentifier();j!=null&&(N=j.kid.hex)}if(N==null)throw new P("wrong key member value");var O=d({tag:{tag:"a2",explicit:!0,obj:{octstr:{hex:N}}}});return O.tohex()}else if(E.name!=null){var C=null;if(typeof E.name=="string"&&E.name.match(/-----BEGIN CERTIFICATE/)){var A=new He(E.name);C=A.getSubject()}else E.name instanceof He?C=E.name.getSubject():typeof E.name=="object"&&(E.name.array!=null||E.name.str!=null)&&(C=E.name);if(C==null)throw new P("wrong name member value");var O=d({tag:{tag:"a1",explicit:!0,obj:new g(C)}});return O.tohex()}throw new P("key or name not specified")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(E){this.params=E},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.ResponderID,v.asn1.ASN1Object),v.asn1.ocsp.SingleResponseList=function(s){v.asn1.ocsp.SingleResponseList.superclass.constructor.call(this);var c=v.asn1,l=c.DERSequence,d=c.ocsp.SingleResponse;this.params=null,this.tohex=function(){var g=this.params;if(typeof g!="object"||g.length==null)throw new Error("params not specified properly");for(var m=[],P=0;P<g.length;P++)m.push(new d(g[P]));var E=new l({array:m});return E.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(g){this.params=g},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.SingleResponseList,v.asn1.ASN1Object),v.asn1.ocsp.SingleResponse=function(s){var c=Error,l=v,d=l.asn1,g=d.DERSequence,m=d.DERGeneralizedTime,P=d.DERTaggedObject,E=d.ocsp,N=E.CertID,A=E.CertStatus,j=d.x509,O=j.Extensions;E.SingleResponse.superclass.constructor.call(this),this.params=null,this.tohex=function(){var C=this.params,I=[];if(C.certid==null)throw new c("certid unspecified");if(C.status==null)throw new c("status unspecified");if(C.thisupdate==null)throw new c("thisupdate unspecified");if(I.push(new N(C.certid)),I.push(new A(C.status)),I.push(new m(C.thisupdate)),C.nextupdate!=null){var T=new m(C.nextupdate);I.push(new P({tag:"a0",explicit:!0,obj:T}))}if(C.ext!=null){var D=new O(C.ext);I.push(new P({tag:"a1",explicit:!0,obj:D}))}var M=new g({array:I});return M.tohex()},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(C){this.params=C},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.SingleResponse,v.asn1.ASN1Object),v.asn1.ocsp.CertID=function(s){var c=v,l=c.asn1,d=l.DEROctetString,g=l.DERInteger,m=l.DERSequence,P=l.x509,E=P.AlgorithmIdentifier,N=l.ocsp;N.DEFAULT_HASH;var A=c.crypto,j=A.Util.hashHex,O=He,C=ke,I=C.getVbyList;N.CertID.superclass.constructor.call(this),this.DEFAULT_HASH="sha1",this.params=null,this.setByValue=function(T,D,M,H){H==null&&(H=this.DEFAULT_HASH),this.params={alg:H,issname:T,isskey:D,sbjsn:M}},this.setByCert=function(T,D,M){M==null&&(M=this.DEFAULT_HASH),this.params={alg:M,issuerCert:T,subjectCert:D}},this.getParamByCerts=function(T,D,M){M==null&&(M=this.DEFAULT_HASH);var H=new O(T),te=new O(D),ie=j(H.getSubjectHex(),M),re=H.getPublicKeyHex(),ae=j(I(re,0,[1],"03",!0),M),V=te.getSerialNumberHex(),$={alg:M,issname:ie,isskey:ae,sbjsn:V};return $},this.tohex=function(){if(typeof this.params!="object")throw new Error("params not set");var T=this.params,D,M,H,te;if(T.alg==null?te=this.DEFAULT_HASH:te=T.alg,T.issuerCert!=null&&T.subjectCert!=null){var ie=this.getParamByCerts(T.issuerCert,T.subjectCert,te);D=ie.issname,M=ie.isskey,H=ie.sbjsn}else if(T.issname!=null&&T.isskey!=null&&T.sbjsn!=null)D=T.issname,M=T.isskey,H=T.sbjsn;else throw new Error("required param members not defined");var re=new E({name:te}),ae=new d({hex:D}),V=new d({hex:M}),$=new g({hex:H}),Z=new m({array:[re,ae,V,$]});return this.hTLV=Z.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.CertID,v.asn1.ASN1Object),v.asn1.ocsp.CertStatus=function(s){v.asn1.ocsp.CertStatus.superclass.constructor.call(this),this.params=null,this.tohex=function(){var c=this.params;if(c.status=="good")return"8000";if(c.status=="unknown")return"8200";if(c.status=="revoked"){var l=[{gentime:{str:c.time}}];c.reason!=null&&l.push({tag:{tag:"a0",explicit:!0,obj:{enum:{int:c.reason}}}});var d={tag:"a1",explicit:!1,obj:{seq:l}};return v.asn1.ASN1Util.newObject({tag:d}).tohex()}throw new Error("bad status")},this.getEncodedHex=function(){return this.tohex()},this.setByParam=function(c){this.params=c},s!==void 0&&this.setByParam(s)},ve(v.asn1.ocsp.CertStatus,v.asn1.ASN1Object),v.asn1.ocsp.Request=function(s){var c=v,l=c.asn1,d=l.DERSequence,g=l.ocsp;if(g.Request.superclass.constructor.call(this),this.dReqCert=null,this.dExt=null,this.tohex=function(){var P=[];if(this.dReqCert===null)throw"reqCert not set";P.push(this.dReqCert);var E=new d({array:P});return this.hTLV=E.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},typeof s<"u"){var m=new g.CertID(s);this.dReqCert=m}},ve(v.asn1.ocsp.Request,v.asn1.ASN1Object),v.asn1.ocsp.TBSRequest=function(s){var c=v,l=c.asn1,d=l.DERSequence,g=l.ocsp;g.TBSRequest.superclass.constructor.call(this),this.version=0,this.dRequestorName=null,this.dRequestList=[],this.dRequestExt=null,this.setRequestListByParam=function(m){for(var P=[],E=0;E<m.length;E++){var N=new g.Request(m[0]);P.push(N)}this.dRequestList=P},this.tohex=function(){var m=[];if(this.version!==0)throw"not supported version: "+this.version;if(this.dRequestorName!==null)throw"requestorName not supported";var P=new d({array:this.dRequestList});if(m.push(P),this.dRequestExt!==null)throw"requestExtensions not supported";var E=new d({array:m});return this.hTLV=E.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&s.reqList!==void 0&&this.setRequestListByParam(s.reqList)},ve(v.asn1.ocsp.TBSRequest,v.asn1.ASN1Object),v.asn1.ocsp.OCSPRequest=function(s){var c=v,l=c.asn1,d=l.DERSequence,g=l.ocsp;if(g.OCSPRequest.superclass.constructor.call(this),this.dTbsRequest=null,this.dOptionalSignature=null,this.tohex=function(){var P=[];if(this.dTbsRequest!==null)P.push(this.dTbsRequest);else throw"tbsRequest not set";if(this.dOptionalSignature!==null)throw"optionalSignature not supported";var E=new d({array:P});return this.hTLV=E.tohex(),this.hTLV},this.getEncodedHex=function(){return this.tohex()},s!==void 0&&s.reqList!==void 0){var m=new g.TBSRequest(s);this.dTbsRequest=m}},ve(v.asn1.ocsp.OCSPRequest,v.asn1.ASN1Object),v.asn1.ocsp.OCSPUtil={},v.asn1.ocsp.OCSPUtil.getRequestHex=function(s,c,l){var d=v,g=d.asn1,m=g.ocsp;l===void 0&&(l=m.DEFAULT_HASH);var P={alg:l,issuerCert:s,subjectCert:c},E=new m.OCSPRequest({reqList:[P]});return E.tohex()},v.asn1.ocsp.OCSPUtil.getOCSPResponseInfo=function(s){var c=ke,l=c.getVbyList,d=c.getVbyListEx,g=c.getIdxbyList;c.getIdxbyListEx;var m=c.getV,P={};try{var E=d(s,0,[0],"0a");P.responseStatus=parseInt(E,16)}catch{}if(P.responseStatus!==0)return P;try{var N=g(s,0,[1,0,1,0,0,2,0,1]);s.substr(N,2)==="80"?P.certStatus="good":s.substr(N,2)==="a1"?(P.certStatus="revoked",P.revocationTime=ft(l(s,N,[0]))):s.substr(N,2)==="82"&&(P.certStatus="unknown")}catch{}try{var A=g(s,0,[1,0,1,0,0,2,0,2]);P.thisUpdate=ft(m(s,A))}catch{}try{var j=g(s,0,[1,0,1,0,0,2,0,3]);s.substr(j,2)==="a0"&&(P.nextUpdate=ft(l(s,j,[0])))}catch{}return P},v.asn1.ocsp.OCSPParser=function(){var s=Error,c=He,l=new c,d=ke,g=d.getV,m=d.getTLV,P=d.getIdxbyList,E=d.getVbyList,N=d.getTLVbyList,A=d.getVbyListEx,j=d.getTLVbyListEx,O=d.getChildIdx;this.getOCSPRequest=function(C){var I=O(C,0);if(I.length!=1&&I.length!=2)throw new s("wrong number elements: "+I.length);var T=this.getTBSRequest(m(C,I[0]));return T},this.getTBSRequest=function(C){var I={},T=j(C,0,[0],"30");I.array=this.getRequestList(T);var D=j(C,0,["[2]",0],"30");return D!=null&&(I.ext=l.getExtParamArray(D)),I},this.getRequestList=function(C){for(var I=[],T=O(C,0),D=0;D<T.length;D++){var C=m(C,T[D]);I.push(this.getRequest(C))}return I},this.getRequest=function(C){var I=O(C,0);if(I.length!=1&&I.length!=2)throw new s("wrong number elements: "+I.length);var T=this.getCertID(m(C,I[0]));if(I.length==2){var D=P(C,0,[1,0]);T.ext=l.getExtParamArray(m(C,D))}return T},this.getCertID=function(C){var I=O(C,0);if(I.length!=4)throw new s("wrong number elements: "+I.length);var T=new c,D={};return D.alg=T.getAlgorithmIdentifierName(m(C,I[0])),D.issname=g(C,I[1]),D.isskey=g(C,I[2]),D.sbjsn=g(C,I[3]),D},this.getOCSPResponse=function(C){var I=O(C,0),T,D=g(C,I[0]),M=parseInt(D);if(I.length==1)return{resstatus:M};var H=N(C,0,[1,0]);return T=this.getResponseBytes(H),T.resstatus=M,T},this.getResponseBytes=function(C){var I=O(C,0),T,D=N(C,0,[1,0]);T=this.getBasicOCSPResponse(D);var M=g(C,I[0]);return T.restype=v.asn1.x509.OID.oid2name(wc(M)),T},this.getBasicOCSPResponse=function(C){var I=O(C,0),T;T=this.getResponseData(m(C,I[0]));var D=new He;T.alg=D.getAlgorithmIdentifierName(m(C,I[1]));var M=g(C,I[2]);T.sighex=M.substr(2);var H=A(C,0,["[0]"]);if(H!=null){for(var te=O(H,0),ie=[],re=0;re<te.length;re++){var ae=m(H,te[re]);ie.push(ae)}T.certs=ie}return T},this.getResponseData=function(C){var I=O(C,0),T=I.length,D={},M=0;C.substr(I[0],2)=="a0"&&M++,D.respid=this.getResponderID(m(C,I[M++]));var H=g(C,I[M++]);if(D.prodat=ft(H),D.array=this.getSingleResponseList(m(C,I[M++])),C.substr(I[T-1],2)=="a1"){var te=N(C,I[T-1],[0]),ie=new He;D.ext=ie.getExtParamArray(te)}return D},this.getResponderID=function(C){var I={};if(C.substr(0,2)=="a2"){var T=E(C,0,[0]);I.key=T}if(C.substr(0,2)=="a1"){var D=N(C,0,[0]),M=new He;I.name=M.getX500Name(D)}return I},this.getSingleResponseList=function(C){for(var I=O(C,0),T=[],D=0;D<I.length;D++){var M=this.getSingleResponse(m(C,I[D]));T.push(M)}return T},this.getSingleResponse=function(C){var I=O(C,0),T={},D=this.getCertID(m(C,I[0]));T.certid=D;var M=this.getCertStatus(m(C,I[1]));if(T.status=M,C.substr(I[2],2)=="18"){var H=g(C,I[2]);T.thisupdate=ft(H)}for(var te=3;te<I.length;te++){if(C.substr(I[te],2)=="a0"){var ie=E(C,I[te],[0],"18");T.nextupdate=ft(ie)}if(C.substr(I[te],2)=="a1"){var re=new He,ae=N(C,0,[te,0]);T.ext=re.getExtParamArray(ae)}}return T},this.getCertStatus=function(C){var I={};if(C=="8000")return{status:"good"};if(C=="8200")return{status:"unknown"};if(C.substr(0,2)=="a1"){I.status="revoked";var T=E(C,0,[0]),D=ft(T);I.time=D}return I}};var v;(typeof v>"u"||!v)&&(v={}),(typeof v.lang>"u"||!v.lang)&&(v.lang={}),v.lang.String=function(){};function Pf(s){for(var c=new Array,l=0;l<s.length;l++)c[l]=s.charCodeAt(l);return c}function kf(s){for(var c="",l=0;l<s.length;l++)c=c+String.fromCharCode(s[l]);return c}function mc(s){for(var c="",l=0;l<s.length;l++){var d=s[l].toString(16);d.length==1&&(d="0"+d),c=c+d}return c}function Bn(s){return mc(Pf(s))}function Fb(s){return p(Bn(s))}function Db(s){return Hs(p(Bn(s)))}function Nb(s){return kf(y(La(s)))}function Hs(s){return s=s.replace(/\=/g,""),s=s.replace(/\+/g,"-"),s=s.replace(/\//g,"_"),s}function La(s){return s.length%4==2?s=s+"==":s.length%4==3&&(s=s+"="),s=s.replace(/-/g,"+"),s=s.replace(/_/g,"/"),s}function Qt(s){return s.length%2==1&&(s="0"+s),Hs(p(s))}function xt(s){return h(La(s))}var ja,Er;typeof Buffer=="function"?(ja=function(s){return Hs(Buffer.from(s,"utf8").toString("base64"))},Er=function(s){return Buffer.from(La(s),"base64").toString("utf8")}):(ja=function(s){return Qt(yc(Sc(s)))},Er=function(s){return decodeURIComponent(_c(xt(s)))});function Ob(s){return p(yc(Sc(s)))}function Mb(s){return decodeURIComponent(_c(h(s)))}function gc(s){return yc(Sc(s)).toLowerCase()}function ft(s){try{return decodeURIComponent(_c(s))}catch{return null}}function Lb(s){return ft(jb(s))}function jb(s){for(var c=s.match(/.{1,2}/g),l=[],d=0;d<c.length;d++){var g=parseInt(c[d],16);161<=g&&g<=191?(l.push("c2"),l.push(c[d])):192<=g&&g<=255?(l.push("c3"),l.push((g-64).toString(16))):l.push(c[d])}return l.join("")}function Un(s){for(var c="",l=0;l<s.length-1;l+=2)c+=String.fromCharCode(parseInt(s.substr(l,2),16));return c}function Gr(s){for(var c="",l=0;l<s.length;l++)c+=("0"+s.charCodeAt(l).toString(16)).slice(-2);return c}function Ju(s){return p(s)}function Bb(s){return vc(Ju(s),64)}function vc(s,c){return s=s.replace(new RegExp("(.{"+c+"})","g"),`$1\r
`),s=s.replace(/\s+$/,""),s}function Tf(s){var c=s.replace(/[^0-9A-Za-z\/+=]*/g,""),l=h(c);return l}function Ub(s,c){return"-----BEGIN "+c+`-----\r
`+vc(s,64)+`\r
-----END `+c+`-----\r
`}function mn(s,c){return"-----BEGIN "+c+`-----\r
`+vc(Ju(s),64)+`\r
-----END `+c+`-----\r
`}function Bt(s,c){if(s.indexOf("-----BEGIN ")==-1)throw new Error("can't find PEM header");return c!==void 0?(s=s.replace(new RegExp("^[^]*-----BEGIN "+c+"-----"),""),s=s.replace(new RegExp("-----END "+c+"-----[^]*$"),"")):(s=s.replace(/^[^]*-----BEGIN [^-]+-----/,""),s=s.replace(/-----END [^-]+-----[^]*$/,"")),Tf(s)}function Hb(s){return s.indexOf("-----BEGIN ")==-1||s.indexOf("-----END ")==-1?null:(s=s.replace(/^[\s\S]*?-----BEGIN [^-]+-----/m,""),s=s.replace(/-----END [\s\S]+$/m,""),s=s.replace(/\s+/g,""),s.match(/^[0-9a-zA-Z+/=]+$/)?s:null)}function Vb(s){if(s.length%2!=0)throw"input is not even length";if(s.match(/^[0-9A-Fa-f]+$/)==null)throw"input is not hexadecimal";for(var c=new ArrayBuffer(s.length/2),l=new DataView(c),d=0;d<s.length/2;d++)l.setUint8(d,parseInt(s.substr(d*2,2),16));return c}function qb(s){for(var c="",l=new DataView(s),d=0;d<s.byteLength;d++)c+=("00"+l.getUint8(d).toString(16)).slice(-2);return c}function Qu(s){var c,l,d,g,m,P,E,N,A,j;if(s=Af(s),j=s.match(/^(\d{4})(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(|\.\d+)Z$/),j)return c=parseInt(j[1]),l=parseInt(j[2])-1,d=parseInt(j[3]),g=parseInt(j[4]),m=parseInt(j[5]),P=parseInt(j[6]),E=0,N=j[7],N!==""&&(A=(N.substr(1)+"00").substr(0,3),E=parseInt(A)),Date.UTC(c,l,d,g,m,P,E);throw new Error("unsupported zulu format: "+s)}function zb(s){var c=new Date(s),l=("0000"+c.getUTCFullYear()).slice(-4),d=("00"+(c.getUTCMonth()+1)).slice(-2),g=("00"+c.getUTCDate()).slice(-2),m=("00"+c.getUTCHours()).slice(-2),P=("00"+c.getUTCMinutes()).slice(-2),E=("00"+c.getUTCSeconds()).slice(-2),N=("000"+c.getUTCMilliseconds()).slice(-3);return N=N.replace(/0+$/,""),N=N!=""?"."+N:N,l+d+g+m+P+E+N+"Z"}function Rf(s){return Math.round(Qu(s)/1e3)}function Kb(s){return new Date(Qu(s))}function $b(s,c,l){var d,g=s.getUTCFullYear();if(c){if(g<1950||2049<g)throw"not proper year for UTCTime: "+g;d=(""+g).slice(-2)}else d=("000"+g).slice(-4);if(d+=("0"+(s.getUTCMonth()+1)).slice(-2),d+=("0"+s.getUTCDate()).slice(-2),d+=("0"+s.getUTCHours()).slice(-2),d+=("0"+s.getUTCMinutes()).slice(-2),d+=("0"+s.getUTCSeconds()).slice(-2),l){var m=s.getUTCMilliseconds();m!==0&&(m=("00"+m).slice(-3),m=m.replace(/0+$/g,""),d+="."+m)}return d+="Z",d}function Af(s){return s.match(/^[0-9]{12}Z$/)||s.match(/^[0-9]{12}[.][0-9]*Z$/)?s.match(/^[0-4]/)?"20"+s:"19"+s:s}function yc(s){return s.replace(/%/g,"")}function _c(s){return s.replace(/(..)/g,"%$1")}function Xu(s){var c="malformed IPv6 address";if(!s.match(/^[0-9A-Fa-f:]+$/))throw c;s=s.toLowerCase();var l=s.split(":").length-1;if(l<2)throw c;var d=":".repeat(7-l+2);s=s.replace("::",d);var g=s.split(":");if(g.length!=8)throw c;for(var m=0;m<8;m++)g[m]=("0000"+g[m]).slice(-4);return g.join("")}function Yu(s){if(!s.match(/^[0-9A-Fa-f]{32}$/))throw new Error("malformed IPv6 address: "+s);s=s.toLowerCase();var c=s.match(/.{1,4}/g);c=c.map(function(g){return g.replace(/^0+/,"")}),c=c.map(function(g){return g==""?"0":g}),s=":"+c.join(":")+":";var l=s.match(/:(0:){2,}/g);if(l==null)return s.slice(1,-1);var d=l.sort().slice(-1)[0];return s=s.replace(d.substr(0,d.length-1),":"),s.substr(0,2)!="::"&&(s=s.substr(1)),s.substr(-2,2)!="::"&&(s=s.substr(0,s.length-1)),s}function bc(s){var c=new Error("malformed hex value");if(!s.match(/^([0-9A-Fa-f][0-9A-Fa-f]){1,}$/))throw c;if(s.length==8){var l;try{return l=parseInt(s.substr(0,2),16)+"."+parseInt(s.substr(2,2),16)+"."+parseInt(s.substr(4,2),16)+"."+parseInt(s.substr(6,2),16),l}catch{throw c}}else if(s.length==16)try{return bc(s.substr(0,8))+"/"+If(s.substr(8))}catch{throw c}else{if(s.length==32)return Yu(s);if(s.length==64){try{return Yu(s.substr(0,32))+"/"+If(s.substr(32))}catch{throw c}return}else return s}}function If(s){var c=new Error("malformed mask"),l;try{l=new _(s,16).toString(2)}catch{throw c}if(!l.match(/^1*0*$/))throw c;return l.replace(/0+$/,"").length}function ed(s){var c=new Error("malformed IP address");if(s=s.toLowerCase(s),!s.match(/^[0-9a-f.:/]+$/))throw c;if(s.match(/^[0-9.]+$/)){var l=s.split(".");if(l.length!==4)throw c;var d="";try{for(var g=0;g<4;g++){var m=parseInt(l[g]);d+=("0"+m.toString(16)).slice(-2)}return d}catch{throw c}}else if(s.match(/^[0-9.]+\/[0-9]+$/)){var P=s.split("/");return ed(P[0])+Ff(parseInt(P[1]),32)}else{if(s.match(/^[0-9a-f:]+$/)&&s.indexOf(":")!==-1)return Xu(s);if(s.match(/^[0-9a-f:]+\/[0-9]+$/)&&s.indexOf(":")!==-1){var P=s.split("/");return Xu(P[0])+Ff(parseInt(P[1]),128)}else throw c}}function Ff(s,c){if(c==32&&s==0)return"00000000";if(c==128&&s==0)return"00000000000000000000000000000000";var l=Array(s+1).join("1")+Array(c-s+1).join("0");return new _(l,2).toString(16)}function td(s){function c(g){var m=parseInt(g.substr(0,2),16),P=parseInt(g.substr(2),16);if(m==0&P<128)return String.fromCharCode(P);if(m<8){var E=192|(m&7)<<3|(P&192)>>6,N=128|P&63;return ft(E.toString(16)+N.toString(16))}var E=224|(m&240)>>4,N=128|(m&15)<<2|(P&192)>>6,A=128|P&63;return ft(E.toString(16)+N.toString(16)+A.toString(16))}var l=s.match(/.{4}/g),d=l.map(c);return d.join("")}function Sc(s){for(var c=encodeURIComponent(s),l="",d=0;d<c.length;d++)c[d]=="%"?(l=l+c.substr(d,3),d=d+2):l=l+"%"+Bn(c[d]);return l}function Wb(s){return s=s.replace(/\r\n/mg,`
`),s}function Gb(s){return s=s.replace(/\r\n/mg,`
`),s=s.replace(/\n/mg,`\r
`),s}v.lang.String.isInteger=function(s){return s.match(/^[0-9]+$/)?!0:!!s.match(/^-[0-9]+$/)},v.lang.String.isHex=function(s){return Df(s)};function Df(s){return!!(s.length%2==0&&(s.match(/^[0-9a-f]+$/)||s.match(/^[0-9A-F]+$/)))}v.lang.String.isBase64=function(s){return s=s.replace(/\s+/g,""),!!(s.match(/^[0-9A-Za-z+\/]+={0,3}$/)&&s.length%4==0)},v.lang.String.isBase64URL=function(s){return s.match(/[+/=]/)?!1:(s=La(s),v.lang.String.isBase64(s))};function nd(s){return!!s.match(/^[0-9A-Za-z-_.]+$/)}v.lang.String.isIntegerArray=function(s){return s=s.replace(/\s+/g,""),!!s.match(/^\[[0-9,]+\]$/)},v.lang.String.isPrintable=function(s){return s.match(/^[0-9A-Za-z '()+,-./:=?]*$/)!==null},v.lang.String.isIA5=function(s){return s.match(/^[\x20-\x21\x23-\x7f]*$/)!==null},v.lang.String.isMail=function(s){return s.match(/^[A-Za-z0-9]{1}[A-Za-z0-9_.-]*@{1}[A-Za-z0-9_.-]{1,}\.[A-Za-z0-9]{1,}$/)!==null};function rd(s){return s.length%2==1?"0"+s:s.substr(0,1)>"7"?"00"+s:s}function Zb(s){s=s.replace(/^\s*\[\s*/,""),s=s.replace(/\s*\]\s*$/,""),s=s.replace(/\s*/g,"");try{var c=s.split(/,/).map(function(l,d,g){var m=parseInt(l);if(m<0||255<m)throw"integer not in range 0-255";var P=("00"+m.toString(16)).slice(-2);return P}).join("");return c}catch(l){throw"malformed integer array string: "+l}}var Jb=function(s,c){var l=s.length;s.length>c.length&&(l=c.length);for(var d=0;d<l;d++)if(s.charCodeAt(d)!=c.charCodeAt(d))return d;return s.length!=c.length?l:-1};function Nf(s){var c=function(E){var N=E.toString(16);return N.length==1&&(N="0"+N),N},l=function(E){var N="",A=parseInt(E,10),j=A.toString(2),O=7-j.length%7;O==7&&(O=0);for(var C="",I=0;I<O;I++)C+="0";j=C+j;for(var I=0;I<j.length-1;I+=7){var T=j.substr(I,7);I!=j.length-7&&(T="1"+T),N+=c(parseInt(T,2))}return N};try{if(!s.match(/^[0-9.]+$/))return null;var d="",g=s.split("."),m=parseInt(g[0],10)*40+parseInt(g[1],10);d+=c(m),g.splice(0,2);for(var P=0;P<g.length;P++)d+=l(g[P]);return d}catch{return null}}function wc(s){if(!Df(s))return null;try{var c=[],l=s.substr(0,2),d=parseInt(l,16);c[0]=new String(Math.floor(d/40)),c[1]=new String(d%40);for(var g=s.substr(2),m=[],P=0;P<g.length/2;P++)m.push(parseInt(g.substr(P*2,2),16));for(var E=[],N="",P=0;P<m.length;P++)m[P]&128?N=N+xc((m[P]&127).toString(2),7):(N=N+xc((m[P]&127).toString(2),7),E.push(new String(parseInt(N,2))),N="");var A=c.join(".");return E.length>0&&(A=A+"."+E.join(".")),A}catch{return null}}function Of(s){var c=new _(String(s),10);return Ba(c)}function Ba(s){var c=s.toString(16);if(c.substr(0,1)!="-")return c.length%2==1?c="0"+c:c.match(/^[0-7]/)||(c="00"+c),c;var l=c.substr(1),d=l.length;d%2==1?d+=1:c.match(/^[0-7]/)||(d+=2);for(var g="",m=0;m<d;m++)g+="f";var P=new _(g,16),E=P.xor(s).add(_.ONE);return c=E.toString(16).replace(/^-/,""),c}var xc=function(s,c,l){return l==null&&(l="0"),s.length>=c?s:new Array(c-s.length+1).join(l)+s};function Mf(s){if(s.length%2!=0||(s=s.toLowerCase(),s.match(/^[0-9a-f]+$/)==null))return-1;try{var c=s.substr(0,2);if(c=="00")return parseInt(s.substr(2),16);var l=parseInt(c,16);if(l>7)return-1;var d=s.substr(2),g=parseInt(d,16).toString(2);g=="0"&&(g="00000000"),g=g.slice(0,0-l);var m=parseInt(g,2);return m==NaN?-1:m}catch{return-1}}function Lf(s){if(typeof s!="number"||s<0)return null;var c=Number(s).toString(2),l=8-c.length%8;l==8&&(l=0),c=c+xc("",l,"0");var d=parseInt(c,2).toString(16);d.length%2==1&&(d="0"+d);var g="0"+l;return g+d}function jf(s){if(typeof s!="string"||s.length%2!=0||!s.match(/^[0-9a-f]+$/))return null;try{var c=parseInt(s.substr(0,2),16);if(c<0||7<c)return null;for(var l=s.substr(2),d="",g=0;g<l.length;g+=2){var m=l.substr(g,2),P=parseInt(m,16).toString(2);P=("0000000"+P).slice(-8),d+=P}return d.substr(0,d.length-c)}catch{return null}}function Qb(s){if(typeof s!="string"||s.match(/^[01]+$/)==null)return null;try{var c=parseInt(s,2);return Lf(c)}catch{return null}}function Cc(s,c){for(var l=0,d=0;d<s.length;d++)l|=1<<c[s[d]];for(var g=l.toString(2),m="",d=g.length-1;d>=0;d--)m+=g[d];return m}function _t(s,d,l){if(typeof s=="object"){for(var d=String(d).split("."),g=0;g<d.length&&s;g++){var m=d[g];m.match(/^[0-9]+$/)&&(m=parseInt(m)),s=s[m]}return s||s===!1?s:l}}function ve(s,c){var l=function(){};l.prototype=c.prototype,s.prototype=new l,s.prototype.constructor=s,s.superclass=c.prototype,c.prototype.constructor==Object.prototype.constructor&&(c.prototype.constructor=c)}(typeof v>"u"||!v)&&(v={}),(typeof v.crypto>"u"||!v.crypto)&&(v.crypto={}),v.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHAwithRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:a.algo.MD5,sha1:a.algo.SHA1,sha224:a.algo.SHA224,sha256:a.algo.SHA256,sha384:a.algo.SHA384,sha512:a.algo.SHA512,ripemd160:a.algo.RIPEMD160},this.getDigestInfoHex=function(s,c){if(typeof this.DIGESTINFOHEAD[c]>"u")throw"alg not supported in Util.DIGESTINFOHEAD: "+c;return this.DIGESTINFOHEAD[c]+s},this.getPaddedDigestInfoHex=function(s,c,l){var d=this.getDigestInfoHex(s,c),g=l/4;if(d.length+22>g)throw"key is too short for SigAlg: keylen="+l+","+c;for(var m="0001",P="00"+d,E="",N=g-m.length-P.length,A=0;A<N;A+=2)E+="ff";var j=m+E+P;return j},this.hashString=function(s,c){var l=new v.crypto.MessageDigest({alg:c});return l.digestString(s)},this.hashHex=function(s,c){var l=new v.crypto.MessageDigest({alg:c});return l.digestHex(s)},this.sha1=function(s){return this.hashString(s,"sha1")},this.sha256=function(s){return this.hashString(s,"sha256")},this.sha256Hex=function(s){return this.hashHex(s,"sha256")},this.sha512=function(s){return this.hashString(s,"sha512")},this.sha512Hex=function(s){return this.hashHex(s,"sha512")},this.isKey=function(s){return s instanceof Ke||s instanceof v.crypto.DSA||s instanceof v.crypto.ECDSA}},v.crypto.Util.md5=function(s){var c=new v.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return c.digestString(s)},v.crypto.Util.ripemd160=function(s){var c=new v.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return c.digestString(s)},v.crypto.Util.SECURERANDOMGEN=new Us,v.crypto.Util.getRandomHexOfNbytes=function(s){var c=new Array(s);return v.crypto.Util.SECURERANDOMGEN.nextBytes(c),mc(c)},v.crypto.Util.getRandomBigIntegerOfNbytes=function(s){return new _(v.crypto.Util.getRandomHexOfNbytes(s),16)},v.crypto.Util.getRandomHexOfNbits=function(s){var c=s%8,l=(s-c)/8,d=new Array(l+1);return v.crypto.Util.SECURERANDOMGEN.nextBytes(d),d[0]=(255<<c&255^255)&d[0],mc(d)},v.crypto.Util.getRandomBigIntegerOfNbits=function(s){return new _(v.crypto.Util.getRandomHexOfNbits(s),16)},v.crypto.Util.getRandomBigIntegerZeroToMax=function(s){for(var c=s.bitLength();;){var l=v.crypto.Util.getRandomBigIntegerOfNbits(c);if(s.compareTo(l)!=-1)return l}},v.crypto.Util.getRandomBigIntegerMinToMax=function(s,c){var l=s.compareTo(c);if(l==1)throw"biMin is greater than biMax";if(l==0)return s;var d=c.subtract(s),g=v.crypto.Util.getRandomBigIntegerZeroToMax(d);return g.add(s)},v.crypto.MessageDigest=function(s){this.setAlgAndProvider=function(c,l){if(c=v.crypto.MessageDigest.getCanonicalAlgName(c),c!==null&&l===void 0&&(l=v.crypto.Util.DEFAULTPROVIDER[c]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(c)!=-1&&l=="cryptojs"){try{this.md=v.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[c].create()}catch(d){throw"setAlgAndProvider hash alg set fail alg="+c+"/"+d}this.updateString=function(d){this.md.update(d)},this.updateHex=function(d){var g=a.enc.Hex.parse(d);this.md.update(g)},this.digest=function(){var d=this.md.finalize();return d.toString(a.enc.Hex)},this.digestString=function(d){return this.updateString(d),this.digest()},this.digestHex=function(d){return this.updateHex(d),this.digest()}}if(":sha256:".indexOf(c)!=-1&&l=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(d){throw"setAlgAndProvider hash alg set fail alg="+c+"/"+d}this.updateString=function(d){this.md.update(d)},this.updateHex=function(d){var g=sjcl.codec.hex.toBits(d);this.md.update(g)},this.digest=function(){var d=this.md.finalize();return sjcl.codec.hex.fromBits(d)},this.digestString=function(d){return this.updateString(d),this.digest()},this.digestHex=function(d){return this.updateHex(d),this.digest()}}},this.updateString=function(c){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(c){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(c){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(c){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},s!==void 0&&s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0&&(this.provName=v.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},v.crypto.MessageDigest.getCanonicalAlgName=function(s){return typeof s=="string"&&(s=s.toLowerCase(),s=s.replace(/-/,"")),s},v.crypto.MessageDigest.getHashLength=function(s){var c=v.crypto.MessageDigest,l=c.getCanonicalAlgName(s);if(c.HASHLENGTH[l]===void 0)throw"not supported algorithm: "+s;return c.HASHLENGTH[l]},v.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},v.crypto.Mac=function(s){this.setAlgAndProvider=function(c,l){if(c=c.toLowerCase(),c==null&&(c="hmacsha1"),c=c.toLowerCase(),c.substr(0,4)!="hmac")throw"setAlgAndProvider unsupported HMAC alg: "+c;l===void 0&&(l=v.crypto.Util.DEFAULTPROVIDER[c]),this.algProv=c+"/"+l;var d=c.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(d)!=-1&&l=="cryptojs"){try{var g=v.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[d];this.mac=a.algo.HMAC.create(g,this.pass)}catch(m){throw"setAlgAndProvider hash alg set fail hashAlg="+d+"/"+m}this.updateString=function(m){this.mac.update(m)},this.updateHex=function(m){var P=a.enc.Hex.parse(m);this.mac.update(P)},this.doFinal=function(){var m=this.mac.finalize();return m.toString(a.enc.Hex)},this.doFinalString=function(m){return this.updateString(m),this.doFinal()},this.doFinalHex=function(m){return this.updateHex(m),this.doFinal()}}},this.updateString=function(c){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(c){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(c){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(c){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(c){if(typeof c=="string"){var l=c;(c.length%2==1||!c.match(/^[0-9A-Fa-f]+$/))&&(l=Gr(c)),this.pass=a.enc.Hex.parse(l);return}if(typeof c!="object")throw"KJUR.crypto.Mac unsupported password type: "+c;var l=null;if(c.hex!==void 0){if(c.hex.length%2!=0||!c.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+c.hex;l=c.hex}if(c.utf8!==void 0&&(l=gc(c.utf8)),c.rstr!==void 0&&(l=Gr(c.rstr)),c.b64!==void 0&&(l=h(c.b64)),c.b64u!==void 0&&(l=xt(c.b64u)),l==null)throw"KJUR.crypto.Mac unsupported password type: "+c;this.pass=a.enc.Hex.parse(l)},s!==void 0&&(s.pass!==void 0&&this.setPassword(s.pass),s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0&&(this.provName=v.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},v.crypto.Signature=function(s){var c=null;if(this._setAlgNames=function(){var l=this.algName.match(/^(.+)with(.+)$/);l&&(this.mdAlgName=l[1].toLowerCase(),this.pubkeyAlgName=l[2].toLowerCase(),this.pubkeyAlgName=="rsaandmgf1"&&this.mdAlgName=="sha"&&(this.mdAlgName="sha1"))},this._zeroPaddingOfSignature=function(l,d){for(var g="",m=d/4-l.length,P=0;P<m;P++)g=g+"0";return g+l},this.setAlgAndProvider=function(l,d){if(this._setAlgNames(),d!="cryptojs/jsrsa")throw new Error("provider not supported: "+d);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new v.crypto.MessageDigest({alg:this.mdAlgName})}catch(g){throw new Error("setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+g)}this.init=function(g,m){var P=null;try{m===void 0?P=nt.getKey(g):P=nt.getKey(g,m)}catch(E){throw"init failed:"+E}if(P.isPrivate===!0)this.prvKey=P,this.state="SIGN";else if(P.isPublic===!0)this.pubKey=P,this.state="VERIFY";else throw"init failed.:"+P},this.updateString=function(g){this.md.updateString(g)},this.updateHex=function(g){this.md.updateHex(g)},this.sign=function(){if(this.sHashHex=this.md.digest(),this.prvKey===void 0&&this.ecprvhex!==void 0&&this.eccurvename!==void 0&&v.crypto.ECDSA!==void 0&&(this.prvKey=new v.crypto.ECDSA({curve:this.eccurvename,prv:this.ecprvhex})),this.prvKey instanceof Ke&&this.pubkeyAlgName==="rsaandmgf1")this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof Ke&&this.pubkeyAlgName==="rsa")this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof v.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else if(this.prvKey instanceof v.crypto.DSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else throw"Signature: unsupported private key alg: "+this.pubkeyAlgName;return this.hSign},this.signString=function(g){return this.updateString(g),this.sign()},this.signHex=function(g){return this.updateHex(g),this.sign()},this.verify=function(g){if(this.sHashHex=this.md.digest(),this.pubKey===void 0&&this.ecpubhex!==void 0&&this.eccurvename!==void 0&&v.crypto.ECDSA!==void 0&&(this.pubKey=new v.crypto.ECDSA({curve:this.eccurvename,pub:this.ecpubhex})),this.pubKey instanceof Ke&&this.pubkeyAlgName==="rsaandmgf1")return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,g,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof Ke&&this.pubkeyAlgName==="rsa")return this.pubKey.verifyWithMessageHash(this.sHashHex,g);if(v.crypto.ECDSA!==void 0&&this.pubKey instanceof v.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,g);if(v.crypto.DSA!==void 0&&this.pubKey instanceof v.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,g);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(l,d){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.updateString=function(l){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(l){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(l){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(l){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(l){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=s,s!==void 0&&(s.alg!==void 0&&(this.algName=s.alg,s.prov===void 0?this.provName=v.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=s.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),s.psssaltlen!==void 0&&(this.pssSaltLen=s.psssaltlen),s.prvkeypem!==void 0)){if(s.prvkeypas!==void 0)throw"both prvkeypem and prvkeypas parameters not supported";try{var c=nt.getKey(s.prvkeypem);this.init(c)}catch(l){throw"fatal error to load pem private key: "+l}}},v.crypto.Cipher=function(s){},v.crypto.Cipher.encrypt=function(s,c,l,d){if(_t(d,"enclag")!=null&&(l=d.encalg),typeof l=="string"&&l.substr(-4)=="-CBC"){var g=c,m=s;_t(d,"key")!=null&&(g=d.key),_t(d,"enc")!=null&&(hEnc=d.enc);var P=a.enc.Hex.parse(g),E=a.enc.Hex.parse(m),N=a.enc.Hex.parse(d.iv),A;if(l=="des-EDE3-CBC")A=a.TripleDES.encrypt(E,P,{iv:N});else if(l=="aes128-CBC"||l=="aes256-CBC")A=a.AES.encrypt(E,P,{iv:N});else throw new Error("unsupported algorithm: "+l);return A+""}else throw new Error("Cipher.encrypt: unsupported key or algorithm")},v.crypto.Cipher.decrypt=function(s,c,l,d){if(_t(d,"enclag")!=null&&(l=d.encalg),typeof l=="string"&&l.substr(-4)=="-CBC"){var g=c,m=s;_t(d,"key")!=null&&(g=d.key),_t(d,"enc")!=null&&(m=d.enc);var P=a.enc.Hex.parse(g),E=a.enc.Hex.parse(m),N=a.enc.Hex.parse(d.iv),A;if(l=="des-EDE3-CBC")A=a.TripleDES.decrypt({ciphertext:E},P,{iv:N});else if(l=="aes128-CBC"||l=="aes256-CBC")A=a.AES.decrypt({ciphertext:E},P,{iv:N});else throw new Error("unsupported algorithm: "+l);return a.enc.Hex.stringify(A)}else throw new Error("Cipher.decrypt: unsupported key or algorithm")},v.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040022":"secp384r1","2b81040023":"secp521r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},(typeof v>"u"||!v)&&(v={}),(typeof v.crypto>"u"||!v.crypto)&&(v.crypto={}),v.crypto.ECDSA=function(s){var c="secp256r1",l=Error,d=_,g=ut,m=v.crypto.ECDSA,P=v.crypto.ECParameterDB,E=m.getName,N=ke,A=N.getVbyListEx,j=N.isASN1HEX,O=new Us;this.type="EC",this.isPrivate=!1,this.isPublic=!1,this.getBigRandom=function(C){return new d(C.bitLength(),O).mod(C.subtract(d.ONE)).add(d.ONE)},this.setNamedCurve=function(C){this.ecparams=P.getByName(C),this.prvKeyHex=null,this.pubKeyHex=null,this.curveName=C},this.setPrivateKeyHex=function(C){this.isPrivate=!0,this.prvKeyHex=C},this.setPublicKeyHex=function(C){this.isPublic=!0,this.pubKeyHex=C},this.getPublicKeyXYHex=function(){var C=this.pubKeyHex;if(C.substr(0,2)!=="04")throw"this method supports uncompressed format(04) only";var I=this.ecparams.keycharlen;if(C.length!==2+I*2)throw"malformed public key hex length";var T={};return T.x=C.substr(2,I),T.y=C.substr(2+I),T},this.getShortNISTPCurveName=function(){var C=this.curveName;return C==="secp256r1"||C==="NIST P-256"||C==="P-256"||C==="prime256v1"?"P-256":C==="secp384r1"||C==="NIST P-384"||C==="P-384"?"P-384":C==="secp521r1"||C==="NIST P-521"||C==="P-521"?"P-521":null},this.generateKeyPairHex=function(){var C=this.ecparams.n,I=this.getBigRandom(C),T=this.ecparams.keycharlen,D=("0000000000"+I.toString(16)).slice(-T);this.setPrivateKeyHex(D);var M=this.generatePublicKeyHex();return{ecprvhex:D,ecpubhex:M}},this.generatePublicKeyHex=function(){var C=new d(this.prvKeyHex,16),I=this.ecparams.G.multiply(C),T=I.getX().toBigInteger(),D=I.getY().toBigInteger(),M=this.ecparams.keycharlen,H=("0000000000"+T.toString(16)).slice(-M),te=("0000000000"+D.toString(16)).slice(-M),ie="04"+H+te;return this.setPublicKeyHex(ie),ie},this.signWithMessageHash=function(C){return this.signHex(C,this.prvKeyHex)},this.signHex=function(C,I){var T=new d(I,16),D=this.ecparams.n,M=new d(C.substring(0,this.ecparams.keycharlen),16);do var H=this.getBigRandom(D),te=this.ecparams.G,ie=te.multiply(H),re=ie.getX().toBigInteger().mod(D);while(re.compareTo(d.ZERO)<=0);var ae=H.modInverse(D).multiply(M.add(T.multiply(re))).mod(D);return m.biRSSigToASN1Sig(re,ae)},this.sign=function(C,I){var T=I,D=this.ecparams.n,M=d.fromByteArrayUnsigned(C);do var H=this.getBigRandom(D),te=this.ecparams.G,ie=te.multiply(H),re=ie.getX().toBigInteger().mod(D);while(re.compareTo(_.ZERO)<=0);var ae=H.modInverse(D).multiply(M.add(T.multiply(re))).mod(D);return this.serializeSig(re,ae)},this.verifyWithMessageHash=function(C,I){return this.verifyHex(C,I,this.pubKeyHex)},this.verifyHex=function(C,I,T){try{var D,M,H=m.parseSigHex(I);D=H.r,M=H.s;var te=g.decodeFromHex(this.ecparams.curve,T),ie=new d(C.substring(0,this.ecparams.keycharlen),16);return this.verifyRaw(ie,D,M,te)}catch{return!1}},this.verify=function(C,I,T){var D,M;if(Bitcoin.Util.isArray(I)){var H=this.parseSig(I);D=H.r,M=H.s}else if(typeof I=="object"&&I.r&&I.s)D=I.r,M=I.s;else throw"Invalid value for signature";var te;if(T instanceof ut)te=T;else if(Bitcoin.Util.isArray(T))te=g.decodeFrom(this.ecparams.curve,T);else throw"Invalid format for pubkey value, must be byte array or ECPointFp";var ie=d.fromByteArrayUnsigned(C);return this.verifyRaw(ie,D,M,te)},this.verifyRaw=function(C,I,T,D){var M=this.ecparams.n,H=this.ecparams.G;if(I.compareTo(d.ONE)<0||I.compareTo(M)>=0||T.compareTo(d.ONE)<0||T.compareTo(M)>=0)return!1;var te=T.modInverse(M),ie=C.multiply(te).mod(M),re=I.multiply(te).mod(M),ae=H.multiply(ie).add(D.multiply(re)),V=ae.getX().toBigInteger().mod(M);return V.equals(I)},this.serializeSig=function(C,I){var T=C.toByteArraySigned(),D=I.toByteArraySigned(),M=[];return M.push(2),M.push(T.length),M=M.concat(T),M.push(2),M.push(D.length),M=M.concat(D),M.unshift(M.length),M.unshift(48),M},this.parseSig=function(C){var I;if(C[0]!=48)throw new Error("Signature not a valid DERSequence");if(I=2,C[I]!=2)throw new Error("First element in signature must be a DERInteger");var T=C.slice(I+2,I+2+C[I+1]);if(I+=2+C[I+1],C[I]!=2)throw new Error("Second element in signature must be a DERInteger");var D=C.slice(I+2,I+2+C[I+1]);I+=2+C[I+1];var M=d.fromByteArrayUnsigned(T),H=d.fromByteArrayUnsigned(D);return{r:M,s:H}},this.parseSigCompact=function(C){if(C.length!==65)throw"Signature has the wrong length";var I=C[0]-27;if(I<0||I>7)throw"Invalid signature type";var T=this.ecparams.n,D=d.fromByteArrayUnsigned(C.slice(1,33)).mod(T),M=d.fromByteArrayUnsigned(C.slice(33,65)).mod(T);return{r:D,s:M,i:I}},this.readPKCS5PrvKeyHex=function(C){if(j(C)===!1)throw new Error("not ASN.1 hex string");var I,T,D;try{I=A(C,0,["[0]",0],"06"),T=A(C,0,[1],"04");try{D=A(C,0,["[1]",0],"03")}catch{}}catch{throw new Error("malformed PKCS#1/5 plain ECC private key")}if(this.curveName=E(I),this.curveName===void 0)throw"unsupported curve name";this.setNamedCurve(this.curveName),this.setPublicKeyHex(D),this.setPrivateKeyHex(T),this.isPublic=!1},this.readPKCS8PrvKeyHex=function(C){if(j(C)===!1)throw new l("not ASN.1 hex string");var I,T,D,M;try{I=A(C,0,[1,0],"06"),T=A(C,0,[1,1],"06"),D=A(C,0,[2,0,1],"04");try{M=A(C,0,[2,0,"[1]",0],"03")}catch{}}catch{throw new l("malformed PKCS#8 plain ECC private key")}if(this.curveName=E(T),this.curveName===void 0)throw new l("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(M),this.setPrivateKeyHex(D),this.isPublic=!1},this.readPKCS8PubKeyHex=function(C){if(j(C)===!1)throw new l("not ASN.1 hex string");var I,T,D;try{I=A(C,0,[0,0],"06"),T=A(C,0,[0,1],"06"),D=A(C,0,[1],"03")}catch{throw new l("malformed PKCS#8 ECC public key")}if(this.curveName=E(T),this.curveName===null)throw new l("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(D)},this.readCertPubKeyHex=function(C,I){if(j(C)===!1)throw new l("not ASN.1 hex string");var T,D;try{T=A(C,0,[0,5,0,1],"06"),D=A(C,0,[0,5,1],"03")}catch{throw new l("malformed X.509 certificate ECC public key")}if(this.curveName=E(T),this.curveName===null)throw new l("unsupported curve name");this.setNamedCurve(this.curveName),this.setPublicKeyHex(D)},s!==void 0&&s.curve!==void 0&&(this.curveName=s.curve),this.curveName===void 0&&(this.curveName=c),this.setNamedCurve(this.curveName),s!==void 0&&(s.prv!==void 0&&this.setPrivateKeyHex(s.prv),s.pub!==void 0&&this.setPublicKeyHex(s.pub))},v.crypto.ECDSA.parseSigHex=function(s){var c=v.crypto.ECDSA.parseSigHexInHexRS(s),l=new _(c.r,16),d=new _(c.s,16);return{r:l,s:d}},v.crypto.ECDSA.parseSigHexInHexRS=function(s){var c=ke,l=c.getChildIdx,d=c.getV;if(c.checkStrictDER(s,0),s.substr(0,2)!="30")throw new Error("signature is not a ASN.1 sequence");var g=l(s,0);if(g.length!=2)throw new Error("signature shall have two elements");var m=g[0],P=g[1];if(s.substr(m,2)!="02")throw new Error("1st item not ASN.1 integer");if(s.substr(P,2)!="02")throw new Error("2nd item not ASN.1 integer");var E=d(s,m),N=d(s,P);return{r:E,s:N}},v.crypto.ECDSA.asn1SigToConcatSig=function(s){var c=v.crypto.ECDSA.parseSigHexInHexRS(s),l=c.r,d=c.s;if(l.length>=130&&l.length<=134){if(l.length%2!=0)throw Error("unknown ECDSA sig r length error");if(d.length%2!=0)throw Error("unknown ECDSA sig s length error");l.substr(0,2)=="00"&&(l=l.substr(2)),d.substr(0,2)=="00"&&(d=d.substr(2));var g=Math.max(l.length,d.length);return l=("000000"+l).slice(-g),d=("000000"+d).slice(-g),l+d}if(l.substr(0,2)=="00"&&l.length%32==2&&(l=l.substr(2)),d.substr(0,2)=="00"&&d.length%32==2&&(d=d.substr(2)),l.length%32==30&&(l="00"+l),d.length%32==30&&(d="00"+d),l.length%32!=0)throw Error("unknown ECDSA sig r length error");if(d.length%32!=0)throw Error("unknown ECDSA sig s length error");return l+d},v.crypto.ECDSA.concatSigToASN1Sig=function(s){if(s.length%4!=0)throw Error("unknown ECDSA concatinated r-s sig length error");var c=s.substr(0,s.length/2),l=s.substr(s.length/2);return v.crypto.ECDSA.hexRSSigToASN1Sig(c,l)},v.crypto.ECDSA.hexRSSigToASN1Sig=function(s,c){var l=new _(s,16),d=new _(c,16);return v.crypto.ECDSA.biRSSigToASN1Sig(l,d)},v.crypto.ECDSA.biRSSigToASN1Sig=function(s,c){var l=v.asn1,d=new l.DERInteger({bigint:s}),g=new l.DERInteger({bigint:c}),m=new l.DERSequence({array:[d,g]});return m.tohex()},v.crypto.ECDSA.getName=function(s){return s==="2b8104001f"?"secp192k1":s==="2a8648ce3d030107"?"secp256r1":s==="2b8104000a"?"secp256k1":s==="2b81040021"?"secp224r1":s==="2b81040022"?"secp384r1":s==="2b81040023"?"secp521r1":"|secp256r1|NIST P-256|P-256|prime256v1|".indexOf(s)!==-1?"secp256r1":"|secp256k1|".indexOf(s)!==-1?"secp256k1":"|secp224r1|NIST P-224|P-224|".indexOf(s)!==-1?"secp224r1":"|secp384r1|NIST P-384|P-384|".indexOf(s)!==-1?"secp384r1":"|secp521r1|NIST P-521|P-521|".indexOf(s)!==-1?"secp521r1":null},(typeof v>"u"||!v)&&(v={}),(typeof v.crypto>"u"||!v.crypto)&&(v.crypto={}),v.crypto.ECParameterDB=new function(){var s={},c={};function l(d){return new _(d,16)}this.getByName=function(d){var g=d;if(typeof c[g]<"u"&&(g=c[d]),typeof s[g]<"u")return s[g];throw"unregistered EC curve name: "+g},this.regist=function(d,g,m,P,E,N,A,j,O,C,I,T){s[d]={};var D=l(m),M=l(P),H=l(E),te=l(N),ie=l(A),re=new oi(D,M,H),ae=re.decodePointHex("04"+j+O);s[d].name=d,s[d].keylen=g,s[d].keycharlen=Math.ceil(g/8)*2,s[d].curve=re,s[d].G=ae,s[d].n=te,s[d].h=ie,s[d].oid=I,s[d].info=T;for(var V=0;V<C.length;V++)c[C[V]]=d}},v.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field"),v.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field"),v.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field"),v.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]),v.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]),v.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]),v.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]),v.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]),v.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]),v.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]),(typeof v>"u"||!v)&&(v={}),(typeof v.crypto>"u"||!v.crypto)&&(v.crypto={}),v.crypto.DSA=function(){var s=ke;s.getVbyList;var c=s.getVbyListEx,l=s.isASN1HEX,d=_;this.p=null,this.q=null,this.g=null,this.y=null,this.x=null,this.type="DSA",this.isPrivate=!1,this.isPublic=!1,this.setPrivate=function(g,m,P,E,N){this.isPrivate=!0,this.p=g,this.q=m,this.g=P,this.y=E,this.x=N},this.setPrivateHex=function(g,m,P,E,N){var A,j,O,C,I;A=new _(g,16),j=new _(m,16),O=new _(P,16),typeof E=="string"&&E.length>1?C=new _(E,16):C=null,I=new _(N,16),this.setPrivate(A,j,O,C,I)},this.setPublic=function(g,m,P,E){this.isPublic=!0,this.p=g,this.q=m,this.g=P,this.y=E,this.x=null},this.setPublicHex=function(g,m,P,E){var N,A,j,O;N=new _(g,16),A=new _(m,16),j=new _(P,16),O=new _(E,16),this.setPublic(N,A,j,O)},this.signWithMessageHash=function(g){var m=this.p,P=this.q,E=this.g;this.y;var N=this.x,A=v.crypto.Util.getRandomBigIntegerMinToMax(_.ONE.add(_.ONE),P.subtract(_.ONE)),j=g.substr(0,P.bitLength()/4),O=new _(j,16),C=E.modPow(A,m).mod(P),I=A.modInverse(P).multiply(O.add(N.multiply(C))).mod(P),T=v.asn1.ASN1Util.jsonToASN1HEX({seq:[{int:{bigint:C}},{int:{bigint:I}}]});return T},this.verifyWithMessageHash=function(g,m){var P=this.p,E=this.q,N=this.g,A=this.y,j=this.parseASN1Signature(m),O=j[0],C=j[1],I=g.substr(0,E.bitLength()/4),T=new _(I,16);if(_.ZERO.compareTo(O)>0||O.compareTo(E)>0||_.ZERO.compareTo(C)>=0||C.compareTo(E)>0)throw"invalid DSA signature";var D=C.modInverse(E),M=T.multiply(D).mod(E),H=O.multiply(D).mod(E),te=N.modPow(M,P).multiply(A.modPow(H,P)).mod(P).mod(E);return te.compareTo(O)==0},this.parseASN1Signature=function(g){try{var m=new d(c(g,0,[0],"02"),16),P=new d(c(g,0,[1],"02"),16);return[m,P]}catch{throw new Error("malformed ASN.1 DSA signature")}},this.readPKCS5PrvKeyHex=function(g){var m,P,E,N,A;if(l(g)===!1)throw new Error("not ASN.1 hex string");try{m=c(g,0,[1],"02"),P=c(g,0,[2],"02"),E=c(g,0,[3],"02"),N=c(g,0,[4],"02"),A=c(g,0,[5],"02")}catch{throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(m,P,E,N,A)},this.readPKCS8PrvKeyHex=function(g){var m,P,E,N;if(l(g)===!1)throw new Error("not ASN.1 hex string");try{m=c(g,0,[1,1,0],"02"),P=c(g,0,[1,1,1],"02"),E=c(g,0,[1,1,2],"02"),N=c(g,0,[2,0],"02")}catch{throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(m,P,E,null,N)},this.readPKCS8PubKeyHex=function(g){var m,P,E,N;if(l(g)===!1)throw new Error("not ASN.1 hex string");try{m=c(g,0,[0,1,0],"02"),P=c(g,0,[0,1,1],"02"),E=c(g,0,[0,1,2],"02"),N=c(g,0,[1,0],"02")}catch{throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(m,P,E,N)},this.readCertPubKeyHex=function(g,m){var P,E,N,A;if(l(g)===!1)throw new Error("not ASN.1 hex string");try{P=c(g,0,[0,5,0,1,0],"02"),E=c(g,0,[0,5,0,1,1],"02"),N=c(g,0,[0,5,0,1,2],"02"),A=c(g,0,[0,5,1,0],"02")}catch{throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(P,E,N,A)}};var nt=function(){var s=function(T,D,M){return d(a.AES,T,D,M)},c=function(T,D,M){return d(a.TripleDES,T,D,M)},l=function(T,D,M){return d(a.DES,T,D,M)},d=function(T,D,M,H){var te=a.enc.Hex.parse(D),ie=a.enc.Hex.parse(M),re=a.enc.Hex.parse(H),ae={};ae.key=ie,ae.iv=re,ae.ciphertext=te;var V=T.decrypt(ae,ie,{iv:re});return a.enc.Hex.stringify(V)},g=function(T,D,M){return E(a.AES,T,D,M)},m=function(T,D,M){return E(a.TripleDES,T,D,M)},P=function(T,D,M){return E(a.DES,T,D,M)},E=function(T,D,M,H){var te=a.enc.Hex.parse(D),ie=a.enc.Hex.parse(M),re=a.enc.Hex.parse(H),ae=T.encrypt(te,ie,{iv:re}),V=a.enc.Hex.parse(ae.toString()),$=a.enc.Base64.stringify(V);return $},N={"AES-256-CBC":{proc:s,eproc:g,keylen:32,ivlen:16},"AES-192-CBC":{proc:s,eproc:g,keylen:24,ivlen:16},"AES-128-CBC":{proc:s,eproc:g,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:c,eproc:m,keylen:24,ivlen:8},"DES-CBC":{proc:l,eproc:P,keylen:8,ivlen:8}},A=function(T){var D=a.lib.WordArray.random(T),M=a.enc.Hex.stringify(D);return M},j=function(T){var D={},M=T.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));M&&(D.cipher=M[1],D.ivsalt=M[2]);var H=T.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));H&&(D.type=H[1]);var te=-1,ie=0;T.indexOf(`\r
\r
`)!=-1&&(te=T.indexOf(`\r
\r
`),ie=2),T.indexOf(`

`)!=-1&&(te=T.indexOf(`

`),ie=1);var re=T.indexOf("-----END");if(te!=-1&&re!=-1){var ae=T.substring(te+ie*2,re-ie);ae=ae.replace(/\s+/g,""),D.data=ae}return D},O=function(T,D,M){for(var H=M.substring(0,16),te=a.enc.Hex.parse(H),ie=a.enc.Utf8.parse(D),re=N[T].keylen+N[T].ivlen,ae="",V=null;;){var $=a.algo.MD5.create();if(V!=null&&$.update(V),$.update(ie),$.update(te),V=$.finalize(),ae=ae+a.enc.Hex.stringify(V),ae.length>=re*2)break}var Z={};return Z.keyhex=ae.substr(0,N[T].keylen*2),Z.ivhex=ae.substr(N[T].keylen*2,N[T].ivlen*2),Z},C=function(T,D,M,H){var te=a.enc.Base64.parse(T),ie=a.enc.Hex.stringify(te),re=N[D].proc,ae=re(ie,M,H);return ae},I=function(T,D,M,H){var te=N[D].eproc,ie=te(T,M,H);return ie};return{version:"1.0.0",parsePKCS5PEM:function(T){return j(T)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(T,D,M){return O(T,D,M)},decryptKeyB64:function(T,D,M,H){return C(T,D,M,H)},getDecryptedKeyHex:function(T,D){var M=j(T),H=M.cipher,te=M.ivsalt,ie=M.data,re=O(H,D,te),ae=re.keyhex,V=C(ie,H,ae,te);return V},getEncryptedPKCS5PEMFromPrvKeyHex:function(T,D,M,H,te){var q="";if((typeof H>"u"||H==null)&&(H="AES-256-CBC"),typeof N[H]>"u")throw new Error("KEYUTIL unsupported algorithm: "+H);if(typeof te>"u"||te==null){var ie=N[H].ivlen,re=A(ie);te=re.toUpperCase()}var ae=O(H,M,te),V=ae.keyhex,$=I(D,H,V,te),Z=$.replace(/(.{64})/g,`$1\r
`),q="-----BEGIN "+T+` PRIVATE KEY-----\r
`;return q+=`Proc-Type: 4,ENCRYPTED\r
`,q+="DEK-Info: "+H+","+te+`\r
`,q+=`\r
`,q+=Z,q+=`\r
-----END `+T+` PRIVATE KEY-----\r
`,q},getEncryptedPKCS8PEM:function(T,D,M){var H=this.getEncryptedPKCS8Hex(T,D,M);return mn(H,"ENCRYPTED PRIVATE KEY")},getEncryptedPKCS8Hex:function(T,D,M){var H;M==null||M==null?H={}:H=JSON.parse(JSON.stringify(M)),H.plain=T,this.initPBES2Param(H),this.encryptPBES2Param(H,D);var te=this.generatePBES2ASN1Param(H);return v.asn1.ASN1Util.newObject(te).tohex()},initPBES2Param:function(T){if(_t(T,"encalg")==null&&(T.encalg="aes256-CBC"),_t(T,"iter")==null&&(T.iter=2048),_t(T,"prf")==null&&(T.prf="hmacWithSHA256"),_t(T,"salt")==null&&(T.salt=a.enc.Hex.stringify(a.lib.WordArray.random(8))),_t(T,"enciv")==null){var D;T.encalg=="des-EDE3-CBC"&&(D=8),T.encalg=="aes128-CBC"&&(D=16),T.encalg=="aes256-CBC"&&(D=16),T.enciv=a.enc.Hex.stringify(a.lib.WordArray.random(D))}},encryptPBES2Param:function(T,D){var M=nt.getDKFromPBES2Param(T,D);try{var H=v.crypto.Cipher.encrypt(T.plain,M,T.encalg,{iv:T.enciv})}catch{throw new Error("encrypt error: "+T.plain+" "+M+" "+T.encalg+" "+T.enciv)}T.enc=H},generatePBES2ASN1Param:function(T){var D={seq:[{seq:[{oid:"pkcs5PBES2"},{seq:[{seq:[{oid:"pkcs5PBKDF2"},{seq:[{octstr:{hex:T.salt}},{int:{hex:Of(T.iter)}}]}]},{seq:[{oid:T.encalg},{octstr:{hex:T.enciv}}]}]}]},{octstr:{hex:T.enc}}]};return T.prf!="hmacWithSHA1"&&D.seq[0].seq[1].seq[0].seq[1].seq.push({seq:[{oid:T.prf},{null:""}]}),D},parseHexOfEncryptedPKCS8:function(T){var D=ke,M=D.getChildIdx,H=D.getV,te={},ie=M(T,0);if(ie.length!=2)throw new Error("malformed format: SEQUENCE(0).items != 2: "+ie.length);te.ciphertext=H(T,ie[1]);var re=M(T,ie[0]);if(re.length!=2)throw new Error("malformed format: SEQUENCE(0.0).items != 2: "+re.length);if(H(T,re[0])!="2a864886f70d01050d")throw new Error("this only supports pkcs5PBES2");var ae=M(T,re[1]);if(re.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1).items != 2: "+ae.length);var V=M(T,ae[1]);if(V.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.1).items != 2: "+V.length);if(H(T,V[0])!="2a864886f70d0307")throw"this only supports TripleDES";te.encryptionSchemeAlg="TripleDES",te.encryptionSchemeIV=H(T,V[1]);var $=M(T,ae[0]);if($.length!=2)throw new Error("malformed format: SEQUENCE(0.0.1.0).items != 2: "+$.length);if(H(T,$[0])!="2a864886f70d01050c")throw new Error("this only supports pkcs5PBKDF2");var Z=M(T,$[1]);if(Z.length<2)throw new Error("malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+Z.length);te.pbkdf2Salt=H(T,Z[0]);var q=H(T,Z[1]);try{te.pbkdf2Iter=parseInt(q,16)}catch{throw new Error("malformed format pbkdf2Iter: "+q)}return te},getPBKDF2KeyHexFromParam:function(T,D){var M=a.enc.Hex.parse(T.pbkdf2Salt),H=T.pbkdf2Iter,te=a.PBKDF2(D,M,{keySize:192/32,iterations:H}),ie=a.enc.Hex.stringify(te);return ie},_getPlainPKCS8HexFromEncryptedPKCS8PEM:function(T,D){var M=Bt(T,"ENCRYPTED PRIVATE KEY"),H=this.parseHexOfEncryptedPKCS8(M),te=nt.getPBKDF2KeyHexFromParam(H,D),ie={};ie.ciphertext=a.enc.Hex.parse(H.ciphertext);var re=a.enc.Hex.parse(te),ae=a.enc.Hex.parse(H.encryptionSchemeIV),V=a.TripleDES.decrypt(ie,re,{iv:ae}),$=a.enc.Hex.stringify(V);return $},parsePBES2:function(T){var D=ke.parse(T);if(_t(D,"seq.0.seq.0.oid")!="pkcs5PBES2"||_t(D,"seq.0.seq.1.seq.0.seq.0.oid")!="pkcs5PBKDF2")throw new Error("not pkcs5PBES2 and pkcs5PBKDF2 used");var M=_t(D,"seq.0.seq.1.seq.0.seq.1.seq");if(M==null)throw new Error("PBKDF2 parameter not found");var H=_t(M,"0.octstr.hex"),te=_t(M,"1.int.hex"),ie=_t(M,"2.seq.0.oid","hmacWithSHA1"),re=-1;try{re=parseInt(te,16)}catch{throw new Error("iter not proper value")}var ae=_t(D,"seq.0.seq.1.seq.1.seq.0.oid"),V=_t(D,"seq.0.seq.1.seq.1.seq.1.octstr.hex"),$=_t(D,"seq.1.octstr.hex");if(ae==null||V==null||$==null)throw new Error("encalg, enciv or enc is undefined");var Z={salt:H,iter:re,prf:ie,encalg:ae,enciv:V,enc:$};return Z},getDKFromPBES2Param:function(T,D){var M={hmacWithSHA1:a.algo.SHA1,hmacWithSHA224:a.algo.SHA224,hmacWithSHA256:a.algo.SHA256,hmacWithSHA384:a.algo.SHA384,hmacWithSHA512:a.algo.SHA512},H={"des-EDE3-CBC":192/32,"aes128-CBC":128/32,"aes256-CBC":256/32},te=M[T.prf];if(te==null)throw new Error("unsupported prf");var ie=H[T.encalg];if(ie==null)throw new Error("unsupported encalg");var re=a.enc.Hex.parse(T.salt),ae=T.iter;try{var V=a.PBKDF2(D,re,{keySize:ie,iterations:ae,hasher:te});return a.enc.Hex.stringify(V)}catch($){throw new Error("PBKDF2 error: "+$+" "+JSON.stringify(T)+" "+D)}},getPlainHexFromEncryptedPKCS8PEM:function(T,D){if(T.indexOf("BEGIN ENCRYPTED PRIVATE KEY")==-1)throw new Error("not Encrypted PKCS#8 PEM string");var M=Bt(T),H;try{H=nt.parsePBES2(M)}catch(ie){throw new Error("malformed PBES2 format: "+ie.message)}var te=nt.getDKFromPBES2Param(H,D);return v.crypto.Cipher.decrypt(H.enc,te,H.encalg,{iv:H.enciv})},getKeyFromEncryptedPKCS8PEM:function(T,D){var M=this.getPlainHexFromEncryptedPKCS8PEM(T,D),H=this.getKeyFromPlainPrivatePKCS8Hex(M);return H},parsePlainPrivatePKCS8Hex:function(T){var D=ke,M=D.getChildIdx,H=D.getV,te={};if(te.algparam=null,T.substr(0,2)!="30")throw new Error("malformed plain PKCS8 private key(code:001)");var ie=M(T,0);if(ie.length<3)throw new Error("malformed plain PKCS8 private key(code:002)");if(T.substr(ie[1],2)!="30")throw new Error("malformed PKCS8 private key(code:003)");var re=M(T,ie[1]);if(re.length!=2)throw new Error("malformed PKCS8 private key(code:004)");if(T.substr(re[0],2)!="06")throw new Error("malformed PKCS8 private key(code:005)");if(te.algoid=H(T,re[0]),T.substr(re[1],2)=="06"&&(te.algparam=H(T,re[1])),T.substr(ie[2],2)!="04")throw new Error("malformed PKCS8 private key(code:006)");return te.keyidx=D.getVidx(T,ie[2]),te},getKeyFromPlainPrivatePKCS8PEM:function(T){var D=Bt(T,"PRIVATE KEY"),M=this.getKeyFromPlainPrivatePKCS8Hex(D);return M},getKeyFromPlainPrivatePKCS8Hex:function(T){var D=this.parsePlainPrivatePKCS8Hex(T),M;if(D.algoid=="2a864886f70d010101")M=new Ke;else if(D.algoid=="2a8648ce380401")M=new v.crypto.DSA;else if(D.algoid=="2a8648ce3d0201")M=new v.crypto.ECDSA;else throw new Error("unsupported private key algorithm");return M.readPKCS8PrvKeyHex(T),M},_getKeyFromPublicPKCS8Hex:function(T){var D,M=ke.getVbyList(T,0,[0,0],"06");if(M==="2a864886f70d010101")D=new Ke;else if(M==="2a8648ce380401")D=new v.crypto.DSA;else if(M==="2a8648ce3d0201")D=new v.crypto.ECDSA;else throw new Error("unsupported PKCS#8 public key hex");return D.readPKCS8PubKeyHex(T),D},parsePublicRawRSAKeyHex:function(T){var D=ke,M=D.getChildIdx,H=D.getV,te={};if(T.substr(0,2)!="30")throw new Error("malformed RSA key(code:001)");var ie=M(T,0);if(ie.length!=2)throw new Error("malformed RSA key(code:002)");if(T.substr(ie[0],2)!="02")throw new Error("malformed RSA key(code:003)");if(te.n=H(T,ie[0]),T.substr(ie[1],2)!="02")throw new Error("malformed RSA key(code:004)");return te.e=H(T,ie[1]),te},parsePublicPKCS8Hex:function(T){var D=ke,M=D.getChildIdx,H=D.getV,te={};te.algparam=null;var ie=M(T,0);if(ie.length!=2)throw new Error("outer DERSequence shall have 2 elements: "+ie.length);var re=ie[0];if(T.substr(re,2)!="30")throw new Error("malformed PKCS8 public key(code:001)");var ae=M(T,re);if(ae.length!=2)throw new Error("malformed PKCS8 public key(code:002)");if(T.substr(ae[0],2)!="06")throw new Error("malformed PKCS8 public key(code:003)");if(te.algoid=H(T,ae[0]),T.substr(ae[1],2)=="06"?te.algparam=H(T,ae[1]):T.substr(ae[1],2)=="30"&&(te.algparam={},te.algparam.p=D.getVbyList(T,ae[1],[0],"02"),te.algparam.q=D.getVbyList(T,ae[1],[1],"02"),te.algparam.g=D.getVbyList(T,ae[1],[2],"02")),T.substr(ie[1],2)!="03")throw new Error("malformed PKCS8 public key(code:004)");return te.key=H(T,ie[1]).substr(2),te}}}();nt.getKey=function(s,c,l){var d=ke,g=d.getChildIdx;d.getV;var m=d.getVbyList,P=v.crypto,E=P.ECDSA,N=P.DSA,A=Ke,j=Bt,O=nt;if(typeof A<"u"&&s instanceof A||typeof E<"u"&&s instanceof E||typeof N<"u"&&s instanceof N)return s;if(s.curve!==void 0&&s.xy!==void 0&&s.d===void 0)return new E({pub:s.xy,curve:s.curve});if(s.curve!==void 0&&s.d!==void 0)return new E({prv:s.d,curve:s.curve});if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d===void 0){var C=new A;return C.setPublic(s.n,s.e),C}if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p!==void 0&&s.q!==void 0&&s.dp!==void 0&&s.dq!==void 0&&s.co!==void 0&&s.qi===void 0){var C=new A;return C.setPrivateEx(s.n,s.e,s.d,s.p,s.q,s.dp,s.dq,s.co),C}if(s.kty===void 0&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p===void 0){var C=new A;return C.setPrivate(s.n,s.e,s.d),C}if(s.p!==void 0&&s.q!==void 0&&s.g!==void 0&&s.y!==void 0&&s.x===void 0){var C=new N;return C.setPublic(s.p,s.q,s.g,s.y),C}if(s.p!==void 0&&s.q!==void 0&&s.g!==void 0&&s.y!==void 0&&s.x!==void 0){var C=new N;return C.setPrivate(s.p,s.q,s.g,s.y,s.x),C}if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d===void 0){var C=new A;return C.setPublic(xt(s.n),xt(s.e)),C}if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0&&s.p!==void 0&&s.q!==void 0&&s.dp!==void 0&&s.dq!==void 0&&s.qi!==void 0){var C=new A;return C.setPrivateEx(xt(s.n),xt(s.e),xt(s.d),xt(s.p),xt(s.q),xt(s.dp),xt(s.dq),xt(s.qi)),C}if(s.kty==="RSA"&&s.n!==void 0&&s.e!==void 0&&s.d!==void 0){var C=new A;return C.setPrivate(xt(s.n),xt(s.e),xt(s.d)),C}if(s.kty==="EC"&&s.crv!==void 0&&s.x!==void 0&&s.y!==void 0&&s.d===void 0){var I=new E({curve:s.crv}),T=I.ecparams.keycharlen,D=("0000000000"+xt(s.x)).slice(-T),M=("0000000000"+xt(s.y)).slice(-T),H="04"+D+M;return I.setPublicKeyHex(H),I}if(s.kty==="EC"&&s.crv!==void 0&&s.x!==void 0&&s.y!==void 0&&s.d!==void 0){var I=new E({curve:s.crv}),T=I.ecparams.keycharlen,D=("0000000000"+xt(s.x)).slice(-T),M=("0000000000"+xt(s.y)).slice(-T),H="04"+D+M,te=("0000000000"+xt(s.d)).slice(-T);return I.setPublicKeyHex(H),I.setPrivateKeyHex(te),I}if(l==="pkcs5prv"){var ie=s,d=ke,re,C;if(re=g(ie,0),re.length===9)C=new A,C.readPKCS5PrvKeyHex(ie);else if(re.length===6)C=new N,C.readPKCS5PrvKeyHex(ie);else if(re.length>2&&ie.substr(re[1],2)==="04")C=new E,C.readPKCS5PrvKeyHex(ie);else throw new Error("unsupported PKCS#1/5 hexadecimal key");return C}if(l==="pkcs8prv"){var C=O.getKeyFromPlainPrivatePKCS8Hex(s);return C}if(l==="pkcs8pub")return O._getKeyFromPublicPKCS8Hex(s);if(l==="x509pub")return He.getPublicKeyFromCertHex(s);if(s.indexOf("-END CERTIFICATE-",0)!=-1||s.indexOf("-END X509 CERTIFICATE-",0)!=-1||s.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return He.getPublicKeyFromCertPEM(s);if(s.indexOf("-END PUBLIC KEY-")!=-1){var ae=Bt(s,"PUBLIC KEY");return O._getKeyFromPublicPKCS8Hex(ae)}if(s.indexOf("-END RSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var V=j(s,"RSA PRIVATE KEY");return O.getKey(V,null,"pkcs5prv")}if(s.indexOf("-END DSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var $=j(s,"DSA PRIVATE KEY"),Z=m($,0,[1],"02"),q=m($,0,[2],"02"),Y=m($,0,[3],"02"),se=m($,0,[4],"02"),ue=m($,0,[5],"02"),C=new N;return C.setPrivate(new _(Z,16),new _(q,16),new _(Y,16),new _(se,16),new _(ue,16)),C}if(s.indexOf("-END EC PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")==-1){var V=j(s,"EC PRIVATE KEY");return O.getKey(V,null,"pkcs5prv")}if(s.indexOf("-END PRIVATE KEY-")!=-1)return O.getKeyFromPlainPrivatePKCS8PEM(s);if(s.indexOf("-END RSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var be=O.getDecryptedKeyHex(s,c),le=new Ke;return le.readPKCS5PrvKeyHex(be),le}if(s.indexOf("-END EC PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var $=O.getDecryptedKeyHex(s,c),C=m($,0,[1],"04"),pe=m($,0,[2,0],"06"),Se=m($,0,[3,0],"03").substr(2),Ce="";if(v.crypto.OID.oidhex2name[pe]!==void 0)Ce=v.crypto.OID.oidhex2name[pe];else throw new Error("undefined OID(hex) in KJUR.crypto.OID: "+pe);var I=new E({curve:Ce});return I.setPublicKeyHex(Se),I.setPrivateKeyHex(C),I.isPublic=!1,I}if(s.indexOf("-END DSA PRIVATE KEY-")!=-1&&s.indexOf("4,ENCRYPTED")!=-1){var $=O.getDecryptedKeyHex(s,c),Z=m($,0,[1],"02"),q=m($,0,[2],"02"),Y=m($,0,[3],"02"),se=m($,0,[4],"02"),ue=m($,0,[5],"02"),C=new N;return C.setPrivate(new _(Z,16),new _(q,16),new _(Y,16),new _(se,16),new _(ue,16)),C}if(s.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return O.getKeyFromEncryptedPKCS8PEM(s,c);throw new Error("not supported argument")},nt.generateKeypair=function(s,c){if(s=="RSA"){var l=c,d=new Ke;d.generate(l,"10001"),d.isPrivate=!0,d.isPublic=!0;var g=new Ke,m=d.n.toString(16),P=d.e.toString(16);g.setPublic(m,P),g.isPrivate=!1,g.isPublic=!0;var E={};return E.prvKeyObj=d,E.pubKeyObj=g,E}else if(s=="EC"){var N=c,A=new v.crypto.ECDSA({curve:N}),j=A.generateKeyPairHex(),d=new v.crypto.ECDSA({curve:N});d.setPublicKeyHex(j.ecpubhex),d.setPrivateKeyHex(j.ecprvhex),d.isPrivate=!0,d.isPublic=!1;var g=new v.crypto.ECDSA({curve:N});g.setPublicKeyHex(j.ecpubhex),g.isPrivate=!1,g.isPublic=!0;var E={};return E.prvKeyObj=d,E.pubKeyObj=g,E}else throw new Error("unknown algorithm: "+s)},nt.getPEM=function(s,c,l,d,g,m){var P=v,E=P.asn1,N=E.DERObjectIdentifier,A=E.DERInteger,j=E.ASN1Util.newObject,O=E.x509,C=O.SubjectPublicKeyInfo,I=P.crypto,T=I.DSA,D=I.ECDSA,M=Ke;function H(pe){var Se=j({seq:[{int:0},{int:{bigint:pe.n}},{int:pe.e},{int:{bigint:pe.d}},{int:{bigint:pe.p}},{int:{bigint:pe.q}},{int:{bigint:pe.dmp1}},{int:{bigint:pe.dmq1}},{int:{bigint:pe.coeff}}]});return Se}function te(pe){var Se=j({seq:[{int:1},{octstr:{hex:pe.prvKeyHex}},{tag:["a0",!0,{oid:{name:pe.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+pe.pubKeyHex}}]}]});return Se}function ie(pe){var Se=j({seq:[{int:0},{int:{bigint:pe.p}},{int:{bigint:pe.q}},{int:{bigint:pe.g}},{int:{bigint:pe.y}},{int:{bigint:pe.x}}]});return Se}if((M!==void 0&&s instanceof M||T!==void 0&&s instanceof T||D!==void 0&&s instanceof D)&&s.isPublic==!0&&(c===void 0||c=="PKCS8PUB")){var re=new C(s),ae=re.tohex();return mn(ae,"PUBLIC KEY")}if(c=="PKCS1PRV"&&M!==void 0&&s instanceof M&&(l===void 0||l==null)&&s.isPrivate==!0){var re=H(s),ae=re.tohex();return mn(ae,"RSA PRIVATE KEY")}if(c=="PKCS1PRV"&&D!==void 0&&s instanceof D&&(l===void 0||l==null)&&s.isPrivate==!0){var V=new N({name:s.curveName}),$=V.tohex(),Z=te(s),q=Z.tohex(),Y="";return Y+=mn($,"EC PARAMETERS"),Y+=mn(q,"EC PRIVATE KEY"),Y}if(c=="PKCS1PRV"&&T!==void 0&&s instanceof T&&(l===void 0||l==null)&&s.isPrivate==!0){var re=ie(s),ae=re.tohex();return mn(ae,"DSA PRIVATE KEY")}if(c=="PKCS5PRV"&&M!==void 0&&s instanceof M&&l!==void 0&&l!=null&&s.isPrivate==!0){var re=H(s),ae=re.tohex();return d===void 0&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",ae,l,d,m)}if(c=="PKCS5PRV"&&D!==void 0&&s instanceof D&&l!==void 0&&l!=null&&s.isPrivate==!0){var re=te(s),ae=re.tohex();return d===void 0&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",ae,l,d,m)}if(c=="PKCS5PRV"&&T!==void 0&&s instanceof T&&l!==void 0&&l!=null&&s.isPrivate==!0){var re=ie(s),ae=re.tohex();return d===void 0&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",ae,l,d,m)}var se=function(pe,Se){if(typeof Se=="string")return nt.getEncryptedPKCS8PEM(pe,Se);if(typeof Se=="object"&&_t(Se,"passcode")!=null){var Ce=JSON.parse(JSON.stringify(Se)),gn=Ce.passcode;return delete Ce.passcode,nt.getEncryptedPKCS8PEM(pe,gn,Ce)}};if(c=="PKCS8PRV"&&M!=null&&s instanceof M&&s.isPrivate==!0){var ue=H(s),be=ue.tohex(),re=j({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:be}}]}),ae=re.tohex();return l===void 0||l==null?mn(ae,"PRIVATE KEY"):se(ae,l)}if(c=="PKCS8PRV"&&D!==void 0&&s instanceof D&&s.isPrivate==!0){var le={seq:[{int:1},{octstr:{hex:s.prvKeyHex}}]};typeof s.pubKeyHex=="string"&&le.seq.push({tag:["a1",!0,{bitstr:{hex:"00"+s.pubKeyHex}}]});var ue=new j(le),be=ue.tohex(),re=j({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:s.curveName}}]},{octstr:{hex:be}}]}),ae=re.tohex();return l===void 0||l==null?mn(ae,"PRIVATE KEY"):se(ae,l)}if(c=="PKCS8PRV"&&T!==void 0&&s instanceof T&&s.isPrivate==!0){var ue=new A({bigint:s.x}),be=ue.tohex(),re=j({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:s.p}},{int:{bigint:s.q}},{int:{bigint:s.g}}]}]},{octstr:{hex:be}}]}),ae=re.tohex();return l===void 0||l==null?mn(ae,"PRIVATE KEY"):se(ae,l)}throw new Error("unsupported object nor format")},nt.getKeyFromCSRPEM=function(s){var c=Bt(s,"CERTIFICATE REQUEST"),l=nt.getKeyFromCSRHex(c);return l},nt.getKeyFromCSRHex=function(s){var c=nt.parseCSRHex(s),l=nt.getKey(c.p8pubkeyhex,null,"pkcs8pub");return l},nt.parseCSRHex=function(s){var c=ke,l=c.getChildIdx,d=c.getTLV,g={},m=s;if(m.substr(0,2)!="30")throw new Error("malformed CSR(code:001)");var P=l(m,0);if(P.length<1)throw new Error("malformed CSR(code:002)");if(m.substr(P[0],2)!="30")throw new Error("malformed CSR(code:003)");var E=l(m,P[0]);if(E.length<3)throw new Error("malformed CSR(code:004)");return g.p8pubkeyhex=d(m,E[2]),g},nt.getKeyID=function(s){var c=nt,l=ke;typeof s=="string"&&s.indexOf("BEGIN ")!=-1&&(s=c.getKey(s));var d=Bt(c.getPEM(s)),g=l.getIdxbyList(d,0,[1]),m=l.getV(d,g).substring(2);return v.crypto.Util.hashHex(m,"sha1")},nt.getJWK=function(s,c,l,d,g){var m,P={},E,N=v.crypto.Util.hashHex;if(typeof s=="string")m=nt.getKey(s),s.indexOf("CERTIFICATE")!=-1&&(E=Bt(s));else if(typeof s=="object")s instanceof He?(m=s.getPublicKey(),E=s.hex):m=s;else throw new Error("unsupported keyinfo type");if(m instanceof Ke&&m.isPrivate)P.kty="RSA",P.n=Qt(m.n.toString(16)),P.e=Qt(m.e.toString(16)),P.d=Qt(m.d.toString(16)),P.p=Qt(m.p.toString(16)),P.q=Qt(m.q.toString(16)),P.dp=Qt(m.dmp1.toString(16)),P.dq=Qt(m.dmq1.toString(16)),P.qi=Qt(m.coeff.toString(16));else if(m instanceof Ke&&m.isPublic)P.kty="RSA",P.n=Qt(m.n.toString(16)),P.e=Qt(m.e.toString(16));else if(m instanceof v.crypto.ECDSA&&m.isPrivate){var A=m.getShortNISTPCurveName();if(A!=="P-256"&&A!=="P-384"&&A!=="P-521")throw new Error("unsupported curve name for JWT: "+A);var j=m.getPublicKeyXYHex();P.kty="EC",P.crv=A,P.x=Qt(j.x),P.y=Qt(j.y),P.d=Qt(m.prvKeyHex)}else if(m instanceof v.crypto.ECDSA&&m.isPublic){var A=m.getShortNISTPCurveName();if(A!=="P-256"&&A!=="P-384"&&A!=="P-521")throw new Error("unsupported curve name for JWT: "+A);var j=m.getPublicKeyXYHex();P.kty="EC",P.crv=A,P.x=Qt(j.x),P.y=Qt(j.y)}if(P.kty==null)throw new Error("unsupported keyinfo");return!m.isPrivate&&c!=!0&&(P.kid=v.jws.JWS.getJWKthumbprint(P)),E!=null&&l!=!0&&(P.x5c=[p(E)]),E!=null&&d!=!0&&(P.x5t=Hs(p(N(E,"sha1")))),E!=null&&g!=!0&&(P["x5t#S256"]=Hs(p(N(E,"sha256")))),P},nt.getJWKFromKey=function(s){return nt.getJWK(s,!0,!0,!0,!0)},Ke.getPosArrayOfChildrenFromHex=function(s){return ke.getChildIdx(s,0)},Ke.getHexValueArrayOfChildrenFromHex=function(s){var c=ke,l=c.getV,C=Ke.getPosArrayOfChildrenFromHex(s),d=l(s,C[0]),g=l(s,C[1]),m=l(s,C[2]),P=l(s,C[3]),E=l(s,C[4]),N=l(s,C[5]),A=l(s,C[6]),j=l(s,C[7]),O=l(s,C[8]),C=new Array;return C.push(d,g,m,P,E,N,A,j,O),C},Ke.prototype.readPrivateKeyFromPEMString=function(s){var c=Bt(s),l=Ke.getHexValueArrayOfChildrenFromHex(c);this.setPrivateEx(l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},Ke.prototype.readPKCS5PrvKeyHex=function(s){var c=Ke.getHexValueArrayOfChildrenFromHex(s);this.setPrivateEx(c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},Ke.prototype.readPKCS8PrvKeyHex=function(s){var c,l,d,g,m,P,E,N,A=ke,j=A.getVbyListEx;if(A.isASN1HEX(s)===!1)throw new Error("not ASN.1 hex string");try{c=j(s,0,[2,0,1],"02"),l=j(s,0,[2,0,2],"02"),d=j(s,0,[2,0,3],"02"),g=j(s,0,[2,0,4],"02"),m=j(s,0,[2,0,5],"02"),P=j(s,0,[2,0,6],"02"),E=j(s,0,[2,0,7],"02"),N=j(s,0,[2,0,8],"02")}catch{throw new Error("malformed PKCS#8 plain RSA private key")}this.setPrivateEx(c,l,d,g,m,P,E,N)},Ke.prototype.readPKCS5PubKeyHex=function(s){var c=ke,l=c.getV;if(c.isASN1HEX(s)===!1)throw new Error("keyHex is not ASN.1 hex string");var d=c.getChildIdx(s,0);if(d.length!==2||s.substr(d[0],2)!=="02"||s.substr(d[1],2)!=="02")throw new Error("wrong hex for PKCS#5 public key");var g=l(s,d[0]),m=l(s,d[1]);this.setPublic(g,m)},Ke.prototype.readPKCS8PubKeyHex=function(s){var c=ke;if(c.isASN1HEX(s)===!1)throw new Error("not ASN.1 hex string");if(c.getTLVbyListEx(s,0,[0,0])!=="06092a864886f70d010101")throw new Error("not PKCS8 RSA public key");var l=c.getTLVbyListEx(s,0,[1,0]);this.readPKCS5PubKeyHex(l)},Ke.prototype.readCertPubKeyHex=function(s,c){var l,d;l=new He,l.readCertHex(s),d=l.getPublicKeyHex(),this.readPKCS8PubKeyHex(d)};function Bf(s,c){for(var l="",d=c/4-s.length,g=0;g<d;g++)l=l+"0";return l+s}Ke.prototype.sign=function(s,c){var l=function(g){return v.crypto.Util.hashString(g,c)},d=l(s);return this.signWithMessageHash(d,c)},Ke.prototype.signWithMessageHash=function(s,c){var l=v.crypto.Util.getPaddedDigestInfoHex(s,c,this.n.bitLength()),d=jn(l,16),g=this.doPrivate(d),m=g.toString(16);return Bf(m,this.n.bitLength())};function Uf(s,c,l){for(var d="",g=0;d.length<c;)d+=Un(l(Gr(s+String.fromCharCode.apply(String,[(g&4278190080)>>24,(g&16711680)>>16,(g&65280)>>8,g&255])))),g+=1;return d}Ke.prototype.signPSS=function(s,c,l){var d=function(m){return v.crypto.Util.hashHex(m,c)},g=d(Gr(s));return l===void 0&&(l=-1),this.signWithMessageHashPSS(g,c,l)},Ke.prototype.signWithMessageHashPSS=function(s,c,l){var d=Un(s),g=d.length,m=this.n.bitLength()-1,P=Math.ceil(m/8),E,N=function(M){return v.crypto.Util.hashHex(M,c)};if(l===-1||l===void 0)l=g;else if(l===-2)l=P-g-2;else if(l<-2)throw new Error("invalid salt length");if(P<g+l+2)throw new Error("data too long");var A="";l>0&&(A=new Array(l),new Us().nextBytes(A),A=String.fromCharCode.apply(String,A));var j=Un(N(Gr("\0\0\0\0\0\0\0\0"+d+A))),O=[];for(E=0;E<P-l-g-2;E+=1)O[E]=0;var C=String.fromCharCode.apply(String,O)+""+A,I=Uf(j,C.length,N),T=[];for(E=0;E<C.length;E+=1)T[E]=C.charCodeAt(E)^I.charCodeAt(E);var D=65280>>8*P-m&255;for(T[0]&=~D,E=0;E<g;E++)T.push(j.charCodeAt(E));return T.push(188),Bf(this.doPrivate(new _(T)).toString(16),this.n.bitLength())};function Hf(s){for(var c in v.crypto.Util.DIGESTINFOHEAD){var l=v.crypto.Util.DIGESTINFOHEAD[c],d=l.length;if(s.substring(0,d)==l){var g=[c,s.substring(d)];return g}}return[]}Ke.prototype.verify=function(s,c){if(c=c.toLowerCase(),c.match(/^[0-9a-f]+$/)==null)return!1;var l=jn(c,16),d=this.n.bitLength();if(l.bitLength()>d)return!1;var g=this.doPublic(l),m=g.toString(16);if(m.length+3!=d/4)return!1;var P=m.replace(/^1f+00/,""),E=Hf(P);if(E.length==0)return!1;var N=E[0],A=E[1],j=function(C){return v.crypto.Util.hashString(C,N)},O=j(s);return A==O},Ke.prototype.verifyWithMessageHash=function(s,c){if(c.length!=Math.ceil(this.n.bitLength()/4))return!1;var l=jn(c,16);if(l.bitLength()>this.n.bitLength())return 0;var d=this.doPublic(l),g=d.toString(16).replace(/^1f+00/,""),m=Hf(g);if(m.length==0)return!1;m[0];var P=m[1];return P==s},Ke.prototype.verifyPSS=function(s,c,l,d){var g=function(P){return v.crypto.Util.hashHex(P,l)},m=g(Gr(s));return d===void 0&&(d=-1),this.verifyWithMessageHashPSS(m,c,l,d)},Ke.prototype.verifyWithMessageHashPSS=function(s,c,l,d){if(c.length!=Math.ceil(this.n.bitLength()/4))return!1;var g=new _(c,16),m=function(te){return v.crypto.Util.hashHex(te,l)},P=Un(s),E=P.length,N=this.n.bitLength()-1,A=Math.ceil(N/8),j;if(d===-1||d===void 0)d=E;else if(d===-2)d=A-E-2;else if(d<-2)throw new Error("invalid salt length");if(A<E+d+2)throw new Error("data too long");var O=this.doPublic(g).toByteArray();for(j=0;j<O.length;j+=1)O[j]&=255;for(;O.length<A;)O.unshift(0);if(O[A-1]!==188)throw new Error("encoded message does not end in 0xbc");O=String.fromCharCode.apply(String,O);var C=O.substr(0,A-E-1),I=O.substr(C.length,E),T=65280>>8*A-N&255;if(C.charCodeAt(0)&T)throw new Error("bits beyond keysize not zero");var D=Uf(I,C.length,m),M=[];for(j=0;j<C.length;j+=1)M[j]=C.charCodeAt(j)^D.charCodeAt(j);M[0]&=~T;var H=A-E-d-2;for(j=0;j<H;j+=1)if(M[j]!==0)throw new Error("leftmost octets not zero");if(M[H]!==1)throw new Error("0x01 marker not found");return I===Un(m(Gr("\0\0\0\0\0\0\0\0"+P+String.fromCharCode.apply(String,M.slice(-d)))))},Ke.SALT_LEN_HLEN=-1,Ke.SALT_LEN_MAX=-2,Ke.SALT_LEN_RECOVER=-2;function He(s){var c=ke,l=c.getChildIdx,d=c.getV;c.dump;var g=c.parse,m=c.getTLV,P=c.getVbyList,E=c.getVbyListEx,N=c.getTLVbyList,A=c.getTLVbyListEx,j=c.getIdxbyList,O=c.getIdxbyListEx,C=c.getVidx,I=c.getInt,T=c.oidname,D=c.hextooidstr,M=Bt,H,te=Error;try{H=v.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch{}this.HEX2STAG={"0c":"utf8",13:"prn",16:"ia5","1a":"vis","1e":"bmp"},this.hex=null,this.version=0,this.foffset=0,this.aExtInfo=null,this.getVersion=function(){if(this.hex===null||this.version!==0)return this.version;var V=N(this.hex,0,[0,0]);if(V.substr(0,2)=="a0"){var $=N(V,0,[0]),Z=I($,0);if(Z<0||2<Z)throw new Error("malformed version field");return this.version=Z+1,this.version}else return this.version=1,this.foffset=-1,1},this.getSerialNumberHex=function(){return E(this.hex,0,[0,0],"02")},this.getSignatureAlgorithmField=function(){var V=A(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(V)},this.getAlgorithmIdentifierName=function(V){for(var $ in H)if(V===H[$])return $;return T(E(V,0,[0],"06"))},this.getIssuer=function(V,$){return this.getX500Name(this.getIssuerHex(),V,$)},this.getIssuerHex=function(){return N(this.hex,0,[0,3+this.foffset],"30")},this.getIssuerString=function(){var V=this.getIssuer();return V.str},this.getSubject=function(V,$){return this.getX500Name(this.getSubjectHex(),V,$)},this.getSubjectHex=function(){return N(this.hex,0,[0,5+this.foffset],"30")},this.getSubjectString=function(){var V=this.getSubject();return V.str},this.getNotBefore=function(){var V=P(this.hex,0,[0,4+this.foffset,0]);return V=V.replace(/(..)/g,"%$1"),V=decodeURIComponent(V),V},this.getNotAfter=function(){var V=P(this.hex,0,[0,4+this.foffset,1]);return V=V.replace(/(..)/g,"%$1"),V=decodeURIComponent(V),V},this.getPublicKeyHex=function(){return this.getSPKI()},this.getSPKI=function(){return N(this.hex,0,[0,6+this.foffset],"30")},this.getSPKIValue=function(){var V=this.getSPKI();return V==null?null:P(V,0,[1],"03",!0)},this.getPublicKeyIdx=function(){return j(this.hex,0,[0,6+this.foffset],"30")},this.getPublicKeyContentIdx=function(){var V=this.getPublicKeyIdx();return j(this.hex,V,[1,0],"30")},this.getPublicKey=function(){return nt.getKey(this.getPublicKeyHex(),null,"pkcs8pub")},this.getSignatureAlgorithmName=function(){var V=N(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(V)},this.getSignatureValueHex=function(){return P(this.hex,0,[2],"03",!0)},this.verifySignature=function(V){var $=this.getSignatureAlgorithmField(),Z=this.getSignatureValueHex(),q=N(this.hex,0,[0],"30"),Y=new v.crypto.Signature({alg:$});return Y.init(V),Y.updateHex(q),Y.verify(Z)},this.parseExt=function(V){var $,Z,q;if(V===void 0){if(q=this.hex,this.version!==3)return-1;$=j(q,0,[0,7,0],"30"),Z=l(q,$)}else{q=Bt(V);var Y=j(q,0,[0,3,0,0],"06");if(d(q,Y)!="2a864886f70d01090e"){this.aExtInfo=new Array;return}$=j(q,0,[0,3,0,1,0],"30"),Z=l(q,$),this.hex=q}this.aExtInfo=new Array;for(var se=0;se<Z.length;se++){var ue={};ue.critical=!1;var be=l(q,Z[se]),le=0;be.length===3&&(ue.critical=!0,le=1),ue.oid=c.hextooidstr(P(q,Z[se],[0],"06"));var pe=j(q,Z[se],[1+le]);ue.vidx=C(q,pe),this.aExtInfo.push(ue)}},this.getExtInfo=function(V){var $=this.aExtInfo,Z=V;if(V.match(/^[0-9.]+$/)||(Z=v.asn1.x509.OID.name2oid(V)),Z!==""){for(var q=0;q<$.length;q++)if($[q].oid===Z)return $[q]}},this.getCriticalExtV=function(V,$,Z){if($!=null)return[$,Z];var q=this.getExtInfo(V);return q==null?[null,null]:[m(this.hex,q.vidx),q.critical]},this.getExtBasicConstraints=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("basicConstraints");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"basicConstraints"};if($&&(q.critical=!0),V==="3000")return q;if(V==="30030101ff")return q.cA=!0,q;if(V.substr(0,12)==="30060101ff02"){var Y=d(V,10),se=parseInt(Y,16);return q.cA=!0,q.pathLen=se,q}throw new Error("hExtV parse error: "+V)},this.getExtNameConstraints=function(V,$){var Z=this.getCriticalExtV("nameConstraints",V,$);if(V=Z[0],$=Z[1],V!=null){var q={extname:"nameConstraints"};$&&(q.critical=!0);for(var Y=l(V,0),se=0;se<Y.length;se++){for(var ue=[],be=l(V,Y[se]),le=0;le<be.length;le++){var pe=m(V,be[le]),Se=this.getGeneralSubtree(pe);ue.push(Se)}var Ce=V.substr(Y[se],2);Ce=="a0"?q.permit=ue:Ce=="a1"&&(q.exclude=ue)}return q}},this.getGeneralSubtree=function(V){var $=l(V,0),Z=$.length;if(Z<1||2<Z)throw new Error("wrong num elements");for(var q=this.getGeneralName(m(V,$[0])),Y=1;Y<Z;Y++){var se=V.substr($[Y],2),ue=d(V,$[Y]),be=parseInt(ue,16);se=="80"&&(q.min=be),se=="81"&&(q.max=be)}return q},this.getExtKeyUsage=function(V,$){var Z=this.getCriticalExtV("keyUsage",V,$);if(V=Z[0],$=Z[1],V!=null){var q={extname:"keyUsage"};return $&&(q.critical=!0),q.names=this.getExtKeyUsageString(V).split(","),q}},this.getExtKeyUsageBin=function(V){if(V===void 0){var $=this.getExtInfo("keyUsage");if($===void 0)return"";V=m(this.hex,$.vidx)}if(V.length!=8&&V.length!=10)throw new Error("malformed key usage value: "+V);var Z="000000000000000"+parseInt(V.substr(6),16).toString(2);return V.length==8&&(Z=Z.slice(-8)),V.length==10&&(Z=Z.slice(-16)),Z=Z.replace(/0+$/,""),Z==""&&(Z="0"),Z},this.getExtKeyUsageString=function(V){for(var $=this.getExtKeyUsageBin(V),Z=new Array,q=0;q<$.length;q++)$.substr(q,1)=="1"&&Z.push(He.KEYUSAGE_NAME[q]);return Z.join(",")},this.getExtSubjectKeyIdentifier=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("subjectKeyIdentifier");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"subjectKeyIdentifier"};$&&(q.critical=!0);var Y=d(V,0);return q.kid={hex:Y},q},this.getExtAuthorityKeyIdentifier=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("authorityKeyIdentifier");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"authorityKeyIdentifier"};$&&(q.critical=!0);for(var Y=l(V,0),se=0;se<Y.length;se++){var ue=V.substr(Y[se],2);if(ue==="80"&&(q.kid={hex:d(V,Y[se])}),ue==="a1"){var be=m(V,Y[se]),le=this.getGeneralNames(be);q.issuer=le[0].dn}ue==="82"&&(q.sn={hex:d(V,Y[se])})}return q},this.getExtExtKeyUsage=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("extKeyUsage");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"extKeyUsage",array:[]};$&&(q.critical=!0);for(var Y=l(V,0),se=0;se<Y.length;se++)q.array.push(T(d(V,Y[se])));return q},this.getExtExtKeyUsageName=function(){var V=this.getExtInfo("extKeyUsage");if(V===void 0)return V;var $=new Array,Z=m(this.hex,V.vidx);if(Z==="")return $;for(var q=l(Z,0),Y=0;Y<q.length;Y++)$.push(T(d(Z,q[Y])));return $},this.getExtSubjectAltName=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("subjectAltName");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"subjectAltName",array:[]};return $&&(q.critical=!0),q.array=this.getGeneralNames(V),q},this.getExtIssuerAltName=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("issuerAltName");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"issuerAltName",array:[]};return $&&(q.critical=!0),q.array=this.getGeneralNames(V),q},this.getGeneralNames=function(V){for(var $=l(V,0),Z=[],q=0;q<$.length;q++){var Y=this.getGeneralName(m(V,$[q]));Y!==void 0&&Z.push(Y)}return Z},this.getGeneralName=function(V){var $=V.substr(0,2),Z=d(V,0),q=Un(Z);if($=="81")return{rfc822:q};if($=="82")return{dns:q};if($=="86")return{uri:q};if($=="87")return{ip:bc(Z)};if($=="a4")return{dn:this.getX500Name(Z)};if($=="a0")return{other:this.getOtherName(V)}},this.getExtSubjectAltName2=function(){var V,$,Z,q=this.getExtInfo("subjectAltName");if(q===void 0)return q;for(var Y=new Array,se=m(this.hex,q.vidx),ue=l(se,0),be=0;be<ue.length;be++)Z=se.substr(ue[be],2),V=d(se,ue[be]),Z==="81"&&($=ft(V),Y.push(["MAIL",$])),Z==="82"&&($=ft(V),Y.push(["DNS",$])),Z==="84"&&($=He.hex2dn(V,0),Y.push(["DN",$])),Z==="86"&&($=ft(V),Y.push(["URI",$])),Z==="87"&&($=bc(V),Y.push(["IP",$]));return Y},this.getExtCRLDistributionPoints=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("cRLDistributionPoints");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"cRLDistributionPoints",array:[]};$&&(q.critical=!0);for(var Y=l(V,0),se=0;se<Y.length;se++){var ue=m(V,Y[se]);q.array.push(this.getDistributionPoint(ue))}return q},this.getDistributionPoint=function(V){for(var $={},Z=l(V,0),q=0;q<Z.length;q++){var Y=V.substr(Z[q],2),se=m(V,Z[q]);Y=="a0"&&($.dpname=this.getDistributionPointName(se))}return $},this.getDistributionPointName=function(V){for(var $={},Z=l(V,0),q=0;q<Z.length;q++){var Y=V.substr(Z[q],2),se=m(V,Z[q]);Y=="a0"&&($.full=this.getGeneralNames(se))}return $},this.getExtCRLDistributionPointsURI=function(){var V=this.getExtCRLDistributionPoints();if(V==null)return V;for(var $=V.array,Z=[],q=0;q<$.length;q++)try{$[q].dpname.full[0].uri!=null&&Z.push($[q].dpname.full[0].uri)}catch{}return Z},this.getExtAIAInfo=function(){var V=this.getExtInfo("authorityInfoAccess");if(V===void 0)return V;for(var $={ocsp:[],caissuer:[]},Z=l(this.hex,V.vidx),q=0;q<Z.length;q++){var Y=P(this.hex,Z[q],[0],"06"),se=P(this.hex,Z[q],[1],"86");Y==="2b06010505073001"&&$.ocsp.push(ft(se)),Y==="2b06010505073002"&&$.caissuer.push(ft(se))}return $},this.getExtAuthorityInfoAccess=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("authorityInfoAccess");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"authorityInfoAccess",array:[]};$&&(q.critical=!0);for(var Y=l(V,0),se=0;se<Y.length;se++){var ue=E(V,Y[se],[0],"06"),be=P(V,Y[se],[1],"86"),le=ft(be);if(ue=="2b06010505073001")q.array.push({ocsp:le});else if(ue=="2b06010505073002")q.array.push({caissuer:le});else throw new Error("unknown method: "+ue)}return q},this.getExtCertificatePolicies=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("certificatePolicies");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"certificatePolicies",array:[]};$&&(q.critical=!0);for(var Y=l(V,0),se=0;se<Y.length;se++){var ue=m(V,Y[se]),be=this.getPolicyInformation(ue);q.array.push(be)}return q},this.getPolicyInformation=function(V){var $={},Z=P(V,0,[0],"06");$.policyoid=T(Z);var q=O(V,0,[1],"30");if(q!=-1){$.array=[];for(var Y=l(V,q),se=0;se<Y.length;se++){var ue=m(V,Y[se]),be=this.getPolicyQualifierInfo(ue);$.array.push(be)}}return $},this.getOtherName=function(V){var $={},Z=l(V,0),q=P(V,Z[0],[],"06"),Y=P(V,Z[1],[]);return $.oid=T(q),$.value=g(Y),$},this.getPolicyQualifierInfo=function(V){var $={},Z=P(V,0,[0],"06");if(Z==="2b06010505070201"){var q=E(V,0,[1],"16");$.cps=Un(q)}else if(Z==="2b06010505070202"){var Y=N(V,0,[1],"30");$.unotice=this.getUserNotice(Y)}return $},this.getUserNotice=function(V){var $=null;try{$=c.parse(V);var Z=this._asn1ToUnotice($);return Z}catch{return}},this._asn1ToUnotice=function(V){try{for(var $={},Z=_t(V,"seq"),q=0;q<Z.length;q++){var Y=this._asn1ToNoticeRef(Z[q]);Y!=null&&($.noticeref=Y);var se=this.asn1ToDisplayText(Z[q]);se!=null&&($.exptext=se)}return Object.keys($).length>0?$:void 0}catch{return}},this._asn1ToNoticeRef=function(V){try{for(var $={},Z=_t(V,"seq"),q=0;q<Z.length;q++){var Y=this._asn1ToNoticeNum(Z[q]);Y!=null&&($.noticenum=Y);var se=this.asn1ToDisplayText(Z[q]);se!=null&&($.org=se)}return Object.keys($).length>0?$:void 0}catch{return}},this._asn1ToNoticeNum=function(V){try{for(var $=_t(V,"seq"),Z=[],q=0;q<$.length;q++){var Y=$[q];Z.push(parseInt(_t(Y,"int.hex"),16))}return Z}catch{return}},this.getDisplayText=function(V){var $={"0c":"utf8",16:"ia5","1a":"vis","1e":"bmp"},Z={};return Z.type=$[V.substr(0,2)],Z.str=Un(d(V,0)),Z},this.asn1ToDisplayText=function(V){if(V.utf8str!=null)return{type:"utf8",str:V.utf8str.str};if(V.ia5str!=null)return{type:"ia5",str:V.ia5str.str};if(V.visstr!=null)return{type:"vis",str:V.visstr.str};if(V.bmpstr!=null)return{type:"bmp",str:V.bmpstr.str};if(V.prnstr!=null)return{type:"prn",str:V.prnstr.str}},this.getExtPolicyMappings=function(V,$){var Z=this.getCriticalExtV("policyMappings",V,$);if(V=Z[0],$=Z[1],V!=null){var q={extname:"policyMappings"};$&&(q.critical=!0);try{for(var Y=g(V),se=Y.seq,ue=[],be=0;be<se.length;be++){var le=se[be].seq;ue.push([le[0].oid,le[1].oid])}q.array=ue}catch{throw new te("malformed policyMappings")}return q}},this.getExtPolicyConstraints=function(V,$){var Z=this.getCriticalExtV("policyConstraints",V,$);if(V=Z[0],$=Z[1],V!=null){var q={extname:"policyConstraints"};$&&(q.critical=!0);var Y=g(V);try{for(var se=Y.seq,ue=0;ue<se.length;ue++){var be=se[ue].tag;be.explicit==!1&&(be.tag=="80"&&(q.reqexp=parseInt(be.hex,16)),be.tag=="81"&&(q.inhibit=parseInt(be.hex,16)))}}catch{return new te("malformed policyConstraints value")}return q}},this.getExtInhibitAnyPolicy=function(V,$){var Z=this.getCriticalExtV("inhibitAnyPolicy",V,$);if(V=Z[0],$=Z[1],V!=null){var q={extname:"inhibitAnyPolicy"};$&&(q.critical=!0);var Y=I(V,0);return Y==-1?new te("wrong value"):(q.skip=Y,q)}},this.getExtCRLNumber=function(V,$){var Z={extname:"cRLNumber"};if($&&(Z.critical=!0),V.substr(0,2)=="02")return Z.num={hex:d(V,0)},Z;throw new te("hExtV parse error: "+V)},this.getExtCRLReason=function(V,$){var Z={extname:"cRLReason"};if($&&(Z.critical=!0),V.substr(0,2)=="0a")return Z.code=parseInt(d(V,0),16),Z;throw new Error("hExtV parse error: "+V)},this.getExtOcspNonce=function(V,$){var Z={extname:"ocspNonce"};$&&(Z.critical=!0);var q=d(V,0);return Z.hex=q,Z},this.getExtOcspNoCheck=function(V,$){var Z={extname:"ocspNoCheck"};return $&&(Z.critical=!0),Z},this.getExtAdobeTimeStamp=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("adobeTimeStamp");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"adobeTimeStamp"};$&&(q.critical=!0);var Y=l(V,0);if(Y.length>1){var se=m(V,Y[1]),ue=this.getGeneralName(se);ue.uri!=null&&(q.uri=ue.uri)}if(Y.length>2){var be=m(V,Y[2]);be=="0101ff"&&(q.reqauth=!0),be=="010100"&&(q.reqauth=!1)}return q},this.getExtSubjectDirectoryAttributes=function(V,$){if(V===void 0&&$===void 0){var Z=this.getExtInfo("subjectDirectoryAttributes");if(Z===void 0)return;V=m(this.hex,Z.vidx),$=Z.critical}var q={extname:"subjectDirectoryAttributes"};$&&(q.critical=!0);try{for(var Y=g(V),se=[],ue=0;ue<Y.seq.length;ue++){var be=Y.seq[ue],le=_t(be,"seq.0.oid"),pe=_t(be,"seq.1.set");if(le==null||pe==null)throw"error";se.push({attr:le,array:pe})}return q.array=se,q}catch{throw new Error("malformed subjectDirectoryAttributes extension value")}};var ie=function(V){var $={};try{var Z=V.seq[0].oid,q=v.asn1.x509.OID.name2oid(Z);$.type=v.asn1.x509.OID.oid2atype(q);var Y=V.seq[1];if(Y.utf8str!=null)$.ds="utf8",$.value=Y.utf8str.str;else if(Y.numstr!=null)$.ds="num",$.value=Y.numstr.str;else if(Y.telstr!=null)$.ds="tel",$.value=Y.telstr.str;else if(Y.prnstr!=null)$.ds="prn",$.value=Y.prnstr.str;else if(Y.ia5str!=null)$.ds="ia5",$.value=Y.ia5str.str;else if(Y.visstr!=null)$.ds="vis",$.value=Y.visstr.str;else if(Y.bmpstr!=null)$.ds="bmp",$.value=Y.bmpstr.str;else throw"error";return $}catch{throw new Erorr("improper ASN.1 parsed AttrTypeAndValue")}},re=function(V){try{return V.set.map(function($){return ie($)})}catch($){throw new Error("improper ASN.1 parsed RDN: "+$)}},ae=function(V){try{return V.seq.map(function($){return re($)})}catch($){throw new Error("improper ASN.1 parsed X500Name: "+$)}};this.getX500NameRule=function(V){for(var $=null,Z=[],q=0;q<V.length;q++)for(var Y=V[q],se=0;se<Y.length;se++)Z.push(Y[se]);for(var q=0;q<Z.length;q++){var ue=Z[q],be=ue.ds,le=ue.value,pe=ue.type;if(be!="prn"&&be!="utf8"&&be!="ia5")return"mixed";if(be=="ia5"){if(pe!="CN")return"mixed";if(v.lang.String.isMail(le))continue;return"mixed"}if(pe=="C"){if(be=="prn")continue;return"mixed"}if($==null)$=be;else if($!==be)return"mixed"}return $??"prn"},this.getAttrTypeAndValue=function(V){var $=g(V);return ie($)},this.getRDN=function(V){var $=g(V);return re($)},this.getX500NameArray=function(V){var $=g(V);return ae($)},this.getX500Name=function(V,$,Z){var q=this.getX500NameArray(V),Y=this.dnarraytostr(q),se={str:Y};return se.array=q,Z==!0&&(se.hex=V),$==!0&&(se.canon=this.c14nRDNArray(q)),se},this.readCertPEM=function(V){this.readCertHex(M(V))},this.readCertHex=function(V){this.hex=V,this.getVersion();try{j(this.hex,0,[0,7],"a3"),this.parseExt()}catch{}},this.getParam=function(V){var $={};return V==null&&(V={}),$.version=this.getVersion(),$.serial={hex:this.getSerialNumberHex()},$.sigalg=this.getSignatureAlgorithmField(),$.issuer=this.getIssuer(V.dncanon,V.dnhex),$.notbefore=this.getNotBefore(),$.notafter=this.getNotAfter(),$.subject=this.getSubject(V.dncanon,V.dnhex),$.sbjpubkey=mn(this.getPublicKeyHex(),"PUBLIC KEY"),this.aExtInfo!=null&&this.aExtInfo.length>0&&($.ext=this.getExtParamArray()),$.sighex=this.getSignatureValueHex(),V.tbshex==!0&&($.tbshex=N(this.hex,0,[0])),V.nodnarray==!0&&(delete $.issuer.array,delete $.subject.array),$},this.getExtParamArray=function(V){if(V==null){var $=O(this.hex,0,[0,"[3]"]);$!=-1&&(V=A(this.hex,0,[0,"[3]",0],"30"))}for(var Z=[],q=l(V,0),Y=0;Y<q.length;Y++){var se=m(V,q[Y]),ue=this.getExtParam(se);ue!=null&&Z.push(ue)}return Z},this.getExtParam=function(V){var $=l(V,0),Z=$.length;if(Z!=2&&Z!=3)throw new Error("wrong number elements in Extension: "+Z+" "+V);var q=D(P(V,0,[0],"06")),Y=!1;Z==3&&N(V,0,[1])=="0101ff"&&(Y=!0);var se=N(V,0,[Z-1,0]),ue=void 0;if(q=="2.5.29.14"?ue=this.getExtSubjectKeyIdentifier(se,Y):q=="2.5.29.15"?ue=this.getExtKeyUsage(se,Y):q=="2.5.29.17"?ue=this.getExtSubjectAltName(se,Y):q=="2.5.29.18"?ue=this.getExtIssuerAltName(se,Y):q=="2.5.29.19"?ue=this.getExtBasicConstraints(se,Y):q=="2.5.29.30"?ue=this.getExtNameConstraints(se,Y):q=="2.5.29.31"?ue=this.getExtCRLDistributionPoints(se,Y):q=="2.5.29.32"?ue=this.getExtCertificatePolicies(se,Y):q=="2.5.29.33"?ue=this.getExtPolicyMappings(se,Y):q=="2.5.29.35"?ue=this.getExtAuthorityKeyIdentifier(se,Y):q=="2.5.29.36"?ue=this.getExtPolicyConstraints(se,Y):q=="2.5.29.37"?ue=this.getExtExtKeyUsage(se,Y):q=="2.5.29.54"?ue=this.getExtInhibitAnyPolicy(se,Y):q=="1.3.6.1.5.5.7.1.1"?ue=this.getExtAuthorityInfoAccess(se,Y):q=="2.5.29.20"?ue=this.getExtCRLNumber(se,Y):q=="2.5.29.21"?ue=this.getExtCRLReason(se,Y):q=="2.5.29.9"?ue=this.getExtSubjectDirectoryAttributes(se,Y):q=="1.3.6.1.5.5.7.48.1.2"?ue=this.getExtOcspNonce(se,Y):q=="1.3.6.1.5.5.7.48.1.5"?ue=this.getExtOcspNoCheck(se,Y):q=="1.2.840.113583.1.1.9.1"?ue=this.getExtAdobeTimeStamp(se,Y):He.EXT_PARSER[q]!=null&&(ue=He.EXT_PARSER[q](q,Y,se)),ue!=null)return ue;var be={extname:q,extn:se};try{be.extn=g(se)}catch{}return Y&&(be.critical=!0),be},this.findExt=function(V,$){for(var Z=0;Z<V.length;Z++)if(V[Z].extname==$)return V[Z];return null},this.updateExtCDPFullURI=function(V,$){var Z=this.findExt(V,"cRLDistributionPoints");if(Z!=null&&Z.array!=null){for(var q=Z.array,Y=0;Y<q.length;Y++)if(q[Y].dpname!=null&&q[Y].dpname.full!=null)for(var se=q[Y].dpname.full,ue=0;ue<se.length;ue++){var be=se[Y];be.uri!=null&&(be.uri=$)}}},this.updateExtAIAOCSP=function(V,$){var Z=this.findExt(V,"authorityInfoAccess");if(Z!=null&&Z.array!=null)for(var q=Z.array,Y=0;Y<q.length;Y++)q[Y].ocsp!=null&&(q[Y].ocsp=$)},this.updateExtAIACAIssuer=function(V,$){var Z=this.findExt(V,"authorityInfoAccess");if(Z!=null&&Z.array!=null)for(var q=Z.array,Y=0;Y<q.length;Y++)q[Y].caissuer!=null&&(q[Y].caissuer=$)},this.dnarraytostr=function(V){function $(q){return q.map(function(Y){return Z(Y).replace(/\+/,"\\+")}).join("+")}function Z(q){return q.type+"="+q.value}return"/"+V.map(function(q){return $(q).replace(/\//,"\\/")}).join("/")},this.setCanonicalizedDN=function(V){var $;if(V.str!=null&&V.array==null){var Z=new v.asn1.x509.X500Name({str:V.str}),q=Z.tohex();$=this.getX500NameArray(q)}else $=V.array;V.canon==null&&(V.canon=this.c14nRDNArray($))},this.c14nRDNArray=function(V){for(var $=[],Z=0;Z<V.length;Z++){for(var q=V[Z],Y=[],se=0;se<q.length;se++){var ue=q[se],be=ue.value;be=be.replace(/^\s*/,""),be=be.replace(/\s*$/,""),be=be.replace(/\s+/g," "),be=be.toLowerCase(),Y.push(ue.type.toLowerCase()+"="+be)}$.push(Y.join("+"))}return"/"+$.join("/")},this.getInfo=function(){var V=function(Pn){for(var st="",gt="    ",Ft=`
`,Dt=Pn.array,Hn=0;Hn<Dt.length;Hn++){var Ut=Dt[Hn];if(Ut.dn!=null&&(st+=gt+"dn: "+Ut.dn.str+Ft),Ut.ip!=null&&(st+=gt+"ip: "+Ut.ip+Ft),Ut.rfc822!=null&&(st+=gt+"rfc822: "+Ut.rfc822+Ft),Ut.dns!=null&&(st+=gt+"dns: "+Ut.dns+Ft),Ut.uri!=null&&(st+=gt+"uri: "+Ut.uri+Ft),Ut.other!=null){var Ha=Ut.other.oid,as=JSON.stringify(Ut.other.value).replace(/\"/g,"");st+=gt+"other: "+Ha+"="+as+Ft}}return st=st.replace(/\n$/,""),st},$=function(Pn){for(var st="",gt=Pn.array,Ft=0;Ft<gt.length;Ft++){var Dt=gt[Ft];if(st+="    policy oid: "+Dt.policyoid+`
`,Dt.array!==void 0)for(var Hn=0;Hn<Dt.array.length;Hn++){var Ut=Dt.array[Hn];Ut.cps!==void 0&&(st+="    cps: "+Ut.cps+`
`)}}return st},Z=function(Pn){for(var st="",gt=Pn.array,Ft=0;Ft<gt.length;Ft++){var Dt=gt[Ft];try{Dt.dpname.full[0].uri!==void 0&&(st+="    "+Dt.dpname.full[0].uri+`
`)}catch{}try{Dt.dname.full[0].dn.hex!==void 0&&(st+="    "+He.hex2dn(Dt.dpname.full[0].dn.hex)+`
`)}catch{}}return st},q=function(Pn){for(var st="",gt=Pn.array,Ft=0;Ft<gt.length;Ft++){var Dt=gt[Ft];Dt.caissuer!==void 0&&(st+="    caissuer: "+Dt.caissuer+`
`),Dt.ocsp!==void 0&&(st+="    ocsp: "+Dt.ocsp+`
`)}return st},Y,se,ue;if(Y=`Basic Fields
`,Y+="  serial number: "+this.getSerialNumberHex()+`
`,Y+="  signature algorithm: "+this.getSignatureAlgorithmField()+`
`,Y+="  issuer: "+this.getIssuerString()+`
`,Y+="  notBefore: "+this.getNotBefore()+`
`,Y+="  notAfter: "+this.getNotAfter()+`
`,Y+="  subject: "+this.getSubjectString()+`
`,Y+=`  subject public key info: 
`,se=this.getPublicKey(),Y+="    key algorithm: "+se.type+`
`,se.type==="RSA"&&(Y+="    n="+rd(se.n.toString(16)).substr(0,16)+`...
`,Y+="    e="+rd(se.e.toString(16))+`
`),ue=this.aExtInfo,ue!=null){Y+=`X509v3 Extensions:
`;for(var be=0;be<ue.length;be++){var le=ue[be],pe=v.asn1.x509.OID.oid2name(le.oid);pe===""&&(pe=le.oid);var Se="";if(le.critical===!0&&(Se="CRITICAL"),Y+="  "+pe+" "+Se+`:
`,pe==="basicConstraints"){var Ce=this.getExtBasicConstraints();Ce.cA===void 0?Y+=`    {}
`:(Y+="    cA=true",Ce.pathLen!==void 0&&(Y+=", pathLen="+Ce.pathLen),Y+=`
`)}else if(pe=="policyMappings"){var gn=this.getExtPolicyMappings().array,It=gn.map(function(Pn){var st=Pn;return st[0]+":"+st[1]}).join(", ");Y+="    "+It+`
`}else if(pe=="policyConstraints"){var St=this.getExtPolicyConstraints();Y+="    ",St.reqexp!=null&&(Y+=" reqexp="+St.reqexp),St.inhibit!=null&&(Y+=" inhibit="+St.inhibit),Y+=`
`}else if(pe=="inhibitAnyPolicy"){var St=this.getExtInhibitAnyPolicy();Y+="    skip="+St.skip+`
`}else if(pe=="keyUsage")Y+="    "+this.getExtKeyUsageString()+`
`;else if(pe=="subjectKeyIdentifier")Y+="    "+this.getExtSubjectKeyIdentifier().kid.hex+`
`;else if(pe=="authorityKeyIdentifier"){var Kt=this.getExtAuthorityKeyIdentifier();Kt.kid!==void 0&&(Y+="    kid="+Kt.kid.hex+`
`)}else if(pe=="extKeyUsage"){var nn=this.getExtExtKeyUsage().array;Y+="    "+nn.join(", ")+`
`}else if(pe=="subjectAltName"){var cn=V(this.getExtSubjectAltName());Y+=cn+`
`}else if(pe=="cRLDistributionPoints"){var rn=this.getExtCRLDistributionPoints();Y+=Z(rn)}else if(pe=="authorityInfoAccess"){var Ua=this.getExtAuthorityInfoAccess();Y+=q(Ua)}else pe=="certificatePolicies"&&(Y+=$(this.getExtCertificatePolicies()))}}return Y+="signature algorithm: "+this.getSignatureAlgorithmName()+`
`,Y+="signature: "+this.getSignatureValueHex().substr(0,16)+`...
`,Y},typeof s=="string"&&(s.indexOf("-----BEGIN")!=-1?this.readCertPEM(s):v.lang.String.isHex(s)&&this.readCertHex(s))}He.EXT_PARSER={},He.registExtParser=function(s,c){He.EXT_PARSER[s]=c},He.hex2dn=function(s,c){c===void 0&&(c=0);var l=new He;ke.getTLV(s,c);var d=l.getX500Name(s);return d.str},He.hex2rdn=function(s,c){if(c===void 0&&(c=0),s.substr(c,2)!=="31")throw new Error("malformed RDN");for(var l=new Array,d=ke.getChildIdx(s,c),g=0;g<d.length;g++)l.push(He.hex2attrTypeValue(s,d[g]));return l=l.map(function(m){return m.replace("+","\\+")}),l.join("+")},He.hex2attrTypeValue=function(s,c){var l=ke,d=l.getV;if(c===void 0&&(c=0),s.substr(c,2)!=="30")throw new Error("malformed attribute type and value");var g=l.getChildIdx(s,c);g.length!==2||s.substr(g[0],2);var m=d(s,g[0]),P=v.asn1.ASN1Util.oidHexToInt(m),E=v.asn1.x509.OID.oid2atype(P),N=d(s,g[1]),A=Un(N);return E+"="+A},He.getPublicKeyFromCertHex=function(s){var c=new He;return c.readCertHex(s),c.getPublicKey()},He.getPublicKeyFromCertPEM=function(s){var c=new He;return c.readCertPEM(s),c.getPublicKey()},He.getPublicKeyInfoPropOfCertPEM=function(s){var c=ke,l=c.getVbyList,d={},g,m;return d.algparam=null,g=new He,g.readCertPEM(s),m=g.getPublicKeyHex(),d.keyhex=l(m,0,[1],"03").substr(2),d.algoid=l(m,0,[0,0],"06"),d.algoid==="2a8648ce3d0201"&&(d.algparam=l(m,0,[0,1],"06")),d},He.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];var Xb=function(s){var c=v,l=c.lang.String.isHex,d=ke,g=d.getV,m=d.getTLV,P=d.getVbyList,E=d.getTLVbyList,N=d.getTLVbyListEx,A=d.getIdxbyList,j=d.getIdxbyListEx,O=d.getChildIdx,C=new He;this.hex=null,this.posSigAlg=null,this.posRevCert=null,this.parsed=null,this._setPos=function(){var I=A(this.hex,0,[0,0]),T=this.hex.substr(I,2);if(T=="02")this.posSigAlg=1;else if(T=="30")this.posSigAlg=0;else throw new Error("malformed 1st item of TBSCertList: "+T);var D=A(this.hex,0,[0,this.posSigAlg+3]),M=this.hex.substr(D,2);if(M=="17"||M=="18"){var H,te;H=A(this.hex,0,[0,this.posSigAlg+4]),this.posRevCert=null,H!=-1&&(te=this.hex.substr(H,2),te=="30"&&(this.posRevCert=this.posSigAlg+4))}else if(M=="30")this.posRevCert=this.posSigAlg+3;else if(M=="a0")this.posRevCert=null;else throw new Error("malformed nextUpdate or revCert tag: "+M)},this.getVersion=function(){return this.posSigAlg==0?null:parseInt(P(this.hex,0,[0,0],"02"),16)+1},this.getSignatureAlgorithmField=function(){var I=E(this.hex,0,[0,this.posSigAlg],"30");return C.getAlgorithmIdentifierName(I)},this.getIssuer=function(){return C.getX500Name(this.getIssuerHex())},this.getIssuerHex=function(){return E(this.hex,0,[0,this.posSigAlg+1],"30")},this.getThisUpdate=function(){var I=P(this.hex,0,[0,this.posSigAlg+2]);return result=Un(I)},this.getNextUpdate=function(){var I=A(this.hex,0,[0,this.posSigAlg+3]),T=this.hex.substr(I,2);return T!="17"&&T!="18"?null:Un(g(this.hex,I))},this.getRevCertArray=function(){if(this.posRevCert==null)return null;for(var I=[],T=A(this.hex,0,[0,this.posRevCert]),D=O(this.hex,T),M=0;M<D.length;M++){var H=m(this.hex,D[M]);I.push(this.getRevCert(H))}return I},this.getRevCert=function(I){var T={},D=O(I,0);return T.sn={hex:P(I,0,[0],"02")},T.date=Un(P(I,0,[1])),D.length==3&&(T.ext=C.getExtParamArray(E(I,0,[2]))),T},this.findRevCert=function(I){var T=new He(I),D=T.getSerialNumberHex();return this.findRevCertBySN(D)},this.findRevCertBySN=function(I){if(this.parsed==null&&this.getParam(),this.parsed.revcert==null)return null;for(var T=this.parsed.revcert,D=0;D<T.length;D++)if(I==T[D].sn.hex)return T[D];return null},this.getSignatureValueHex=function(){return P(this.hex,0,[2],"03",!0)},this.verifySignature=function(I){var T=this.getSignatureAlgorithmField(),D=this.getSignatureValueHex(),M=E(this.hex,0,[0],"30"),H=new v.crypto.Signature({alg:T});return H.init(I),H.updateHex(M),H.verify(D)},this.getParam=function(I){var T={},D=this.getVersion();D!=null&&(T.version=D),T.sigalg=this.getSignatureAlgorithmField(),T.issuer=this.getIssuer(),T.thisupdate=this.getThisUpdate();var M=this.getNextUpdate();M!=null&&(T.nextupdate=M);var H=this.getRevCertArray();H!=null&&(T.revcert=H);var te=j(this.hex,0,[0,"[0]"]);if(te!=-1){var ie=N(this.hex,0,[0,"[0]",0]);T.ext=C.getExtParamArray(ie)}return T.sighex=this.getSignatureValueHex(),this.parsed=T,typeof I=="object"&&(I.tbshex==!0&&(T.tbshex=E(this.hex,0,[0])),I.nodnarray==!0&&delete T.issuer.array),T},typeof s=="string"&&(l(s)?this.hex=s:s.match(/-----BEGIN X509 CRL/)&&(this.hex=Bt(s)),this._setPos())};(typeof v>"u"||!v)&&(v={}),(typeof v.jws>"u"||!v.jws)&&(v.jws={}),v.jws.JWS=function(){var s=v,c=s.jws.JWS,l=c.isSafeJSONString;this.parseJWS=function(d,g){if(!(this.parsedJWS!==void 0&&(g||this.parsedJWS.sigvalH!==void 0))){var m=d.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(m==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var P=m[1],E=m[2],N=m[3],A=P+"."+E;if(this.parsedJWS={},this.parsedJWS.headB64U=P,this.parsedJWS.payloadB64U=E,this.parsedJWS.sigvalB64U=N,this.parsedJWS.si=A,!g){var j=xt(N),O=jn(j,16);this.parsedJWS.sigvalH=j,this.parsedJWS.sigvalBI=O}var C=Er(P),I=Er(E);if(this.parsedJWS.headS=C,this.parsedJWS.payloadS=I,!l(C,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+C}}},v.jws.JWS.sign=function(s,c,l,d,g){var m=v,P=m.jws,E=P.JWS,N=E.readSafeJSONString,A=E.isSafeJSONString,j=m.crypto;j.ECDSA;var O=j.Mac,C=j.Signature,I=JSON,T,D,M;if(typeof c!="string"&&typeof c!="object")throw"spHeader must be JSON string or object: "+c;if(typeof c=="object"&&(D=c,T=I.stringify(D)),typeof c=="string"){if(T=c,!A(T))throw"JWS Head is not safe JSON string: "+T;D=N(T)}if(M=l,typeof l=="object"&&(M=I.stringify(l)),(s==""||s==null)&&D.alg!==void 0&&(s=D.alg),s!=""&&s!=null&&D.alg===void 0&&(D.alg=s,T=I.stringify(D)),s!==D.alg)throw"alg and sHeader.alg doesn't match: "+s+"!="+D.alg;var H=null;if(E.jwsalg2sigalg[s]===void 0)throw"unsupported alg name: "+s;H=E.jwsalg2sigalg[s];var te=ja(T),ie=ja(M),re=te+"."+ie,ae="";if(H.substr(0,4)=="Hmac"){if(d===void 0)throw"mac key shall be specified for HS* alg";var V=new O({alg:H,prov:"cryptojs",pass:d});V.updateString(re),ae=V.doFinal()}else if(H.indexOf("withECDSA")!=-1){var $=new C({alg:H});$.init(d,g),$.updateString(re);var Z=$.sign();ae=v.crypto.ECDSA.asn1SigToConcatSig(Z)}else if(H!="none"){var $=new C({alg:H});$.init(d,g),$.updateString(re),ae=$.sign()}var q=Qt(ae);return re+"."+q},v.jws.JWS.verify=function(s,c,l){var d=v,g=d.jws,m=g.JWS,P=m.readSafeJSONString,E=d.crypto,N=E.ECDSA,A=E.Mac,j=E.Signature,O;if(typeof Ke!==void 0&&(O=Ke),!nd(s))return!1;var C=s.split(".");if(C.length!==3)return!1;var I=C[0],T=C[1],D=I+"."+T,M=xt(C[2]),H=P(Er(C[0])),te=null,ie=null;if(H.alg===void 0)throw"algorithm not specified in header";if(te=H.alg,ie=te.substr(0,2),l!=null&&Object.prototype.toString.call(l)==="[object Array]"&&l.length>0){var re=":"+l.join(":")+":";if(re.indexOf(":"+te+":")==-1)throw"algorithm '"+te+"' not accepted in the list"}if(te!="none"&&c===null)throw"key shall be specified to verify.";if(typeof c=="string"&&c.indexOf("-----BEGIN ")!=-1&&(c=nt.getKey(c)),(ie=="RS"||ie=="PS")&&!(c instanceof O))throw"key shall be a RSAKey obj for RS* and PS* algs";if(ie=="ES"&&!(c instanceof N))throw"key shall be a ECDSA obj for ES* algs";var ae=null;if(m.jwsalg2sigalg[H.alg]===void 0)throw"unsupported alg name: "+te;if(ae=m.jwsalg2sigalg[te],ae=="none")throw"not supported";if(ae.substr(0,4)=="Hmac"){var V=null;if(c===void 0)throw"hexadecimal key shall be specified for HMAC";var $=new A({alg:ae,pass:c});return $.updateString(D),V=$.doFinal(),M==V}else if(ae.indexOf("withECDSA")!=-1){var Z=null;try{Z=N.concatSigToASN1Sig(M)}catch{return!1}var q=new j({alg:ae});return q.init(c),q.updateString(D),q.verify(Z)}else{var q=new j({alg:ae});return q.init(c),q.updateString(D),q.verify(M)}},v.jws.JWS.parse=function(s){var c=s.split("."),l={},d,g,m;if(c.length!=2&&c.length!=3)throw"malformed sJWS: wrong number of '.' splitted elements";return d=c[0],g=c[1],c.length==3&&(m=c[2]),l.headerObj=v.jws.JWS.readSafeJSONString(Er(d)),l.payloadObj=v.jws.JWS.readSafeJSONString(Er(g)),l.headerPP=JSON.stringify(l.headerObj,null,"  "),l.payloadObj==null?l.payloadPP=Er(g):l.payloadPP=JSON.stringify(l.payloadObj,null,"  "),m!==void 0&&(l.sigHex=xt(m)),l},v.jws.JWS.verifyJWT=function(s,c,l){var d=v,g=d.jws,m=g.JWS,P=m.readSafeJSONString,E=m.inArray,N=m.includedArray;if(!nd(s))return!1;var A=s.split(".");if(A.length!=3)return!1;var j=A[0],O=A[1];xt(A[2]);var C=P(Er(j)),I=P(Er(O));if(C.alg===void 0)return!1;if(l.alg===void 0)throw"acceptField.alg shall be specified";if(!E(C.alg,l.alg)||I.iss!==void 0&&typeof l.iss=="object"&&!E(I.iss,l.iss)||I.sub!==void 0&&typeof l.sub=="object"&&!E(I.sub,l.sub))return!1;if(I.aud!==void 0&&typeof l.aud=="object"){if(typeof I.aud=="string"){if(!E(I.aud,l.aud))return!1}else if(typeof I.aud=="object"&&!N(I.aud,l.aud))return!1}var T=g.IntDate.getNow();return l.verifyAt!==void 0&&typeof l.verifyAt=="number"&&(T=l.verifyAt),(l.gracePeriod===void 0||typeof l.gracePeriod!="number")&&(l.gracePeriod=0),!(I.exp!==void 0&&typeof I.exp=="number"&&I.exp+l.gracePeriod<T||I.nbf!==void 0&&typeof I.nbf=="number"&&T<I.nbf-l.gracePeriod||I.iat!==void 0&&typeof I.iat=="number"&&T<I.iat-l.gracePeriod||I.jti!==void 0&&l.jti!==void 0&&I.jti!==l.jti||!m.verify(s,c,l.alg))},v.jws.JWS.includedArray=function(s,c){var l=v.jws.JWS.inArray;if(s===null||typeof s!="object"||typeof s.length!="number")return!1;for(var d=0;d<s.length;d++)if(!l(s[d],c))return!1;return!0},v.jws.JWS.inArray=function(s,c){if(c===null||typeof c!="object"||typeof c.length!="number")return!1;for(var l=0;l<c.length;l++)if(c[l]==s)return!0;return!1},v.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",ES512:"SHA512withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},v.jws.JWS.isSafeJSONString=function(s,c,l){var d=null;try{return d=Ef(s),typeof d!="object"||d.constructor===Array?0:(c&&(c[l]=d),1)}catch{return 0}},v.jws.JWS.readSafeJSONString=function(s){var c=null;try{return c=Ef(s),typeof c!="object"||c.constructor===Array?null:c}catch{return null}},v.jws.JWS.getEncodedSignatureValueFromJWS=function(s){var c=s.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(c==null)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return c[1]},v.jws.JWS.getJWKthumbprint=function(s){if(s.kty!=="RSA"&&s.kty!=="EC"&&s.kty!=="oct")throw"unsupported algorithm for JWK Thumprint";var c="{";if(s.kty==="RSA"){if(typeof s.n!="string"||typeof s.e!="string")throw"wrong n and e value for RSA key";c+='"e":"'+s.e+'",',c+='"kty":"'+s.kty+'",',c+='"n":"'+s.n+'"}'}else if(s.kty==="EC"){if(typeof s.crv!="string"||typeof s.x!="string"||typeof s.y!="string")throw"wrong crv, x and y value for EC key";c+='"crv":"'+s.crv+'",',c+='"kty":"'+s.kty+'",',c+='"x":"'+s.x+'",',c+='"y":"'+s.y+'"}'}else if(s.kty==="oct"){if(typeof s.k!="string")throw"wrong k value for oct(symmetric) key";c+='"kty":"'+s.kty+'",',c+='"k":"'+s.k+'"}'}var l=Gr(c),d=v.crypto.Util.hashHex(l,"sha256"),g=Qt(d);return g},v.jws.IntDate={},v.jws.IntDate.get=function(s){var c=v.jws.IntDate,l=c.getNow,d=c.getZulu;if(s=="now")return l();if(s=="now + 1hour")return l()+60*60;if(s=="now + 1day")return l()+60*60*24;if(s=="now + 1month")return l()+60*60*24*30;if(s=="now + 1year")return l()+60*60*24*365;if(s.match(/Z$/))return d(s);if(s.match(/^[0-9]+$/))return parseInt(s);throw"unsupported format: "+s},v.jws.IntDate.getZulu=function(s){return Rf(s)},v.jws.IntDate.getNow=function(){var s=~~(new Date/1e3);return s},v.jws.IntDate.intDate2UTCString=function(s){var c=new Date(s*1e3);return c.toUTCString()},v.jws.IntDate.intDate2Zulu=function(s){var c=new Date(s*1e3),l=("0000"+c.getUTCFullYear()).slice(-4),d=("00"+(c.getUTCMonth()+1)).slice(-2),g=("00"+c.getUTCDate()).slice(-2),m=("00"+c.getUTCHours()).slice(-2),P=("00"+c.getUTCMinutes()).slice(-2),E=("00"+c.getUTCSeconds()).slice(-2);return l+d+g+m+P+E+"Z"},(typeof v>"u"||!v)&&(v={}),(typeof v.jws>"u"||!v.jws)&&(v.jws={}),v.jws.JWSJS=function(){var s=v,c=s.jws,l=c.JWS,d=l.readSafeJSONString;this.aHeader=[],this.sPayload="",this.aSignature=[],this.init=function(){this.aHeader=[],this.sPayload=void 0,this.aSignature=[]},this.initWithJWS=function(g){this.init();var m=g.split(".");if(m.length!=3)throw"malformed input JWS";this.aHeader.push(m[0]),this.sPayload=m[1],this.aSignature.push(m[2])},this.addSignature=function(g,m,P,E){if(this.sPayload===void 0||this.sPayload===null)throw"there's no JSON-JS signature to add.";var N=this.aHeader.length;if(this.aHeader.length!=this.aSignature.length)throw"aHeader.length != aSignature.length";try{var A=v.jws.JWS.sign(g,m,this.sPayload,P,E),j=A.split("."),O=j[0],C=j[2];this.aHeader.push(j[0]),this.aSignature.push(j[2])}catch(I){throw this.aHeader.length>N&&this.aHeader.pop(),this.aSignature.length>N&&this.aSignature.pop(),"addSignature failed: "+I}},this.verifyAll=function(g){if(this.aHeader.length!==g.length||this.aSignature.length!==g.length)return!1;for(var m=0;m<g.length;m++){var P=g[m];if(P.length!==2)return!1;var E=this.verifyNth(m,P[0],P[1]);if(E===!1)return!1}return!0},this.verifyNth=function(g,m,P){if(this.aHeader.length<=g||this.aSignature.length<=g)return!1;var E=this.aHeader[g],N=this.aSignature[g],A=E+"."+this.sPayload+"."+N,j=!1;try{j=l.verify(A,m,P)}catch{return!1}return j},this.readJWSJS=function(g){if(typeof g=="string"){var m=d(g);if(m==null)throw"argument is not safe JSON object string";this.aHeader=m.headers,this.sPayload=m.payload,this.aSignature=m.signatures}else try{if(g.headers.length>0)this.aHeader=g.headers;else throw"malformed header";if(typeof g.payload=="string")this.sPayload=g.payload;else throw"malformed signatures";if(g.signatures.length>0)this.aSignature=g.signatures;else throw"malformed signatures"}catch(P){throw"malformed JWS-JS JSON object: "+P}},this.getJSON=function(){return{headers:this.aHeader,payload:this.sPayload,signatures:this.aSignature}},this.isEmpty=function(){return this.aHeader.length==0?1:0}},e.SecureRandom=Us,e.rng_seed_time=$u,e.BigInteger=_,e.RSAKey=Ke,e.ECDSA=v.crypto.ECDSA,e.DSA=v.crypto.DSA,e.Signature=v.crypto.Signature,e.MessageDigest=v.crypto.MessageDigest,e.Mac=v.crypto.Mac,e.KEYUTIL=nt,e.ASN1HEX=ke,e.X509=He,e.X509CRL=Xb,e.CryptoJS=a,e.b64tohex=h,e.b64toBA=y,e.ECFieldElementFp=Jt,e.ECPointFp=ut,e.ECCurveFp=oi,e.stoBA=Pf,e.BAtos=kf,e.BAtohex=mc,e.stohex=Bn,e.stob64=Fb,e.stob64u=Db,e.b64utos=Nb,e.b64tob64u=Hs,e.b64utob64=La,e.hex2b64=p,e.hextob64u=Qt,e.b64utohex=xt,e.utf8tob64u=ja,e.b64utoutf8=Er,e.utf8tob64=Ob,e.b64toutf8=Mb,e.utf8tohex=gc,e.hextoutf8=ft,e.hextorstr=Un,e.rstrtohex=Gr,e.hextob64=Ju,e.hextob64nl=Bb,e.b64nltohex=Tf,e.hextopem=mn,e.pemtohex=Bt,e.hextoArrayBuffer=Vb,e.ArrayBuffertohex=qb,e.zulutomsec=Qu,e.msectozulu=zb,e.zulutosec=Rf,e.zulutodate=Kb,e.datetozulu=$b,e.uricmptohex=yc,e.hextouricmp=_c,e.ipv6tohex=Xu,e.hextoipv6=Yu,e.hextoip=bc,e.iptohex=ed,e.ucs2hextoutf8=td,e.encodeURIComponentAll=Sc,e.newline_toUnix=Wb,e.newline_toDos=Gb,e.hextoposhex=rd,e.intarystrtohex=Zb,e.strdiffidx=Jb,e.oidtohex=Nf,e.hextooid=wc,e.strpad=xc,e.bitstrtoint=Mf,e.inttobitstr=Lf,e.bitstrtobinstr=jf,e.binstrtobitstr=Qb,e.isBase64URLDot=nd,e.namearraytobinstr=Cc,e.extendClass=ve,e.foldnl=vc,e.b64topem=Ub,e.pemtob64=Hb,e.timeogen=Af,e.aryval=_t,e.inttohex=Of,e.twoscompl=Ba,e.KJUR=v,e.crypto=v.crypto,e.asn1=v.asn1,e.jws=v.jws,e.lang=v.lang,e.VERSION=r,e.VERSION_FULL=i}}),sf=fe({"../../node_modules/.pnpm/isomorphic-ws@4.0.1_ws@8.18.2/node_modules/isomorphic-ws/browser.js"(e,t){W();var n=null;typeof WebSocket<"u"?n=WebSocket:typeof MozWebSocket<"u"?n=MozWebSocket:typeof global<"u"?n=global.WebSocket||global.MozWebSocket:typeof window<"u"?n=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(n=self.WebSocket||self.MozWebSocket),t.exports=n}}),ay=fe({"../../node_modules/.pnpm/deepmerge@4.3.1/node_modules/deepmerge/dist/cjs.js"(e,t){W();var n=function(L){return r(L)&&!i(L)};function r(k){return!!k&&typeof k=="object"}function i(k){var L=Object.prototype.toString.call(k);return L==="[object RegExp]"||L==="[object Date]"||u(k)}var a=typeof Symbol=="function"&&Symbol.for,o=a?Symbol.for("react.element"):60103;function u(k){return k.$$typeof===o}function p(k){return Array.isArray(k)?[]:{}}function h(k,L){return L.clone!==!1&&L.isMergeableObject(k)?b(p(k),k,L):k}function y(k,L,G){return k.concat(L).map(function(K){return h(K,G)})}function f(k,L){if(!L.customMerge)return b;var G=L.customMerge(k);return typeof G=="function"?G:b}function _(k){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(k).filter(function(L){return Object.propertyIsEnumerable.call(k,L)}):[]}function w(k){return Object.keys(k).concat(_(k))}function R(k,L){try{return L in k}catch{return!1}}function F(k,L){return R(k,L)&&!(Object.hasOwnProperty.call(k,L)&&Object.propertyIsEnumerable.call(k,L))}function S(k,L,G){var K={};return G.isMergeableObject(k)&&w(k).forEach(function(z){K[z]=h(k[z],G)}),w(L).forEach(function(z){F(k,z)||(R(k,z)&&G.isMergeableObject(L[z])?K[z]=f(z,G)(k[z],L[z],G):K[z]=h(L[z],G))}),K}function b(k,L,G){G=G||{},G.arrayMerge=G.arrayMerge||y,G.isMergeableObject=G.isMergeableObject||n,G.cloneUnlessOtherwiseSpecified=h;var K=Array.isArray(L),z=Array.isArray(k),U=K===z;return U?K?G.arrayMerge(k,L,G):S(k,L,G):h(L,G)}b.all=function(L,G){if(!Array.isArray(L))throw new Error("first argument should be an array");return L.reduce(function(K,z){return b(K,z,G)},{})};var x=b;t.exports=x}}),Nx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_listCacheClear.js"(e,t){W();function n(){this.__data__=[],this.size=0}t.exports=n}}),oy=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/eq.js"(e,t){W();function n(r,i){return r===i||r!==r&&i!==i}t.exports=n}}),_u=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_assocIndexOf.js"(e,t){W();var n=oy();function r(i,a){for(var o=i.length;o--;)if(n(i[o][0],a))return o;return-1}t.exports=r}}),Ox=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_listCacheDelete.js"(e,t){W();var n=_u(),r=Array.prototype,i=r.splice;function a(o){var u=this.__data__,p=n(u,o);if(p<0)return!1;var h=u.length-1;return p==h?u.pop():i.call(u,p,1),--this.size,!0}t.exports=a}}),Mx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_listCacheGet.js"(e,t){W();var n=_u();function r(i){var a=this.__data__,o=n(a,i);return o<0?void 0:a[o][1]}t.exports=r}}),Lx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_listCacheHas.js"(e,t){W();var n=_u();function r(i){return n(this.__data__,i)>-1}t.exports=r}}),jx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_listCacheSet.js"(e,t){W();var n=_u();function r(i,a){var o=this.__data__,u=n(o,i);return u<0?(++this.size,o.push([i,a])):o[u][1]=a,this}t.exports=r}}),bu=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_ListCache.js"(e,t){W();var n=Nx(),r=Ox(),i=Mx(),a=Lx(),o=jx();function u(p){var h=-1,y=p==null?0:p.length;for(this.clear();++h<y;){var f=p[h];this.set(f[0],f[1])}}u.prototype.clear=n,u.prototype.delete=r,u.prototype.get=i,u.prototype.has=a,u.prototype.set=o,t.exports=u}}),Bx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stackClear.js"(e,t){W();var n=bu();function r(){this.__data__=new n,this.size=0}t.exports=r}}),Ux=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stackDelete.js"(e,t){W();function n(r){var i=this.__data__,a=i.delete(r);return this.size=i.size,a}t.exports=n}}),Hx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stackGet.js"(e,t){W();function n(r){return this.__data__.get(r)}t.exports=n}}),Vx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stackHas.js"(e,t){W();function n(r){return this.__data__.has(r)}t.exports=n}}),cy=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_freeGlobal.js"(e,t){W();var n=typeof global=="object"&&global&&global.Object===Object&&global;t.exports=n}}),wi=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_root.js"(e,t){W();var n=cy(),r=typeof self=="object"&&self&&self.Object===Object&&self,i=n||r||Function("return this")();t.exports=i}}),af=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_Symbol.js"(e,t){W();var n=wi(),r=n.Symbol;t.exports=r}}),qx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_getRawTag.js"(e,t){W();var n=af(),r=Object.prototype,i=r.hasOwnProperty,a=r.toString,o=n?n.toStringTag:void 0;function u(p){var h=i.call(p,o),y=p[o];try{p[o]=void 0;var f=!0}catch{}var _=a.call(p);return f&&(h?p[o]=y:delete p[o]),_}t.exports=u}}),zx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_objectToString.js"(e,t){W();var n=Object.prototype,r=n.toString;function i(a){return r.call(a)}t.exports=i}}),Su=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseGetTag.js"(e,t){W();var n=af(),r=qx(),i=zx(),a="[object Null]",o="[object Undefined]",u=n?n.toStringTag:void 0;function p(h){return h==null?h===void 0?o:a:u&&u in Object(h)?r(h):i(h)}t.exports=p}}),ly=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isObject.js"(e,t){W();function n(r){var i=typeof r;return r!=null&&(i=="object"||i=="function")}t.exports=n}}),uy=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isFunction.js"(e,t){W();var n=Su(),r=ly(),i="[object AsyncFunction]",a="[object Function]",o="[object GeneratorFunction]",u="[object Proxy]";function p(h){if(!r(h))return!1;var y=n(h);return y==a||y==o||y==i||y==u}t.exports=p}}),Kx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_coreJsData.js"(e,t){W();var n=wi(),r=n["__core-js_shared__"];t.exports=r}}),$x=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_isMasked.js"(e,t){W();var n=Kx(),r=function(){var a=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}();function i(a){return!!r&&r in a}t.exports=i}}),dy=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_toSource.js"(e,t){W();var n=Function.prototype,r=n.toString;function i(a){if(a!=null){try{return r.call(a)}catch{}try{return a+""}catch{}}return""}t.exports=i}}),Wx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseIsNative.js"(e,t){W();var n=uy(),r=$x(),i=ly(),a=dy(),o=/[\\^$.*+?()[\]{}|]/g,u=/^\[object .+?Constructor\]$/,p=Function.prototype,h=Object.prototype,y=p.toString,f=h.hasOwnProperty,_=RegExp("^"+y.call(f).replace(o,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function w(R){if(!i(R)||r(R))return!1;var F=n(R)?_:u;return F.test(a(R))}t.exports=w}}),Gx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_getValue.js"(e,t){W();function n(r,i){return r==null?void 0:r[i]}t.exports=n}}),Ra=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_getNative.js"(e,t){W();var n=Wx(),r=Gx();function i(a,o){var u=r(a,o);return n(u)?u:void 0}t.exports=i}}),of=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_Map.js"(e,t){W();var n=Ra(),r=wi(),i=n(r,"Map");t.exports=i}}),wu=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_nativeCreate.js"(e,t){W();var n=Ra(),r=n(Object,"create");t.exports=r}}),Zx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hashClear.js"(e,t){W();var n=wu();function r(){this.__data__=n?n(null):{},this.size=0}t.exports=r}}),Jx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hashDelete.js"(e,t){W();function n(r){var i=this.has(r)&&delete this.__data__[r];return this.size-=i?1:0,i}t.exports=n}}),Qx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hashGet.js"(e,t){W();var n=wu(),r="__lodash_hash_undefined__",i=Object.prototype,a=i.hasOwnProperty;function o(u){var p=this.__data__;if(n){var h=p[u];return h===r?void 0:h}return a.call(p,u)?p[u]:void 0}t.exports=o}}),Xx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hashHas.js"(e,t){W();var n=wu(),r=Object.prototype,i=r.hasOwnProperty;function a(o){var u=this.__data__;return n?u[o]!==void 0:i.call(u,o)}t.exports=a}}),Yx=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_hashSet.js"(e,t){W();var n=wu(),r="__lodash_hash_undefined__";function i(a,o){var u=this.__data__;return this.size+=this.has(a)?0:1,u[a]=n&&o===void 0?r:o,this}t.exports=i}}),e2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_Hash.js"(e,t){W();var n=Zx(),r=Jx(),i=Qx(),a=Xx(),o=Yx();function u(p){var h=-1,y=p==null?0:p.length;for(this.clear();++h<y;){var f=p[h];this.set(f[0],f[1])}}u.prototype.clear=n,u.prototype.delete=r,u.prototype.get=i,u.prototype.has=a,u.prototype.set=o,t.exports=u}}),t2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_mapCacheClear.js"(e,t){W();var n=e2(),r=bu(),i=of();function a(){this.size=0,this.__data__={hash:new n,map:new(i||r),string:new n}}t.exports=a}}),n2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_isKeyable.js"(e,t){W();function n(r){var i=typeof r;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?r!=="__proto__":r===null}t.exports=n}}),xu=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_getMapData.js"(e,t){W();var n=n2();function r(i,a){var o=i.__data__;return n(a)?o[typeof a=="string"?"string":"hash"]:o.map}t.exports=r}}),r2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_mapCacheDelete.js"(e,t){W();var n=xu();function r(i){var a=n(this,i).delete(i);return this.size-=a?1:0,a}t.exports=r}}),i2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_mapCacheGet.js"(e,t){W();var n=xu();function r(i){return n(this,i).get(i)}t.exports=r}}),s2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_mapCacheHas.js"(e,t){W();var n=xu();function r(i){return n(this,i).has(i)}t.exports=r}}),a2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_mapCacheSet.js"(e,t){W();var n=xu();function r(i,a){var o=n(this,i),u=o.size;return o.set(i,a),this.size+=o.size==u?0:1,this}t.exports=r}}),hy=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_MapCache.js"(e,t){W();var n=t2(),r=r2(),i=i2(),a=s2(),o=a2();function u(p){var h=-1,y=p==null?0:p.length;for(this.clear();++h<y;){var f=p[h];this.set(f[0],f[1])}}u.prototype.clear=n,u.prototype.delete=r,u.prototype.get=i,u.prototype.has=a,u.prototype.set=o,t.exports=u}}),o2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_stackSet.js"(e,t){W();var n=bu(),r=of(),i=hy(),a=200;function o(u,p){var h=this.__data__;if(h instanceof n){var y=h.__data__;if(!r||y.length<a-1)return y.push([u,p]),this.size=++h.size,this;h=this.__data__=new i(y)}return h.set(u,p),this.size=h.size,this}t.exports=o}}),c2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_Stack.js"(e,t){W();var n=bu(),r=Bx(),i=Ux(),a=Hx(),o=Vx(),u=o2();function p(h){var y=this.__data__=new n(h);this.size=y.size}p.prototype.clear=r,p.prototype.delete=i,p.prototype.get=a,p.prototype.has=o,p.prototype.set=u,t.exports=p}}),l2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_setCacheAdd.js"(e,t){W();var n="__lodash_hash_undefined__";function r(i){return this.__data__.set(i,n),this}t.exports=r}}),u2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_setCacheHas.js"(e,t){W();function n(r){return this.__data__.has(r)}t.exports=n}}),d2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_SetCache.js"(e,t){W();var n=hy(),r=l2(),i=u2();function a(o){var u=-1,p=o==null?0:o.length;for(this.__data__=new n;++u<p;)this.add(o[u])}a.prototype.add=a.prototype.push=r,a.prototype.has=i,t.exports=a}}),h2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_arraySome.js"(e,t){W();function n(r,i){for(var a=-1,o=r==null?0:r.length;++a<o;)if(i(r[a],a,r))return!0;return!1}t.exports=n}}),p2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_cacheHas.js"(e,t){W();function n(r,i){return r.has(i)}t.exports=n}}),py=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_equalArrays.js"(e,t){W();var n=d2(),r=h2(),i=p2(),a=1,o=2;function u(p,h,y,f,_,w){var R=y&a,F=p.length,S=h.length;if(F!=S&&!(R&&S>F))return!1;var b=w.get(p),x=w.get(h);if(b&&x)return b==h&&x==p;var k=-1,L=!0,G=y&o?new n:void 0;for(w.set(p,h),w.set(h,p);++k<F;){var K=p[k],z=h[k];if(f)var U=R?f(z,K,k,h,p,w):f(K,z,k,p,h,w);if(U!==void 0){if(U)continue;L=!1;break}if(G){if(!r(h,function(J,Q){if(!i(G,Q)&&(K===J||_(K,J,y,f,w)))return G.push(Q)})){L=!1;break}}else if(!(K===z||_(K,z,y,f,w))){L=!1;break}}return w.delete(p),w.delete(h),L}t.exports=u}}),f2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_Uint8Array.js"(e,t){W();var n=wi(),r=n.Uint8Array;t.exports=r}}),m2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_mapToArray.js"(e,t){W();function n(r){var i=-1,a=Array(r.size);return r.forEach(function(o,u){a[++i]=[u,o]}),a}t.exports=n}}),g2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_setToArray.js"(e,t){W();function n(r){var i=-1,a=Array(r.size);return r.forEach(function(o){a[++i]=o}),a}t.exports=n}}),v2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_equalByTag.js"(e,t){W();var n=af(),r=f2(),i=oy(),a=py(),o=m2(),u=g2(),p=1,h=2,y="[object Boolean]",f="[object Date]",_="[object Error]",w="[object Map]",R="[object Number]",F="[object RegExp]",S="[object Set]",b="[object String]",x="[object Symbol]",k="[object ArrayBuffer]",L="[object DataView]",G=n?n.prototype:void 0,K=G?G.valueOf:void 0;function z(U,J,Q,ne,oe,he,X){switch(Q){case L:if(U.byteLength!=J.byteLength||U.byteOffset!=J.byteOffset)return!1;U=U.buffer,J=J.buffer;case k:return!(U.byteLength!=J.byteLength||!he(new r(U),new r(J)));case y:case f:case R:return i(+U,+J);case _:return U.name==J.name&&U.message==J.message;case F:case b:return U==J+"";case w:var _e=o;case S:var Pe=ne&p;if(_e||(_e=u),U.size!=J.size&&!Pe)return!1;var xe=X.get(U);if(xe)return xe==J;ne|=h,X.set(U,J);var ge=a(_e(U),_e(J),ne,oe,he,X);return X.delete(U),ge;case x:if(K)return K.call(U)==K.call(J)}return!1}t.exports=z}}),y2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_arrayPush.js"(e,t){W();function n(r,i){for(var a=-1,o=i.length,u=r.length;++a<o;)r[u+a]=i[a];return r}t.exports=n}}),cf=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isArray.js"(e,t){W();var n=Array.isArray;t.exports=n}}),_2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseGetAllKeys.js"(e,t){W();var n=y2(),r=cf();function i(a,o,u){var p=o(a);return r(a)?p:n(p,u(a))}t.exports=i}}),b2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_arrayFilter.js"(e,t){W();function n(r,i){for(var a=-1,o=r==null?0:r.length,u=0,p=[];++a<o;){var h=r[a];i(h,a,r)&&(p[u++]=h)}return p}t.exports=n}}),S2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/stubArray.js"(e,t){W();function n(){return[]}t.exports=n}}),w2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_getSymbols.js"(e,t){W();var n=b2(),r=S2(),i=Object.prototype,a=i.propertyIsEnumerable,o=Object.getOwnPropertySymbols,u=o?function(p){return p==null?[]:(p=Object(p),n(o(p),function(h){return a.call(p,h)}))}:r;t.exports=u}}),x2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseTimes.js"(e,t){W();function n(r,i){for(var a=-1,o=Array(r);++a<r;)o[a]=i(a);return o}t.exports=n}}),Cu=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isObjectLike.js"(e,t){W();function n(r){return r!=null&&typeof r=="object"}t.exports=n}}),C2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseIsArguments.js"(e,t){W();var n=Su(),r=Cu(),i="[object Arguments]";function a(o){return r(o)&&n(o)==i}t.exports=a}}),E2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isArguments.js"(e,t){W();var n=C2(),r=Cu(),i=Object.prototype,a=i.hasOwnProperty,o=i.propertyIsEnumerable,u=n(function(){return arguments}())?n:function(p){return r(p)&&a.call(p,"callee")&&!o.call(p,"callee")};t.exports=u}}),P2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/stubFalse.js"(e,t){W();function n(){return!1}t.exports=n}}),fy=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isBuffer.js"(e,t){W();var n=wi(),r=P2(),i=typeof e=="object"&&e&&!e.nodeType&&e,a=i&&typeof t=="object"&&t&&!t.nodeType&&t,o=a&&a.exports===i,u=o?n.Buffer:void 0,p=u?u.isBuffer:void 0,h=p||r;t.exports=h}}),k2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_isIndex.js"(e,t){W();var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;function i(a,o){var u=typeof a;return o=o??n,!!o&&(u=="number"||u!="symbol"&&r.test(a))&&a>-1&&a%1==0&&a<o}t.exports=i}}),my=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isLength.js"(e,t){W();var n=9007199254740991;function r(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=n}t.exports=r}}),T2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseIsTypedArray.js"(e,t){W();var n=Su(),r=my(),i=Cu(),a="[object Arguments]",o="[object Array]",u="[object Boolean]",p="[object Date]",h="[object Error]",y="[object Function]",f="[object Map]",_="[object Number]",w="[object Object]",R="[object RegExp]",F="[object Set]",S="[object String]",b="[object WeakMap]",x="[object ArrayBuffer]",k="[object DataView]",L="[object Float32Array]",G="[object Float64Array]",K="[object Int8Array]",z="[object Int16Array]",U="[object Int32Array]",J="[object Uint8Array]",Q="[object Uint8ClampedArray]",ne="[object Uint16Array]",oe="[object Uint32Array]",he={};he[L]=he[G]=he[K]=he[z]=he[U]=he[J]=he[Q]=he[ne]=he[oe]=!0,he[a]=he[o]=he[x]=he[u]=he[k]=he[p]=he[h]=he[y]=he[f]=he[_]=he[w]=he[R]=he[F]=he[S]=he[b]=!1;function X(_e){return i(_e)&&r(_e.length)&&!!he[n(_e)]}t.exports=X}}),R2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseUnary.js"(e,t){W();function n(r){return function(i){return r(i)}}t.exports=n}}),A2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_nodeUtil.js"(e,t){W();var n=cy(),r=typeof e=="object"&&e&&!e.nodeType&&e,i=r&&typeof t=="object"&&t&&!t.nodeType&&t,a=i&&i.exports===r,o=a&&n.process,u=function(){try{var p=i&&i.require&&i.require("util").types;return p||o&&o.binding&&o.binding("util")}catch{}}();t.exports=u}}),gy=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isTypedArray.js"(e,t){W();var n=T2(),r=R2(),i=A2(),a=i&&i.isTypedArray,o=a?r(a):n;t.exports=o}}),I2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_arrayLikeKeys.js"(e,t){W();var n=x2(),r=E2(),i=cf(),a=fy(),o=k2(),u=gy(),p=Object.prototype,h=p.hasOwnProperty;function y(f,_){var w=i(f),R=!w&&r(f),F=!w&&!R&&a(f),S=!w&&!R&&!F&&u(f),b=w||R||F||S,x=b?n(f.length,String):[],k=x.length;for(var L in f)(_||h.call(f,L))&&!(b&&(L=="length"||F&&(L=="offset"||L=="parent")||S&&(L=="buffer"||L=="byteLength"||L=="byteOffset")||o(L,k)))&&x.push(L);return x}t.exports=y}}),F2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_isPrototype.js"(e,t){W();var n=Object.prototype;function r(i){var a=i&&i.constructor,o=typeof a=="function"&&a.prototype||n;return i===o}t.exports=r}}),D2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_overArg.js"(e,t){W();function n(r,i){return function(a){return r(i(a))}}t.exports=n}}),N2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_nativeKeys.js"(e,t){W();var n=D2(),r=n(Object.keys,Object);t.exports=r}}),O2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseKeys.js"(e,t){W();var n=F2(),r=N2(),i=Object.prototype,a=i.hasOwnProperty;function o(u){if(!n(u))return r(u);var p=[];for(var h in Object(u))a.call(u,h)&&h!="constructor"&&p.push(h);return p}t.exports=o}}),M2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isArrayLike.js"(e,t){W();var n=uy(),r=my();function i(a){return a!=null&&r(a.length)&&!n(a)}t.exports=i}}),L2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/keys.js"(e,t){W();var n=I2(),r=O2(),i=M2();function a(o){return i(o)?n(o):r(o)}t.exports=a}}),j2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_getAllKeys.js"(e,t){W();var n=_2(),r=w2(),i=L2();function a(o){return n(o,i,r)}t.exports=a}}),B2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_equalObjects.js"(e,t){W();var n=j2(),r=1,i=Object.prototype,a=i.hasOwnProperty;function o(u,p,h,y,f,_){var w=h&r,R=n(u),F=R.length,S=n(p),b=S.length;if(F!=b&&!w)return!1;for(var x=F;x--;){var k=R[x];if(!(w?k in p:a.call(p,k)))return!1}var L=_.get(u),G=_.get(p);if(L&&G)return L==p&&G==u;var K=!0;_.set(u,p),_.set(p,u);for(var z=w;++x<F;){k=R[x];var U=u[k],J=p[k];if(y)var Q=w?y(J,U,k,p,u,_):y(U,J,k,u,p,_);if(!(Q===void 0?U===J||f(U,J,h,y,_):Q)){K=!1;break}z||(z=k=="constructor")}if(K&&!z){var ne=u.constructor,oe=p.constructor;ne!=oe&&"constructor"in u&&"constructor"in p&&!(typeof ne=="function"&&ne instanceof ne&&typeof oe=="function"&&oe instanceof oe)&&(K=!1)}return _.delete(u),_.delete(p),K}t.exports=o}}),U2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_DataView.js"(e,t){W();var n=Ra(),r=wi(),i=n(r,"DataView");t.exports=i}}),H2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_Promise.js"(e,t){W();var n=Ra(),r=wi(),i=n(r,"Promise");t.exports=i}}),V2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_Set.js"(e,t){W();var n=Ra(),r=wi(),i=n(r,"Set");t.exports=i}}),q2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_WeakMap.js"(e,t){W();var n=Ra(),r=wi(),i=n(r,"WeakMap");t.exports=i}}),z2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_getTag.js"(e,t){W();var n=U2(),r=of(),i=H2(),a=V2(),o=q2(),u=Su(),p=dy(),h="[object Map]",y="[object Object]",f="[object Promise]",_="[object Set]",w="[object WeakMap]",R="[object DataView]",F=p(n),S=p(r),b=p(i),x=p(a),k=p(o),L=u;(n&&L(new n(new ArrayBuffer(1)))!=R||r&&L(new r)!=h||i&&L(i.resolve())!=f||a&&L(new a)!=_||o&&L(new o)!=w)&&(L=function(G){var K=u(G),z=K==y?G.constructor:void 0,U=z?p(z):"";if(U)switch(U){case F:return R;case S:return h;case b:return f;case x:return _;case k:return w}return K}),t.exports=L}}),K2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseIsEqualDeep.js"(e,t){W();var n=c2(),r=py(),i=v2(),a=B2(),o=z2(),u=cf(),p=fy(),h=gy(),y=1,f="[object Arguments]",_="[object Array]",w="[object Object]",R=Object.prototype,F=R.hasOwnProperty;function S(b,x,k,L,G,K){var z=u(b),U=u(x),J=z?_:o(b),Q=U?_:o(x);J=J==f?w:J,Q=Q==f?w:Q;var ne=J==w,oe=Q==w,he=J==Q;if(he&&p(b)){if(!p(x))return!1;z=!0,ne=!1}if(he&&!ne)return K||(K=new n),z||h(b)?r(b,x,k,L,G,K):i(b,x,J,k,L,G,K);if(!(k&y)){var X=ne&&F.call(b,"__wrapped__"),_e=oe&&F.call(x,"__wrapped__");if(X||_e){var Pe=X?b.value():b,xe=_e?x.value():x;return K||(K=new n),G(Pe,xe,k,L,K)}}return he?(K||(K=new n),a(b,x,k,L,G,K)):!1}t.exports=S}}),$2=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/_baseIsEqual.js"(e,t){W();var n=K2(),r=Cu();function i(a,o,u,p,h){return a===o?!0:a==null||o==null||!r(a)&&!r(o)?a!==a&&o!==o:n(a,o,u,p,i,h)}t.exports=i}}),vy=fe({"../../node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/isEqual.js"(e,t){W();var n=$2();function r(i,a){return n(i,a)}t.exports=r}}),W2=fe({"../../node_modules/.pnpm/ms@2.1.3/node_modules/ms/index.js"(e,t){W();var n=1e3,r=n*60,i=r*60,a=i*24,o=a*7,u=a*365.25;t.exports=function(_,w){w=w||{};var R=typeof _;if(R==="string"&&_.length>0)return p(_);if(R==="number"&&isFinite(_))return w.long?y(_):h(_);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(_))};function p(_){if(_=String(_),!(_.length>100)){var w=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(_);if(w){var R=parseFloat(w[1]),F=(w[2]||"ms").toLowerCase();switch(F){case"years":case"year":case"yrs":case"yr":case"y":return R*u;case"weeks":case"week":case"w":return R*o;case"days":case"day":case"d":return R*a;case"hours":case"hour":case"hrs":case"hr":case"h":return R*i;case"minutes":case"minute":case"mins":case"min":case"m":return R*r;case"seconds":case"second":case"secs":case"sec":case"s":return R*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return R;default:return}}}}function h(_){var w=Math.abs(_);return w>=a?Math.round(_/a)+"d":w>=i?Math.round(_/i)+"h":w>=r?Math.round(_/r)+"m":w>=n?Math.round(_/n)+"s":_+"ms"}function y(_){var w=Math.abs(_);return w>=a?f(_,w,a,"day"):w>=i?f(_,w,i,"hour"):w>=r?f(_,w,r,"minute"):w>=n?f(_,w,n,"second"):_+" ms"}function f(_,w,R,F){var S=w>=R*1.5;return Math.round(_/R)+" "+F+(S?"s":"")}}}),G2=fe({"../../node_modules/.pnpm/debug@4.4.1_supports-color@10.2.0/node_modules/debug/src/common.js"(e,t){W();function n(r){a.debug=a,a.default=a,a.coerce=f,a.disable=h,a.enable=u,a.enabled=y,a.humanize=W2(),a.destroy=_,Object.keys(r).forEach(w=>{a[w]=r[w]}),a.names=[],a.skips=[],a.formatters={};function i(w){let R=0;for(let F=0;F<w.length;F++)R=(R<<5)-R+w.charCodeAt(F),R|=0;return a.colors[Math.abs(R)%a.colors.length]}a.selectColor=i;function a(w){let R,F=null,S,b;function x(...k){if(!x.enabled)return;const L=x,G=Number(new Date),K=G-(R||G);L.diff=K,L.prev=R,L.curr=G,R=G,k[0]=a.coerce(k[0]),typeof k[0]!="string"&&k.unshift("%O");let z=0;k[0]=k[0].replace(/%([a-zA-Z%])/g,(J,Q)=>{if(J==="%%")return"%";z++;const ne=a.formatters[Q];if(typeof ne=="function"){const oe=k[z];J=ne.call(L,oe),k.splice(z,1),z--}return J}),a.formatArgs.call(L,k),(L.log||a.log).apply(L,k)}return x.namespace=w,x.useColors=a.useColors(),x.color=a.selectColor(w),x.extend=o,x.destroy=a.destroy,Object.defineProperty(x,"enabled",{enumerable:!0,configurable:!1,get:()=>F!==null?F:(S!==a.namespaces&&(S=a.namespaces,b=a.enabled(w)),b),set:k=>{F=k}}),typeof a.init=="function"&&a.init(x),x}function o(w,R){const F=a(this.namespace+(typeof R>"u"?":":R)+w);return F.log=this.log,F}function u(w){a.save(w),a.namespaces=w,a.names=[],a.skips=[];const R=(typeof w=="string"?w:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const F of R)F[0]==="-"?a.skips.push(F.slice(1)):a.names.push(F)}function p(w,R){let F=0,S=0,b=-1,x=0;for(;F<w.length;)if(S<R.length&&(R[S]===w[F]||R[S]==="*"))R[S]==="*"?(b=S,x=F,S++):(F++,S++);else if(b!==-1)S=b+1,x++,F=x;else return!1;for(;S<R.length&&R[S]==="*";)S++;return S===R.length}function h(){const w=[...a.names,...a.skips.map(R=>"-"+R)].join(",");return a.enable(""),w}function y(w){for(const R of a.skips)if(p(w,R))return!1;for(const R of a.names)if(p(w,R))return!0;return!1}function f(w){return w instanceof Error?w.stack||w.message:w}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return a.enable(a.load()),a}t.exports=n}}),Eu=fe({"../../node_modules/.pnpm/debug@4.4.1_supports-color@10.2.0/node_modules/debug/src/browser.js"(e,t){W(),e.formatArgs=r,e.save=i,e.load=a,e.useColors=n,e.storage=o(),e.destroy=(()=>{let p=!1;return()=>{p||(p=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let p;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(p=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(p[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(p){if(p[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+p[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;p.splice(1,0,h,"color: inherit");let y=0,f=0;p[0].replace(/%[a-zA-Z%]/g,_=>{_!=="%%"&&(y++,_==="%c"&&(f=y))}),p.splice(f,0,h)}e.log=console.debug||console.log||(()=>{});function i(p){try{p?e.storage.setItem("debug",p):e.storage.removeItem("debug")}catch{}}function a(){let p;try{p=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!p&&typeof da<"u"&&"env"in da&&(p=da.env.DEBUG),p}function o(){try{return localStorage}catch{}}t.exports=G2()(e);var{formatters:u}=t.exports;u.j=function(p){try{return JSON.stringify(p)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}}),Z2=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/types.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0})}}),Yn=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/Logger.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var t=Eu(),n="mediasoup-client",r=class{constructor(i){ce(this,"_debug"),ce(this,"_warn"),ce(this,"_error"),i?(this._debug=(0,t.default)(`${n}:${i}`),this._warn=(0,t.default)(`${n}:WARN:${i}`),this._error=(0,t.default)(`${n}:ERROR:${i}`)):(this._debug=(0,t.default)(n),this._warn=(0,t.default)(`${n}:WARN`),this._error=(0,t.default)(`${n}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};e.Logger=r}}),J2=fe({"../../node_modules/.pnpm/events@3.3.0/node_modules/events/events.js"(e,t){W();var n=typeof Reflect=="object"?Reflect:null,r=n&&typeof n.apply=="function"?n.apply:function(z,U,J){return Function.prototype.apply.call(z,U,J)},i;n&&typeof n.ownKeys=="function"?i=n.ownKeys:Object.getOwnPropertySymbols?i=function(z){return Object.getOwnPropertyNames(z).concat(Object.getOwnPropertySymbols(z))}:i=function(z){return Object.getOwnPropertyNames(z)};function a(K){console&&console.warn&&console.warn(K)}var o=Number.isNaN||function(z){return z!==z};function u(){u.init.call(this)}t.exports=u,t.exports.once=k,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var p=10;function h(K){if(typeof K!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof K)}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(K){if(typeof K!="number"||K<0||o(K))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+K+".");p=K}}),u.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(z){if(typeof z!="number"||z<0||o(z))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+z+".");return this._maxListeners=z,this};function y(K){return K._maxListeners===void 0?u.defaultMaxListeners:K._maxListeners}u.prototype.getMaxListeners=function(){return y(this)},u.prototype.emit=function(z){for(var U=[],J=1;J<arguments.length;J++)U.push(arguments[J]);var Q=z==="error",ne=this._events;if(ne!==void 0)Q=Q&&ne.error===void 0;else if(!Q)return!1;if(Q){var oe;if(U.length>0&&(oe=U[0]),oe instanceof Error)throw oe;var he=new Error("Unhandled error."+(oe?" ("+oe.message+")":""));throw he.context=oe,he}var X=ne[z];if(X===void 0)return!1;if(typeof X=="function")r(X,this,U);else for(var _e=X.length,Pe=S(X,_e),J=0;J<_e;++J)r(Pe[J],this,U);return!0};function f(K,z,U,J){var Q,ne,oe;if(h(U),ne=K._events,ne===void 0?(ne=K._events=Object.create(null),K._eventsCount=0):(ne.newListener!==void 0&&(K.emit("newListener",z,U.listener?U.listener:U),ne=K._events),oe=ne[z]),oe===void 0)oe=ne[z]=U,++K._eventsCount;else if(typeof oe=="function"?oe=ne[z]=J?[U,oe]:[oe,U]:J?oe.unshift(U):oe.push(U),Q=y(K),Q>0&&oe.length>Q&&!oe.warned){oe.warned=!0;var he=new Error("Possible EventEmitter memory leak detected. "+oe.length+" "+String(z)+" listeners added. Use emitter.setMaxListeners() to increase limit");he.name="MaxListenersExceededWarning",he.emitter=K,he.type=z,he.count=oe.length,a(he)}return K}u.prototype.addListener=function(z,U){return f(this,z,U,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(z,U){return f(this,z,U,!0)};function _(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function w(K,z,U){var J={fired:!1,wrapFn:void 0,target:K,type:z,listener:U},Q=_.bind(J);return Q.listener=U,J.wrapFn=Q,Q}u.prototype.once=function(z,U){return h(U),this.on(z,w(this,z,U)),this},u.prototype.prependOnceListener=function(z,U){return h(U),this.prependListener(z,w(this,z,U)),this},u.prototype.removeListener=function(z,U){var J,Q,ne,oe,he;if(h(U),Q=this._events,Q===void 0)return this;if(J=Q[z],J===void 0)return this;if(J===U||J.listener===U)--this._eventsCount===0?this._events=Object.create(null):(delete Q[z],Q.removeListener&&this.emit("removeListener",z,J.listener||U));else if(typeof J!="function"){for(ne=-1,oe=J.length-1;oe>=0;oe--)if(J[oe]===U||J[oe].listener===U){he=J[oe].listener,ne=oe;break}if(ne<0)return this;ne===0?J.shift():b(J,ne),J.length===1&&(Q[z]=J[0]),Q.removeListener!==void 0&&this.emit("removeListener",z,he||U)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(z){var U,J,Q;if(J=this._events,J===void 0)return this;if(J.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):J[z]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete J[z]),this;if(arguments.length===0){var ne=Object.keys(J),oe;for(Q=0;Q<ne.length;++Q)oe=ne[Q],oe!=="removeListener"&&this.removeAllListeners(oe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(U=J[z],typeof U=="function")this.removeListener(z,U);else if(U!==void 0)for(Q=U.length-1;Q>=0;Q--)this.removeListener(z,U[Q]);return this};function R(K,z,U){var J=K._events;if(J===void 0)return[];var Q=J[z];return Q===void 0?[]:typeof Q=="function"?U?[Q.listener||Q]:[Q]:U?x(Q):S(Q,Q.length)}u.prototype.listeners=function(z){return R(this,z,!0)},u.prototype.rawListeners=function(z){return R(this,z,!1)},u.listenerCount=function(K,z){return typeof K.listenerCount=="function"?K.listenerCount(z):F.call(K,z)},u.prototype.listenerCount=F;function F(K){var z=this._events;if(z!==void 0){var U=z[K];if(typeof U=="function")return 1;if(U!==void 0)return U.length}return 0}u.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]};function S(K,z){for(var U=new Array(z),J=0;J<z;++J)U[J]=K[J];return U}function b(K,z){for(;z+1<K.length;z++)K[z]=K[z+1];K.pop()}function x(K){for(var z=new Array(K.length),U=0;U<z.length;++U)z[U]=K[U].listener||K[U];return z}function k(K,z){return new Promise(function(U,J){function Q(oe){K.removeListener(z,ne),J(oe)}function ne(){typeof K.removeListener=="function"&&K.removeListener("error",Q),U([].slice.call(arguments))}G(K,z,ne,{once:!0}),z!=="error"&&L(K,Q,{once:!0})})}function L(K,z,U){typeof K.on=="function"&&G(K,"error",z,U)}function G(K,z,U,J){if(typeof K.on=="function")J.once?K.once(z,U):K.on(z,U);else if(typeof K.addEventListener=="function")K.addEventListener(z,function Q(ne){J.once&&K.removeEventListener(z,Q),U(ne)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof K)}}}),cr=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/enhancedEvents.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.EnhancedEventEmitter=void 0;var t=J2(),n=Yn(),r=new n.Logger("EnhancedEventEmitter"),i=class extends t.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}close(){super.removeAllListeners()}emit(a,...o){return super.emit(a,...o)}safeEmit(a,...o){try{return super.emit(a,...o)}catch(u){r.error("safeEmit() | event listener threw an error [eventName:%s]:%o",a,u);try{super.emit("listenererror",a,u)}catch{}return!!super.listenerCount(a)}}on(a,o){return super.on(a,o),this}off(a,o){return super.off(a,o),this}addListener(a,o){return super.on(a,o),this}prependListener(a,o){return super.prependListener(a,o),this}once(a,o){return super.once(a,o),this}prependOnceListener(a,o){return super.prependOnceListener(a,o),this}removeListener(a,o){return super.off(a,o),this}removeAllListeners(a){return super.removeAllListeners(a),this}listenerCount(a){return super.listenerCount(a)}listeners(a){return super.listeners(a)}rawListeners(a){return super.rawListeners(a)}};e.EnhancedEventEmitter=i}}),zr=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/errors.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.InvalidStateError=e.UnsupportedError=void 0;var t=class yy extends Error{constructor(i){super(i),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,yy):this.stack=new Error(i).stack}};e.UnsupportedError=t;var n=class _y extends Error{constructor(i){super(i),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,_y):this.stack=new Error(i).stack}};e.InvalidStateError=n}}),Aa=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/utils.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.clone=t,e.generateRandomNumber=n,e.deepFreeze=r;function t(i){if(i!==void 0)return Number.isNaN(i)?NaN:typeof structuredClone=="function"?structuredClone(i):JSON.parse(JSON.stringify(i))}function n(){return Math.round(Math.random()*1e7)}function r(i){const a=Reflect.ownKeys(i);for(const o of a){const u=i[o];(u&&typeof u=="object"||typeof u=="function")&&r(u)}return Object.freeze(i)}}}),Q2=fe({"../../node_modules/.pnpm/h264-profile-level-id@2.2.3_supports-color@10.2.0/node_modules/h264-profile-level-id/lib/Logger.js"(e){W();var t=e&&e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var n=t(Eu()),r="h264-profile-level-id",i=class{constructor(a){a?(this._debug=(0,n.default)(`${r}:${a}`),this._warn=(0,n.default)(`${r}:WARN:${a}`),this._error=(0,n.default)(`${r}:ERROR:${a}`)):(this._debug=(0,n.default)(r),this._warn=(0,n.default)(`${r}:WARN`),this._error=(0,n.default)(`${r}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};e.Logger=i}}),X2=fe({"../../node_modules/.pnpm/h264-profile-level-id@2.2.3_supports-color@10.2.0/node_modules/h264-profile-level-id/lib/index.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.ProfileLevelId=e.Level=e.Profile=void 0,e.parseProfileLevelId=f,e.profileLevelIdToString=_,e.profileToString=w,e.levelToString=R,e.parseSdpProfileLevelId=F,e.isSameProfile=S,e.isSameProfileAndLevel=b,e.generateProfileLevelIdStringForAnswer=x,e.supportedLevel=k;var t=Q2(),n=new t.Logger,r;(function(U){U[U.ConstrainedBaseline=1]="ConstrainedBaseline",U[U.Baseline=2]="Baseline",U[U.Main=3]="Main",U[U.ConstrainedHigh=4]="ConstrainedHigh",U[U.High=5]="High",U[U.PredictiveHigh444=6]="PredictiveHigh444"})(r||(e.Profile=r={}));var i;(function(U){U[U.L1_b=0]="L1_b",U[U.L1=10]="L1",U[U.L1_1=11]="L1_1",U[U.L1_2=12]="L1_2",U[U.L1_3=13]="L1_3",U[U.L2=20]="L2",U[U.L2_1=21]="L2_1",U[U.L2_2=22]="L2_2",U[U.L3=30]="L3",U[U.L3_1=31]="L3_1",U[U.L3_2=32]="L3_2",U[U.L4=40]="L4",U[U.L4_1=41]="L4_1",U[U.L4_2=42]="L4_2",U[U.L5=50]="L5",U[U.L5_1=51]="L5_1",U[U.L5_2=52]="L5_2"})(i||(e.Level=i={}));var a=class{constructor(U,J){this.profile=U,this.level=J}};e.ProfileLevelId=a;var o=new a(r.ConstrainedBaseline,i.L3_1),u=class{constructor(U){this.mask=~L("x",U),this.masked_value=L("1",U)}isMatch(U){return this.masked_value===(U&this.mask)}},p=class{constructor(U,J,Q){this.profile_idc=U,this.profile_iop=J,this.profile=Q}},h=[new p(66,new u("x1xx0000"),r.ConstrainedBaseline),new p(77,new u("1xxx0000"),r.ConstrainedBaseline),new p(88,new u("11xx0000"),r.ConstrainedBaseline),new p(66,new u("x0xx0000"),r.Baseline),new p(88,new u("10xx0000"),r.Baseline),new p(77,new u("0x0x0000"),r.Main),new p(100,new u("00000000"),r.High),new p(100,new u("00001100"),r.ConstrainedHigh),new p(244,new u("00000000"),r.PredictiveHigh444)],y=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:i.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:i.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:i.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:i.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:i.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:i.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:i.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:i.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:i.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:i.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:i.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:i.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:i.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:i.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:i.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:i.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:i.L5_2}];function f(U){if(typeof U!="string"||U.length!==6)return;const Q=parseInt(U,16);if(Q===0)return;const ne=Q&255,oe=Q>>8&255,he=Q>>16&255;let X;switch(ne){case i.L1_1:{X=oe&16?i.L1_b:i.L1_1;break}case i.L1:case i.L1_2:case i.L1_3:case i.L2:case i.L2_1:case i.L2_2:case i.L3:case i.L3_1:case i.L3_2:case i.L4:case i.L4_1:case i.L4_2:case i.L5:case i.L5_1:case i.L5_2:{X=ne;break}default:{n.warn(`parseProfileLevelId() | unrecognized level_idc [str:${U}, level_idc:${ne}]`);return}}for(const _e of h)if(he===_e.profile_idc&&_e.profile_iop.isMatch(oe))return n.debug(`parseProfileLevelId() | result [str:${U}, profile:${_e.profile}, level:${X}]`),new a(_e.profile,X);n.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${U}, profile_idc:${he}, profile_iop:${oe}]`)}function _(U){if(U.level==i.L1_b)switch(U.profile){case r.ConstrainedBaseline:return"42f00b";case r.Baseline:return"42100b";case r.Main:return"4d100b";default:{n.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${U.profile}`);return}}let J;switch(U.profile){case r.ConstrainedBaseline:{J="42e0";break}case r.Baseline:{J="4200";break}case r.Main:{J="4d00";break}case r.ConstrainedHigh:{J="640c";break}case r.High:{J="6400";break}case r.PredictiveHigh444:{J="f400";break}default:{n.warn(`profileLevelIdToString() | unrecognized profile ${U.profile}`);return}}let Q=U.level.toString(16);return Q.length===1&&(Q=`0${Q}`),`${J}${Q}`}function w(U){switch(U){case r.ConstrainedBaseline:return"ConstrainedBaseline";case r.Baseline:return"Baseline";case r.Main:return"Main";case r.ConstrainedHigh:return"ConstrainedHigh";case r.High:return"High";case r.PredictiveHigh444:return"PredictiveHigh444";default:{n.warn(`profileToString() | unrecognized profile ${U}`);return}}}function R(U){switch(U){case i.L1_b:return"1b";case i.L1:return"1";case i.L1_1:return"1.1";case i.L1_2:return"1.2";case i.L1_3:return"1.3";case i.L2:return"2";case i.L2_1:return"2.1";case i.L2_2:return"2.2";case i.L3:return"3";case i.L3_1:return"3.1";case i.L3_2:return"3.2";case i.L4:return"4";case i.L4_1:return"4.1";case i.L4_2:return"4.2";case i.L5:return"5";case i.L5_1:return"5.1";case i.L5_2:return"5.2";default:{n.warn(`levelToString() | unrecognized level ${U}`);return}}}function F(U={}){const J=U["profile-level-id"];return J?f(J):o}function S(U={},J={}){const Q=F(U),ne=F(J);return!!(Q&&ne&&Q.profile===ne.profile)}function b(U={},J={}){const Q=F(U),ne=F(J);return!!(Q&&ne&&Q.profile===ne.profile&&Q.level==ne.level)}function x(U={},J={}){if(!U["profile-level-id"]&&!J["profile-level-id"]){n.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const Q=F(U),ne=F(J);if(!Q)throw new TypeError("invalid local_profile_level_id");if(!ne)throw new TypeError("invalid remote_profile_level_id");if(Q.profile!==ne.profile)throw new TypeError("H264 Profile mismatch");const oe=z(U)&&z(J),he=Q.level,X=ne.level,_e=K(he,X),Pe=oe?he:_e;return n.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${Q.profile}, level:${Pe}]`),_(new a(Q.profile,Pe))}function k(U,J){for(let ne=y.length-1;ne>=0;--ne){const oe=y[ne];if(oe.max_macroblock_frame_size*256<=U&&oe.max_macroblocks_per_second<=J*oe.max_macroblock_frame_size)return n.debug(`supportedLevel() | result [max_frame_pixel_count:${U}, max_fps:${J}, level:${oe.level}]`),oe.level}n.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${U}, max_fps:${J}]`)}function L(U,J){return+(J[0]===U)<<7|+(J[1]===U)<<6|+(J[2]===U)<<5|+(J[3]===U)<<4|+(J[4]===U)<<3|+(J[5]===U)<<2|+(J[6]===U)<<1|+(J[7]===U)<<0}function G(U,J){return U===i.L1_b?J!==i.L1&&J!==i.L1_b:J===i.L1_b?U!==i.L1:U<J}function K(U,J){return G(U,J)?U:J}function z(U={}){const J=U["level-asymmetry-allowed"];return J===!0||J===1||J==="1"}}}),xi=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/ortc.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.validateRtpCapabilities=o,e.validateRtpParameters=u,e.validateSctpStreamParameters=p,e.validateSctpCapabilities=h,e.getExtendedRtpCapabilities=y,e.getRecvRtpCapabilities=f,e.getSendingRtpParameters=_,e.getSendingRemoteRtpParameters=w,e.reduceCodecs=R,e.generateProbatorRtpParameters=F,e.canSend=S,e.canReceive=b;var t=X2(),n=Aa(),r="probator",i=1234,a=127;function o(X){if(typeof X!="object")throw new TypeError("caps is not an object");if(X.codecs&&!Array.isArray(X.codecs))throw new TypeError("caps.codecs is not an array");X.codecs||(X.codecs=[]);for(const _e of X.codecs)x(_e);if(X.headerExtensions&&!Array.isArray(X.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");X.headerExtensions||(X.headerExtensions=[]);for(const _e of X.headerExtensions)L(_e)}function u(X){if(typeof X!="object")throw new TypeError("params is not an object");if(X.mid&&typeof X.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(X.codecs))throw new TypeError("missing params.codecs");for(const _e of X.codecs)G(_e);if(X.headerExtensions&&!Array.isArray(X.headerExtensions))throw new TypeError("params.headerExtensions is not an array");X.headerExtensions||(X.headerExtensions=[]);for(const _e of X.headerExtensions)K(_e);if(X.encodings&&!Array.isArray(X.encodings))throw new TypeError("params.encodings is not an array");X.encodings||(X.encodings=[]);for(const _e of X.encodings)z(_e);if(X.rtcp&&typeof X.rtcp!="object")throw new TypeError("params.rtcp is not an object");X.rtcp||(X.rtcp={}),U(X.rtcp)}function p(X){if(typeof X!="object")throw new TypeError("params is not an object");if(typeof X.streamId!="number")throw new TypeError("missing params.streamId");let _e=!1;if(typeof X.ordered=="boolean"?_e=!0:X.ordered=!0,X.maxPacketLifeTime&&typeof X.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(X.maxRetransmits&&typeof X.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(X.maxPacketLifeTime&&X.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(_e&&X.ordered&&(X.maxPacketLifeTime||X.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!_e&&(X.maxPacketLifeTime||X.maxRetransmits)&&(X.ordered=!1),X.label&&typeof X.label!="string")throw new TypeError("invalid params.label");if(X.protocol&&typeof X.protocol!="string")throw new TypeError("invalid params.protocol")}function h(X){if(typeof X!="object")throw new TypeError("caps is not an object");if(!X.numStreams||typeof X.numStreams!="object")throw new TypeError("missing caps.numStreams");J(X.numStreams)}function y(X,_e,Pe){var xe,ge,ye,Ee,Ne,Ye,zt,jt,en;const Tt={codecs:[],headerExtensions:[]};if(Pe)for(const et of(xe=X.codecs)!=null?xe:[]){if(Q(et))continue;const dt=((ge=_e.codecs)!=null?ge:[]).find(fn=>ne(fn,et,{strict:!0,modify:!0}));if(!dt)continue;const on={kind:et.kind,mimeType:et.mimeType,clockRate:et.clockRate,channels:et.channels,localPayloadType:et.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:dt.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:(ye=et.parameters)!=null?ye:{},remoteParameters:(Ee=dt.parameters)!=null?Ee:{},rtcpFeedback:he(et,dt)};Tt.codecs.push(on)}else for(const et of(Ne=_e.codecs)!=null?Ne:[]){if(Q(et))continue;const dt=((Ye=X.codecs)!=null?Ye:[]).find(fn=>ne(fn,et,{strict:!0,modify:!0}));if(!dt)continue;const on={kind:dt.kind,mimeType:dt.mimeType,clockRate:dt.clockRate,channels:dt.channels,localPayloadType:dt.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:et.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:(zt=dt.parameters)!=null?zt:{},remoteParameters:(jt=et.parameters)!=null?jt:{},rtcpFeedback:he(dt,et)};Tt.codecs.push(on)}for(const et of Tt.codecs){const dt=X.codecs.find(fn=>{var Wr;return Q(fn)&&((Wr=fn.parameters)==null?void 0:Wr.apt)===et.localPayloadType}),on=_e.codecs.find(fn=>{var Wr;return Q(fn)&&((Wr=fn.parameters)==null?void 0:Wr.apt)===et.remotePayloadType});dt&&on&&(et.localRtxPayloadType=dt.preferredPayloadType,et.remoteRtxPayloadType=on.preferredPayloadType)}for(const et of _e.headerExtensions){const dt=X.headerExtensions.find(fn=>oe(fn,et));if(!dt)continue;const on={kind:et.kind,uri:et.uri,sendId:dt.preferredId,recvId:et.preferredId,encrypt:(en=dt.preferredEncrypt)!=null?en:!1,direction:"sendrecv"};switch(et.direction){case"sendrecv":{on.direction="sendrecv";break}case"recvonly":{on.direction="sendonly";break}case"sendonly":{on.direction="recvonly";break}case"inactive":{on.direction="inactive";break}}Tt.headerExtensions.push(on)}return Tt}function f(X){var _e;const Pe={codecs:[],headerExtensions:[]};for(const xe of X.codecs){const ge={kind:xe.kind,mimeType:xe.mimeType,preferredPayloadType:xe.remotePayloadType,clockRate:xe.clockRate,channels:xe.channels,parameters:xe.localParameters,rtcpFeedback:xe.rtcpFeedback};if(Pe.codecs.push(ge),!xe.remoteRtxPayloadType)continue;const ye={kind:xe.kind,mimeType:`${xe.kind}/rtx`,preferredPayloadType:xe.remoteRtxPayloadType,clockRate:xe.clockRate,parameters:{apt:xe.remotePayloadType},rtcpFeedback:[]};Pe.codecs.push(ye)}for(const xe of X.headerExtensions){if(xe.direction!=="sendrecv"&&xe.direction!=="recvonly")continue;const ge={kind:xe.kind,uri:xe.uri,preferredId:xe.recvId,preferredEncrypt:(_e=xe.encrypt)!=null?_e:!1,direction:xe.direction};Pe.headerExtensions.push(ge)}return Pe}function _(X,_e){const Pe={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const xe of _e.codecs){if(xe.kind!==X)continue;const ge={mimeType:xe.mimeType,payloadType:xe.localPayloadType,clockRate:xe.clockRate,channels:xe.channels,parameters:xe.localParameters,rtcpFeedback:xe.rtcpFeedback};if(Pe.codecs.push(ge),xe.localRtxPayloadType){const ye={mimeType:`${xe.kind}/rtx`,payloadType:xe.localRtxPayloadType,clockRate:xe.clockRate,parameters:{apt:xe.localPayloadType},rtcpFeedback:[]};Pe.codecs.push(ye)}}for(const xe of _e.headerExtensions){if(xe.kind&&xe.kind!==X||xe.direction!=="sendrecv"&&xe.direction!=="sendonly")continue;const ge={uri:xe.uri,id:xe.sendId,encrypt:xe.encrypt,parameters:{}};Pe.headerExtensions.push(ge)}return Pe}function w(X,_e){var Pe,xe,ge;const ye={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const Ee of _e.codecs){if(Ee.kind!==X)continue;const Ne={mimeType:Ee.mimeType,payloadType:Ee.localPayloadType,clockRate:Ee.clockRate,channels:Ee.channels,parameters:Ee.remoteParameters,rtcpFeedback:Ee.rtcpFeedback};if(ye.codecs.push(Ne),Ee.localRtxPayloadType){const Ye={mimeType:`${Ee.kind}/rtx`,payloadType:Ee.localRtxPayloadType,clockRate:Ee.clockRate,parameters:{apt:Ee.localPayloadType},rtcpFeedback:[]};ye.codecs.push(Ye)}}for(const Ee of _e.headerExtensions){if(Ee.kind&&Ee.kind!==X||Ee.direction!=="sendrecv"&&Ee.direction!=="sendonly")continue;const Ne={uri:Ee.uri,id:Ee.sendId,encrypt:Ee.encrypt,parameters:{}};ye.headerExtensions.push(Ne)}if(ye.headerExtensions.some(Ee=>Ee.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const Ee of ye.codecs)Ee.rtcpFeedback=((Pe=Ee.rtcpFeedback)!=null?Pe:[]).filter(Ne=>Ne.type!=="goog-remb");else if(ye.headerExtensions.some(Ee=>Ee.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const Ee of ye.codecs)Ee.rtcpFeedback=((xe=Ee.rtcpFeedback)!=null?xe:[]).filter(Ne=>Ne.type!=="transport-cc");else for(const Ee of ye.codecs)Ee.rtcpFeedback=((ge=Ee.rtcpFeedback)!=null?ge:[]).filter(Ne=>Ne.type!=="transport-cc"&&Ne.type!=="goog-remb");return ye}function R(X,_e){const Pe=[];if(!_e)Pe.push(X[0]),Q(X[1])&&Pe.push(X[1]);else{for(let xe=0;xe<X.length;++xe)if(ne(X[xe],_e,{strict:!0})){Pe.push(X[xe]),Q(X[xe+1])&&Pe.push(X[xe+1]);break}if(Pe.length===0)throw new TypeError("no matching codec found")}return Pe}function F(X){X=n.clone(X),u(X);const _e={mid:r,codecs:[],headerExtensions:[],encodings:[{ssrc:i}],rtcp:{cname:"probator"}};return _e.codecs.push(X.codecs[0]),_e.codecs[0].payloadType=a,_e.headerExtensions=X.headerExtensions,_e}function S(X,_e){var Pe;return((Pe=_e.codecs)!=null?Pe:[]).some(xe=>xe.kind===X)}function b(X,_e){var Pe;if(u(X),X.codecs.length===0)return!1;const xe=X.codecs[0];return((Pe=_e.codecs)!=null?Pe:[]).some(ge=>ge.preferredPayloadType===xe.payloadType)}function x(X){const _e=new RegExp("^(audio|video)/(.+)","i");if(typeof X!="object")throw new TypeError("codec is not an object");if(!X.mimeType||typeof X.mimeType!="string")throw new TypeError("missing codec.mimeType");const Pe=_e.exec(X.mimeType);if(!Pe)throw new TypeError("invalid codec.mimeType");if(X.kind=Pe[1].toLowerCase(),typeof X.preferredPayloadType!="number")throw new TypeError("missing codec.preferredPayloadType");if(typeof X.clockRate!="number")throw new TypeError("missing codec.clockRate");X.kind==="audio"?typeof X.channels!="number"&&(X.channels=1):delete X.channels,(!X.parameters||typeof X.parameters!="object")&&(X.parameters={});for(const xe of Object.keys(X.parameters)){let ge=X.parameters[xe];if(ge===void 0&&(X.parameters[xe]="",ge=""),typeof ge!="string"&&typeof ge!="number")throw new TypeError(`invalid codec parameter [key:${xe}s, value:${ge}]`);if(xe==="apt"&&typeof ge!="number")throw new TypeError("invalid codec apt parameter")}(!X.rtcpFeedback||!Array.isArray(X.rtcpFeedback))&&(X.rtcpFeedback=[]);for(const xe of X.rtcpFeedback)k(xe)}function k(X){if(typeof X!="object")throw new TypeError("fb is not an object");if(!X.type||typeof X.type!="string")throw new TypeError("missing fb.type");(!X.parameter||typeof X.parameter!="string")&&(X.parameter="")}function L(X){if(typeof X!="object")throw new TypeError("ext is not an object");if(X.kind!=="audio"&&X.kind!=="video")throw new TypeError("invalid ext.kind");if(!X.uri||typeof X.uri!="string")throw new TypeError("missing ext.uri");if(typeof X.preferredId!="number")throw new TypeError("missing ext.preferredId");if(X.preferredEncrypt&&typeof X.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(X.preferredEncrypt||(X.preferredEncrypt=!1),X.direction&&typeof X.direction!="string")throw new TypeError("invalid ext.direction");X.direction||(X.direction="sendrecv")}function G(X){const _e=new RegExp("^(audio|video)/(.+)","i");if(typeof X!="object")throw new TypeError("codec is not an object");if(!X.mimeType||typeof X.mimeType!="string")throw new TypeError("missing codec.mimeType");const Pe=_e.exec(X.mimeType);if(!Pe)throw new TypeError("invalid codec.mimeType");if(typeof X.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof X.clockRate!="number")throw new TypeError("missing codec.clockRate");Pe[1].toLowerCase()==="audio"?typeof X.channels!="number"&&(X.channels=1):delete X.channels,(!X.parameters||typeof X.parameters!="object")&&(X.parameters={});for(const ge of Object.keys(X.parameters)){let ye=X.parameters[ge];if(ye===void 0&&(X.parameters[ge]="",ye=""),typeof ye!="string"&&typeof ye!="number")throw new TypeError(`invalid codec parameter [key:${ge}s, value:${ye}]`);if(ge==="apt"&&typeof ye!="number")throw new TypeError("invalid codec apt parameter")}(!X.rtcpFeedback||!Array.isArray(X.rtcpFeedback))&&(X.rtcpFeedback=[]);for(const ge of X.rtcpFeedback)k(ge)}function K(X){if(typeof X!="object")throw new TypeError("ext is not an object");if(!X.uri||typeof X.uri!="string")throw new TypeError("missing ext.uri");if(typeof X.id!="number")throw new TypeError("missing ext.id");if(X.encrypt&&typeof X.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");X.encrypt||(X.encrypt=!1),(!X.parameters||typeof X.parameters!="object")&&(X.parameters={});for(const _e of Object.keys(X.parameters)){let Pe=X.parameters[_e];if(Pe===void 0&&(X.parameters[_e]="",Pe=""),typeof Pe!="string"&&typeof Pe!="number")throw new TypeError("invalid header extension parameter")}}function z(X){if(typeof X!="object")throw new TypeError("encoding is not an object");if(X.ssrc&&typeof X.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(X.rid&&typeof X.rid!="string")throw new TypeError("invalid encoding.rid");if(X.rtx&&typeof X.rtx!="object")throw new TypeError("invalid encoding.rtx");if(X.rtx&&typeof X.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!X.dtx||typeof X.dtx!="boolean")&&(X.dtx=!1),X.scalabilityMode&&typeof X.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function U(X){if(typeof X!="object")throw new TypeError("rtcp is not an object");if(X.cname&&typeof X.cname!="string")throw new TypeError("invalid rtcp.cname");(!X.reducedSize||typeof X.reducedSize!="boolean")&&(X.reducedSize=!0)}function J(X){if(typeof X!="object")throw new TypeError("numStreams is not an object");if(typeof X.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof X.MIS!="number")throw new TypeError("missing numStreams.MIS")}function Q(X){return X?/.+\/rtx$/i.test(X.mimeType):!1}function ne(X,_e,{strict:Pe=!1,modify:xe=!1}={}){var ge,ye,Ee,Ne;const Ye=X.mimeType.toLowerCase(),zt=_e.mimeType.toLowerCase();if(Ye!==zt||X.clockRate!==_e.clockRate||X.channels!==_e.channels)return!1;switch(Ye){case"video/h264":{if(Pe){const jt=(ge=X.parameters["packetization-mode"])!=null?ge:0,en=(ye=_e.parameters["packetization-mode"])!=null?ye:0;if(jt!==en||!t.isSameProfile(X.parameters,_e.parameters))return!1;let Tt;try{Tt=t.generateProfileLevelIdStringForAnswer(X.parameters,_e.parameters)}catch{return!1}xe&&(Tt?(X.parameters["profile-level-id"]=Tt,_e.parameters["profile-level-id"]=Tt):(delete X.parameters["profile-level-id"],delete _e.parameters["profile-level-id"]))}break}case"video/vp9":{if(Pe){const jt=(Ee=X.parameters["profile-id"])!=null?Ee:0,en=(Ne=_e.parameters["profile-id"])!=null?Ne:0;if(jt!==en)return!1}break}}return!0}function oe(X,_e){return!(X.kind&&_e.kind&&X.kind!==_e.kind||X.uri!==_e.uri)}function he(X,_e){var Pe,xe;const ge=[];for(const ye of(Pe=X.rtcpFeedback)!=null?Pe:[]){const Ee=((xe=_e.rtcpFeedback)!=null?xe:[]).find(Ne=>Ne.type===ye.type&&(Ne.parameter===ye.parameter||!Ne.parameter&&!ye.parameter));Ee&&ge.push(Ee)}return ge}}}),Y2=fe({"../../node_modules/.pnpm/awaitqueue@3.2.4_supports-color@10.2.0/node_modules/awaitqueue/lib/Logger.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;var t=Eu(),n="awaitqueue",r=class{constructor(i){ce(this,"_debug"),ce(this,"_warn"),ce(this,"_error"),i?(this._debug=t(`${n}:${i}`),this._warn=t(`${n}:WARN:${i}`),this._error=t(`${n}:ERROR:${i}`)):(this._debug=t(n),this._warn=t(`${n}:WARN`),this._error=t(`${n}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};e.Logger=r}}),by=fe({"../../node_modules/.pnpm/awaitqueue@3.2.4_supports-color@10.2.0/node_modules/awaitqueue/lib/errors.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueueRemovedTaskError=e.AwaitQueueStoppedError=void 0;var t=class Sy extends Error{constructor(i){super(i??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,Sy)}};e.AwaitQueueStoppedError=t;var n=class wy extends Error{constructor(i){super(i??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,wy)}};e.AwaitQueueRemovedTaskError=n}}),eC=fe({"../../node_modules/.pnpm/awaitqueue@3.2.4_supports-color@10.2.0/node_modules/awaitqueue/lib/AwaitQueue.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueue=void 0;var t=Y2(),n=by(),r=new t.Logger("AwaitQueue"),i=class{constructor(){ce(this,"pendingTasks",new Map),ce(this,"nextTaskId",0),ce(this,"stopping",!1),r.debug("constructor()")}get size(){return this.pendingTasks.size}push(a,o){return B(this,null,function*(){if(o=o??a.name,r.debug(`push() [name:${o}]`),typeof a!="function")throw new TypeError("given task is not a function");if(o)try{Object.defineProperty(a,"name",{value:o})}catch{}return new Promise((u,p)=>{const h={id:this.nextTaskId++,task:a,name:o,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:y=>{if(h.completed)return;h.completed=!0,this.pendingTasks.delete(h.id),r.debug(`resolving task [name:${h.name}]`),u(y);const[f]=this.pendingTasks.values();f&&!f.executedAt&&this.execute(f)},reject:y=>{if(!h.completed&&(h.completed=!0,this.pendingTasks.delete(h.id),r.debug(`rejecting task [name:${h.name}]: %s`,String(y)),p(y),!this.stopping)){const[f]=this.pendingTasks.values();f&&!f.executedAt&&this.execute(f)}}};this.pendingTasks.set(h.id,h),this.pendingTasks.size===1&&this.execute(h)})})}stop(){r.debug("stop()"),this.stopping=!0;for(const a of this.pendingTasks.values())r.debug(`stop() | stopping task [name:${a.name}]`),a.reject(new n.AwaitQueueStoppedError);this.stopping=!1}remove(a){r.debug(`remove() [taskIdx:${a}]`);const o=Array.from(this.pendingTasks.values())[a];if(!o){r.debug(`stop() | no task with given idx [taskIdx:${a}]`);return}o.reject(new n.AwaitQueueRemovedTaskError)}dump(){const a=Date.now();let o=0;return Array.from(this.pendingTasks.values()).map(u=>({idx:o++,task:u.task,name:u.name,enqueuedTime:u.executedAt?u.executedAt-u.enqueuedAt:a-u.enqueuedAt,executionTime:u.executedAt?a-u.executedAt:0}))}execute(a){return B(this,null,function*(){if(r.debug(`execute() [name:${a.name}]`),a.executedAt)throw new Error("task already being executed");a.executedAt=Date.now();try{const o=yield a.task();a.resolve(o)}catch(o){a.reject(o)}})}};e.AwaitQueue=i}}),tC=fe({"../../node_modules/.pnpm/awaitqueue@3.2.4_supports-color@10.2.0/node_modules/awaitqueue/lib/index.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.AwaitQueueRemovedTaskError=e.AwaitQueueStoppedError=e.AwaitQueue=void 0;var t=eC();Object.defineProperty(e,"AwaitQueue",{enumerable:!0,get:function(){return t.AwaitQueue}});var n=by();Object.defineProperty(e,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return n.AwaitQueueStoppedError}}),Object.defineProperty(e,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return n.AwaitQueueRemovedTaskError}})}}),nC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/Producer.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Producer=void 0;var t=Yn(),n=cr(),r=zr(),i=new t.Logger("Producer"),a=class extends n.EnhancedEventEmitter{constructor({id:o,localId:u,rtpSender:p,track:h,rtpParameters:y,stopTracks:f,disableTrackOnPause:_,zeroRtpOnPause:w,appData:R}){super(),ce(this,"_id"),ce(this,"_localId"),ce(this,"_closed",!1),ce(this,"_rtpSender"),ce(this,"_track"),ce(this,"_kind"),ce(this,"_rtpParameters"),ce(this,"_paused"),ce(this,"_maxSpatialLayer"),ce(this,"_stopTracks"),ce(this,"_disableTrackOnPause"),ce(this,"_zeroRtpOnPause"),ce(this,"_appData"),ce(this,"_observer",new n.EnhancedEventEmitter),i.debug("constructor()"),this._id=o,this._localId=u,this._rtpSender=p,this._track=h,this._kind=h.kind,this._rtpParameters=y,this._paused=_?!h.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=f,this._disableTrackOnPause=_,this._zeroRtpOnPause=w,this._appData=R??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(o){this._appData=o}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return B(this,null,function*(){if(this._closed)throw new r.InvalidStateError("closed");return new Promise((o,u)=>{this.safeEmit("@getstats",o,u)})})}pause(){if(i.debug("pause()"),this._closed){i.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((o,u)=>{this.safeEmit("@pause",o,u)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(i.debug("resume()"),this._closed){i.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((o,u)=>{this.safeEmit("@resume",o,u)}).catch(()=>{}),this._observer.safeEmit("resume")}replaceTrack(o){return B(this,arguments,function*({track:u}){if(i.debug("replaceTrack() [track:%o]",u),this._closed){if(u&&this._stopTracks)try{u.stop()}catch{}throw new r.InvalidStateError("closed")}else if(u&&u.readyState==="ended")throw new r.InvalidStateError("track ended");if(u===this._track){i.debug("replaceTrack() | same track, ignored");return}yield new Promise((p,h)=>{this.safeEmit("@replacetrack",u,p,h)}),this.destroyTrack(),this._track=u,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()})}setMaxSpatialLayer(o){return B(this,null,function*(){if(this._closed)throw new r.InvalidStateError("closed");if(this._kind!=="video")throw new r.UnsupportedError("not a video Producer");if(typeof o!="number")throw new TypeError("invalid spatialLayer");o!==this._maxSpatialLayer&&(yield new Promise((u,p)=>{this.safeEmit("@setmaxspatiallayer",o,u,p)}).catch(()=>{}),this._maxSpatialLayer=o)})}setRtpEncodingParameters(o){return B(this,null,function*(){if(this._closed)throw new r.InvalidStateError("closed");if(typeof o!="object")throw new TypeError("invalid params");yield new Promise((u,p)=>{this.safeEmit("@setrtpencodingparameters",o,u,p)})})}onTrackEnded(){i.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};e.Producer=a}}),rC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/Consumer.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Consumer=void 0;var t=Yn(),n=cr(),r=zr(),i=new t.Logger("Consumer"),a=class extends n.EnhancedEventEmitter{constructor({id:o,localId:u,producerId:p,rtpReceiver:h,track:y,rtpParameters:f,appData:_}){super(),ce(this,"_id"),ce(this,"_localId"),ce(this,"_producerId"),ce(this,"_closed",!1),ce(this,"_rtpReceiver"),ce(this,"_track"),ce(this,"_rtpParameters"),ce(this,"_paused"),ce(this,"_appData"),ce(this,"_observer",new n.EnhancedEventEmitter),i.debug("constructor()"),this._id=o,this._localId=u,this._producerId=p,this._rtpReceiver=h,this._track=y,this._rtpParameters=f,this._paused=!y.enabled,this._appData=_??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(o){this._appData=o}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}getStats(){return B(this,null,function*(){if(this._closed)throw new r.InvalidStateError("closed");return new Promise((o,u)=>{this.safeEmit("@getstats",o,u)})})}pause(){if(i.debug("pause()"),this._closed){i.error("pause() | Consumer closed");return}if(this._paused){i.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(i.debug("resume()"),this._closed){i.error("resume() | Consumer closed");return}if(!this._paused){i.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){i.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};e.Consumer=a}}),iC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/DataProducer.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.DataProducer=void 0;var t=Yn(),n=cr(),r=zr(),i=new t.Logger("DataProducer"),a=class extends n.EnhancedEventEmitter{constructor({id:o,dataChannel:u,sctpStreamParameters:p,appData:h}){super(),ce(this,"_id"),ce(this,"_dataChannel"),ce(this,"_closed",!1),ce(this,"_sctpStreamParameters"),ce(this,"_appData"),ce(this,"_observer",new n.EnhancedEventEmitter),i.debug("constructor()"),this._id=o,this._dataChannel=u,this._sctpStreamParameters=p,this._appData=h??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(o){this._dataChannel.bufferedAmountLowThreshold=o}get appData(){return this._appData}set appData(o){this._appData=o}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(o){if(i.debug("send()"),this._closed)throw new r.InvalidStateError("closed");this._dataChannel.send(o)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(i.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",o=>{var u,p,h;if(this._closed)return;const y=(u=o.error)!=null?u:new Error("unknown DataChannel error");((p=o.error)==null?void 0:p.errorDetail)==="sctp-failure"?i.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(h=o.error)==null?void 0:h.sctpCauseCode,o.error.message):i.error('DataChannel "error" event: %o',y),this.safeEmit("error",y)}),this._dataChannel.addEventListener("close",()=>{this._closed||(i.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||i.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};e.DataProducer=a}}),sC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/DataConsumer.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.DataConsumer=void 0;var t=Yn(),n=cr(),r=new t.Logger("DataConsumer"),i=class extends n.EnhancedEventEmitter{constructor({id:a,dataProducerId:o,dataChannel:u,sctpStreamParameters:p,appData:h}){super(),ce(this,"_id"),ce(this,"_dataProducerId"),ce(this,"_dataChannel"),ce(this,"_closed",!1),ce(this,"_sctpStreamParameters"),ce(this,"_appData"),ce(this,"_observer",new n.EnhancedEventEmitter),r.debug("constructor()"),this._id=a,this._dataProducerId=o,this._dataChannel=u,this._sctpStreamParameters=p,this._appData=h??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(a){this._dataChannel.binaryType=a}get appData(){return this._appData}set appData(a){this._appData=a}get observer(){return this._observer}close(){this._closed||(r.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),super.close(),this._observer.close())}transportClosed(){this._closed||(r.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(r.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",a=>{var o,u,p;if(this._closed)return;const h=(o=a.error)!=null?o:new Error("unknown DataChannel error");((u=a.error)==null?void 0:u.errorDetail)==="sctp-failure"?r.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",(p=a.error)==null?void 0:p.sctpCauseCode,a.error.message):r.error('DataChannel "error" event: %o',h),this.safeEmit("error",h)}),this._dataChannel.addEventListener("close",()=>{this._closed||(r.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",a=>{this._closed||this.safeEmit("message",a.data)})}};e.DataConsumer=i}}),aC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/Transport.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Transport=void 0;var t=tC(),n=Yn(),r=cr(),i=zr(),a=Aa(),o=xi(),u=nC(),p=rC(),h=iC(),y=sC(),f=new n.Logger("Transport"),_=class{constructor(R){ce(this,"consumerOptions"),ce(this,"promise"),ce(this,"resolve"),ce(this,"reject"),this.consumerOptions=R,this.promise=new Promise((F,S)=>{this.resolve=F,this.reject=S})}},w=class extends r.EnhancedEventEmitter{constructor({direction:R,id:F,iceParameters:S,iceCandidates:b,dtlsParameters:x,sctpParameters:k,iceServers:L,iceTransportPolicy:G,additionalSettings:K,appData:z,handlerFactory:U,getSendExtendedRtpCapabilities:J,recvRtpCapabilities:Q,canProduceByKind:ne}){var oe;super(),ce(this,"_id"),ce(this,"_closed",!1),ce(this,"_direction"),ce(this,"_getSendExtendedRtpCapabilities"),ce(this,"_recvRtpCapabilities"),ce(this,"_canProduceByKind"),ce(this,"_maxSctpMessageSize"),ce(this,"_handler"),ce(this,"_iceGatheringState","new"),ce(this,"_connectionState","new"),ce(this,"_appData"),ce(this,"_producers",new Map),ce(this,"_consumers",new Map),ce(this,"_dataProducers",new Map),ce(this,"_dataConsumers",new Map),ce(this,"_probatorConsumerCreated",!1),ce(this,"_awaitQueue",new t.AwaitQueue),ce(this,"_pendingConsumerTasks",[]),ce(this,"_consumerCreationInProgress",!1),ce(this,"_pendingPauseConsumers",new Map),ce(this,"_consumerPauseInProgress",!1),ce(this,"_pendingResumeConsumers",new Map),ce(this,"_consumerResumeInProgress",!1),ce(this,"_pendingCloseConsumers",new Map),ce(this,"_consumerCloseInProgress",!1),ce(this,"_observer",new r.EnhancedEventEmitter),f.debug("constructor() [id:%s, direction:%s]",F,R),this._id=F,this._direction=R,this._getSendExtendedRtpCapabilities=J,this._recvRtpCapabilities=Q,this._canProduceByKind=ne,this._maxSctpMessageSize=k?k.maxMessageSize:null;const he=(oe=a.clone(K))!=null?oe:{};delete he.iceServers,delete he.iceTransportPolicy,delete he.bundlePolicy,delete he.rtcpMuxPolicy,this._handler=U.factory({direction:R,iceParameters:S,iceCandidates:b,dtlsParameters:x,sctpParameters:k,iceServers:L,iceTransportPolicy:G,additionalSettings:he,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities}),this._appData=z??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(R){this._appData=R}get observer(){return this._observer}close(){if(!this._closed){f.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const R of this._producers.values())R.transportClosed();this._producers.clear();for(const R of this._consumers.values())R.transportClosed();this._consumers.clear();for(const R of this._dataProducers.values())R.transportClosed();this._dataProducers.clear();for(const R of this._dataConsumers.values())R.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close"),super.close(),this._observer.close()}}getStats(){return B(this,null,function*(){if(this._closed)throw new i.InvalidStateError("closed");return this._handler.getTransportStats()})}restartIce(R){return B(this,arguments,function*({iceParameters:F}){if(f.debug("restartIce()"),this._closed)throw new i.InvalidStateError("closed");if(!F)throw new TypeError("missing iceParameters");return this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.restartIce(F)}),"transport.restartIce()")})}updateIceServers(){return B(this,arguments,function*({iceServers:R}={}){if(f.debug("updateIceServers()"),this._closed)throw new i.InvalidStateError("closed");if(!Array.isArray(R))throw new TypeError("missing iceServers");return this._awaitQueue.push(()=>B(this,null,function*(){return this._handler.updateIceServers(R)}),"transport.updateIceServers()")})}produce(){return B(this,arguments,function*({track:R,encodings:F,codecOptions:S,codec:b,stopTracks:x=!0,disableTrackOnPause:k=!0,zeroRtpOnPause:L=!1,onRtpSender:G,appData:K={}}={}){if(f.debug("produce() [track:%o]",R),this._closed)throw new i.InvalidStateError("closed");if(R){if(this._direction!=="send")throw new i.UnsupportedError("not a sending Transport");if(this._canProduceByKind[R.kind]){if(R.readyState==="ended")throw new i.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(K&&typeof K!="object")throw new TypeError("if given, appData must be an object")}else throw new i.UnsupportedError(`cannot produce ${R.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(()=>B(this,null,function*(){let z;if(F&&!Array.isArray(F))throw TypeError("encodings must be an array");F&&F.length===0?z=void 0:F&&(z=F.map(ne=>{const oe={active:!0};return ne.active===!1&&(oe.active=!1),typeof ne.dtx=="boolean"&&(oe.dtx=ne.dtx),typeof ne.scalabilityMode=="string"&&(oe.scalabilityMode=ne.scalabilityMode),typeof ne.scaleResolutionDownBy=="number"&&(oe.scaleResolutionDownBy=ne.scaleResolutionDownBy),typeof ne.maxBitrate=="number"&&(oe.maxBitrate=ne.maxBitrate),typeof ne.maxFramerate=="number"&&(oe.maxFramerate=ne.maxFramerate),typeof ne.adaptivePtime=="boolean"&&(oe.adaptivePtime=ne.adaptivePtime),typeof ne.priority=="string"&&(oe.priority=ne.priority),typeof ne.networkPriority=="string"&&(oe.networkPriority=ne.networkPriority),oe}));const{localId:U,rtpParameters:J,rtpSender:Q}=yield this._handler.send({track:R,encodings:z,codecOptions:S,codec:b,onRtpSender:G});try{o.validateRtpParameters(J);const{id:ne}=yield new Promise((he,X)=>{this.safeEmit("produce",{kind:R.kind,rtpParameters:J,appData:K},he,X)}),oe=new u.Producer({id:ne,localId:U,rtpSender:Q,track:R,rtpParameters:J,stopTracks:x,disableTrackOnPause:k,zeroRtpOnPause:L,appData:K});return this._producers.set(oe.id,oe),this.handleProducer(oe),this._observer.safeEmit("newproducer",oe),oe}catch(ne){throw this._handler.stopSending(U).catch(()=>{}),ne}}),"transport.produce()").catch(z=>{if(x)try{R.stop()}catch{}throw z})})}consume(R){return B(this,arguments,function*({id:F,producerId:S,kind:b,rtpParameters:x,streamId:k,onRtpReceiver:L,appData:G={}}){if(f.debug("consume()"),this._closed)throw new i.InvalidStateError("closed");if(this._direction!=="recv")throw new i.UnsupportedError("not a receiving Transport");if(typeof F!="string")throw new TypeError("missing id");if(typeof S!="string")throw new TypeError("missing producerId");if(b!=="audio"&&b!=="video")throw new TypeError(`invalid kind '${b}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(G&&typeof G!="object")throw new TypeError("if given, appData must be an object");const K=a.clone(x);if(!o.canReceive(K,this._recvRtpCapabilities))throw new i.UnsupportedError("cannot consume this Producer");const U=new _({id:F,producerId:S,kind:b,rtpParameters:K,streamId:k,onRtpReceiver:L,appData:G});return this._pendingConsumerTasks.push(U),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),U.promise})}produceData(){return B(this,arguments,function*({ordered:R=!0,maxPacketLifeTime:F,maxRetransmits:S,label:b="",protocol:x="",appData:k={}}={}){if(f.debug("produceData()"),this._closed)throw new i.InvalidStateError("closed");if(this._direction!=="send")throw new i.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(k&&typeof k!="object")throw new TypeError("if given, appData must be an object")}else throw new i.UnsupportedError("SCTP not enabled by remote Transport");return(F||S)&&(R=!1),this._awaitQueue.push(()=>B(this,null,function*(){const{dataChannel:L,sctpStreamParameters:G}=yield this._handler.sendDataChannel({ordered:R,maxPacketLifeTime:F,maxRetransmits:S,label:b,protocol:x});o.validateSctpStreamParameters(G);const{id:K}=yield new Promise((U,J)=>{this.safeEmit("producedata",{sctpStreamParameters:G,label:b,protocol:x,appData:k},U,J)}),z=new h.DataProducer({id:K,dataChannel:L,sctpStreamParameters:G,appData:k});return this._dataProducers.set(z.id,z),this.handleDataProducer(z),this._observer.safeEmit("newdataproducer",z),z}),"transport.produceData()")})}consumeData(R){return B(this,arguments,function*({id:F,dataProducerId:S,sctpStreamParameters:b,label:x="",protocol:k="",appData:L={}}){if(f.debug("consumeData()"),this._closed)throw new i.InvalidStateError("closed");if(this._direction!=="recv")throw new i.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof F!="string")throw new TypeError("missing id");if(typeof S!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(L&&typeof L!="object")throw new TypeError("if given, appData must be an object")}else throw new i.UnsupportedError("SCTP not enabled by remote Transport");const G=a.clone(b);return o.validateSctpStreamParameters(G),this._awaitQueue.push(()=>B(this,null,function*(){const{dataChannel:K}=yield this._handler.receiveDataChannel({sctpStreamParameters:G,label:x,protocol:k}),z=new y.DataConsumer({id:F,dataProducerId:S,dataChannel:K,sctpStreamParameters:G,appData:L});return this._dataConsumers.set(z.id,z),this.handleDataConsumer(z),this._observer.safeEmit("newdataconsumer",z),z}),"transport.consumeData()")})}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(()=>B(this,null,function*(){if(this._pendingConsumerTasks.length===0){f.debug("createPendingConsumers() | there is no Consumer to be created");return}const R=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let F;const S=[];for(const b of R){const{id:x,kind:k,rtpParameters:L,streamId:G,onRtpReceiver:K}=b.consumerOptions;S.push({trackId:x,kind:k,rtpParameters:L,streamId:G,onRtpReceiver:K})}try{const b=yield this._handler.receive(S);for(let x=0;x<b.length;++x){const k=R[x],L=b[x],{id:G,producerId:K,kind:z,rtpParameters:U,appData:J}=k.consumerOptions,{localId:Q,rtpReceiver:ne,track:oe}=L,he=new p.Consumer({id:G,localId:Q,producerId:K,rtpReceiver:ne,track:oe,rtpParameters:U,appData:J});this._consumers.set(he.id,he),this.handleConsumer(he),!this._probatorConsumerCreated&&!F&&z==="video"&&(F=he),this._observer.safeEmit("newconsumer",he),k.resolve(he)}}catch(b){for(const x of R)x.reject(b)}if(F)try{const b=o.generateProbatorRtpParameters(F.rtpParameters);yield this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:b}]),f.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(b){f.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",b)}}),"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(()=>B(this,null,function*(){if(this._pendingPauseConsumers.size===0){f.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const R=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const F=R.map(S=>S.localId);yield this._handler.pauseReceiving(F)}catch(F){f.error("pausePendingConsumers() | failed to pause Consumers:",F)}}),"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(()=>B(this,null,function*(){if(this._pendingResumeConsumers.size===0){f.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const R=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const F=R.map(S=>S.localId);yield this._handler.resumeReceiving(F)}catch(F){f.error("resumePendingConsumers() | failed to resume Consumers:",F)}}),"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(()=>B(this,null,function*(){if(this._pendingCloseConsumers.size===0){f.debug("closePendingConsumers() | there is no Consumer to be closed");return}const R=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{yield this._handler.stopReceiving(R.map(F=>F.localId))}catch(F){f.error("closePendingConsumers() | failed to close Consumers:",F)}}),"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const R=this._handler;R.on("@connect",({dtlsParameters:F},S,b)=>{if(this._closed){b(new i.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:F},S,b)}),R.on("@icegatheringstatechange",F=>{F!==this._iceGatheringState&&(f.debug("ICE gathering state changed to %s",F),this._iceGatheringState=F,this._closed||this.safeEmit("icegatheringstatechange",F))}),R.on("@icecandidateerror",F=>{f.warn(`ICE candidate error [url:${F.url}, localAddress:${F.address}, localPort:${F.port}]: ${F.errorCode} "${F.errorText}"`),this.safeEmit("icecandidateerror",F)}),R.on("@connectionstatechange",F=>{F!==this._connectionState&&(f.debug("connection state changed to %s",F),this._connectionState=F,this._closed||this.safeEmit("connectionstatechange",F))})}handleProducer(R){R.on("@close",()=>{this._producers.delete(R.id),!this._closed&&this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.stopSending(R.localId)}),"producer @close event").catch(F=>f.warn("producer.close() failed:%o",F))}),R.on("@pause",(F,S)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.pauseSending(R.localId)}),"producer @pause event").then(F).catch(S)}),R.on("@resume",(F,S)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.resumeSending(R.localId)}),"producer @resume event").then(F).catch(S)}),R.on("@replacetrack",(F,S,b)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.replaceTrack(R.localId,F)}),"producer @replacetrack event").then(S).catch(b)}),R.on("@setmaxspatiallayer",(F,S,b)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.setMaxSpatialLayer(R.localId,F)}),"producer @setmaxspatiallayer event").then(S).catch(b)}),R.on("@setrtpencodingparameters",(F,S,b)=>{this._awaitQueue.push(()=>B(this,null,function*(){return yield this._handler.setRtpEncodingParameters(R.localId,F)}),"producer @setrtpencodingparameters event").then(S).catch(b)}),R.on("@getstats",(F,S)=>{if(this._closed)return S(new i.InvalidStateError("closed"));this._handler.getSenderStats(R.localId).then(F).catch(S)})}handleConsumer(R){R.on("@close",()=>{this._consumers.delete(R.id),this._pendingPauseConsumers.delete(R.id),this._pendingResumeConsumers.delete(R.id),!this._closed&&(this._pendingCloseConsumers.set(R.id,R),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),R.on("@pause",()=>{this._pendingResumeConsumers.has(R.id)&&this._pendingResumeConsumers.delete(R.id),this._pendingPauseConsumers.set(R.id,R),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),R.on("@resume",()=>{this._pendingPauseConsumers.has(R.id)&&this._pendingPauseConsumers.delete(R.id),this._pendingResumeConsumers.set(R.id,R),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),R.on("@getstats",(F,S)=>{if(this._closed)return S(new i.InvalidStateError("closed"));this._handler.getReceiverStats(R.localId).then(F).catch(S)})}handleDataProducer(R){R.on("@close",()=>{this._dataProducers.delete(R.id)})}handleDataConsumer(R){R.on("@close",()=>{this._dataConsumers.delete(R.id)})}};e.Transport=w}}),Ia=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/scalabilityModes.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.parse=n;var t=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function n(r){const i=t.exec(r??"");return i?{spatialLayers:Number(i[1]),temporalLayers:Number(i[2])}:{spatialLayers:1,temporalLayers:1}}}}),ic=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/sdp/commonUtils.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.extractRtpCapabilities=n,e.extractDtlsParameters=r,e.getCname=i,e.applyCodecParameters=a;var t=qr();function n({sdpObject:o}){var u,p,h;const y=new Map,f=new Map;for(const w of o.media){const R=w.type;switch(R){case"audio":case"video":break;default:continue}for(const F of w.rtp){const S={kind:R,mimeType:`${R}/${F.codec}`,preferredPayloadType:F.payload,clockRate:F.rate,channels:F.encoding,parameters:{},rtcpFeedback:[]};y.set(S.preferredPayloadType,S)}for(const F of(u=w.fmtp)!=null?u:[]){const S=t.parseParams(F.config),b=y.get(F.payload);b&&(S!=null&&S.hasOwnProperty("profile-level-id")&&(S["profile-level-id"]=String(S["profile-level-id"])),b.parameters=S)}for(const F of(p=w.rtcpFb)!=null?p:[]){const S={type:F.type,parameter:F.subtype};if(S.parameter||delete S.parameter,F.payload!=="*"){const b=y.get(Number(F.payload));if(!b)continue;b.rtcpFeedback.push(S)}else for(const b of y.values())b.kind===R&&!/.+\/rtx$/i.test(b.mimeType)&&b.rtcpFeedback.push(S)}for(const F of(h=w.ext)!=null?h:[]){if(F["encrypt-uri"])continue;const S={kind:R,uri:F.uri,preferredId:F.value};f.set(S.preferredId,S)}}return{codecs:Array.from(y.values()),headerExtensions:Array.from(f.values())}}function r({sdpObject:o}){var u;let p=o.setup,h=o.fingerprint;if(!p||!h){const _=((u=o.media)!=null?u:[]).find(w=>w.port!==0);_&&(p??(p=_.setup),h??(h=_.fingerprint))}if(p){if(!h)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let y;switch(p){case"active":{y="client";break}case"passive":{y="server";break}case"actpass":{y="auto";break}}return{role:y,fingerprints:[{algorithm:h.type,value:h.hash}]}}function i({offerMediaObject:o}){var u;const p=((u=o.ssrcs)!=null?u:[]).find(h=>h.attribute==="cname");return p?p.value:""}function a({offerRtpParameters:o,answerMediaObject:u}){var p,h,y;for(const f of o.codecs){const _=f.mimeType.toLowerCase();if(_!=="audio/opus"||!((p=u.rtp)!=null?p:[]).find(S=>S.payload===f.payloadType))continue;u.fmtp=(h=u.fmtp)!=null?h:[];let R=u.fmtp.find(S=>S.payload===f.payloadType);R||(R={payload:f.payloadType,config:""},u.fmtp.push(R));const F=t.parseParams(R.config);switch(_){case"audio/opus":{const S=(y=f.parameters)==null?void 0:y["sprop-stereo"];S!==void 0&&(F.stereo=Number(S)?1:0);break}}R.config="";for(const S of Object.keys(F))R.config&&(R.config+=";"),R.config+=`${S}=${F[S]}`}}}}),sc=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/sdp/unifiedPlanUtils.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.getRtpEncodings=t,e.addLegacySimulcast=n;function t({offerMediaObject:r}){var i,a;const o=new Set;for(const h of(i=r.ssrcs)!=null?i:[]){const y=h.id;y&&o.add(y)}if(o.size===0)throw new Error("no a=ssrc lines found");const u=new Map;for(const h of(a=r.ssrcGroups)!=null?a:[]){if(h.semantics!=="FID")continue;const y=h.ssrcs.split(/\s+/),f=Number(y[0]),_=Number(y[1]);o.has(f)&&(o.delete(f),o.delete(_),u.set(f,_))}for(const h of o)u.set(h,void 0);const p=[];for(const[h,y]of u){const f={ssrc:h};y&&(f.rtx={ssrc:y}),p.push(f)}return p}function n({offerMediaObject:r,numStreams:i}){var a,o,u;if(i<=1)throw new TypeError("numStreams must be greater than 1");const p=((a=r.ssrcs)!=null?a:[]).find(b=>b.attribute==="msid");if(!p)throw new Error("a=ssrc line with msid information not found");const[h,y]=p.value.split(" "),f=Number(p.id);let _;((o=r.ssrcGroups)!=null?o:[]).some(b=>{if(b.semantics!=="FID")return!1;const x=b.ssrcs.split(/\s+/);return Number(x[0])===f?(_=Number(x[1]),!0):!1});const w=((u=r.ssrcs)!=null?u:[]).find(b=>b.attribute==="cname");if(!w)throw new Error("a=ssrc line with cname information not found");const R=w.value,F=[],S=[];for(let b=0;b<i;++b)F.push(f+b),_&&S.push(_+b);r.ssrcGroups=[],r.ssrcs=[],r.ssrcGroups.push({semantics:"SIM",ssrcs:F.join(" ")});for(const b of F)r.ssrcs.push({id:b,attribute:"cname",value:R}),r.ssrcs.push({id:b,attribute:"msid",value:`${h} ${y}`});for(let b=0;b<S.length;++b){const x=F[b],k=S[b];r.ssrcs.push({id:k,attribute:"cname",value:R}),r.ssrcs.push({id:k,attribute:"msid",value:`${h} ${y}`}),r.ssrcGroups.push({semantics:"FID",ssrcs:`${x} ${k}`})}}}}),Pu=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/ortc/utils.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.addNackSupportForOpus=t;function t(n){var r,i;for(const a of(r=n.codecs)!=null?r:[])(a.mimeType.toLowerCase()==="audio/opus"||a.mimeType.toLowerCase()==="audio/multiopus")&&!((i=a.rtcpFeedback)!=null&&i.some(o=>o.type==="nack"&&!o.parameter))&&(a.rtcpFeedback||(a.rtcpFeedback=[]),a.rtcpFeedback.push({type:"nack"}))}}}),oC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/sdp/MediaSection.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.OfferMediaSection=e.AnswerMediaSection=e.MediaSection=void 0;var t=qr(),n=Aa(),r=class{constructor({iceParameters:u,iceCandidates:p,dtlsParameters:h}){ce(this,"_mediaObject");var y;if(this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},u&&this.setIceParameters(u),p){this._mediaObject.candidates=[];for(const f of p){const _={foundation:f.foundation,component:1,ip:(y=f.address)!=null?y:f.ip,port:f.port,priority:f.priority,transport:f.protocol,type:f.type};f.tcpType&&(_.tcptype=f.tcpType),this._mediaObject.candidates.push(_)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}h&&this.setDtlsRole(h.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(u){this._mediaObject.iceUfrag=u.usernameFragment,this._mediaObject.icePwd=u.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};e.MediaSection=r;var i=class extends r{constructor({iceParameters:u,iceCandidates:p,dtlsParameters:h,sctpParameters:y,plainRtpParameters:f,offerMediaObject:_,offerRtpParameters:w,answerRtpParameters:R,codecOptions:F}){var S,b,x,k,L;switch(super({iceParameters:u,iceCandidates:p,dtlsParameters:h}),this._mediaObject.mid=String(_.mid),this._mediaObject.type=_.type,this._mediaObject.protocol=_.protocol,f?(this._mediaObject.connection={ip:f.ip,version:f.ipVersion},this._mediaObject.port=f.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),_.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const G of R.codecs){const K={payload:G.payloadType,codec:o(G),rate:G.clockRate};G.channels>1&&(K.encoding=G.channels),this._mediaObject.rtp.push(K);const z=(S=n.clone(G.parameters))!=null?S:{};let U=(b=n.clone(G.rtcpFeedback))!=null?b:[];if(F){const{opusStereo:Q,opusFec:ne,opusDtx:oe,opusMaxPlaybackRate:he,opusMaxAverageBitrate:X,opusPtime:_e,opusNack:Pe,videoGoogleStartBitrate:xe,videoGoogleMaxBitrate:ge,videoGoogleMinBitrate:ye}=F,Ee=w.codecs.find(Ne=>Ne.payloadType===G.payloadType);switch(G.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{Q!==void 0&&(Ee.parameters["sprop-stereo"]=Q?1:0,z.stereo=Q?1:0),ne!==void 0&&(Ee.parameters.useinbandfec=ne?1:0,z.useinbandfec=ne?1:0),oe!==void 0&&(Ee.parameters.usedtx=oe?1:0,z.usedtx=oe?1:0),he!==void 0&&(z.maxplaybackrate=he),X!==void 0&&(z.maxaveragebitrate=X),_e!==void 0&&(Ee.parameters.ptime=_e,z.ptime=_e),Pe||(Ee.rtcpFeedback=Ee.rtcpFeedback.filter(Ne=>Ne.type!=="nack"||Ne.parameter),U=U.filter(Ne=>Ne.type!=="nack"||Ne.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{xe!==void 0&&(z["x-google-start-bitrate"]=xe),ge!==void 0&&(z["x-google-max-bitrate"]=ge),ye!==void 0&&(z["x-google-min-bitrate"]=ye);break}}}const J={payload:G.payloadType,config:""};for(const Q of Object.keys(z))J.config&&(J.config+=";"),J.config+=`${Q}=${z[Q]}`;J.config&&this._mediaObject.fmtp.push(J);for(const Q of U)this._mediaObject.rtcpFb.push({payload:G.payloadType,type:Q.type,subtype:Q.parameter})}this._mediaObject.payloads=R.codecs.map(G=>G.payloadType).join(" "),this._mediaObject.ext=[];for(const G of R.headerExtensions)((x=_.ext)!=null?x:[]).some(z=>z.uri===G.uri)&&this._mediaObject.ext.push({uri:G.uri,value:G.id});if(_.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),_.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:_.simulcast.list1},this._mediaObject.rids=[];for(const G of(k=_.rids)!=null?k:[])G.direction==="send"&&this._mediaObject.rids.push({id:G.id,direction:"recv"})}else if(_.simulcast_03){this._mediaObject.simulcast_03={value:_.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const G of(L=_.rids)!=null?L:[])G.direction==="send"&&this._mediaObject.rids.push({id:G.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";break}case"application":{typeof _.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=y.port,this._mediaObject.maxMessageSize=y.maxMessageSize):_.sctpmap&&(this._mediaObject.payloads=String(y.port),this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:y.port,maxMessageSize:y.maxMessageSize});break}}}setDtlsRole(u){switch(u){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(u){var p,h;if(!((p=this._mediaObject.simulcast)!=null&&p.list1))return;const y={};for(const w of u)w.rid&&(y[w.rid]=w);const f=this._mediaObject.simulcast.list1,_=t.parseSimulcastStreamList(f);for(const w of _)for(const R of w)R.paused=!((h=y[R.scid])!=null&&h.active);this._mediaObject.simulcast.list1=_.map(w=>w.map(R=>`${R.paused?"~":""}${R.scid}`).join(",")).join(";")}};e.AnswerMediaSection=i;var a=class extends r{constructor({iceParameters:u,iceCandidates:p,dtlsParameters:h,sctpParameters:y,plainRtpParameters:f,mid:_,kind:w,offerRtpParameters:R,streamId:F,trackId:S}){var b,x;switch(super({iceParameters:u,iceCandidates:p,dtlsParameters:h}),this._mediaObject.mid=String(_),this._mediaObject.type=w,f?(this._mediaObject.connection={ip:f.ip,version:f.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=f.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},y?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",w){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._mediaObject.msid=`${F??"-"} ${S}`;for(const K of R.codecs){const z={payload:K.payloadType,codec:o(K),rate:K.clockRate};K.channels>1&&(z.encoding=K.channels),this._mediaObject.rtp.push(z);const U={payload:K.payloadType,config:""};for(const J of Object.keys((b=K.parameters)!=null?b:{}))U.config&&(U.config+=";"),U.config+=`${J}=${K.parameters[J]}`;U.config&&this._mediaObject.fmtp.push(U);for(const J of K.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:K.payloadType,type:J.type,subtype:J.parameter})}this._mediaObject.payloads=R.codecs.map(K=>K.payloadType).join(" "),this._mediaObject.ext=[];for(const K of R.headerExtensions)this._mediaObject.ext.push({uri:K.uri,value:K.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const k=R.encodings[0],L=k.ssrc,G=(x=k.rtx)==null?void 0:x.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],L&&R.rtcp.cname&&this._mediaObject.ssrcs.push({id:L,attribute:"cname",value:R.rtcp.cname}),G&&(R.rtcp.cname&&this._mediaObject.ssrcs.push({id:G,attribute:"cname",value:R.rtcp.cname}),L&&this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${L} ${G}`}));break}case"application":{this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=y.port,this._mediaObject.maxMessageSize=y.maxMessageSize;break}}}setDtlsRole(u){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}};e.OfferMediaSection=a;function o(u){const h=new RegExp("^(audio|video)/(.+)","i").exec(u.mimeType);if(!h)throw new TypeError("invalid codec.mimeType");return h[2]}}}),ac=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/sdp/RemoteSdp.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.RemoteSdp=void 0;var t=qr(),n=Yn(),r=oC(),i=["av1","h264"],a=new n.Logger("RemoteSdp"),o=class{constructor({iceParameters:u,iceCandidates:p,dtlsParameters:h,sctpParameters:y,plainRtpParameters:f}){if(ce(this,"_iceParameters"),ce(this,"_iceCandidates"),ce(this,"_dtlsParameters"),ce(this,"_sctpParameters"),ce(this,"_plainRtpParameters"),ce(this,"_mediaSections",[]),ce(this,"_midToIndex",new Map),ce(this,"_firstMid"),ce(this,"_sdpObject"),this._iceParameters=u,this._iceCandidates=p,this._dtlsParameters=h,this._sctpParameters=y,this._plainRtpParameters=f,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},u!=null&&u.iceLite&&(this._sdpObject.icelite="ice-lite"),h){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const _=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:h.fingerprints[_-1].algorithm,hash:h.fingerprints[_-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}f&&(this._sdpObject.origin.address=f.ip,this._sdpObject.origin.ipVer=f.ipVersion)}updateIceParameters(u){a.debug("updateIceParameters() [iceParameters:%o]",u),this._iceParameters=u,this._sdpObject.icelite=u.iceLite?"ice-lite":void 0;for(const p of this._mediaSections)p.setIceParameters(u)}updateDtlsRole(u){a.debug("updateDtlsRole() [role:%s]",u),this._dtlsParameters.role=u;for(const p of this._mediaSections)p.setDtlsRole(u)}setSessionExtmapAllowMixed(){a.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let u=0;u<this._mediaSections.length;++u){const p=this._mediaSections[u];if(p.closed)return{idx:u,reuseMid:p.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:u,reuseMid:p,offerRtpParameters:h,answerRtpParameters:y,codecOptions:f}){var _;const w=new r.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:u,offerRtpParameters:h,answerRtpParameters:y,codecOptions:f}),R=w.getObject();R.rtp.find(S=>i.includes(S.codec.toLowerCase()))||(R.ext=(_=R.ext)==null?void 0:_.filter(S=>S.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),p?this._replaceMediaSection(w,p):this._midToIndex.has(w.mid)?this._replaceMediaSection(w):this._addMediaSection(w)}receive({mid:u,kind:p,offerRtpParameters:h,streamId:y,trackId:f}){this.setSessionExtmapAllowMixed();const _=new r.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:u,kind:p,offerRtpParameters:h,streamId:y,trackId:f}),w=this._mediaSections.find(R=>R.closed);w?this._replaceMediaSection(_,w.mid):this._addMediaSection(_)}pauseMediaSection(u){this._findMediaSection(u).pause()}resumeSendingMediaSection(u){this._findMediaSection(u).resume()}resumeReceivingMediaSection(u){this._findMediaSection(u).resume()}disableMediaSection(u){this._findMediaSection(u).disable()}closeMediaSection(u){const p=this._findMediaSection(u);return u===this._firstMid?(a.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",u),this.disableMediaSection(u),!1):(p.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(u,p){const h=this._findMediaSection(u);h.muxSimulcastStreams(p),this._replaceMediaSection(h)}sendSctpAssociation({offerMediaObject:u}){const p=new r.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:u});this._addMediaSection(p)}receiveSctpAssociation(){const u=new r.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this._addMediaSection(u)}getSdp(){return this._sdpObject.origin.sessionVersion++,t.write(this._sdpObject)}_addMediaSection(u){this._firstMid||(this._firstMid=u.mid),this._mediaSections.push(u),this._midToIndex.set(u.mid,this._mediaSections.length-1),this._sdpObject.media.push(u.getObject()),this._regenerateBundleMids()}_replaceMediaSection(u,p){if(typeof p=="string"){const h=this._midToIndex.get(p);if(h===void 0)throw new Error(`no media section found for reuseMid '${p}'`);const y=this._mediaSections[h];this._mediaSections[h]=u,this._midToIndex.delete(y.mid),this._midToIndex.set(u.mid,h),this._sdpObject.media[h]=u.getObject(),this._regenerateBundleMids()}else{const h=this._midToIndex.get(u.mid);if(h===void 0)throw new Error(`no media section found with mid '${u.mid}'`);this._mediaSections[h]=u,this._sdpObject.media[h]=u.getObject()}}_findMediaSection(u){const p=this._midToIndex.get(u);if(p===void 0)throw new Error(`no media section found with mid '${u}'`);return this._mediaSections[p]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(u=>!u.closed).map(u=>u.mid).join(" "))}};e.RemoteSdp=o}}),cC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/Chrome111.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Chrome111=void 0;var t=qr(),n=cr(),r=Yn(),i=xi(),a=zr(),o=Ia(),u=ic(),p=sc(),h=Pu(),y=ac(),f=new r.Logger("Chrome111"),_="Chrome111",w={OS:1024,MIS:1024},R=class al extends n.EnhancedEventEmitter{constructor({direction:S,iceParameters:b,iceCandidates:x,dtlsParameters:k,sctpParameters:L,iceServers:G,iceTransportPolicy:K,additionalSettings:z,getSendExtendedRtpCapabilities:U}){super(),ce(this,"_closed",!1),ce(this,"_direction"),ce(this,"_remoteSdp"),ce(this,"_getSendExtendedRtpCapabilities"),ce(this,"_forcedLocalDtlsRole"),ce(this,"_pc"),ce(this,"_mapMidTransceiver",new Map),ce(this,"_sendStream",new MediaStream),ce(this,"_hasDataChannelMediaSection",!1),ce(this,"_nextSendSctpStreamId",0),ce(this,"_transportReady",!1),ce(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),ce(this,"onIceCandidateError",J=>{this.emit("@icecandidateerror",J)}),ce(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}),ce(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),f.debug("constructor()"),this._direction=S,this._remoteSdp=new y.RemoteSdp({iceParameters:b,iceCandidates:x,dtlsParameters:k,sctpParameters:L}),this._getSendExtendedRtpCapabilities=U,k.role&&k.role!=="auto"&&(this._forcedLocalDtlsRole=k.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ee({iceServers:G??[],iceTransportPolicy:K??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},z)),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:_,factory:S=>new al(S),getNativeRtpCapabilities:()=>B(null,null,function*(){f.debug("getNativeRtpCapabilities()");let S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{S.addTransceiver("audio"),S.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const b=yield S.createOffer();try{S.close()}catch{}S=void 0;const x=t.parse(b.sdp);return al.getLocalRtpCapabilities(x)}catch(b){try{S==null||S.close()}catch{}throw S=void 0,b}}),getNativeSctpCapabilities:()=>B(null,null,function*(){return f.debug("getNativeSctpCapabilities()"),{numStreams:w}})}}static getLocalRtpCapabilities(S){const b=u.extractRtpCapabilities({sdpObject:S});return h.addNackSupportForOpus(b),b}get name(){return _}close(){if(f.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}updateIceServers(S){return B(this,null,function*(){this.assertNotClosed(),f.debug("updateIceServers()");const b=this._pc.getConfiguration();b.iceServers=S,this._pc.setConfiguration(b)})}restartIce(S){return B(this,null,function*(){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const b=yield this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const x={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",x),yield this._pc.setRemoteDescription(x)}else{const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(S){return B(this,arguments,function*({track:b,encodings:x,codecOptions:k,codec:L,onRtpSender:G}){var K;if(this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",b.kind,b.id),x&&x.length>1){let ge=1;for(const ye of x){const Ee=ye.scalabilityMode?(0,o.parse)(ye.scalabilityMode).temporalLayers:3;Ee>ge&&(ge=Ee)}x.forEach((ye,Ee)=>{ye.rid=`r${Ee}`,ye.scalabilityMode=`L1T${ge}`})}const z=this._remoteSdp.getNextMediaSectionIdx(),U=this._pc.addTransceiver(b,{direction:"sendonly",streams:[this._sendStream],sendEncodings:x});G&&G(U.sender);const J=yield this._pc.createOffer();let Q=t.parse(J.sdp);Q.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const ne=al.getLocalRtpCapabilities(Q),oe=this._getSendExtendedRtpCapabilities(ne),he=i.getSendingRtpParameters(b.kind,oe);he.codecs=i.reduceCodecs(he.codecs,L);const X=i.getSendingRemoteRtpParameters(b.kind,oe);X.codecs=i.reduceCodecs(X.codecs,L),this._transportReady||(yield this.setupTransport({localDtlsRole:(K=this._forcedLocalDtlsRole)!=null?K:"client",localSdpObject:Q})),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",J),yield this._pc.setLocalDescription(J);const _e=U.mid;he.mid=_e,Q=t.parse(this._pc.localDescription.sdp);const Pe=Q.media[z.idx];if(he.rtcp.cname=u.getCname({offerMediaObject:Pe}),!x)he.encodings=p.getRtpEncodings({offerMediaObject:Pe});else if(x.length===1){const ge=p.getRtpEncodings({offerMediaObject:Pe});Object.assign(ge[0],x[0]),he.encodings=ge}else he.encodings=x;this._remoteSdp.send({offerMediaObject:Pe,reuseMid:z.reuseMid,offerRtpParameters:he,answerRtpParameters:X,codecOptions:k});const xe={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",xe),yield this._pc.setRemoteDescription(xe),this._mapMidTransceiver.set(_e,U),{localId:_e,rtpParameters:he,rtpSender:U.sender}})}stopSending(S){return B(this,null,function*(){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",S),this._closed)return;const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");if(b.sender.replaceTrack(null),this._pc.removeTrack(b.sender),this._remoteSdp.closeMediaSection(b.mid))try{b.stop()}catch{}const k=yield this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",k),yield this._pc.setLocalDescription(k);const L={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",L),yield this._pc.setRemoteDescription(L),this._mapMidTransceiver.delete(S)})}pauseSending(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(S);const x=yield this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",x),yield this._pc.setLocalDescription(x);const k={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",k),yield this._pc.setRemoteDescription(k)})}resumeSending(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(this._remoteSdp.resumeSendingMediaSection(S),!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="sendonly";const x=yield this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",x),yield this._pc.setLocalDescription(x);const k={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",k),yield this._pc.setRemoteDescription(k)})}replaceTrack(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),b?f.debug("replaceTrack() [localId:%s, track.id:%s]",S,b.id):f.debug("replaceTrack() [localId:%s, no track]",S);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");yield x.sender.replaceTrack(b)})}setMaxSpatialLayer(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,b);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");const k=x.sender.getParameters();k.encodings.forEach((K,z)=>{z<=b?K.active=!0:K.active=!1}),yield x.sender.setParameters(k),this._remoteSdp.muxMediaSectionSimulcast(S,k.encodings);const L=yield this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",L),yield this._pc.setLocalDescription(L);const G={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",G),yield this._pc.setRemoteDescription(G)})}setRtpEncodingParameters(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,b);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");const k=x.sender.getParameters();k.encodings.forEach((K,z)=>{k.encodings[z]=ee(ee({},K),b)}),yield x.sender.setParameters(k),this._remoteSdp.muxMediaSectionSimulcast(S,k.encodings);const L=yield this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",L),yield this._pc.setLocalDescription(L);const G={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",G),yield this._pc.setRemoteDescription(G)})}getSenderStats(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");return b.sender.getStats()})}sendDataChannel(S){return B(this,arguments,function*({ordered:b,maxPacketLifeTime:x,maxRetransmits:k,label:L,protocol:G}){var K;this.assertNotClosed(),this.assertSendDirection();const z={negotiated:!0,id:this._nextSendSctpStreamId,ordered:b,maxPacketLifeTime:x,maxRetransmits:k,protocol:G};f.debug("sendDataChannel() [options:%o]",z);const U=this._pc.createDataChannel(L,z);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%w.MIS,!this._hasDataChannelMediaSection){const Q=yield this._pc.createOffer(),ne=t.parse(Q.sdp),oe=ne.media.find(X=>X.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(K=this._forcedLocalDtlsRole)!=null?K:"client",localSdpObject:ne})),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",Q),yield this._pc.setLocalDescription(Q),this._remoteSdp.sendSctpAssociation({offerMediaObject:oe});const he={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",he),yield this._pc.setRemoteDescription(he),this._hasDataChannelMediaSection=!0}const J={streamId:z.id,ordered:z.ordered,maxPacketLifeTime:z.maxPacketLifeTime,maxRetransmits:z.maxRetransmits};return{dataChannel:U,sctpStreamParameters:J}})}receive(S){return B(this,null,function*(){var b,x;this.assertNotClosed(),this.assertRecvDirection();const k=[],L=new Map;for(const U of S){const{trackId:J,kind:Q,rtpParameters:ne,streamId:oe}=U;f.debug("receive() [trackId:%s, kind:%s]",J,Q);const he=(b=ne.mid)!=null?b:String(this._mapMidTransceiver.size);L.set(J,he),this._remoteSdp.receive({mid:he,kind:Q,offerRtpParameters:ne,streamId:oe??ne.rtcp.cname,trackId:J})}const G={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",G),yield this._pc.setRemoteDescription(G);for(const U of S){const{trackId:J,onRtpReceiver:Q}=U;if(Q){const ne=L.get(J),oe=this._pc.getTransceivers().find(he=>he.mid===ne);if(!oe)throw new Error("transceiver not found");Q(oe.receiver)}}let K=yield this._pc.createAnswer();const z=t.parse(K.sdp);for(const U of S){const{trackId:J,rtpParameters:Q}=U,ne=L.get(J),oe=z.media.find(he=>String(he.mid)===ne);u.applyCodecParameters({offerRtpParameters:Q,answerMediaObject:oe})}K={type:"answer",sdp:t.write(z)},this._transportReady||(yield this.setupTransport({localDtlsRole:(x=this._forcedLocalDtlsRole)!=null?x:"client",localSdpObject:z})),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K);for(const U of S){const{trackId:J}=U,Q=L.get(J),ne=this._pc.getTransceivers().find(oe=>oe.mid===Q);if(ne)this._mapMidTransceiver.set(Q,ne),k.push({localId:Q,track:ne.receiver.track,rtpReceiver:ne.receiver});else throw new Error("new RTCRtpTransceiver not found")}return k})}stopReceiving(S){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const k of S){f.debug("stopReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(L.mid)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x);for(const k of S)this._mapMidTransceiver.delete(k)})}pauseReceiving(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const k of S){f.debug("pauseReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="inactive",this._remoteSdp.pauseMediaSection(k)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)})}resumeReceiving(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const k of S){f.debug("resumeReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(k)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)})}getReceiverStats(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");return b.receiver.getStats()})}receiveDataChannel(S){return B(this,arguments,function*({sctpStreamParameters:b,label:x,protocol:k}){var L;this.assertNotClosed(),this.assertRecvDirection();const{streamId:G,ordered:K,maxPacketLifeTime:z,maxRetransmits:U}=b,J={negotiated:!0,id:G,ordered:K,maxPacketLifeTime:z,maxRetransmits:U,protocol:k};f.debug("receiveDataChannel() [options:%o]",J);const Q=this._pc.createDataChannel(x,J);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const ne={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",ne),yield this._pc.setRemoteDescription(ne);const oe=yield this._pc.createAnswer();if(!this._transportReady){const he=t.parse(oe.sdp);yield this.setupTransport({localDtlsRole:(L=this._forcedLocalDtlsRole)!=null?L:"client",localSdpObject:he})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",oe),yield this._pc.setLocalDescription(oe),this._hasDataChannelMediaSection=!0}return{dataChannel:Q}})}setupTransport(S){return B(this,arguments,function*({localDtlsRole:b,localSdpObject:x}){x||(x=t.parse(this._pc.localDescription.sdp));const k=u.extractDtlsParameters({sdpObject:x});k.role=b,this._remoteSdp.updateDtlsRole(b==="client"?"server":"client"),yield new Promise((L,G)=>{this.safeEmit("@connect",{dtlsParameters:k},L,G)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new a.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Chrome111=R}}),lC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/Chrome74.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Chrome74=void 0;var t=qr(),n=Yn(),r=cr(),i=xi(),a=zr(),o=Ia(),u=ic(),p=sc(),h=Pu(),y=ac(),f=new n.Logger("Chrome74"),_="Chrome74",w={OS:1024,MIS:1024},R=class ol extends r.EnhancedEventEmitter{constructor({direction:S,iceParameters:b,iceCandidates:x,dtlsParameters:k,sctpParameters:L,iceServers:G,iceTransportPolicy:K,additionalSettings:z,getSendExtendedRtpCapabilities:U}){super(),ce(this,"_closed",!1),ce(this,"_direction"),ce(this,"_remoteSdp"),ce(this,"_getSendExtendedRtpCapabilities"),ce(this,"_forcedLocalDtlsRole"),ce(this,"_pc"),ce(this,"_mapMidTransceiver",new Map),ce(this,"_sendStream",new MediaStream),ce(this,"_hasDataChannelMediaSection",!1),ce(this,"_nextSendSctpStreamId",0),ce(this,"_transportReady",!1),ce(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),ce(this,"onIceCandidateError",J=>{this.emit("@icecandidateerror",J)}),ce(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}),ce(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),f.debug("constructor()"),this._direction=S,this._remoteSdp=new y.RemoteSdp({iceParameters:b,iceCandidates:x,dtlsParameters:k,sctpParameters:L}),this._getSendExtendedRtpCapabilities=U,k.role&&k.role!=="auto"&&(this._forcedLocalDtlsRole=k.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ee({iceServers:G??[],iceTransportPolicy:K??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},z)),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:_,factory:S=>new ol(S),getNativeRtpCapabilities:()=>B(null,null,function*(){f.debug("getNativeRtpCapabilities()");let S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{S.addTransceiver("audio"),S.addTransceiver("video");const b=yield S.createOffer();try{S.close()}catch{}S=void 0;const x=t.parse(b.sdp);return ol.getLocalRtpCapabilities(x)}catch(b){try{S==null||S.close()}catch{}throw S=void 0,b}}),getNativeSctpCapabilities:()=>B(null,null,function*(){return f.debug("getNativeSctpCapabilities()"),{numStreams:w}})}}static getLocalRtpCapabilities(S){const b=u.extractRtpCapabilities({sdpObject:S});return h.addNackSupportForOpus(b),b}get name(){return _}close(){if(f.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}updateIceServers(S){return B(this,null,function*(){this.assertNotClosed(),f.debug("updateIceServers()");const b=this._pc.getConfiguration();b.iceServers=S,this._pc.setConfiguration(b)})}restartIce(S){return B(this,null,function*(){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const b=yield this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const x={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",x),yield this._pc.setRemoteDescription(x)}else{const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(S){return B(this,arguments,function*({track:b,encodings:x,codecOptions:k,codec:L}){var G;this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",b.kind,b.id),x&&x.length>1&&x.forEach((ye,Ee)=>{ye.rid=`r${Ee}`});const K=this._remoteSdp.getNextMediaSectionIdx(),z=this._pc.addTransceiver(b,{direction:"sendonly",streams:[this._sendStream],sendEncodings:x});let U=yield this._pc.createOffer(),J=t.parse(U.sdp);J.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const Q=ol.getLocalRtpCapabilities(J),ne=this._getSendExtendedRtpCapabilities(Q),oe=i.getSendingRtpParameters(b.kind,ne);oe.codecs=i.reduceCodecs(oe.codecs,L);const he=i.getSendingRemoteRtpParameters(b.kind,ne);he.codecs=i.reduceCodecs(he.codecs,L),this._transportReady||(yield this.setupTransport({localDtlsRole:(G=this._forcedLocalDtlsRole)!=null?G:"client",localSdpObject:J}));let X=!1;const _e=(0,o.parse)((x??[{}])[0].scalabilityMode);let Pe;x&&x.length===1&&_e.spatialLayers>1&&oe.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),X=!0,J=t.parse(U.sdp),Pe=J.media[K.idx],p.addLegacySimulcast({offerMediaObject:Pe,numStreams:_e.spatialLayers}),U={type:"offer",sdp:t.write(J)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U);const xe=z.mid;if(oe.mid=xe,J=t.parse(this._pc.localDescription.sdp),Pe=J.media[K.idx],oe.rtcp.cname=u.getCname({offerMediaObject:Pe}),!x)oe.encodings=p.getRtpEncodings({offerMediaObject:Pe});else if(x.length===1){let ye=p.getRtpEncodings({offerMediaObject:Pe});Object.assign(ye[0],x[0]),X&&(ye=[ye[0]]),oe.encodings=ye}else oe.encodings=x;if(oe.encodings.length>1&&(oe.codecs[0].mimeType.toLowerCase()==="video/vp8"||oe.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ye of oe.encodings)ye.scalabilityMode?ye.scalabilityMode=`L1T${_e.temporalLayers}`:ye.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:Pe,reuseMid:K.reuseMid,offerRtpParameters:oe,answerRtpParameters:he,codecOptions:k});const ge={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ge),yield this._pc.setRemoteDescription(ge),this._mapMidTransceiver.set(xe,z),{localId:xe,rtpParameters:oe,rtpSender:z.sender}})}stopSending(S){return B(this,null,function*(){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",S),this._closed)return;const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");if(b.sender.replaceTrack(null),this._pc.removeTrack(b.sender),this._remoteSdp.closeMediaSection(b.mid))try{b.stop()}catch{}const k=yield this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",k),yield this._pc.setLocalDescription(k);const L={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",L),yield this._pc.setRemoteDescription(L),this._mapMidTransceiver.delete(S)})}pauseSending(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(S);const x=yield this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",x),yield this._pc.setLocalDescription(x);const k={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",k),yield this._pc.setRemoteDescription(k)})}resumeSending(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(this._remoteSdp.resumeSendingMediaSection(S),!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="sendonly";const x=yield this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",x),yield this._pc.setLocalDescription(x);const k={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",k),yield this._pc.setRemoteDescription(k)})}replaceTrack(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),b?f.debug("replaceTrack() [localId:%s, track.id:%s]",S,b.id):f.debug("replaceTrack() [localId:%s, no track]",S);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");yield x.sender.replaceTrack(b)})}setMaxSpatialLayer(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,b);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");const k=x.sender.getParameters();k.encodings.forEach((K,z)=>{z<=b?K.active=!0:K.active=!1}),yield x.sender.setParameters(k),this._remoteSdp.muxMediaSectionSimulcast(S,k.encodings);const L=yield this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",L),yield this._pc.setLocalDescription(L);const G={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",G),yield this._pc.setRemoteDescription(G)})}setRtpEncodingParameters(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,b);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");const k=x.sender.getParameters();k.encodings.forEach((K,z)=>{k.encodings[z]=ee(ee({},K),b)}),yield x.sender.setParameters(k),this._remoteSdp.muxMediaSectionSimulcast(S,k.encodings);const L=yield this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",L),yield this._pc.setLocalDescription(L);const G={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",G),yield this._pc.setRemoteDescription(G)})}getSenderStats(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");return b.sender.getStats()})}sendDataChannel(S){return B(this,arguments,function*({ordered:b,maxPacketLifeTime:x,maxRetransmits:k,label:L,protocol:G}){var K;this.assertNotClosed(),this.assertSendDirection();const z={negotiated:!0,id:this._nextSendSctpStreamId,ordered:b,maxPacketLifeTime:x,maxRetransmits:k,protocol:G};f.debug("sendDataChannel() [options:%o]",z);const U=this._pc.createDataChannel(L,z);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%w.MIS,!this._hasDataChannelMediaSection){const Q=yield this._pc.createOffer(),ne=t.parse(Q.sdp),oe=ne.media.find(X=>X.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(K=this._forcedLocalDtlsRole)!=null?K:"client",localSdpObject:ne})),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",Q),yield this._pc.setLocalDescription(Q),this._remoteSdp.sendSctpAssociation({offerMediaObject:oe});const he={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",he),yield this._pc.setRemoteDescription(he),this._hasDataChannelMediaSection=!0}const J={streamId:z.id,ordered:z.ordered,maxPacketLifeTime:z.maxPacketLifeTime,maxRetransmits:z.maxRetransmits};return{dataChannel:U,sctpStreamParameters:J}})}receive(S){return B(this,null,function*(){var b,x;this.assertNotClosed(),this.assertRecvDirection();const k=[],L=new Map;for(const U of S){const{trackId:J,kind:Q,rtpParameters:ne,streamId:oe}=U;f.debug("receive() [trackId:%s, kind:%s]",J,Q);const he=(b=ne.mid)!=null?b:String(this._mapMidTransceiver.size);L.set(J,he),this._remoteSdp.receive({mid:he,kind:Q,offerRtpParameters:ne,streamId:oe??ne.rtcp.cname,trackId:J})}const G={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",G),yield this._pc.setRemoteDescription(G);let K=yield this._pc.createAnswer();const z=t.parse(K.sdp);for(const U of S){const{trackId:J,rtpParameters:Q}=U,ne=L.get(J),oe=z.media.find(he=>String(he.mid)===ne);u.applyCodecParameters({offerRtpParameters:Q,answerMediaObject:oe})}K={type:"answer",sdp:t.write(z)},this._transportReady||(yield this.setupTransport({localDtlsRole:(x=this._forcedLocalDtlsRole)!=null?x:"client",localSdpObject:z})),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K);for(const U of S){const{trackId:J}=U,Q=L.get(J),ne=this._pc.getTransceivers().find(oe=>oe.mid===Q);if(ne)this._mapMidTransceiver.set(Q,ne),k.push({localId:Q,track:ne.receiver.track,rtpReceiver:ne.receiver});else throw new Error("new RTCRtpTransceiver not found")}return k})}stopReceiving(S){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const k of S){f.debug("stopReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(L.mid)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x);for(const k of S)this._mapMidTransceiver.delete(k)})}pauseReceiving(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const k of S){f.debug("pauseReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="inactive",this._remoteSdp.pauseMediaSection(k)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)})}resumeReceiving(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const k of S){f.debug("resumeReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(k)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)})}getReceiverStats(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");return b.receiver.getStats()})}receiveDataChannel(S){return B(this,arguments,function*({sctpStreamParameters:b,label:x,protocol:k}){var L;this.assertNotClosed(),this.assertRecvDirection();const{streamId:G,ordered:K,maxPacketLifeTime:z,maxRetransmits:U}=b,J={negotiated:!0,id:G,ordered:K,maxPacketLifeTime:z,maxRetransmits:U,protocol:k};f.debug("receiveDataChannel() [options:%o]",J);const Q=this._pc.createDataChannel(x,J);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const ne={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",ne),yield this._pc.setRemoteDescription(ne);const oe=yield this._pc.createAnswer();if(!this._transportReady){const he=t.parse(oe.sdp);yield this.setupTransport({localDtlsRole:(L=this._forcedLocalDtlsRole)!=null?L:"client",localSdpObject:he})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",oe),yield this._pc.setLocalDescription(oe),this._hasDataChannelMediaSection=!0}return{dataChannel:Q}})}setupTransport(S){return B(this,arguments,function*({localDtlsRole:b,localSdpObject:x}){x||(x=t.parse(this._pc.localDescription.sdp));const k=u.extractDtlsParameters({sdpObject:x});k.role=b,this._remoteSdp.updateDtlsRole(b==="client"?"server":"client"),yield new Promise((L,G)=>{this.safeEmit("@connect",{dtlsParameters:k},L,G)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new a.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Chrome74=R}}),uC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/Firefox120.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Firefox120=void 0;var t=qr(),n=cr(),r=Yn(),i=zr(),a=xi(),o=Ia(),u=ic(),p=sc(),h=ac(),y=new r.Logger("Firefox120"),f="Firefox120",_={OS:16,MIS:2048},w=class cl extends n.EnhancedEventEmitter{constructor({direction:F,iceParameters:S,iceCandidates:b,dtlsParameters:x,sctpParameters:k,iceServers:L,iceTransportPolicy:G,additionalSettings:K,getSendExtendedRtpCapabilities:z}){super(),ce(this,"_closed",!1),ce(this,"_direction"),ce(this,"_remoteSdp"),ce(this,"_getSendExtendedRtpCapabilities"),ce(this,"_pc"),ce(this,"_mapMidTransceiver",new Map),ce(this,"_sendStream",new MediaStream),ce(this,"_hasDataChannelMediaSection",!1),ce(this,"_nextSendSctpStreamId",0),ce(this,"_transportReady",!1),ce(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),ce(this,"onIceCandidateError",U=>{this.emit("@icecandidateerror",U)}),ce(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}),ce(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),y.debug("constructor()"),this._direction=F,this._remoteSdp=new h.RemoteSdp({iceParameters:S,iceCandidates:b,dtlsParameters:x,sctpParameters:k}),this._getSendExtendedRtpCapabilities=z,this._pc=new RTCPeerConnection(ee({iceServers:L??[],iceTransportPolicy:G??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},K)),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(y.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:f,factory:F=>new cl(F),getNativeRtpCapabilities:()=>B(null,null,function*(){y.debug("getNativeRtpCapabilities()");let F=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});const S=document.createElement("canvas");S.getContext("2d");const x=S.captureStream().getVideoTracks()[0];try{F.addTransceiver("audio",{direction:"sendrecv"}),F.addTransceiver(x,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const k=yield F.createOffer();try{S.remove()}catch{}try{x.stop()}catch{}try{F.close()}catch{}F=void 0;const L=t.parse(k.sdp);return cl.getLocalRtpCapabilities(L)}catch(k){try{S.remove()}catch{}try{x.stop()}catch{}try{F==null||F.close()}catch{}throw F=void 0,k}}),getNativeSctpCapabilities:()=>B(null,null,function*(){return y.debug("getNativeSctpCapabilities()"),{numStreams:_}})}}static getLocalRtpCapabilities(F){return u.extractRtpCapabilities({sdpObject:F})}get name(){return f}close(){if(y.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}updateIceServers(F){return B(this,null,function*(){throw this.assertNotClosed(),new i.UnsupportedError("not supported")})}restartIce(F){return B(this,null,function*(){if(this.assertNotClosed(),y.debug("restartIce()"),this._remoteSdp.updateIceParameters(F),!!this._transportReady)if(this._direction==="send"){const S=yield this._pc.createOffer({iceRestart:!0});y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",S),yield this._pc.setLocalDescription(S);const b={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",b),yield this._pc.setRemoteDescription(b)}else{const S={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",S),yield this._pc.setRemoteDescription(S);const b=yield this._pc.createAnswer();y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(F){return B(this,arguments,function*({track:S,encodings:b,codecOptions:x,codec:k,onRtpSender:L}){this.assertNotClosed(),this.assertSendDirection(),y.debug("send() [kind:%s, track.id:%s]",S.kind,S.id),b&&b.length>1&&b.forEach((Pe,xe)=>{Pe.rid=`r${xe}`});const G=this._pc.addTransceiver(S,{direction:"sendonly",streams:[this._sendStream],sendEncodings:b});L&&L(G.sender);const K=yield this._pc.createOffer();let z=t.parse(K.sdp);z.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const U=cl.getLocalRtpCapabilities(z),J=this._getSendExtendedRtpCapabilities(U),Q=a.getSendingRtpParameters(S.kind,J);Q.codecs=a.reduceCodecs(Q.codecs,k);const ne=a.getSendingRemoteRtpParameters(S.kind,J);ne.codecs=a.reduceCodecs(ne.codecs,k),this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:z}));const oe=(0,o.parse)((b??[{}])[0].scalabilityMode);y.debug("send() | calling pc.setLocalDescription() [offer:%o]",K),yield this._pc.setLocalDescription(K);const he=G.mid;Q.mid=he,z=t.parse(this._pc.localDescription.sdp);const X=z.media[z.media.length-1];if(Q.rtcp.cname=u.getCname({offerMediaObject:X}),!b)Q.encodings=p.getRtpEncodings({offerMediaObject:X});else if(b.length===1){const Pe=p.getRtpEncodings({offerMediaObject:X});Object.assign(Pe[0],b[0]),Q.encodings=Pe}else Q.encodings=b;if(Q.encodings.length>1&&(Q.codecs[0].mimeType.toLowerCase()==="video/vp8"||Q.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Pe of Q.encodings)Pe.scalabilityMode?Pe.scalabilityMode=`L1T${oe.temporalLayers}`:Pe.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:X,offerRtpParameters:Q,answerRtpParameters:ne,codecOptions:x});const _e={type:"answer",sdp:this._remoteSdp.getSdp()};return y.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_e),yield this._pc.setRemoteDescription(_e),this._mapMidTransceiver.set(he,G),{localId:he,rtpParameters:Q,rtpSender:G.sender}})}stopSending(F){return B(this,null,function*(){if(this.assertSendDirection(),y.debug("stopSending() [localId:%s]",F),this._closed)return;const S=this._mapMidTransceiver.get(F);if(!S)throw new Error("associated transceiver not found");S.sender.replaceTrack(null),this._pc.removeTrack(S.sender),this._remoteSdp.disableMediaSection(S.mid);const b=yield this._pc.createOffer();y.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const x={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",x),yield this._pc.setRemoteDescription(x),this._mapMidTransceiver.delete(F)})}pauseSending(F){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),y.debug("pauseSending() [localId:%s]",F);const S=this._mapMidTransceiver.get(F);if(!S)throw new Error("associated RTCRtpTransceiver not found");S.direction="inactive",this._remoteSdp.pauseMediaSection(F);const b=yield this._pc.createOffer();y.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const x={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",x),yield this._pc.setRemoteDescription(x)})}resumeSending(F){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),y.debug("resumeSending() [localId:%s]",F);const S=this._mapMidTransceiver.get(F);if(!S)throw new Error("associated RTCRtpTransceiver not found");S.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(F);const b=yield this._pc.createOffer();y.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const x={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",x),yield this._pc.setRemoteDescription(x)})}replaceTrack(F,S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),S?y.debug("replaceTrack() [localId:%s, track.id:%s]",F,S.id):y.debug("replaceTrack() [localId:%s, no track]",F);const b=this._mapMidTransceiver.get(F);if(!b)throw new Error("associated RTCRtpTransceiver not found");yield b.sender.replaceTrack(S)})}setMaxSpatialLayer(F,S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",F,S);const b=this._mapMidTransceiver.get(F);if(!b)throw new Error("associated transceiver not found");const x=b.sender.getParameters();x.encodings.forEach((G,K)=>{K<=S?G.active=!0:G.active=!1}),yield b.sender.setParameters(x),this._remoteSdp.muxMediaSectionSimulcast(F,x.encodings);const k=yield this._pc.createOffer();y.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",k),yield this._pc.setLocalDescription(k);const L={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",L),yield this._pc.setRemoteDescription(L)})}setRtpEncodingParameters(F,S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",F,S);const b=this._mapMidTransceiver.get(F);if(!b)throw new Error("associated RTCRtpTransceiver not found");const x=b.sender.getParameters();x.encodings.forEach((G,K)=>{x.encodings[K]=ee(ee({},G),S)}),yield b.sender.setParameters(x),this._remoteSdp.muxMediaSectionSimulcast(F,x.encodings);const k=yield this._pc.createOffer();y.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",k),yield this._pc.setLocalDescription(k);const L={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",L),yield this._pc.setRemoteDescription(L)})}getSenderStats(F){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const S=this._mapMidTransceiver.get(F);if(!S)throw new Error("associated RTCRtpTransceiver not found");return S.sender.getStats()})}sendDataChannel(F){return B(this,arguments,function*({ordered:S,maxPacketLifeTime:b,maxRetransmits:x,label:k,protocol:L}){this.assertNotClosed(),this.assertSendDirection();const G={negotiated:!0,id:this._nextSendSctpStreamId,ordered:S,maxPacketLifeTime:b,maxRetransmits:x,protocol:L};y.debug("sendDataChannel() [options:%o]",G);const K=this._pc.createDataChannel(k,G);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%_.MIS,!this._hasDataChannelMediaSection){const U=yield this._pc.createOffer(),J=t.parse(U.sdp),Q=J.media.find(oe=>oe.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:J})),y.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",U),yield this._pc.setLocalDescription(U),this._remoteSdp.sendSctpAssociation({offerMediaObject:Q});const ne={type:"answer",sdp:this._remoteSdp.getSdp()};y.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",ne),yield this._pc.setRemoteDescription(ne),this._hasDataChannelMediaSection=!0}const z={streamId:G.id,ordered:G.ordered,maxPacketLifeTime:G.maxPacketLifeTime,maxRetransmits:G.maxRetransmits};return{dataChannel:K,sctpStreamParameters:z}})}receive(F){return B(this,null,function*(){var S;this.assertNotClosed(),this.assertRecvDirection();const b=[],x=new Map;for(const K of F){const{trackId:z,kind:U,rtpParameters:J,streamId:Q}=K;y.debug("receive() [trackId:%s, kind:%s]",z,U);const ne=(S=J.mid)!=null?S:String(this._mapMidTransceiver.size);x.set(z,ne),this._remoteSdp.receive({mid:ne,kind:U,offerRtpParameters:J,streamId:Q??J.rtcp.cname,trackId:z})}const k={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",k),yield this._pc.setRemoteDescription(k);for(const K of F){const{trackId:z,onRtpReceiver:U}=K;if(U){const J=x.get(z),Q=this._pc.getTransceivers().find(ne=>ne.mid===J);if(!Q)throw new Error("transceiver not found");U(Q.receiver)}}let L=yield this._pc.createAnswer();const G=t.parse(L.sdp);for(const K of F){const{trackId:z,rtpParameters:U}=K,J=x.get(z),Q=G.media.find(ne=>String(ne.mid)===J);u.applyCodecParameters({offerRtpParameters:U,answerMediaObject:Q}),L={type:"answer",sdp:t.write(G)}}this._transportReady||(yield this.setupTransport({localDtlsRole:"client",localSdpObject:G})),y.debug("receive() | calling pc.setLocalDescription() [answer:%o]",L),yield this._pc.setLocalDescription(L);for(const K of F){const{trackId:z}=K,U=x.get(z),J=this._pc.getTransceivers().find(Q=>Q.mid===U);if(!J)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(U,J),b.push({localId:U,track:J.receiver.track,rtpReceiver:J.receiver})}return b})}stopReceiving(F){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const x of F){y.debug("stopReceiving() [localId:%s]",x);const k=this._mapMidTransceiver.get(x);if(!k)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(k.mid)}const S={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",S),yield this._pc.setRemoteDescription(S);const b=yield this._pc.createAnswer();y.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b);for(const x of F)this._mapMidTransceiver.delete(x)})}pauseReceiving(F){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const x of F){y.debug("pauseReceiving() [localId:%s]",x);const k=this._mapMidTransceiver.get(x);if(!k)throw new Error("associated RTCRtpTransceiver not found");k.direction="inactive",this._remoteSdp.pauseMediaSection(x)}const S={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",S),yield this._pc.setRemoteDescription(S);const b=yield this._pc.createAnswer();y.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}resumeReceiving(F){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const x of F){y.debug("resumeReceiving() [localId:%s]",x);const k=this._mapMidTransceiver.get(x);if(!k)throw new Error("associated RTCRtpTransceiver not found");k.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(x)}const S={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",S),yield this._pc.setRemoteDescription(S);const b=yield this._pc.createAnswer();y.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",b),yield this._pc.setLocalDescription(b)})}getReceiverStats(F){return B(this,null,function*(){this.assertRecvDirection();const S=this._mapMidTransceiver.get(F);if(!S)throw new Error("associated RTCRtpTransceiver not found");return S.receiver.getStats()})}receiveDataChannel(F){return B(this,arguments,function*({sctpStreamParameters:S,label:b,protocol:x}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:k,ordered:L,maxPacketLifeTime:G,maxRetransmits:K}=S,z={negotiated:!0,id:k,ordered:L,maxPacketLifeTime:G,maxRetransmits:K,protocol:x};y.debug("receiveDataChannel() [options:%o]",z);const U=this._pc.createDataChannel(b,z);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const J={type:"offer",sdp:this._remoteSdp.getSdp()};y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",J),yield this._pc.setRemoteDescription(J);const Q=yield this._pc.createAnswer();if(!this._transportReady){const ne=t.parse(Q.sdp);yield this.setupTransport({localDtlsRole:"client",localSdpObject:ne})}y.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),yield this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:U}})}setupTransport(F){return B(this,arguments,function*({localDtlsRole:S,localSdpObject:b}){b||(b=t.parse(this._pc.localDescription.sdp));const x=u.extractDtlsParameters({sdpObject:b});x.role=S,this._remoteSdp.updateDtlsRole(S==="client"?"server":"client"),yield new Promise((k,L)=>{this.safeEmit("@connect",{dtlsParameters:x},k,L)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new i.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Firefox120=w}}),dC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/Safari12.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Safari12=void 0;var t=qr(),n=cr(),r=Yn(),i=xi(),a=zr(),o=Ia(),u=ac(),p=ic(),h=sc(),y=Pu(),f=new r.Logger("Safari12"),_="Safari12",w={OS:1024,MIS:1024},R=class ll extends n.EnhancedEventEmitter{constructor({direction:S,iceParameters:b,iceCandidates:x,dtlsParameters:k,sctpParameters:L,iceServers:G,iceTransportPolicy:K,additionalSettings:z,getSendExtendedRtpCapabilities:U}){super(),ce(this,"_closed",!1),ce(this,"_direction"),ce(this,"_remoteSdp"),ce(this,"_getSendExtendedRtpCapabilities"),ce(this,"_forcedLocalDtlsRole"),ce(this,"_pc"),ce(this,"_mapMidTransceiver",new Map),ce(this,"_sendStream",new MediaStream),ce(this,"_hasDataChannelMediaSection",!1),ce(this,"_nextSendSctpStreamId",0),ce(this,"_transportReady",!1),ce(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),ce(this,"onIceCandidateError",J=>{this.emit("@icecandidateerror",J)}),ce(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}),ce(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),f.debug("constructor()"),this._direction=S,this._remoteSdp=new u.RemoteSdp({iceParameters:b,iceCandidates:x,dtlsParameters:k,sctpParameters:L}),this._getSendExtendedRtpCapabilities=U,k.role&&k.role!=="auto"&&(this._forcedLocalDtlsRole=k.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ee({iceServers:G??[],iceTransportPolicy:K??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},z)),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",J=>{this.emit("@icecandidateerror",J)}),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:_,factory:S=>new ll(S),getNativeRtpCapabilities:()=>B(null,null,function*(){f.debug("getNativeRtpCapabilities()");let S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{S.addTransceiver("audio"),S.addTransceiver("video");const b=yield S.createOffer();try{S.close()}catch{}S=void 0;const x=t.parse(b.sdp);return ll.getLocalRtpCapabilities(x)}catch(b){try{S==null||S.close()}catch{}throw S=void 0,b}}),getNativeSctpCapabilities:()=>B(null,null,function*(){return f.debug("getNativeSctpCapabilities()"),{numStreams:w}})}}static getLocalRtpCapabilities(S){const b=p.extractRtpCapabilities({sdpObject:S});return y.addNackSupportForOpus(b),b}get name(){return _}close(){if(f.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}updateIceServers(S){return B(this,null,function*(){this.assertNotClosed(),f.debug("updateIceServers()");const b=this._pc.getConfiguration();b.iceServers=S,this._pc.setConfiguration(b)})}restartIce(S){return B(this,null,function*(){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const b=yield this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const x={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",x),yield this._pc.setRemoteDescription(x)}else{const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(S){return B(this,arguments,function*({track:b,encodings:x,codecOptions:k,codec:L,onRtpSender:G}){var K;this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",b.kind,b.id);const z=this._remoteSdp.getNextMediaSectionIdx(),U=this._pc.addTransceiver(b,{direction:"sendonly",streams:[this._sendStream]});G&&G(U.sender);let J=yield this._pc.createOffer(),Q=t.parse(J.sdp);Q.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const ne=ll.getLocalRtpCapabilities(Q),oe=this._getSendExtendedRtpCapabilities(ne),he=i.getSendingRtpParameters(b.kind,oe);he.codecs=i.reduceCodecs(he.codecs,L);const X=i.getSendingRemoteRtpParameters(b.kind,oe);X.codecs=i.reduceCodecs(X.codecs,L);let _e;this._transportReady||(yield this.setupTransport({localDtlsRole:(K=this._forcedLocalDtlsRole)!=null?K:"client",localSdpObject:Q}));const Pe=(0,o.parse)((x??[{}])[0].scalabilityMode);x&&x.length>1&&(f.debug("send() | enabling legacy simulcast"),Q=t.parse(J.sdp),_e=Q.media[z.idx],h.addLegacySimulcast({offerMediaObject:_e,numStreams:x.length}),J={type:"offer",sdp:t.write(Q)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",J),yield this._pc.setLocalDescription(J);const xe=U.mid;if(he.mid=xe,Q=t.parse(this._pc.localDescription.sdp),_e=Q.media[z.idx],he.rtcp.cname=p.getCname({offerMediaObject:_e}),he.encodings=h.getRtpEncodings({offerMediaObject:_e}),x)for(let ye=0;ye<he.encodings.length;++ye)x[ye]&&Object.assign(he.encodings[ye],x[ye]);if(he.encodings.length>1&&(he.codecs[0].mimeType.toLowerCase()==="video/vp8"||he.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ye of he.encodings)ye.scalabilityMode?ye.scalabilityMode=`L1T${Pe.temporalLayers}`:ye.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:_e,reuseMid:z.reuseMid,offerRtpParameters:he,answerRtpParameters:X,codecOptions:k});const ge={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ge),yield this._pc.setRemoteDescription(ge),this._mapMidTransceiver.set(xe,U),{localId:xe,rtpParameters:he,rtpSender:U.sender}})}stopSending(S){return B(this,null,function*(){if(this.assertSendDirection(),this._closed)return;f.debug("stopSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");if(b.sender.replaceTrack(null),this._pc.removeTrack(b.sender),this._remoteSdp.closeMediaSection(b.mid))try{b.stop()}catch{}const k=yield this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",k),yield this._pc.setLocalDescription(k);const L={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",L),yield this._pc.setRemoteDescription(L),this._mapMidTransceiver.delete(S)})}pauseSending(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(S);const x=yield this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",x),yield this._pc.setLocalDescription(x);const k={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",k),yield this._pc.setRemoteDescription(k)})}resumeSending(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(S);const x=yield this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",x),yield this._pc.setLocalDescription(x);const k={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",k),yield this._pc.setRemoteDescription(k)})}replaceTrack(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),b?f.debug("replaceTrack() [localId:%s, track.id:%s]",S,b.id):f.debug("replaceTrack() [localId:%s, no track]",S);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");yield x.sender.replaceTrack(b)})}setMaxSpatialLayer(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,b);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");const k=x.sender.getParameters();k.encodings.forEach((K,z)=>{z<=b?K.active=!0:K.active=!1}),yield x.sender.setParameters(k),this._remoteSdp.muxMediaSectionSimulcast(S,k.encodings);const L=yield this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",L),yield this._pc.setLocalDescription(L);const G={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",G),yield this._pc.setRemoteDescription(G)})}setRtpEncodingParameters(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,b);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");const k=x.sender.getParameters();k.encodings.forEach((K,z)=>{k.encodings[z]=ee(ee({},K),b)}),yield x.sender.setParameters(k),this._remoteSdp.muxMediaSectionSimulcast(S,k.encodings);const L=yield this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",L),yield this._pc.setLocalDescription(L);const G={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",G),yield this._pc.setRemoteDescription(G)})}getSenderStats(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");return b.sender.getStats()})}sendDataChannel(S){return B(this,arguments,function*({ordered:b,maxPacketLifeTime:x,maxRetransmits:k,label:L,protocol:G}){var K;this.assertNotClosed(),this.assertSendDirection();const z={negotiated:!0,id:this._nextSendSctpStreamId,ordered:b,maxPacketLifeTime:x,maxRetransmits:k,protocol:G};f.debug("sendDataChannel() [options:%o]",z);const U=this._pc.createDataChannel(L,z);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%w.MIS,!this._hasDataChannelMediaSection){const Q=yield this._pc.createOffer(),ne=t.parse(Q.sdp),oe=ne.media.find(X=>X.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(K=this._forcedLocalDtlsRole)!=null?K:"client",localSdpObject:ne})),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",Q),yield this._pc.setLocalDescription(Q),this._remoteSdp.sendSctpAssociation({offerMediaObject:oe});const he={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",he),yield this._pc.setRemoteDescription(he),this._hasDataChannelMediaSection=!0}const J={streamId:z.id,ordered:z.ordered,maxPacketLifeTime:z.maxPacketLifeTime,maxRetransmits:z.maxRetransmits};return{dataChannel:U,sctpStreamParameters:J}})}receive(S){return B(this,null,function*(){var b,x;this.assertNotClosed(),this.assertRecvDirection();const k=[],L=new Map;for(const U of S){const{trackId:J,kind:Q,rtpParameters:ne,streamId:oe}=U;f.debug("receive() [trackId:%s, kind:%s]",J,Q);const he=(b=ne.mid)!=null?b:String(this._mapMidTransceiver.size);L.set(J,he),this._remoteSdp.receive({mid:he,kind:Q,offerRtpParameters:ne,streamId:oe??ne.rtcp.cname,trackId:J})}const G={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",G),yield this._pc.setRemoteDescription(G);for(const U of S){const{trackId:J,onRtpReceiver:Q}=U;if(Q){const ne=L.get(J),oe=this._pc.getTransceivers().find(he=>he.mid===ne);if(!oe)throw new Error("transceiver not found");Q(oe.receiver)}}let K=yield this._pc.createAnswer();const z=t.parse(K.sdp);for(const U of S){const{trackId:J,rtpParameters:Q}=U,ne=L.get(J),oe=z.media.find(he=>String(he.mid)===ne);p.applyCodecParameters({offerRtpParameters:Q,answerMediaObject:oe})}K={type:"answer",sdp:t.write(z)},this._transportReady||(yield this.setupTransport({localDtlsRole:(x=this._forcedLocalDtlsRole)!=null?x:"client",localSdpObject:z})),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K);for(const U of S){const{trackId:J}=U,Q=L.get(J),ne=this._pc.getTransceivers().find(oe=>oe.mid===Q);if(!ne)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(Q,ne),k.push({localId:Q,track:ne.receiver.track,rtpReceiver:ne.receiver})}return k})}stopReceiving(S){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const k of S){f.debug("stopReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(L.mid)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x);for(const k of S)this._mapMidTransceiver.delete(k)})}pauseReceiving(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const k of S){f.debug("pauseReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="inactive",this._remoteSdp.pauseMediaSection(k)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)})}resumeReceiving(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const k of S){f.debug("resumeReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(k)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)})}getReceiverStats(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");return b.receiver.getStats()})}receiveDataChannel(S){return B(this,arguments,function*({sctpStreamParameters:b,label:x,protocol:k}){var L;this.assertNotClosed(),this.assertRecvDirection();const{streamId:G,ordered:K,maxPacketLifeTime:z,maxRetransmits:U}=b,J={negotiated:!0,id:G,ordered:K,maxPacketLifeTime:z,maxRetransmits:U,protocol:k};f.debug("receiveDataChannel() [options:%o]",J);const Q=this._pc.createDataChannel(x,J);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const ne={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",ne),yield this._pc.setRemoteDescription(ne);const oe=yield this._pc.createAnswer();if(!this._transportReady){const he=t.parse(oe.sdp);yield this.setupTransport({localDtlsRole:(L=this._forcedLocalDtlsRole)!=null?L:"client",localSdpObject:he})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",oe),yield this._pc.setLocalDescription(oe),this._hasDataChannelMediaSection=!0}return{dataChannel:Q}})}setupTransport(S){return B(this,arguments,function*({localDtlsRole:b,localSdpObject:x}){x||(x=t.parse(this._pc.localDescription.sdp));const k=p.extractDtlsParameters({sdpObject:x});k.role=b,this._remoteSdp.updateDtlsRole(b==="client"?"server":"client"),yield new Promise((L,G)=>{this.safeEmit("@connect",{dtlsParameters:k},L,G)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new a.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.Safari12=R}}),hC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/ReactNative106.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.ReactNative106=void 0;var t=qr(),n=cr(),r=Yn(),i=xi(),a=zr(),o=Ia(),u=ac(),p=ic(),h=sc(),y=Pu(),f=new r.Logger("ReactNative106"),_="ReactNative106",w={OS:1024,MIS:1024},R=class ul extends n.EnhancedEventEmitter{constructor({direction:S,iceParameters:b,iceCandidates:x,dtlsParameters:k,sctpParameters:L,iceServers:G,iceTransportPolicy:K,additionalSettings:z,getSendExtendedRtpCapabilities:U}){super(),ce(this,"_closed",!1),ce(this,"_direction"),ce(this,"_remoteSdp"),ce(this,"_getSendExtendedRtpCapabilities"),ce(this,"_forcedLocalDtlsRole"),ce(this,"_pc"),ce(this,"_mapMidTransceiver",new Map),ce(this,"_sendStream",new MediaStream),ce(this,"_hasDataChannelMediaSection",!1),ce(this,"_nextSendSctpStreamId",0),ce(this,"_transportReady",!1),ce(this,"onIceGatheringStateChange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),ce(this,"onIceCandidateError",J=>{this.emit("@icecandidateerror",J)}),ce(this,"onConnectionStateChange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}),ce(this,"onIceConnectionStateChange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),f.debug("constructor()"),this._direction=S,this._remoteSdp=new u.RemoteSdp({iceParameters:b,iceCandidates:x,dtlsParameters:k,sctpParameters:L}),this._getSendExtendedRtpCapabilities=U,k.role&&k.role!=="auto"&&(this._forcedLocalDtlsRole=k.role==="server"?"client":"server"),this._pc=new RTCPeerConnection(ee({iceServers:G??[],iceTransportPolicy:K??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},z)),this._pc.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.addEventListener("icecandidateerror",this.onIceCandidateError),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",this.onConnectionStateChange):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange))}static createFactory(){return{name:_,factory:S=>new ul(S),getNativeRtpCapabilities:()=>B(null,null,function*(){f.debug("getNativeRtpCapabilities()");let S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{S.addTransceiver("audio"),S.addTransceiver("video");const b=yield S.createOffer();try{S.close()}catch{}S=void 0;const x=t.parse(b.sdp);return ul.getLocalRtpCapabilities(x)}catch(b){try{S==null||S.close()}catch{}throw S=void 0,b}}),getNativeSctpCapabilities:()=>B(null,null,function*(){return f.debug("getNativeSctpCapabilities()"),{numStreams:w}})}}static getLocalRtpCapabilities(S){const b=p.extractRtpCapabilities({sdpObject:S});return y.addNackSupportForOpus(b),b}get name(){return _}close(){if(f.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch{}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),super.close()}}updateIceServers(S){return B(this,null,function*(){this.assertNotClosed(),f.debug("updateIceServers()");const b=this._pc.getConfiguration();b.iceServers=S,this._pc.setConfiguration(b)})}restartIce(S){return B(this,null,function*(){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const b=yield this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",b),yield this._pc.setLocalDescription(b);const x={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",x),yield this._pc.setRemoteDescription(x)}else{const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)}})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),this._pc.getStats()})}send(S){return B(this,arguments,function*({track:b,encodings:x,codecOptions:k,codec:L,onRtpSender:G}){var K,z;this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",b.kind,b.id),x&&x.length>1&&x.forEach((Ne,Ye)=>{Ne.rid=`r${Ye}`});const U=this._remoteSdp.getNextMediaSectionIdx(),J=this._pc.addTransceiver(b,{direction:"sendonly",streams:[this._sendStream],sendEncodings:x});G&&G(J.sender);let Q=yield this._pc.createOffer(),ne=t.parse(Q.sdp);ne.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const oe=ul.getLocalRtpCapabilities(ne),he=this._getSendExtendedRtpCapabilities(oe),X=i.getSendingRtpParameters(b.kind,he);X.codecs=i.reduceCodecs(X.codecs,L);const _e=i.getSendingRemoteRtpParameters(b.kind,he);_e.codecs=i.reduceCodecs(_e.codecs,L),this._transportReady||(yield this.setupTransport({localDtlsRole:(K=this._forcedLocalDtlsRole)!=null?K:"client",localSdpObject:ne}));let Pe=!1;const xe=(0,o.parse)((x??[{}])[0].scalabilityMode);let ge;x&&x.length===1&&xe.spatialLayers>1&&X.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),Pe=!0,ne=t.parse(Q.sdp),ge=ne.media[U.idx],h.addLegacySimulcast({offerMediaObject:ge,numStreams:xe.spatialLayers}),Q={type:"offer",sdp:t.write(ne)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",Q),yield this._pc.setLocalDescription(Q);let ye=(z=J.mid)!=null?z:void 0;if(ye||f.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),X.mid=ye,ne=t.parse(this._pc.localDescription.sdp),ge=ne.media[U.idx],X.rtcp.cname=p.getCname({offerMediaObject:ge}),!x)X.encodings=h.getRtpEncodings({offerMediaObject:ge});else if(x.length===1){let Ne=h.getRtpEncodings({offerMediaObject:ge});Object.assign(Ne[0],x[0]),Pe&&(Ne=[Ne[0]]),X.encodings=Ne}else X.encodings=x;if(X.encodings.length>1&&(X.codecs[0].mimeType.toLowerCase()==="video/vp8"||X.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const Ne of X.encodings)Ne.scalabilityMode?Ne.scalabilityMode=`L1T${xe.temporalLayers}`:Ne.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:ge,reuseMid:U.reuseMid,offerRtpParameters:X,answerRtpParameters:_e,codecOptions:k});const Ee={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Ee),yield this._pc.setRemoteDescription(Ee),ye||(ye=J.mid,X.mid=ye),this._mapMidTransceiver.set(ye,J),{localId:ye,rtpParameters:X,rtpSender:J.sender}})}stopSending(S){return B(this,null,function*(){if(this.assertSendDirection(),this._closed)return;f.debug("stopSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");if(b.sender.replaceTrack(null),this._pc.removeTrack(b.sender),this._remoteSdp.closeMediaSection(b.mid))try{b.stop()}catch{}const k=yield this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",k),yield this._pc.setLocalDescription(k);const L={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",L),yield this._pc.setRemoteDescription(L),this._mapMidTransceiver.delete(S)})}pauseSending(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="inactive",this._remoteSdp.pauseMediaSection(S);const x=yield this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",x),yield this._pc.setLocalDescription(x);const k={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",k),yield this._pc.setRemoteDescription(k)})}resumeSending(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",S);const b=this._mapMidTransceiver.get(S);if(this._remoteSdp.resumeSendingMediaSection(S),!b)throw new Error("associated RTCRtpTransceiver not found");b.direction="sendonly";const x=yield this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",x),yield this._pc.setLocalDescription(x);const k={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",k),yield this._pc.setRemoteDescription(k)})}replaceTrack(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),b?f.debug("replaceTrack() [localId:%s, track.id:%s]",S,b.id):f.debug("replaceTrack() [localId:%s, no track]",S);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");yield x.sender.replaceTrack(b)})}setMaxSpatialLayer(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,b);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");const k=x.sender.getParameters();k.encodings.forEach((K,z)=>{z<=b?K.active=!0:K.active=!1}),yield x.sender.setParameters(k),this._remoteSdp.muxMediaSectionSimulcast(S,k.encodings);const L=yield this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",L),yield this._pc.setLocalDescription(L);const G={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",G),yield this._pc.setRemoteDescription(G)})}setRtpEncodingParameters(S,b){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,b);const x=this._mapMidTransceiver.get(S);if(!x)throw new Error("associated RTCRtpTransceiver not found");const k=x.sender.getParameters();k.encodings.forEach((K,z)=>{k.encodings[z]=ee(ee({},K),b)}),yield x.sender.setParameters(k),this._remoteSdp.muxMediaSectionSimulcast(S,k.encodings);const L=yield this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",L),yield this._pc.setLocalDescription(L);const G={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",G),yield this._pc.setRemoteDescription(G)})}getSenderStats(S){return B(this,null,function*(){this.assertNotClosed(),this.assertSendDirection();const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");return b.sender.getStats()})}sendDataChannel(S){return B(this,arguments,function*({ordered:b,maxPacketLifeTime:x,maxRetransmits:k,label:L,protocol:G}){var K;this.assertNotClosed(),this.assertSendDirection();const z={negotiated:!0,id:this._nextSendSctpStreamId,ordered:b,maxPacketLifeTime:x,maxRetransmits:k,protocol:G};f.debug("sendDataChannel() [options:%o]",z);const U=this._pc.createDataChannel(L,z);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%w.MIS,!this._hasDataChannelMediaSection){const Q=yield this._pc.createOffer(),ne=t.parse(Q.sdp),oe=ne.media.find(X=>X.type==="application");this._transportReady||(yield this.setupTransport({localDtlsRole:(K=this._forcedLocalDtlsRole)!=null?K:"client",localSdpObject:ne})),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",Q),yield this._pc.setLocalDescription(Q),this._remoteSdp.sendSctpAssociation({offerMediaObject:oe});const he={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",he),yield this._pc.setRemoteDescription(he),this._hasDataChannelMediaSection=!0}const J={streamId:z.id,ordered:z.ordered,maxPacketLifeTime:z.maxPacketLifeTime,maxRetransmits:z.maxRetransmits};return{dataChannel:U,sctpStreamParameters:J}})}receive(S){return B(this,null,function*(){var b,x;this.assertNotClosed(),this.assertRecvDirection();const k=[],L=new Map;for(const U of S){const{trackId:J,kind:Q,rtpParameters:ne,streamId:oe}=U;f.debug("receive() [trackId:%s, kind:%s]",J,Q);const he=(b=ne.mid)!=null?b:String(this._mapMidTransceiver.size);L.set(J,he),this._remoteSdp.receive({mid:he,kind:Q,offerRtpParameters:ne,streamId:oe??ne.rtcp.cname,trackId:J})}const G={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",G),yield this._pc.setRemoteDescription(G);for(const U of S){const{trackId:J,onRtpReceiver:Q}=U;if(Q){const ne=L.get(J),oe=this._pc.getTransceivers().find(he=>he.mid===ne);if(!oe)throw new Error("transceiver not found");Q(oe.receiver)}}let K=yield this._pc.createAnswer();const z=t.parse(K.sdp);for(const U of S){const{trackId:J,rtpParameters:Q}=U,ne=L.get(J),oe=z.media.find(he=>String(he.mid)===ne);p.applyCodecParameters({offerRtpParameters:Q,answerMediaObject:oe})}K={type:"answer",sdp:t.write(z)},this._transportReady||(yield this.setupTransport({localDtlsRole:(x=this._forcedLocalDtlsRole)!=null?x:"client",localSdpObject:z})),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",K),yield this._pc.setLocalDescription(K);for(const U of S){const{trackId:J}=U,Q=L.get(J),ne=this._pc.getTransceivers().find(oe=>oe.mid===Q);if(ne)this._mapMidTransceiver.set(Q,ne),k.push({localId:Q,track:ne.receiver.track,rtpReceiver:ne.receiver});else throw new Error("new RTCRtpTransceiver not found")}return k})}stopReceiving(S){return B(this,null,function*(){if(this.assertRecvDirection(),this._closed)return;for(const k of S){f.debug("stopReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(L.mid)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x);for(const k of S)this._mapMidTransceiver.delete(k)})}pauseReceiving(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const k of S){f.debug("pauseReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="inactive",this._remoteSdp.pauseMediaSection(k)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)})}resumeReceiving(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();for(const k of S){f.debug("resumeReceiving() [localId:%s]",k);const L=this._mapMidTransceiver.get(k);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(k)}const b={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),yield this._pc.setRemoteDescription(b);const x=yield this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",x),yield this._pc.setLocalDescription(x)})}getReceiverStats(S){return B(this,null,function*(){this.assertNotClosed(),this.assertRecvDirection();const b=this._mapMidTransceiver.get(S);if(!b)throw new Error("associated RTCRtpTransceiver not found");return b.receiver.getStats()})}receiveDataChannel(S){return B(this,arguments,function*({sctpStreamParameters:b,label:x,protocol:k}){var L;this.assertNotClosed(),this.assertRecvDirection();const{streamId:G,ordered:K,maxPacketLifeTime:z,maxRetransmits:U}=b,J={negotiated:!0,id:G,ordered:K,maxPacketLifeTime:z,maxRetransmits:U,protocol:k};f.debug("receiveDataChannel() [options:%o]",J);const Q=this._pc.createDataChannel(x,J);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const ne={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",ne),yield this._pc.setRemoteDescription(ne);const oe=yield this._pc.createAnswer();if(!this._transportReady){const he=t.parse(oe.sdp);yield this.setupTransport({localDtlsRole:(L=this._forcedLocalDtlsRole)!=null?L:"client",localSdpObject:he})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",oe),yield this._pc.setLocalDescription(oe),this._hasDataChannelMediaSection=!0}return{dataChannel:Q}})}setupTransport(S){return B(this,arguments,function*({localDtlsRole:b,localSdpObject:x}){x||(x=t.parse(this._pc.localDescription.sdp));const k=p.extractDtlsParameters({sdpObject:x});k.role=b,this._remoteSdp.updateDtlsRole(b==="client"?"server":"client"),yield new Promise((L,G)=>{this.safeEmit("@connect",{dtlsParameters:k},L,G)}),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new a.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};e.ReactNative106=R}}),pC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/Device.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.Device=void 0,e.detectDeviceAsync=R,e.detectDevice=F;var t=sy(),n=Yn(),r=cr(),i=zr(),a=Aa(),o=xi(),u=aC(),p=cC(),h=lC(),y=uC(),f=dC(),_=hC(),w=new n.Logger("Device");function R(x){return B(this,null,function*(){w.debug("detectDeviceAsync() [userAgent:%s]",x),!x&&typeof navigator=="object"&&(x=navigator.userAgent);const k=(0,t.UAParser)(x);return b(k)})}function F(x){w.debug("detectDevice() [userAgent:%s]",x),!x&&typeof navigator=="object"&&(x=navigator.userAgent);const k=(0,t.UAParser)(x);return b(k)}var S=class xy{constructor({handlerName:k,handlerFactory:L}={}){if(ce(this,"_handlerFactory"),ce(this,"_handlerName"),ce(this,"_loaded",!1),ce(this,"_getSendExtendedRtpCapabilities"),ce(this,"_recvRtpCapabilities"),ce(this,"_canProduceByKind",{audio:!1,video:!1}),ce(this,"_sctpCapabilities"),ce(this,"_observer",new r.EnhancedEventEmitter),w.debug("constructor()"),k&&L)throw new TypeError("just one of handlerName or handlerInterface can be given");if(L)this._handlerFactory=L;else{if(k)w.debug("constructor() | handler given: %s",k);else if(k=F(),k)w.debug("constructor() | detected handler: %s",k);else throw new i.UnsupportedError("device not supported");switch(k){case"Chrome111":{this._handlerFactory=p.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=h.Chrome74.createFactory();break}case"Firefox120":{this._handlerFactory=y.Firefox120.createFactory();break}case"Safari12":{this._handlerFactory=f.Safari12.createFactory();break}case"ReactNative106":{this._handlerFactory=_.ReactNative106.createFactory();break}default:throw new TypeError(`unknown handlerName "${k}"`)}}this._handlerName=this._handlerFactory.name}static factory(){return B(this,arguments,function*({handlerName:k,handlerFactory:L}={}){if(w.debug("factory()"),k&&L)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!k&&!L&&(k=yield R(),!k))throw new i.UnsupportedError("device not supported");return new xy({handlerName:k,handlerFactory:L})})}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new i.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new i.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}load(k){return B(this,arguments,function*({routerRtpCapabilities:L,preferLocalCodecsOrder:G=!1}){if(w.debug("load() [routerRtpCapabilities:%o]",L),this._loaded)throw new i.InvalidStateError("already loaded");const K=a.clone(L);o.validateRtpCapabilities(K);const{getNativeRtpCapabilities:z,getNativeSctpCapabilities:U}=this._handlerFactory,J=a.clone(yield z());o.validateRtpCapabilities(J),w.debug("load() | got native RTP capabilities:%o",J),this._getSendExtendedRtpCapabilities=ne=>a.clone(o.getExtendedRtpCapabilities(ne,K,G));const Q=o.getExtendedRtpCapabilities(J,K,!1);this._recvRtpCapabilities=o.getRecvRtpCapabilities(Q),o.validateRtpCapabilities(this._recvRtpCapabilities),w.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=o.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=o.canSend("video",this._recvRtpCapabilities),this._sctpCapabilities=yield U(),o.validateSctpCapabilities(this._sctpCapabilities),w.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),w.debug("load() succeeded"),this._loaded=!0})}canProduce(k){if(this._loaded){if(k!=="audio"&&k!=="video")throw new TypeError(`invalid kind "${k}"`)}else throw new i.InvalidStateError("not loaded");return this._canProduceByKind[k]}createSendTransport({id:k,iceParameters:L,iceCandidates:G,dtlsParameters:K,sctpParameters:z,iceServers:U,iceTransportPolicy:J,additionalSettings:Q,appData:ne}){return w.debug("createSendTransport()"),this.createTransport({direction:"send",id:k,iceParameters:L,iceCandidates:G,dtlsParameters:K,sctpParameters:z,iceServers:U,iceTransportPolicy:J,additionalSettings:Q,appData:ne})}createRecvTransport({id:k,iceParameters:L,iceCandidates:G,dtlsParameters:K,sctpParameters:z,iceServers:U,iceTransportPolicy:J,additionalSettings:Q,appData:ne}){return w.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:k,iceParameters:L,iceCandidates:G,dtlsParameters:K,sctpParameters:z,iceServers:U,iceTransportPolicy:J,additionalSettings:Q,appData:ne})}createTransport({direction:k,id:L,iceParameters:G,iceCandidates:K,dtlsParameters:z,sctpParameters:U,iceServers:J,iceTransportPolicy:Q,additionalSettings:ne,appData:oe}){if(this._loaded){if(typeof L!="string")throw new TypeError("missing id");if(typeof G!="object")throw new TypeError("missing iceParameters");if(Array.isArray(K)){if(typeof z!="object")throw new TypeError("missing dtlsParameters");if(U&&typeof U!="object")throw new TypeError("wrong sctpParameters");if(oe&&typeof oe!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new i.InvalidStateError("not loaded");const he=new u.Transport({direction:k,id:L,iceParameters:G,iceCandidates:K,dtlsParameters:z,sctpParameters:U,iceServers:J,iceTransportPolicy:Q,additionalSettings:ne,appData:oe,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",he),he}};e.Device=S;function b(x){var k,L,G,K,z,U;if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(w.debug("detectDeviceImpl() | React-Native detected"),typeof RTCPeerConnection>"u"||typeof RTCRtpTransceiver>"u"){w.warn("detectDeviceImpl() | unsupported react-native-webrtc without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?");return}return"ReactNative106"}else{w.debug("detectDeviceImpl() | browser detected [userAgent:%s, parsed:%o]",x.ua,x);const J=x.browser,Q=(k=J.name)==null?void 0:k.toLowerCase(),ne=parseInt((L=J.major)!=null?L:"0"),he=(G=x.engine.name)==null?void 0:G.toLowerCase(),X=x.os,_e=(K=X.name)==null?void 0:K.toLowerCase(),Pe=parseFloat((z=X.version)!=null?z:"0"),ge=(U=x.device.model)==null?void 0:U.toLowerCase(),ye=_e==="ios"||ge==="ipad",Ee=Q&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(Q),Ne=Q&&["firefox","mobile firefox","mobile focus"].includes(Q),Ye=Q&&["safari","mobile safari"].includes(Q),zt=Q&&["edge"].includes(Q);if((Ee||zt)&&!ye&&ne>=111)return"Chrome111";if(Ee&&!ye&&ne>=74||zt&&!ye&&ne>=88)return"Chrome74";if(Ne&&!ye&&ne>=120)return"Firefox120";if(Ne&&ye&&Pe>=14.3)return"Safari12";if(Ye&&ne>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(he==="webkit"&&ye&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(he==="blink"){const jt=x.ua.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);return jt?Number(jt[1])>=111?"Chrome111":"Chrome74":"Chrome111"}else{w.warn("detectDeviceImpl() | browser not supported [name:%s, version:%s]",Q,ne);return}}}}}),fC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/max.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.default="ffffffff-ffff-ffff-ffff-ffffffffffff"}}),mC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/nil.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.default="00000000-0000-0000-0000-000000000000"}}),gC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/regex.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i}}),ku=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/validate.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t=gC();function n(r){return typeof r=="string"&&t.default.test(r)}e.default=n}}),Tu=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/parse.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t=ku();function n(r){if(!(0,t.default)(r))throw TypeError("Invalid UUID");let i;return Uint8Array.of((i=parseInt(r.slice(0,8),16))>>>24,i>>>16&255,i>>>8&255,i&255,(i=parseInt(r.slice(9,13),16))>>>8,i&255,(i=parseInt(r.slice(14,18),16))>>>8,i&255,(i=parseInt(r.slice(19,23),16))>>>8,i&255,(i=parseInt(r.slice(24,36),16))/1099511627776&255,i/4294967296&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255)}e.default=n}}),rs=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/stringify.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.unsafeStringify=void 0;var t=ku(),n=[];for(let a=0;a<256;++a)n.push((a+256).toString(16).slice(1));function r(a,o=0){return(n[a[o+0]]+n[a[o+1]]+n[a[o+2]]+n[a[o+3]]+"-"+n[a[o+4]]+n[a[o+5]]+"-"+n[a[o+6]]+n[a[o+7]]+"-"+n[a[o+8]]+n[a[o+9]]+"-"+n[a[o+10]]+n[a[o+11]]+n[a[o+12]]+n[a[o+13]]+n[a[o+14]]+n[a[o+15]]).toLowerCase()}e.unsafeStringify=r;function i(a,o=0){const u=r(a,o);if(!(0,t.default)(u))throw TypeError("Stringified UUID is invalid");return u}e.default=i}}),lf=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/rng.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t,n=new Uint8Array(16);function r(){if(!t){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");t=crypto.getRandomValues.bind(crypto)}return t(n)}e.default=r}}),Cy=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v1.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.updateV1State=void 0;var t=lf(),n=rs(),r={};function i(u,p,h){var y,f,_,w;let R;const F=(y=u==null?void 0:u._v6)!=null?y:!1;if(u){const S=Object.keys(u);S.length===1&&S[0]==="_v6"&&(u=void 0)}if(u)R=o((w=(_=u.random)!=null?_:(f=u.rng)==null?void 0:f.call(u))!=null?w:(0,t.default)(),u.msecs,u.nsecs,u.clockseq,u.node,p,h);else{const S=Date.now(),b=(0,t.default)();a(r,S,b),R=o(b,r.msecs,r.nsecs,F?void 0:r.clockseq,F?void 0:r.node,p,h)}return p??(0,n.unsafeStringify)(R)}function a(u,p,h){var y,f;return(y=u.msecs)!=null||(u.msecs=-1/0),(f=u.nsecs)!=null||(u.nsecs=0),p===u.msecs?(u.nsecs++,u.nsecs>=1e4&&(u.node=void 0,u.nsecs=0)):p>u.msecs?u.nsecs=0:p<u.msecs&&(u.node=void 0),u.node||(u.node=h.slice(10,16),u.node[0]|=1,u.clockseq=(h[8]<<8|h[9])&16383),u.msecs=p,u}e.updateV1State=a;function o(u,p,h,y,f,_,w=0){if(u.length<16)throw new Error("Random bytes length must be >= 16");if(!_)_=new Uint8Array(16),w=0;else if(w<0||w+16>_.length)throw new RangeError(`UUID byte range ${w}:${w+15} is out of buffer bounds`);p??(p=Date.now()),h??(h=0),y??(y=(u[8]<<8|u[9])&16383),f??(f=u.slice(10,16)),p+=122192928e5;const R=((p&268435455)*1e4+h)%4294967296;_[w++]=R>>>24&255,_[w++]=R>>>16&255,_[w++]=R>>>8&255,_[w++]=R&255;const F=p/4294967296*1e4&268435455;_[w++]=F>>>8&255,_[w++]=F&255,_[w++]=F>>>24&15|16,_[w++]=F>>>16&255,_[w++]=y>>>8|128,_[w++]=y&255;for(let S=0;S<6;++S)_[w++]=f[S];return _}e.default=i}}),Ey=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v1ToV6.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t=Tu(),n=rs();function r(a){const o=typeof a=="string"?(0,t.default)(a):a,u=i(o);return typeof a=="string"?(0,n.unsafeStringify)(u):u}e.default=r;function i(a){return Uint8Array.of((a[6]&15)<<4|a[7]>>4&15,(a[7]&15)<<4|(a[4]&240)>>4,(a[4]&15)<<4|(a[5]&240)>>4,(a[5]&15)<<4|(a[0]&240)>>4,(a[0]&15)<<4|(a[1]&240)>>4,(a[1]&15)<<4|(a[2]&240)>>4,96|a[2]&15,a[3],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}}}),vC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/md5.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});function t(w){const R=a(w),F=i(R,w.length*8);return n(F)}function n(w){const R=new Uint8Array(w.length*4);for(let F=0;F<w.length*4;F++)R[F]=w[F>>2]>>>F%4*8&255;return R}function r(w){return(w+64>>>9<<4)+14+1}function i(w,R){const F=new Uint32Array(r(R)).fill(0);F.set(w),F[R>>5]|=128<<R%32,F[F.length-1]=R,w=F;let S=1732584193,b=-271733879,x=-1732584194,k=271733878;for(let L=0;L<w.length;L+=16){const G=S,K=b,z=x,U=k;S=h(S,b,x,k,w[L],7,-680876936),k=h(k,S,b,x,w[L+1],12,-389564586),x=h(x,k,S,b,w[L+2],17,606105819),b=h(b,x,k,S,w[L+3],22,-1044525330),S=h(S,b,x,k,w[L+4],7,-176418897),k=h(k,S,b,x,w[L+5],12,1200080426),x=h(x,k,S,b,w[L+6],17,-1473231341),b=h(b,x,k,S,w[L+7],22,-45705983),S=h(S,b,x,k,w[L+8],7,1770035416),k=h(k,S,b,x,w[L+9],12,-1958414417),x=h(x,k,S,b,w[L+10],17,-42063),b=h(b,x,k,S,w[L+11],22,-1990404162),S=h(S,b,x,k,w[L+12],7,1804603682),k=h(k,S,b,x,w[L+13],12,-40341101),x=h(x,k,S,b,w[L+14],17,-1502002290),b=h(b,x,k,S,w[L+15],22,1236535329),S=y(S,b,x,k,w[L+1],5,-165796510),k=y(k,S,b,x,w[L+6],9,-1069501632),x=y(x,k,S,b,w[L+11],14,643717713),b=y(b,x,k,S,w[L],20,-373897302),S=y(S,b,x,k,w[L+5],5,-701558691),k=y(k,S,b,x,w[L+10],9,38016083),x=y(x,k,S,b,w[L+15],14,-660478335),b=y(b,x,k,S,w[L+4],20,-405537848),S=y(S,b,x,k,w[L+9],5,568446438),k=y(k,S,b,x,w[L+14],9,-1019803690),x=y(x,k,S,b,w[L+3],14,-187363961),b=y(b,x,k,S,w[L+8],20,1163531501),S=y(S,b,x,k,w[L+13],5,-1444681467),k=y(k,S,b,x,w[L+2],9,-51403784),x=y(x,k,S,b,w[L+7],14,1735328473),b=y(b,x,k,S,w[L+12],20,-1926607734),S=f(S,b,x,k,w[L+5],4,-378558),k=f(k,S,b,x,w[L+8],11,-2022574463),x=f(x,k,S,b,w[L+11],16,1839030562),b=f(b,x,k,S,w[L+14],23,-35309556),S=f(S,b,x,k,w[L+1],4,-1530992060),k=f(k,S,b,x,w[L+4],11,1272893353),x=f(x,k,S,b,w[L+7],16,-155497632),b=f(b,x,k,S,w[L+10],23,-1094730640),S=f(S,b,x,k,w[L+13],4,681279174),k=f(k,S,b,x,w[L],11,-358537222),x=f(x,k,S,b,w[L+3],16,-722521979),b=f(b,x,k,S,w[L+6],23,76029189),S=f(S,b,x,k,w[L+9],4,-640364487),k=f(k,S,b,x,w[L+12],11,-421815835),x=f(x,k,S,b,w[L+15],16,530742520),b=f(b,x,k,S,w[L+2],23,-995338651),S=_(S,b,x,k,w[L],6,-198630844),k=_(k,S,b,x,w[L+7],10,1126891415),x=_(x,k,S,b,w[L+14],15,-1416354905),b=_(b,x,k,S,w[L+5],21,-57434055),S=_(S,b,x,k,w[L+12],6,1700485571),k=_(k,S,b,x,w[L+3],10,-1894986606),x=_(x,k,S,b,w[L+10],15,-1051523),b=_(b,x,k,S,w[L+1],21,-2054922799),S=_(S,b,x,k,w[L+8],6,1873313359),k=_(k,S,b,x,w[L+15],10,-30611744),x=_(x,k,S,b,w[L+6],15,-1560198380),b=_(b,x,k,S,w[L+13],21,1309151649),S=_(S,b,x,k,w[L+4],6,-145523070),k=_(k,S,b,x,w[L+11],10,-1120210379),x=_(x,k,S,b,w[L+2],15,718787259),b=_(b,x,k,S,w[L+9],21,-343485551),S=o(S,G),b=o(b,K),x=o(x,z),k=o(k,U)}return Uint32Array.of(S,b,x,k)}function a(w){if(w.length===0)return new Uint32Array;const R=new Uint32Array(r(w.length*8)).fill(0);for(let F=0;F<w.length;F++)R[F>>2]|=(w[F]&255)<<F%4*8;return R}function o(w,R){const F=(w&65535)+(R&65535);return(w>>16)+(R>>16)+(F>>16)<<16|F&65535}function u(w,R){return w<<R|w>>>32-R}function p(w,R,F,S,b,x){return o(u(o(o(R,w),o(S,x)),b),F)}function h(w,R,F,S,b,x,k){return p(R&F|~R&S,w,R,b,x,k)}function y(w,R,F,S,b,x,k){return p(R&S|F&~S,w,R,b,x,k)}function f(w,R,F,S,b,x,k){return p(R^F^S,w,R,b,x,k)}function _(w,R,F,S,b,x,k){return p(F^(R|~S),w,R,b,x,k)}e.default=t}}),zl=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v35.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=e.stringToBytes=void 0;var t=Tu(),n=rs();function r(a){a=unescape(encodeURIComponent(a));const o=new Uint8Array(a.length);for(let u=0;u<a.length;++u)o[u]=a.charCodeAt(u);return o}e.stringToBytes=r,e.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",e.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function i(a,o,u,p,h,y){const f=typeof u=="string"?r(u):u,_=typeof p=="string"?(0,t.default)(p):p;if(typeof p=="string"&&(p=(0,t.default)(p)),(p==null?void 0:p.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let w=new Uint8Array(16+f.length);if(w.set(_),w.set(f,_.length),w=o(w),w[6]=w[6]&15|a,w[8]=w[8]&63|128,h){y=y||0;for(let R=0;R<16;++R)h[y+R]=w[R];return h}return(0,n.unsafeStringify)(w)}e.default=i}}),yC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v3.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=void 0;var t=vC(),n=zl(),r=zl();Object.defineProperty(e,"DNS",{enumerable:!0,get:function(){return r.DNS}}),Object.defineProperty(e,"URL",{enumerable:!0,get:function(){return r.URL}});function i(a,o,u,p){return(0,n.default)(48,t.default,a,o,u,p)}i.DNS=n.DNS,i.URL=n.URL,e.default=i}}),_C=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/native.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);e.default={randomUUID:t}}}),bC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v4.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t=_C(),n=lf(),r=rs();function i(a,o,u){var p,h,y;if(t.default.randomUUID&&!o&&!a)return t.default.randomUUID();a=a||{};const f=(y=(h=a.random)!=null?h:(p=a.rng)==null?void 0:p.call(a))!=null?y:(0,n.default)();if(f.length<16)throw new Error("Random bytes length must be >= 16");if(f[6]=f[6]&15|64,f[8]=f[8]&63|128,o){if(u=u||0,u<0||u+16>o.length)throw new RangeError(`UUID byte range ${u}:${u+15} is out of buffer bounds`);for(let _=0;_<16;++_)o[u+_]=f[_];return o}return(0,r.unsafeStringify)(f)}e.default=i}}),SC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/sha1.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});function t(i,a,o,u){switch(i){case 0:return a&o^~a&u;case 1:return a^o^u;case 2:return a&o^a&u^o&u;case 3:return a^o^u}}function n(i,a){return i<<a|i>>>32-a}function r(i){const a=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520],u=new Uint8Array(i.length+1);u.set(i),u[i.length]=128,i=u;const p=i.length/4+2,h=Math.ceil(p/16),y=new Array(h);for(let f=0;f<h;++f){const _=new Uint32Array(16);for(let w=0;w<16;++w)_[w]=i[f*64+w*4]<<24|i[f*64+w*4+1]<<16|i[f*64+w*4+2]<<8|i[f*64+w*4+3];y[f]=_}y[h-1][14]=(i.length-1)*8/Math.pow(2,32),y[h-1][14]=Math.floor(y[h-1][14]),y[h-1][15]=(i.length-1)*8&4294967295;for(let f=0;f<h;++f){const _=new Uint32Array(80);for(let x=0;x<16;++x)_[x]=y[f][x];for(let x=16;x<80;++x)_[x]=n(_[x-3]^_[x-8]^_[x-14]^_[x-16],1);let w=o[0],R=o[1],F=o[2],S=o[3],b=o[4];for(let x=0;x<80;++x){const k=Math.floor(x/20),L=n(w,5)+t(k,R,F,S)+b+a[k]+_[x]>>>0;b=S,S=F,F=n(R,30)>>>0,R=w,w=L}o[0]=o[0]+w>>>0,o[1]=o[1]+R>>>0,o[2]=o[2]+F>>>0,o[3]=o[3]+S>>>0,o[4]=o[4]+b>>>0}return Uint8Array.of(o[0]>>24,o[0]>>16,o[0]>>8,o[0],o[1]>>24,o[1]>>16,o[1]>>8,o[1],o[2]>>24,o[2]>>16,o[2]>>8,o[2],o[3]>>24,o[3]>>16,o[3]>>8,o[3],o[4]>>24,o[4]>>16,o[4]>>8,o[4])}e.default=r}}),wC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v5.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.URL=e.DNS=void 0;var t=SC(),n=zl(),r=zl();Object.defineProperty(e,"DNS",{enumerable:!0,get:function(){return r.DNS}}),Object.defineProperty(e,"URL",{enumerable:!0,get:function(){return r.URL}});function i(a,o,u,p){return(0,n.default)(80,t.default,a,o,u,p)}i.DNS=n.DNS,i.URL=n.URL,e.default=i}}),xC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v6.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t=rs(),n=Cy(),r=Ey();function i(a,o,u){a??(a={}),u??(u=0);let p=(0,n.default)(de(ee({},a),{_v6:!0}),new Uint8Array(16));if(p=(0,r.default)(p),o){for(let h=0;h<16;h++)o[u+h]=p[h];return o}return(0,t.unsafeStringify)(p)}e.default=i}}),CC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v6ToV1.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t=Tu(),n=rs();function r(a){const o=typeof a=="string"?(0,t.default)(a):a,u=i(o);return typeof a=="string"?(0,n.unsafeStringify)(u):u}e.default=r;function i(a){return Uint8Array.of((a[3]&15)<<4|a[4]>>4&15,(a[4]&15)<<4|(a[5]&240)>>4,(a[5]&15)<<4|a[6]&15,a[7],(a[1]&15)<<4|(a[2]&240)>>4,(a[2]&15)<<4|(a[3]&240)>>4,16|(a[0]&240)>>4,(a[0]&15)<<4|(a[1]&240)>>4,a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}}}),EC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/v7.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.updateV7State=void 0;var t=lf(),n=rs(),r={};function i(u,p,h){var y,f,_;let w;if(u)w=o((_=(f=u.random)!=null?f:(y=u.rng)==null?void 0:y.call(u))!=null?_:(0,t.default)(),u.msecs,u.seq,p,h);else{const R=Date.now(),F=(0,t.default)();a(r,R,F),w=o(F,r.msecs,r.seq,p,h)}return p??(0,n.unsafeStringify)(w)}function a(u,p,h){var y,f;return(y=u.msecs)!=null||(u.msecs=-1/0),(f=u.seq)!=null||(u.seq=0),p>u.msecs?(u.seq=h[6]<<23|h[7]<<16|h[8]<<8|h[9],u.msecs=p):(u.seq=u.seq+1|0,u.seq===0&&u.msecs++),u}e.updateV7State=a;function o(u,p,h,y,f=0){if(u.length<16)throw new Error("Random bytes length must be >= 16");if(!y)y=new Uint8Array(16),f=0;else if(f<0||f+16>y.length)throw new RangeError(`UUID byte range ${f}:${f+15} is out of buffer bounds`);return p??(p=Date.now()),h??(h=u[6]*127<<24|u[7]<<16|u[8]<<8|u[9]),y[f++]=p/1099511627776&255,y[f++]=p/4294967296&255,y[f++]=p/16777216&255,y[f++]=p/65536&255,y[f++]=p/256&255,y[f++]=p&255,y[f++]=112|h>>>28&15,y[f++]=h>>>20&255,y[f++]=128|h>>>14&63,y[f++]=h>>>6&255,y[f++]=h<<2&255|u[10]&3,y[f++]=u[11],y[f++]=u[12],y[f++]=u[13],y[f++]=u[14],y[f++]=u[15],y}e.default=i}}),PC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/version.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0});var t=ku();function n(r){if(!(0,t.default)(r))throw TypeError("Invalid UUID");return parseInt(r.slice(14,15),16)}e.default=n}}),kC=fe({"../../node_modules/.pnpm/uuid@11.1.0/node_modules/uuid/dist/cjs-browser/index.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.version=e.validate=e.v7=e.v6ToV1=e.v6=e.v5=e.v4=e.v3=e.v1ToV6=e.v1=e.stringify=e.parse=e.NIL=e.MAX=void 0;var t=fC();Object.defineProperty(e,"MAX",{enumerable:!0,get:function(){return t.default}});var n=mC();Object.defineProperty(e,"NIL",{enumerable:!0,get:function(){return n.default}});var r=Tu();Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return r.default}});var i=rs();Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return i.default}});var a=Cy();Object.defineProperty(e,"v1",{enumerable:!0,get:function(){return a.default}});var o=Ey();Object.defineProperty(e,"v1ToV6",{enumerable:!0,get:function(){return o.default}});var u=yC();Object.defineProperty(e,"v3",{enumerable:!0,get:function(){return u.default}});var p=bC();Object.defineProperty(e,"v4",{enumerable:!0,get:function(){return p.default}});var h=wC();Object.defineProperty(e,"v5",{enumerable:!0,get:function(){return h.default}});var y=xC();Object.defineProperty(e,"v6",{enumerable:!0,get:function(){return y.default}});var f=CC();Object.defineProperty(e,"v6ToV1",{enumerable:!0,get:function(){return f.default}});var _=EC();Object.defineProperty(e,"v7",{enumerable:!0,get:function(){return _.default}});var w=ku();Object.defineProperty(e,"validate",{enumerable:!0,get:function(){return w.default}});var R=PC();Object.defineProperty(e,"version",{enumerable:!0,get:function(){return R.default}})}}),TC=fe({"../../node_modules/.pnpm/fake-mediastreamtrack@2.1.2/node_modules/fake-mediastreamtrack/lib/FakeEventTarget.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.FakeEventTarget=void 0;var t=class{constructor(){ce(this,"listeners",{})}addEventListener(n,r,i={}){var a,o;r&&((o=(a=this.listeners)[n])!=null||(a[n]=[]),this.listeners[n].push({callback:r,once:i.once===!0}))}removeEventListener(n,r){this.listeners[n]&&(this.listeners[n]=this.listeners[n].filter(i=>i.callback!==r))}dispatchEvent(n){if(!n||typeof n.type!="string")throw new Error("invalid event object");const r=this.listeners[n.type];if(!r)return!0;for(const i of[...r]){try{i.callback.call(this,n)}catch(a){setTimeout(()=>{throw a},0)}i.once&&this.removeEventListener(n.type,i.callback)}return!n.defaultPrevented}};e.FakeEventTarget=t}}),RC=fe({"../../node_modules/.pnpm/fake-mediastreamtrack@2.1.2/node_modules/fake-mediastreamtrack/lib/utils.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.clone=t;function t(n){if(n!==void 0)return Number.isNaN(n)?NaN:typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}}}),AC=fe({"../../node_modules/.pnpm/fake-mediastreamtrack@2.1.2/node_modules/fake-mediastreamtrack/lib/index.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.FakeMediaStreamTrack=void 0;var t=kC(),n=TC(),r=RC(),i,a,o,u,p,h,y,f,_,w,R,F,S,b,x,k,L=class Py extends n.FakeEventTarget{constructor({kind:z,id:U,label:J,contentHint:Q,enabled:ne,muted:oe,readyState:he,capabilities:X,constraints:_e,settings:Pe,data:xe}){super(),_n(this,i),_n(this,a),_n(this,o),_n(this,u),_n(this,p),_n(this,h),_n(this,y),_n(this,f),_n(this,_),_n(this,w),_n(this,R),_n(this,F,null),_n(this,S,null),_n(this,b,null),_n(this,x,null),_n(this,k,null),Rt(this,i,U??(0,t.v4)()),Rt(this,a,z),Rt(this,o,J??""),Rt(this,y,Q??""),Rt(this,p,ne??!0),Rt(this,h,oe??!1),Rt(this,u,he??"live"),Rt(this,f,X??{}),Rt(this,_,_e??{}),Rt(this,w,Pe??{}),Rt(this,R,xe??{})}get id(){return Je(this,i)}get kind(){return Je(this,a)}get label(){return Je(this,o)}get contentHint(){return Je(this,y)}set contentHint(z){Rt(this,y,z)}get enabled(){return Je(this,p)}set enabled(z){const U=Je(this,p)!==z;Rt(this,p,z),U&&this.dispatchEvent(new Event("enabledchange"))}get muted(){return Je(this,h)}get readyState(){return Je(this,u)}get data(){return Je(this,R)}set data(z){Rt(this,R,z)}get onmute(){return Je(this,F)}set onmute(z){Je(this,F)&&this.removeEventListener("mute",Je(this,F)),Rt(this,F,z),z&&this.addEventListener("mute",z)}get onunmute(){return Je(this,S)}set onunmute(z){Je(this,S)&&this.removeEventListener("unmute",Je(this,S)),Rt(this,S,z),z&&this.addEventListener("unmute",z)}get onended(){return Je(this,b)}set onended(z){Je(this,b)&&this.removeEventListener("ended",Je(this,b)),Rt(this,b,z),z&&this.addEventListener("ended",z)}get onenabledchange(){return Je(this,x)}set onenabledchange(z){Je(this,x)&&this.removeEventListener("enabledchange",Je(this,x)),Rt(this,x,z),z&&this.addEventListener("enabledchange",z)}get onstopped(){return Je(this,k)}set onstopped(z){Je(this,k)&&this.removeEventListener("stopped",Je(this,k)),Rt(this,k,z),z&&this.addEventListener("stopped",z)}addEventListener(z,U,J){super.addEventListener(z,U,J)}removeEventListener(z,U){super.removeEventListener(z,U)}stop(){Je(this,u)!=="ended"&&(Rt(this,u,"ended"),this.dispatchEvent(new Event("stopped")))}clone({id:z,data:U}={}){return new Py({id:z??(0,t.v4)(),kind:Je(this,a),label:Je(this,o),contentHint:Je(this,y),enabled:Je(this,p),muted:Je(this,h),readyState:Je(this,u),capabilities:(0,r.clone)(Je(this,f)),constraints:(0,r.clone)(Je(this,_)),settings:(0,r.clone)(Je(this,w)),data:U??(0,r.clone)(Je(this,R))})}getCapabilities(){return Je(this,f)}getConstraints(){return Je(this,_)}applyConstraints(){return B(this,arguments,function*(z={}){return Rt(this,_,z),Promise.resolve()})}getSettings(){return Je(this,w)}remoteStop(){Je(this,u)!=="ended"&&(Rt(this,u,"ended"),this.dispatchEvent(new Event("stopped")),this.dispatchEvent(new Event("ended")))}remoteMute(){Je(this,h)||(Rt(this,h,!0),this.dispatchEvent(new Event("mute")))}remoteUnmute(){Je(this,h)&&(Rt(this,h,!1),this.dispatchEvent(new Event("unmute")))}};i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,p=new WeakMap,h=new WeakMap,y=new WeakMap,f=new WeakMap,_=new WeakMap,w=new WeakMap,R=new WeakMap,F=new WeakMap,S=new WeakMap,b=new WeakMap,x=new WeakMap,k=new WeakMap;var G=L;e.FakeMediaStreamTrack=G}}),IC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/handlers/FakeHandler.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.FakeHandler=void 0;var t=AC(),n=cr(),r=Yn(),i=Aa(),a=xi(),o=zr(),u=new r.Logger("FakeHandler"),p="FakeHandler",h=class dl extends n.EnhancedEventEmitter{constructor({getSendExtendedRtpCapabilities:_},w){super(),ce(this,"_closed",!1),ce(this,"_fakeParameters"),ce(this,"_getSendExtendedRtpCapabilities"),ce(this,"_cname",`CNAME-${i.generateRandomNumber()}`),ce(this,"_transportReady",!1),ce(this,"_nextLocalId",1),ce(this,"_tracks",new Map),ce(this,"_nextSctpStreamId",0),u.debug("constructor()"),this._getSendExtendedRtpCapabilities=_,this._fakeParameters=w}static createFactory(_){return{name:p,factory:w=>new dl(w,_),getNativeRtpCapabilities:()=>B(null,null,function*(){return u.debug("getNativeRtpCapabilities()"),dl.getLocalRtpCapabilities(_)}),getNativeSctpCapabilities:()=>B(null,null,function*(){return u.debug("getNativeSctpCapabilities()"),_.generateNativeSctpCapabilities()})}}static getLocalRtpCapabilities(_){return _.generateNativeRtpCapabilities()}get name(){return p}close(){u.debug("close()"),!this._closed&&(this._closed=!0,super.close())}setIceGatheringState(_){this.emit("@icegatheringstatechange",_)}setConnectionState(_){this.emit("@connectionstatechange",_)}updateIceServers(_){return B(this,null,function*(){this.assertNotClosed(),u.debug("updateIceServers()")})}restartIce(_){return B(this,null,function*(){this.assertNotClosed(),u.debug("restartIce()")})}getTransportStats(){return B(this,null,function*(){return this.assertNotClosed(),new Map})}send(_){return B(this,arguments,function*({track:w,encodings:R,codecOptions:F,codec:S}){this.assertNotClosed(),u.debug("send() [kind:%s, track.id:%s]",w.kind,w.id),this._transportReady||(yield this.setupTransport({localDtlsRole:"server"}));const b=dl.getLocalRtpCapabilities(this._fakeParameters),x=this._getSendExtendedRtpCapabilities(b),k=a.getSendingRtpParameters(w.kind,x);k.codecs=a.reduceCodecs(k.codecs,S);const L=k.codecs.some(K=>/.+\/rtx$/i.test(K.mimeType));k.mid=`mid-${i.generateRandomNumber()}`,R||(R=[{}]);for(const K of R)K.ssrc=i.generateRandomNumber(),L&&(K.rtx={ssrc:i.generateRandomNumber()});k.encodings=R,k.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const G=this._nextLocalId++;return this._tracks.set(G,w),{localId:String(G),rtpParameters:k}})}stopSending(_){return B(this,null,function*(){if(u.debug("stopSending() [localId:%s]",_),!this._closed){if(!this._tracks.has(Number(_)))throw new Error("local track not found");this._tracks.delete(Number(_))}})}pauseSending(_){return B(this,null,function*(){this.assertNotClosed()})}resumeSending(_){return B(this,null,function*(){this.assertNotClosed()})}replaceTrack(_,w){return B(this,null,function*(){this.assertNotClosed(),w?u.debug("replaceTrack() [localId:%s, track.id:%s]",_,w.id):u.debug("replaceTrack() [localId:%s, no track]",_),this._tracks.delete(Number(_)),this._tracks.set(Number(_),w)})}setMaxSpatialLayer(_,w){return B(this,null,function*(){this.assertNotClosed(),u.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",_,w)})}setRtpEncodingParameters(_,w){return B(this,null,function*(){this.assertNotClosed(),u.debug("setRtpEncodingParameters() [localId:%s, params:%o]",_,w)})}getSenderStats(_){return B(this,null,function*(){return this.assertNotClosed(),new Map})}sendDataChannel(_){return B(this,arguments,function*({ordered:w,maxPacketLifeTime:R,maxRetransmits:F,label:S,protocol:b}){this.assertNotClosed(),this._transportReady||(yield this.setupTransport({localDtlsRole:"server"})),u.debug("sendDataChannel()");const x=new y({id:this._nextSctpStreamId++,ordered:w,maxPacketLifeTime:R,maxRetransmits:F,label:S,protocol:b}),k={streamId:this._nextSctpStreamId,ordered:w,maxPacketLifeTime:R,maxRetransmits:F};return{dataChannel:x,sctpStreamParameters:k}})}receive(_){return B(this,null,function*(){this.assertNotClosed();const w=[];for(const R of _){const{trackId:F,kind:S}=R;this._transportReady||(yield this.setupTransport({localDtlsRole:"client"})),u.debug("receive() [trackId:%s, kind:%s]",F,S);const b=this._nextLocalId++,x=new t.FakeMediaStreamTrack({kind:S});this._tracks.set(b,x),w.push({localId:String(b),track:x})}return w})}stopReceiving(_){return B(this,null,function*(){if(!this._closed)for(const w of _)u.debug("stopReceiving() [localId:%s]",w),this._tracks.delete(Number(w))})}pauseReceiving(_){return B(this,null,function*(){this.assertNotClosed()})}resumeReceiving(_){return B(this,null,function*(){this.assertNotClosed()})}getReceiverStats(_){return B(this,null,function*(){return this.assertNotClosed(),new Map})}receiveDataChannel(_){return B(this,arguments,function*({sctpStreamParameters:w,label:R,protocol:F}){return this.assertNotClosed(),this._transportReady||(yield this.setupTransport({localDtlsRole:"client"})),u.debug("receiveDataChannel()"),{dataChannel:new y({id:w.streamId,ordered:w.ordered,maxPacketLifeTime:w.maxPacketLifeTime,maxRetransmits:w.maxRetransmits,label:R,protocol:F})}})}setupTransport(_){return B(this,arguments,function*({localDtlsRole:w,localSdpObject:R}){const F=i.clone(this._fakeParameters.generateLocalDtlsParameters());w&&(F.role=w),this.emit("@connectionstatechange","connecting"),yield new Promise((S,b)=>this.emit("@connect",{dtlsParameters:F},S,b)),this._transportReady=!0})}assertNotClosed(){if(this._closed)throw new o.InvalidStateError("method called in a closed handler")}};e.FakeHandler=h;var y=class extends EventTarget{constructor({id:f,ordered:_=!0,maxPacketLifeTime:w=null,maxRetransmits:R=null,label:F="",protocol:S=""}){super(),ce(this,"_id"),ce(this,"_negotiated",!0),ce(this,"_ordered"),ce(this,"_maxPacketLifeTime"),ce(this,"_maxRetransmits"),ce(this,"_label"),ce(this,"_protocol"),ce(this,"_readyState","connecting"),ce(this,"_bufferedAmount",0),ce(this,"_bufferedAmountLowThreshold",0),ce(this,"_binaryType","arraybuffer"),ce(this,"_onopen",null),ce(this,"_onclosing",null),ce(this,"_onclose",null),ce(this,"_onmessage",null),ce(this,"_onbufferedamountlow",null),ce(this,"_onerror",null),u.debug(`constructor() [id:${f}, ordered:${_}, maxPacketLifeTime:${w}, maxRetransmits:${R}, label:${F}, protocol:${S}`),this._id=f,this._ordered=_,this._maxPacketLifeTime=w,this._maxRetransmits=R,this._label=F,this._protocol=S}get id(){return this._id}get negotiated(){return this._negotiated}get ordered(){return this._ordered}get maxPacketLifeTime(){return this._maxPacketLifeTime}get maxRetransmits(){return this._maxRetransmits}get label(){return this._label}get protocol(){return this._protocol}get readyState(){return this._readyState}get bufferedAmount(){return this._bufferedAmount}get bufferedAmountLowThreshold(){return this._bufferedAmountLowThreshold}set bufferedAmountLowThreshold(f){this._bufferedAmountLowThreshold=f}get binaryType(){return this._binaryType}set binaryType(f){this._binaryType=f}get onopen(){return this._onopen}set onopen(f){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=f,f&&this.addEventListener("open",f)}get onclosing(){return this._onclosing}set onclosing(f){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=f,f&&this.addEventListener("closing",f)}get onclose(){return this._onclose}set onclose(f){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=f,f&&this.addEventListener("close",f)}get onmessage(){return this._onmessage}set onmessage(f){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=f,f&&this.addEventListener("message",f)}get onbufferedamountlow(){return this._onbufferedamountlow}set onbufferedamountlow(f){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=f,f&&this.addEventListener("bufferedamountlow",f)}get onerror(){return this._onerror}set onerror(f){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=f,f&&this.addEventListener("error",f)}addEventListener(f,_,w){super.addEventListener(f,_,w)}removeEventListener(f,_,w){super.removeEventListener(f,_,w)}close(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}send(f){if(this._readyState!=="open")throw new o.InvalidStateError("not open")}}}}),FC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/test/fakeParameters.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.generateRouterRtpCapabilities=r,e.generateNativeRtpCapabilities=i,e.generateNativeSctpCapabilities=a,e.generateLocalDtlsParameters=o,e.generateTransportRemoteParameters=u,e.generateProducerRemoteParameters=p,e.generateConsumerRemoteParameters=h,e.generateDataProducerRemoteParameters=y,e.generateDataConsumerRemoteParameters=f;var t=Aa();function n(){return String(t.generateRandomNumber())}function r(){return t.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function i(){return t.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]})}function a(){return t.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function o(){return t.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function u(){return{id:n(),iceParameters:t.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:t.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:t.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:t.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function p(){return t.deepFreeze({id:n()})}function h({id:_,codecMimeType:w}={}){switch(w){case"audio/opus":return{id:_??n(),producerId:n(),kind:"audio",rtpParameters:t.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:_??n(),producerId:n(),kind:"audio",rtpParameters:t.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:_??n(),producerId:n(),kind:"video",rtpParameters:t.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:_??n(),producerId:n(),kind:"video",rtpParameters:t.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${w}'`)}}function y(){return t.deepFreeze({id:n()})}function f({id:_}={}){return{id:_??n(),dataProducerId:n(),sctpStreamParameters:t.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}}}),DC=fe({"../../node_modules/.pnpm/@skyway-sdk+mediasoup-client@3.15.2/node_modules/@skyway-sdk/mediasoup-client/lib/index.js"(e){W(),Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.testFakeParameters=e.FakeHandler=e.enhancedEvents=e.ortc=e.parseScalabilityMode=e.detectDeviceAsync=e.detectDevice=e.Device=e.version=e.types=void 0;var t=Eu();e.debug=t.default,e.types=Z2(),e.version="3.15.2";var n=pC();Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return n.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return n.detectDevice}}),Object.defineProperty(e,"detectDeviceAsync",{enumerable:!0,get:function(){return n.detectDeviceAsync}});var r=Ia();Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return r.parse}}),e.ortc=xi(),e.enhancedEvents=cr();var i=IC();Object.defineProperty(e,"FakeHandler",{enumerable:!0,get:function(){return i.FakeHandler}}),e.testFakeParameters=FC()}});W();W();W();W();W();W();W();var Ym=["disable","error","warn","info","debug"],Os=class Ii{constructor(t){this.debug=(...n)=>(this._log("debug",...n),Date.now()),this.info=(...n)=>(this._log("info",...n),Date.now()),this.warn=(...n)=>{this._log("warn",...n)},this.error=(...n)=>{this._log("error",...n)},this.elapsed=(n,...r)=>{const i=Date.now()-n;this._log("info",`elapsed ms:${i}`,...r)},this.prefix=t}_log(t,...n){const r=Ym.indexOf(t);if(Ym.indexOf(Ii.level)>=r){const a=new Date,o=Ii.formatter.formatToParts(a),u=_=>{var w;return(w=o.find(R=>R.type===_))==null?void 0:w.value},p=String(a.getMilliseconds()).padStart(3,"0"),h=`${u("year")}-${u("month")}-${u("day")}T${u("hour")}:${u("minute")}:${u("second")}.${p}+09:00`;n=[this.prefix,...n].map(_=>{if(_ instanceof Error)return _.toJSON?_.toJSON():{name:_.name,message:_.message,stack:_.stack};if(typeof _=="object")try{return JSON.parse(JSON.stringify(_))}catch{return"json error"}return _});let f=[h,t,...n];switch(Ii.format==="string"&&(f=[h+" "+t+" "+JSON.stringify(n)]),t){case"debug":console.debug(...f);break;case"info":console.info(...f);break;case"warn":console.warn(...f);break;case"error":console.error(...f);break}Ii.onLog({id:Ii.id,timestamp:h,level:t,message:n}),Ii._onLogForAnalytics({id:Ii.id,timestamp:h,level:t,message:n,prefix:this.prefix})}}createBlock(t){return{warn:(...n)=>{this.warn(ee({},t),...n)},debug:(...n)=>{this.debug(ee({},t),...n)},info:(...n)=>{this.info(ee({},t),...n)},error:(...n)=>{this.error(ee({},t),...n)}}}};Os.level="error";Os.format="object";Os.onLog=()=>{};Os._onLogForAnalytics=()=>{};Os.id=Math.random().toString().slice(2,7);Os.formatter=new Intl.DateTimeFormat("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});var De=Os,NC=new De("packages/common/src/error.ts"),Kn=class extends Error{constructor(e,t=!0){if(super(e.info.detail),this.id=Math.random().toString().slice(2,10),Object.assign(this,e),this.name=this.info.name,t){const n=["SkyWayError",`name:${this.info.name}, detail:${this.info.detail}, solution:${this.info.solution}`];this.path&&n.push(this.path),this.error&&n.push(this.error),this.payload&&n.push(this.payload),n.push(this.id),NC.warn(...n)}}toJSON(){return{id:this.id,info:this.info,path:this.path,payload:this.payload,error:this.error,stack:this.stack}}};W();var OC=new De("packages/common/src/event.ts"),Me=class{constructor(e=()=>{}){this._onSetListener=e,this._stack=[],this._eventIndex=0,this.emit=t=>{for(const n of this._stack)try{n.execute(t)}catch(r){OC.error("task throws error",r)}},this.removeAllListeners=()=>{this._stack=[]},this.pipe=t=>this.add(n=>t.emit(n)),this.add=t=>{const n=this._eventIndex;this._stack.push({execute:t,id:n}),this._eventIndex++;const r=()=>{this._stack=this._stack.filter(a=>a.id!==n&&a)},i=a=>{a.push(r)};return this._onSetListener(),{removeListener:r,disposer:i}},this.once=t=>{const n=this.add(r=>{n.removeListener(),t(r)});return n},this.asPromise=t=>new Promise((n,r)=>{const i=t&&setTimeout(()=>{r(new eg("Event asPromise timeout : "+t))},t);this.once(a=>{i&&clearTimeout(i),n(a)})}),this.watch=(t,n)=>new Promise((r,i)=>{const a=n&&setTimeout(()=>{i(new eg("Event watch timeout : "+n))},n),{removeListener:o}=this.add(u=>{t(u)&&(a&&clearTimeout(a),o(),r(u))})})}get length(){return this._stack.length}},ai=class{constructor(){this.events=[]}make(){const e=new Me;return this.events.push(e),e}dispose(){this.events.forEach(e=>e.removeAllListeners()),this.events=[]}},lr=class{constructor(){this._disposer=[]}push(e){this._disposer.push(e)}dispose(){this._disposer.forEach(e=>e()),this._disposer=[]}},eg=class extends Error{toJSON(){return{name:this.name,message:this.message,stack:this.stack}}};W();W();W();W();W();function ky(e,t){return function(){return e.apply(t,arguments)}}var{toString:MC}=Object.prototype,{getPrototypeOf:uf}=Object,{iterator:Ru,toStringTag:Ty}=Symbol,Au=(e=>t=>{const n=MC.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Kr=e=>(e=e.toLowerCase(),t=>Au(t)===e),Iu=e=>t=>typeof t===e,{isArray:Fa}=Array,Mo=Iu("undefined");function LC(e){return e!==null&&!Mo(e)&&e.constructor!==null&&!Mo(e.constructor)&&Jn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}var Ry=Kr("ArrayBuffer");function jC(e){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(e):t=e&&e.buffer&&Ry(e.buffer),t}var BC=Iu("string"),Jn=Iu("function"),Ay=Iu("number"),Fu=e=>e!==null&&typeof e=="object",UC=e=>e===!0||e===!1,hl=e=>{if(Au(e)!=="object")return!1;const t=uf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Ty in e)&&!(Ru in e)},HC=Kr("Date"),VC=Kr("File"),qC=Kr("Blob"),zC=Kr("FileList"),KC=e=>Fu(e)&&Jn(e.pipe),$C=e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||Jn(e.append)&&((t=Au(e))==="formdata"||t==="object"&&Jn(e.toString)&&e.toString()==="[object FormData]"))},WC=Kr("URLSearchParams"),[GC,ZC,JC,QC]=["ReadableStream","Request","Response","Headers"].map(Kr),XC=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function oc(e,t,{allOwnKeys:n=!1}={}){if(e===null||typeof e>"u")return;let r,i;if(typeof e!="object"&&(e=[e]),Fa(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{const a=n?Object.getOwnPropertyNames(e):Object.keys(e),o=a.length;let u;for(r=0;r<o;r++)u=a[r],t.call(null,e[u],u,e)}}function Iy(e,t){t=t.toLowerCase();const n=Object.keys(e);let r=n.length,i;for(;r-- >0;)if(i=n[r],t===i.toLowerCase())return i;return null}var ys=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Fy=e=>!Mo(e)&&e!==ys;function Uh(){const{caseless:e}=Fy(this)&&this||{},t={},n=(r,i)=>{const a=e&&Iy(t,i)||i;hl(t[a])&&hl(r)?t[a]=Uh(t[a],r):hl(r)?t[a]=Uh({},r):Fa(r)?t[a]=r.slice():t[a]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&oc(arguments[r],n);return t}var YC=(e,t,n,{allOwnKeys:r}={})=>(oc(t,(i,a)=>{n&&Jn(i)?e[a]=ky(i,n):e[a]=i},{allOwnKeys:r}),e),eE=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),tE=(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},nE=(e,t,n,r)=>{let i,a,o;const u={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-- >0;)o=i[a],(!r||r(o,e,t))&&!u[o]&&(t[o]=e[o],u[o]=!0);e=n!==!1&&uf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},rE=(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return r!==-1&&r===n},iE=e=>{if(!e)return null;if(Fa(e))return e;let t=e.length;if(!Ay(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},sE=(e=>t=>e&&t instanceof e)(typeof Uint8Array<"u"&&uf(Uint8Array)),aE=(e,t)=>{const r=(e&&e[Ru]).call(e);let i;for(;(i=r.next())&&!i.done;){const a=i.value;t.call(e,a[0],a[1])}},oE=(e,t)=>{let n;const r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},cE=Kr("HTMLFormElement"),lE=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,i){return r.toUpperCase()+i}),tg=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),uE=Kr("RegExp"),Dy=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};oc(n,(i,a)=>{let o;(o=t(i,a,e))!==!1&&(r[a]=o||i)}),Object.defineProperties(e,r)},dE=e=>{Dy(e,(t,n)=>{if(Jn(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=e[n];if(Jn(r)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},hE=(e,t)=>{const n={},r=i=>{i.forEach(a=>{n[a]=!0})};return Fa(e)?r(e):r(String(e).split(t)),n},pE=()=>{},fE=(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t;function mE(e){return!!(e&&Jn(e.append)&&e[Ty]==="FormData"&&e[Ru])}var gE=e=>{const t=new Array(10),n=(r,i)=>{if(Fu(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[i]=r;const a=Fa(r)?[]:{};return oc(r,(o,u)=>{const p=n(o,i+1);!Mo(p)&&(a[u]=p)}),t[i]=void 0,a}}return r};return n(e,0)},vE=Kr("AsyncFunction"),yE=e=>e&&(Fu(e)||Jn(e))&&Jn(e.then)&&Jn(e.catch),Ny=((e,t)=>e?setImmediate:t?((n,r)=>(ys.addEventListener("message",({source:i,data:a})=>{i===ys&&a===n&&r.length&&r.shift()()},!1),i=>{r.push(i),ys.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",Jn(ys.postMessage)),_E=typeof queueMicrotask<"u"?queueMicrotask.bind(ys):typeof da<"u"&&da.nextTick||Ny,bE=e=>e!=null&&Jn(e[Ru]),me={isArray:Fa,isArrayBuffer:Ry,isBuffer:LC,isFormData:$C,isArrayBufferView:jC,isString:BC,isNumber:Ay,isBoolean:UC,isObject:Fu,isPlainObject:hl,isReadableStream:GC,isRequest:ZC,isResponse:JC,isHeaders:QC,isUndefined:Mo,isDate:HC,isFile:VC,isBlob:qC,isRegExp:uE,isFunction:Jn,isStream:KC,isURLSearchParams:WC,isTypedArray:sE,isFileList:zC,forEach:oc,merge:Uh,extend:YC,trim:XC,stripBOM:eE,inherits:tE,toFlatObject:nE,kindOf:Au,kindOfTest:Kr,endsWith:rE,toArray:iE,forEachEntry:aE,matchAll:oE,isHTMLForm:cE,hasOwnProperty:tg,hasOwnProp:tg,reduceDescriptors:Dy,freezeMethods:dE,toObjectSet:hE,toCamelCase:lE,noop:pE,toFiniteNumber:fE,findKey:Iy,global:ys,isContextDefined:Fy,isSpecCompliantForm:mE,toJSONObject:gE,isAsyncFn:vE,isThenable:yE,setImmediate:Ny,asap:_E,isIterable:bE};W();W();W();W();W();function ba(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}me.inherits(ba,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:me.toJSONObject(this.config),code:this.code,status:this.status}}});var Oy=ba.prototype,My={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{My[e]={value:e}});Object.defineProperties(ba,My);Object.defineProperty(Oy,"isAxiosError",{value:!0});ba.from=(e,t,n,r,i,a)=>{const o=Object.create(Oy);return me.toFlatObject(e,o,function(p){return p!==Error.prototype},u=>u!=="isAxiosError"),ba.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};var rt=ba;W();var SE=null;function Hh(e){return me.isPlainObject(e)||me.isArray(e)}function Ly(e){return me.endsWith(e,"[]")?e.slice(0,-2):e}function ng(e,t,n){return e?e.concat(t).map(function(i,a){return i=Ly(i),!n&&a?"["+i+"]":i}).join(n?".":""):t}function wE(e){return me.isArray(e)&&!e.some(Hh)}var xE=me.toFlatObject(me,{},null,function(t){return/^is[A-Z]/.test(t)});function CE(e,t,n){if(!me.isObject(e))throw new TypeError("target must be an object");t=t||new FormData,n=me.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(F,S){return!me.isUndefined(S[F])});const r=n.metaTokens,i=n.visitor||y,a=n.dots,o=n.indexes,p=(n.Blob||typeof Blob<"u"&&Blob)&&me.isSpecCompliantForm(t);if(!me.isFunction(i))throw new TypeError("visitor must be a function");function h(R){if(R===null)return"";if(me.isDate(R))return R.toISOString();if(me.isBoolean(R))return R.toString();if(!p&&me.isBlob(R))throw new rt("Blob is not supported. Use a Buffer instead.");return me.isArrayBuffer(R)||me.isTypedArray(R)?p&&typeof Blob=="function"?new Blob([R]):Buffer.from(R):R}function y(R,F,S){let b=R;if(R&&!S&&typeof R=="object"){if(me.endsWith(F,"{}"))F=r?F:F.slice(0,-2),R=JSON.stringify(R);else if(me.isArray(R)&&wE(R)||(me.isFileList(R)||me.endsWith(F,"[]"))&&(b=me.toArray(R)))return F=Ly(F),b.forEach(function(k,L){!(me.isUndefined(k)||k===null)&&t.append(o===!0?ng([F],L,a):o===null?F:F+"[]",h(k))}),!1}return Hh(R)?!0:(t.append(ng(S,F,a),h(R)),!1)}const f=[],_=Object.assign(xE,{defaultVisitor:y,convertValue:h,isVisitable:Hh});function w(R,F){if(!me.isUndefined(R)){if(f.indexOf(R)!==-1)throw Error("Circular reference detected in "+F.join("."));f.push(R),me.forEach(R,function(b,x){(!(me.isUndefined(b)||b===null)&&i.call(t,b,me.isString(x)?x.trim():x,F,_))===!0&&w(b,F?F.concat(x):[x])}),f.pop()}}if(!me.isObject(e))throw new TypeError("data must be an object");return w(e),t}var Du=CE;function rg(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function jy(e,t){this._pairs=[],e&&Du(e,this,t)}var By=jy.prototype;By.append=function(t,n){this._pairs.push([t,n])};By.toString=function(t){const n=t?function(r){return t.call(this,r,rg)}:rg;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};var Uy=jy;function EE(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Hy(e,t,n){if(!t)return e;const r=n&&n.encode||EE;me.isFunction(n)&&(n={serialize:n});const i=n&&n.serialize;let a;if(i?a=i(t,n):a=me.isURLSearchParams(t)?t.toString():new Uy(t,n).toString(r),a){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+a}return e}W();var PE=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){me.forEach(this.handlers,function(n){n!==null&&e(n)})}},ig=PE;W();W();W();W();var Vy={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};W();W();W();W();var kE=typeof URLSearchParams<"u"?URLSearchParams:Uy;W();var TE=typeof FormData<"u"?FormData:null;W();var RE=typeof Blob<"u"?Blob:null,AE={isBrowser:!0,classes:{URLSearchParams:kE,FormData:TE,Blob:RE},protocols:["http","https","file","blob","url","data"]},qy={};ty(qy,{hasBrowserEnv:()=>df,hasStandardBrowserEnv:()=>IE,hasStandardBrowserWebWorkerEnv:()=>FE,navigator:()=>Vh,origin:()=>DE});W();var df=typeof window<"u"&&typeof document<"u",Vh=typeof navigator=="object"&&navigator||void 0,IE=df&&(!Vh||["ReactNative","NativeScript","NS"].indexOf(Vh.product)<0),FE=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",DE=df&&window.location.href||"http://localhost",wn=ee(ee({},qy),AE);function NE(e,t){return Du(e,new wn.classes.URLSearchParams,Object.assign({visitor:function(n,r,i,a){return wn.isNode&&me.isBuffer(n)?(this.append(r,n.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},t))}W();function OE(e){return me.matchAll(/\w+|\[(\w*)]/g,e).map(t=>t[0]==="[]"?"":t[1]||t[0])}function ME(e){const t={},n=Object.keys(e);let r;const i=n.length;let a;for(r=0;r<i;r++)a=n[r],t[a]=e[a];return t}function LE(e){function t(n,r,i,a){let o=n[a++];if(o==="__proto__")return!0;const u=Number.isFinite(+o),p=a>=n.length;return o=!o&&me.isArray(i)?i.length:o,p?(me.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!u):((!i[o]||!me.isObject(i[o]))&&(i[o]=[]),t(n,r,i[o],a)&&me.isArray(i[o])&&(i[o]=ME(i[o])),!u)}if(me.isFormData(e)&&me.isFunction(e.entries)){const n={};return me.forEachEntry(e,(r,i)=>{t(OE(r),i,n,0)}),n}return null}var zy=LE;function jE(e,t,n){if(me.isString(e))try{return(t||JSON.parse)(e),me.trim(e)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(e)}var hf={transitional:Vy,adapter:["xhr","http","fetch"],transformRequest:[function(t,n){const r=n.getContentType()||"",i=r.indexOf("application/json")>-1,a=me.isObject(t);if(a&&me.isHTMLForm(t)&&(t=new FormData(t)),me.isFormData(t))return i?JSON.stringify(zy(t)):t;if(me.isArrayBuffer(t)||me.isBuffer(t)||me.isStream(t)||me.isFile(t)||me.isBlob(t)||me.isReadableStream(t))return t;if(me.isArrayBufferView(t))return t.buffer;if(me.isURLSearchParams(t))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return NE(t,this.formSerializer).toString();if((u=me.isFileList(t))||r.indexOf("multipart/form-data")>-1){const p=this.env&&this.env.FormData;return Du(u?{"files[]":t}:t,p&&new p,this.formSerializer)}}return a||i?(n.setContentType("application/json",!1),jE(t)):t}],transformResponse:[function(t){const n=this.transitional||hf.transitional,r=n&&n.forcedJSONParsing,i=this.responseType==="json";if(me.isResponse(t)||me.isReadableStream(t))return t;if(t&&me.isString(t)&&(r&&!this.responseType||i)){const o=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(t)}catch(u){if(o)throw u.name==="SyntaxError"?rt.from(u,rt.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:wn.classes.FormData,Blob:wn.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};me.forEach(["delete","get","head","post","put","patch"],e=>{hf.headers[e]={}});var pf=hf;W();W();var BE=me.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),UE=e=>{const t={};let n,r,i;return e&&e.split(`
`).forEach(function(o){i=o.indexOf(":"),n=o.substring(0,i).trim().toLowerCase(),r=o.substring(i+1).trim(),!(!n||t[n]&&BE[n])&&(n==="set-cookie"?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t},sg=Symbol("internals");function Ja(e){return e&&String(e).trim().toLowerCase()}function pl(e){return e===!1||e==null?e:me.isArray(e)?e.map(pl):String(e)}function HE(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}var VE=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Id(e,t,n,r,i){if(me.isFunction(r))return r.call(this,t,n);if(i&&(t=n),!!me.isString(t)){if(me.isString(r))return t.indexOf(r)!==-1;if(me.isRegExp(r))return r.test(t)}}function qE(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,n,r)=>n.toUpperCase()+r)}function zE(e,t){const n=me.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(i,a,o){return this[r].call(this,t,i,a,o)},configurable:!0})})}var Nu=class{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(o,u,p){const h=Ja(u);if(!h)throw new Error("header name must be a non-empty string");const y=me.findKey(r,h);(!y||r[y]===void 0||p===!0||p===void 0&&r[y]!==!1)&&(r[y||u]=pl(o))}const a=(o,u)=>me.forEach(o,(p,h)=>i(p,h,u));if(me.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(me.isString(e)&&(e=e.trim())&&!VE(e))a(UE(e),t);else if(me.isObject(e)&&me.isIterable(e)){let o={},u,p;for(const h of e){if(!me.isArray(h))throw TypeError("Object iterator must return a key-value pair");o[p=h[0]]=(u=o[p])?me.isArray(u)?[...u,h[1]]:[u,h[1]]:h[1]}a(o,t)}else e!=null&&i(t,e,n);return this}get(e,t){if(e=Ja(e),e){const n=me.findKey(this,e);if(n){const r=this[n];if(!t)return r;if(t===!0)return HE(r);if(me.isFunction(t))return t.call(this,r,n);if(me.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ja(e),e){const n=me.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||Id(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let r=!1;function i(a){if(a=Ja(a),a){const o=me.findKey(n,a);o&&(!t||Id(n,n[o],o,t))&&(delete n[o],r=!0)}}return me.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];(!e||Id(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return me.forEach(this,(r,i)=>{const a=me.findKey(n,i);if(a){t[a]=pl(r),delete t[i];return}const o=e?qE(i):String(i).trim();o!==i&&delete t[i],t[o]=pl(r),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return me.forEach(this,(n,r)=>{n!=null&&n!==!1&&(t[r]=e&&me.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[sg]=this[sg]={accessors:{}}).accessors,r=this.prototype;function i(a){const o=Ja(a);n[o]||(zE(r,a),n[o]=!0)}return me.isArray(e)?e.forEach(i):i(e),this}};Nu.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);me.reduceDescriptors(Nu.prototype,({value:e},t)=>{let n=t[0].toUpperCase()+t.slice(1);return{get:()=>e,set(r){this[n]=r}}});me.freezeMethods(Nu);var Br=Nu;function Fd(e,t){const n=this||pf,r=t||n,i=Br.from(r.headers);let a=r.data;return me.forEach(e,function(u){a=u.call(n,a,i.normalize(),t?t.status:void 0)}),i.normalize(),a}W();function Ky(e){return!!(e&&e.__CANCEL__)}W();function $y(e,t,n){rt.call(this,e??"canceled",rt.ERR_CANCELED,t,n),this.name="CanceledError"}me.inherits($y,rt,{__CANCEL__:!0});var cc=$y;W();W();W();function Wy(e,t,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?e(n):t(new rt("Request failed with status code "+n.status,[rt.ERR_BAD_REQUEST,rt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}W();function KE(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}W();W();function $E(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i=0,a=0,o;return t=t!==void 0?t:1e3,function(p){const h=Date.now(),y=r[a];o||(o=h),n[i]=p,r[i]=h;let f=a,_=0;for(;f!==i;)_+=n[f++],f=f%e;if(i=(i+1)%e,i===a&&(a=(a+1)%e),h-o<t)return;const w=y&&h-y;return w?Math.round(_*1e3/w):void 0}}var WE=$E;W();function GE(e,t){let n=0,r=1e3/t,i,a;const o=(h,y=Date.now())=>{n=y,i=null,a&&(clearTimeout(a),a=null),e.apply(null,h)};return[(...h)=>{const y=Date.now(),f=y-n;f>=r?o(h,y):(i=h,a||(a=setTimeout(()=>{a=null,o(i)},r-f)))},()=>i&&o(i)]}var ZE=GE,Kl=(e,t,n=3)=>{let r=0;const i=WE(50,250);return ZE(a=>{const o=a.loaded,u=a.lengthComputable?a.total:void 0,p=o-r,h=i(p),y=o<=u;r=o;const f={loaded:o,total:u,progress:u?o/u:void 0,bytes:p,rate:h||void 0,estimated:h&&u&&y?(u-o)/h:void 0,event:a,lengthComputable:u!=null,[t?"download":"upload"]:!0};e(f)},n)},ag=(e,t)=>{const n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},og=e=>(...t)=>me.asap(()=>e(...t));W();W();var JE=wn.hasStandardBrowserEnv?((e,t)=>n=>(n=new URL(n,wn.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new URL(wn.origin),wn.navigator&&/(msie|trident)/i.test(wn.navigator.userAgent)):()=>!0;W();var QE=wn.hasStandardBrowserEnv?{write(e,t,n,r,i,a){const o=[e+"="+encodeURIComponent(t)];me.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),me.isString(r)&&o.push("path="+r),me.isString(i)&&o.push("domain="+i),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};W();W();function XE(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}W();function YE(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}function Gy(e,t,n){let r=!XE(t);return e&&(r||n==!1)?YE(e,t):t}W();var cg=e=>e instanceof Br?ee({},e):e;function As(e,t){t=t||{};const n={};function r(h,y,f,_){return me.isPlainObject(h)&&me.isPlainObject(y)?me.merge.call({caseless:_},h,y):me.isPlainObject(y)?me.merge({},y):me.isArray(y)?y.slice():y}function i(h,y,f,_){if(me.isUndefined(y)){if(!me.isUndefined(h))return r(void 0,h,f,_)}else return r(h,y,f,_)}function a(h,y){if(!me.isUndefined(y))return r(void 0,y)}function o(h,y){if(me.isUndefined(y)){if(!me.isUndefined(h))return r(void 0,h)}else return r(void 0,y)}function u(h,y,f){if(f in t)return r(h,y);if(f in e)return r(void 0,h)}const p={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:u,headers:(h,y,f)=>i(cg(h),cg(y),f,!0)};return me.forEach(Object.keys(Object.assign({},e,t)),function(y){const f=p[y]||i,_=f(e[y],t[y],y);me.isUndefined(_)&&f!==u||(n[y]=_)}),n}var Zy=e=>{const t=As({},e);let{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:a,headers:o,auth:u}=t;t.headers=o=Br.from(o),t.url=Hy(Gy(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),u&&o.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let p;if(me.isFormData(n)){if(wn.hasStandardBrowserEnv||wn.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((p=o.getContentType())!==!1){const[h,...y]=p?p.split(";").map(f=>f.trim()).filter(Boolean):[];o.setContentType([h||"multipart/form-data",...y].join("; "))}}if(wn.hasStandardBrowserEnv&&(r&&me.isFunction(r)&&(r=r(t)),r||r!==!1&&JE(t.url))){const h=i&&a&&QE.read(a);h&&o.set(i,h)}return t},eP=typeof XMLHttpRequest<"u",tP=eP&&function(e){return new Promise(function(n,r){const i=Zy(e);let a=i.data;const o=Br.from(i.headers).normalize();let{responseType:u,onUploadProgress:p,onDownloadProgress:h}=i,y,f,_,w,R;function F(){w&&w(),R&&R(),i.cancelToken&&i.cancelToken.unsubscribe(y),i.signal&&i.signal.removeEventListener("abort",y)}let S=new XMLHttpRequest;S.open(i.method.toUpperCase(),i.url,!0),S.timeout=i.timeout;function b(){if(!S)return;const k=Br.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),G={data:!u||u==="text"||u==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:k,config:e,request:S};Wy(function(z){n(z),F()},function(z){r(z),F()},G),S=null}"onloadend"in S?S.onloadend=b:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(b)},S.onabort=function(){S&&(r(new rt("Request aborted",rt.ECONNABORTED,e,S)),S=null)},S.onerror=function(){r(new rt("Network Error",rt.ERR_NETWORK,e,S)),S=null},S.ontimeout=function(){let L=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const G=i.transitional||Vy;i.timeoutErrorMessage&&(L=i.timeoutErrorMessage),r(new rt(L,G.clarifyTimeoutError?rt.ETIMEDOUT:rt.ECONNABORTED,e,S)),S=null},a===void 0&&o.setContentType(null),"setRequestHeader"in S&&me.forEach(o.toJSON(),function(L,G){S.setRequestHeader(G,L)}),me.isUndefined(i.withCredentials)||(S.withCredentials=!!i.withCredentials),u&&u!=="json"&&(S.responseType=i.responseType),h&&([_,R]=Kl(h,!0),S.addEventListener("progress",_)),p&&S.upload&&([f,w]=Kl(p),S.upload.addEventListener("progress",f),S.upload.addEventListener("loadend",w)),(i.cancelToken||i.signal)&&(y=k=>{S&&(r(!k||k.type?new cc(null,e,S):k),S.abort(),S=null)},i.cancelToken&&i.cancelToken.subscribe(y),i.signal&&(i.signal.aborted?y():i.signal.addEventListener("abort",y)));const x=KE(i.url);if(x&&wn.protocols.indexOf(x)===-1){r(new rt("Unsupported protocol "+x+":",rt.ERR_BAD_REQUEST,e));return}S.send(a||null)})};W();W();var nP=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r=new AbortController,i;const a=function(h){if(!i){i=!0,u();const y=h instanceof Error?h:this.reason;r.abort(y instanceof rt?y:new cc(y instanceof Error?y.message:y))}};let o=t&&setTimeout(()=>{o=null,a(new rt(`timeout ${t} of ms exceeded`,rt.ETIMEDOUT))},t);const u=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(h=>{h.unsubscribe?h.unsubscribe(a):h.removeEventListener("abort",a)}),e=null)};e.forEach(h=>h.addEventListener("abort",a));const{signal:p}=r;return p.unsubscribe=()=>me.asap(u),p}},rP=nP;W();var iP=function*(e,t){let n=e.byteLength;if(n<t){yield e;return}let r=0,i;for(;r<n;)i=r+t,yield e.slice(r,i),r=i},sP=function(e,t){return ry(this,null,function*(){try{for(var n=Rx(aP(e)),r,i,a;r=!(i=yield new _a(n.next())).done;r=!1){const o=i.value;yield*iy(iP(o,t))}}catch(o){a=[o]}finally{try{r&&(i=n.return)&&(yield new _a(i.call(n)))}finally{if(a)throw a[0]}}})},aP=function(e){return ry(this,null,function*(){if(e[Symbol.asyncIterator]){yield*iy(e);return}const t=e.getReader();try{for(;;){const{done:n,value:r}=yield new _a(t.read());if(n)break;yield r}}finally{yield new _a(t.cancel())}})},lg=(e,t,n,r)=>{const i=sP(e,t);let a=0,o,u=p=>{o||(o=!0,r&&r(p))};return new ReadableStream({pull(p){return B(this,null,function*(){try{const{done:h,value:y}=yield i.next();if(h){u(),p.close();return}let f=y.byteLength;if(n){let _=a+=f;n(_)}p.enqueue(new Uint8Array(y))}catch(h){throw u(h),h}})},cancel(p){return u(p),i.return()}},{highWaterMark:2})},Ou=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Jy=Ou&&typeof ReadableStream=="function",oP=Ou&&(typeof TextEncoder=="function"?(e=>t=>e.encode(t))(new TextEncoder):e=>B(null,null,function*(){return new Uint8Array(yield new Response(e).arrayBuffer())})),Qy=(e,...t)=>{try{return!!e(...t)}catch{return!1}},cP=Jy&&Qy(()=>{let e=!1;const t=new Request(wn.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),ug=64*1024,qh=Jy&&Qy(()=>me.isReadableStream(new Response("").body)),$l={stream:qh&&(e=>e.body)};Ou&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!$l[t]&&($l[t]=me.isFunction(e[t])?n=>n[t]():(n,r)=>{throw new rt(`Response type '${t}' is not supported`,rt.ERR_NOT_SUPPORT,r)})})})(new Response);var lP=e=>B(null,null,function*(){if(e==null)return 0;if(me.isBlob(e))return e.size;if(me.isSpecCompliantForm(e))return(yield new Request(wn.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(me.isArrayBufferView(e)||me.isArrayBuffer(e))return e.byteLength;if(me.isURLSearchParams(e)&&(e=e+""),me.isString(e))return(yield oP(e)).byteLength}),uP=(e,t)=>B(null,null,function*(){const n=me.toFiniteNumber(e.getContentLength());return n??lP(t)}),dP=Ou&&(e=>B(null,null,function*(){let{url:t,method:n,data:r,signal:i,cancelToken:a,timeout:o,onDownloadProgress:u,onUploadProgress:p,responseType:h,headers:y,withCredentials:f="same-origin",fetchOptions:_}=Zy(e);h=h?(h+"").toLowerCase():"text";let w=rP([i,a&&a.toAbortSignal()],o),R;const F=w&&w.unsubscribe&&(()=>{w.unsubscribe()});let S;try{if(p&&cP&&n!=="get"&&n!=="head"&&(S=yield uP(y,r))!==0){let G=new Request(t,{method:"POST",body:r,duplex:"half"}),K;if(me.isFormData(r)&&(K=G.headers.get("content-type"))&&y.setContentType(K),G.body){const[z,U]=ag(S,Kl(og(p)));r=lg(G.body,ug,z,U)}}me.isString(f)||(f=f?"include":"omit");const b="credentials"in Request.prototype;R=new Request(t,de(ee({},_),{signal:w,method:n.toUpperCase(),headers:y.normalize().toJSON(),body:r,duplex:"half",credentials:b?f:void 0}));let x=yield fetch(R,_);const k=qh&&(h==="stream"||h==="response");if(qh&&(u||k&&F)){const G={};["status","statusText","headers"].forEach(J=>{G[J]=x[J]});const K=me.toFiniteNumber(x.headers.get("content-length")),[z,U]=u&&ag(K,Kl(og(u),!0))||[];x=new Response(lg(x.body,ug,z,()=>{U&&U(),F&&F()}),G)}h=h||"text";let L=yield $l[me.findKey($l,h)||"text"](x,e);return!k&&F&&F(),yield new Promise((G,K)=>{Wy(G,K,{data:L,headers:Br.from(x.headers),status:x.status,statusText:x.statusText,config:e,request:R})})}catch(b){throw F&&F(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new rt("Network Error",rt.ERR_NETWORK,e,R),{cause:b.cause||b}):rt.from(b,b&&b.code,e,R)}})),zh={http:SE,xhr:tP,fetch:dP};me.forEach(zh,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});var dg=e=>`- ${e}`,hP=e=>me.isFunction(e)||e===null||e===!1,Xy={getAdapter:e=>{e=me.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let a=0;a<t;a++){n=e[a];let o;if(r=n,!hP(n)&&(r=zh[(o=String(n)).toLowerCase()],r===void 0))throw new rt(`Unknown adapter '${o}'`);if(r)break;i[o||"#"+a]=r}if(!r){const a=Object.entries(i).map(([u,p])=>`adapter ${u} `+(p===!1?"is not supported by the environment":"is not available in the build"));let o=t?a.length>1?`since :
`+a.map(dg).join(`
`):" "+dg(a[0]):"as no adapter specified";throw new rt("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:zh};function Dd(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new cc(null,e)}function hg(e){return Dd(e),e.headers=Br.from(e.headers),e.data=Fd.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Xy.getAdapter(e.adapter||pf.adapter)(e).then(function(r){return Dd(e),r.data=Fd.call(e,e.transformResponse,r),r.headers=Br.from(r.headers),r},function(r){return Ky(r)||(Dd(e),r&&r.response&&(r.response.data=Fd.call(e,e.transformResponse,r.response),r.response.headers=Br.from(r.response.headers))),Promise.reject(r)})}W();W();var Yy="1.10.0",Mu={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Mu[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});var pg={};Mu.transitional=function(t,n,r){function i(a,o){return"[Axios v"+Yy+"] Transitional option '"+a+"'"+o+(r?". "+r:"")}return(a,o,u)=>{if(t===!1)throw new rt(i(o," has been removed"+(n?" in "+n:"")),rt.ERR_DEPRECATED);return n&&!pg[o]&&(pg[o]=!0,console.warn(i(o," has been deprecated since v"+n+" and will be removed in the near future"))),t?t(a,o,u):!0}};Mu.spelling=function(t){return(n,r)=>(console.warn(`${r} is likely a misspelling of ${t}`),!0)};function pP(e,t,n){if(typeof e!="object")throw new rt("options must be an object",rt.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const a=r[i],o=t[a];if(o){const u=e[a],p=u===void 0||o(u,a,e);if(p!==!0)throw new rt("option "+a+" must be "+p,rt.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new rt("Unknown option "+a,rt.ERR_BAD_OPTION)}}var fl={assertOptions:pP,validators:Mu},Xr=fl.validators,Wl=class{constructor(e){this.defaults=e||{},this.interceptors={request:new ig,response:new ig}}request(e,t){return B(this,null,function*(){try{return yield this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}})}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=As(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;n!==void 0&&fl.assertOptions(n,{silentJSONParsing:Xr.transitional(Xr.boolean),forcedJSONParsing:Xr.transitional(Xr.boolean),clarifyTimeoutError:Xr.transitional(Xr.boolean)},!1),r!=null&&(me.isFunction(r)?t.paramsSerializer={serialize:r}:fl.assertOptions(r,{encode:Xr.function,serialize:Xr.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),fl.assertOptions(t,{baseUrl:Xr.spelling("baseURL"),withXsrfToken:Xr.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=i&&me.merge(i.common,i[t.method]);i&&me.forEach(["delete","get","head","post","put","patch","common"],w=>{delete i[w]}),t.headers=Br.concat(a,i);const o=[];let u=!0;this.interceptors.request.forEach(function(R){typeof R.runWhen=="function"&&R.runWhen(t)===!1||(u=u&&R.synchronous,o.unshift(R.fulfilled,R.rejected))});const p=[];this.interceptors.response.forEach(function(R){p.push(R.fulfilled,R.rejected)});let h,y=0,f;if(!u){const w=[hg.bind(this),void 0];for(w.unshift.apply(w,o),w.push.apply(w,p),f=w.length,h=Promise.resolve(t);y<f;)h=h.then(w[y++],w[y++]);return h}f=o.length;let _=t;for(y=0;y<f;){const w=o[y++],R=o[y++];try{_=w(_)}catch(F){R.call(this,F);break}}try{h=hg.call(this,_)}catch(w){return Promise.reject(w)}for(y=0,f=p.length;y<f;)h=h.then(p[y++],p[y++]);return h}getUri(e){e=As(this.defaults,e);const t=Gy(e.baseURL,e.url,e.allowAbsoluteUrls);return Hy(t,e.params,e.paramsSerializer)}};me.forEach(["delete","get","head","options"],function(t){Wl.prototype[t]=function(n,r){return this.request(As(r||{},{method:t,url:n,data:(r||{}).data}))}});me.forEach(["post","put","patch"],function(t){function n(r){return function(a,o,u){return this.request(As(u||{},{method:t,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}Wl.prototype[t]=n(),Wl.prototype[t+"Form"]=n(!0)});var ml=Wl;W();var fP=class e_{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(a){n=a});const r=this;this.promise.then(i=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](i);r._listeners=null}),this.promise.then=i=>{let a;const o=new Promise(u=>{r.subscribe(u),a=u}).then(i);return o.cancel=function(){r.unsubscribe(a)},o},t(function(a,o,u){r.reason||(r.reason=new cc(a,o,u),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new e_(function(i){t=i}),cancel:t}}},mP=fP;W();function gP(e){return function(n){return e.apply(null,n)}}W();function vP(e){return me.isObject(e)&&e.isAxiosError===!0}W();var Kh={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Kh).forEach(([e,t])=>{Kh[t]=e});var yP=Kh;function t_(e){const t=new ml(e),n=ky(ml.prototype.request,t);return me.extend(n,ml.prototype,t,{allOwnKeys:!0}),me.extend(n,t,null,{allOwnKeys:!0}),n.create=function(i){return t_(As(e,i))},n}var Zt=t_(pf);Zt.Axios=ml;Zt.CanceledError=cc;Zt.CancelToken=mP;Zt.isCancel=Ky;Zt.VERSION=Yy;Zt.toFormData=Du;Zt.AxiosError=rt;Zt.Cancel=Zt.CanceledError;Zt.all=function(t){return Promise.all(t)};Zt.spread=gP;Zt.isAxiosError=vP;Zt.mergeConfig=As;Zt.AxiosHeaders=Br;Zt.formToJSON=e=>zy(me.isHTMLForm(e)?new FormData(e):e);Zt.getAdapter=Xy.getAdapter;Zt.HttpStatusCode=yP;Zt.default=Zt;var qs=Zt,{Axios:RR,AxiosError:AR,CanceledError:IR,isCancel:FR,CancelToken:DR,VERSION:NR,all:OR,Cancel:MR,isAxiosError:LR,spread:jR,toFormData:BR,AxiosHeaders:UR,HttpStatusCode:HR,formToJSON:VR,getAdapter:qR,mergeConfig:zR}=qs,Tr=new De("packages/common/src/http.ts"),ff=class{constructor(e){this.api=qs.create({baseURL:e})}get(e,t){return B(this,null,function*(){const n=yield this.api.get(e,t).catch(r=>r);if(qs.isAxiosError(n)){const r=de(ee({},n.response),{message:n.message});if(t!=null&&t.retry){if(yield t.retry(r))return Tr.warn("retry get",{url:e}),this.get(e,t);throw Tr.warn("retry get failed",{url:e}),r}throw Tr.warn("response error",{error:r}),r}else return n.data})}post(e,t,n){return B(this,null,function*(){var r,i,a;const o=yield this.api.post(e,t,n).catch(u=>u);if(qs.isAxiosError(o)){const u={data:(r=o.response)==null?void 0:r.data,status:(i=o.response)==null?void 0:i.status,statusText:(a=o.response)==null?void 0:a.statusText,message:o.message};if(Tr.warn("error received",u),n!=null&&n.retry){const p=yield n.retry(u);if(p)return Tr.warn("retry post",e,{data:t,error:u,needRetry:p}),this.post(e,t,n);throw u}throw u}else return o.data})}put(e,t,n){return B(this,null,function*(){const r=yield this.api.put(e,t,n).catch(i=>i);if(qs.isAxiosError(r)){const i=de(ee({},r.response),{message:r.message});if(n!=null&&n.retry){if(yield n.retry(i))return Tr.warn("retry put",{url:e,data:t}),this.put(e,t,n);throw Tr.warn("retry put failed",{url:e,data:t}),i}throw Tr.warn("response error",{error:i}),i}else return r.data})}delete(e,t){return B(this,null,function*(){const n=yield this.api.delete(e,t).catch(r=>r);if(qs.isAxiosError(n)){const r=de(ee({},n.response),{message:n.message});if(t!=null&&t.retry){if(yield t.retry(r))return Tr.warn("retry delete",{url:e}),this.delete(e,t);throw Tr.warn("retry delete failed",{url:e}),r}throw Tr.warn("response error",{error:r}),r}else return n.data})}};W();var _P=new De("packages/common/src/promise.ts"),is=class{constructor(){this.id=Math.random().toString().slice(2),this.queue=[],this.running=!1,this.push=e=>new Promise((t,n)=>{this.queue.push({promise:e,done:t,failed:n}),this.running||this.run().catch(r=>{_P.error("push",r)})})}run(){return B(this,null,function*(){const e=this.queue.shift();if(e){this.running=!0;try{const t=yield e.promise();e.done(t)}catch(t){e.failed(t)}yield this.run()}else this.running=!1})}};W();var Mr=class{constructor(e={}){this.count=0,this.times=8,this.interval=100,this.jitter=0,Object.assign(this,e)}wait(){return B(this,null,function*(){if(this.exceeded)return!1;const e=this.timeout;return this.count++,yield new Promise(t=>setTimeout(t,e)),!0})}get timeout(){return _i(this.count,2)*this.interval+_i(this.count,2)*this.jitter*Math.random()}get exceeded(){return this.count>=this.times}reset(){this.count=0}},bP=e=>JSON.parse(JSON.stringify(e));W();var Ae={internal:{name:"internal",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},missingProperty:{name:"missingProperty",detail:"",solution:""},notFound:{name:"notFound",detail:"",solution:""},invalidParameter:{name:"invalidParameter",detail:"",solution:""},invalidArgumentValue:{name:"invalidArgumentValue",detail:"引数の値が不正です",solution:"正しい値を引数に渡してください"},invalidContentType:{name:"invalidContentType",detail:"contentTypeが正しくありません",solution:"ContentTypeを確認してください"},localPersonNotJoinedChannel:{name:"localPersonNotJoinedChannel",detail:"操作しようとしたPersonがChannelに居ないので、操作できません The person who tried to operate is not in the channel, so the operation is not possible",solution:"Channelに居ないPersonを操作している可能性があるので確認してください Please check as you may be operating a person which is not in the channel"},alreadyLocalPersonExist:{name:"alreadyLocalPersonExist",detail:"ChannelにすでにLocalPersonが存在します。一つのChannelインスタンスにはLocalPersonが一つしかJoinできません",solution:"複数のLocalPersonを用意したい場合は個別にChannelインスタンスを用意してください。"},alreadySameNameMemberExist:{name:"alreadySameNameMemberExist",detail:"Channelにすでに同じNameのMemberが存在します",solution:"別のNameを使用してください"},alreadyPublishedStream:{name:"alreadyPublishedStream",detail:"すでにPublishしたStreamを再度Publishすることはできません You cannot re-publish a stream that has already been published",solution:"そのStreamをPublishしたPublicationをUnpublishするか、別の新しいStreamを作ってPublishしてください Unpublish the publication that published that stream, or create another new stream and publish it"},alreadySubscribedPublication:{name:"alreadySubscribedPublication",detail:"すでにSubscribeしたPublicationをSubscribeすることはできません",solution:"ありません"},invalidTrackKind:{name:"invalidTrackKind",detail:"Streamの種類とMediaStreamTrackの種類が一致しません",solution:"Streamの種類と同じMediaStreamTrackを利用してください"},cantMoveSameIdChannel:{name:"cantMoveSameIdChannel",detail:"moveChannelで同じidのChannelに移動することは出来ません",solution:"移動先のChannelが正しいか確かめてください"},alreadyChannelClosed:{name:"alreadyChannelClosed",detail:"ChannelがすでにCloseされています",solution:"ありません"},disabledDataStream:{name:"disabledDataStream",detail:"関連するPublicationがDisableなDataStreamには書き込みできません",solution:"関連するPublicationをEnableしてから書き込んでください"},publicationNotExist:{name:"publicationNotExist",detail:"channelに該当するPublicationが存在しません",solution:"publicationIdが正しいか確かめてください"},subscriptionNotExist:{name:"subscriptionNotExist",detail:"channelに該当するSubscriptionが存在しません",solution:"subscriptionIdが正しいか確かめてください"},unknownMemberType:{name:"unknownMemberType",detail:"対象のMemberのSubtypeのプラグインが登録されていません",solution:"対象のMemberのSubtypeのプラグイン(SfuBotなど)をSkyWayContextに登録してください"},streamNotExistInSubscription:{name:"streamNotExistInSubscription",detail:"SubscriptionにStreamがありません。RemoteMemberのSubscriptionのStreamにはアクセスできません",solution:"参照しているSubscriptionが目的のものか確かめてください。"},streamNotExistInPublication:{name:"streamNotExistInPublication",detail:"PublicationにStreamがありません。RemoteMemberのPublicationのStreamにはアクセスできません",solution:"参照しているPublicationが目的のものか確かめてください。"},dataStreamNotSupportEncoding:{name:"dataStreamNotSupportEncoding",detail:"dataStreamはEncode設定の変更に対応していません",solution:"ありません"},correspondingEncodeNotExistForId:{name:"correspondingEncodeNotExistForId",detail:"指定されたIDに対応するEncode設定が存在しません",solution:"正しいEncodingIDを指定してください"},updateIceParamsFailed:{name:"updateIceParamsFailed",detail:"iceParamsの更新に失敗しました",solution:"ありません"},invalidElement:{name:"invalidElement",detail:"渡されたHTML Elementが正しくありません",solution:"要求された正しいElementを渡してください"},connectRtcApiFailed:{name:"connectRtcApiFailed",detail:"RtcAPIへの接続に失敗しました",solution:"インターネットへ接続できているか、もしくはTokenのパラメータが正しいかを確かめてください"},rtcApiFatalError:{name:"rtcApiFatalError",detail:"RtcAPIの回復不能なエラーです。サーバー側の問題の可能性があります",solution:"インターネットへの接続が出来ているかを確かめてください"},invalidExpireTokenValue:{name:"invalidExpireTokenValue",detail:"tokenのExpire時刻が不正です",solution:"正しい時刻を指定してください"},invalidRemindExpireTokenValue:{name:"invalidRemindExpireTokenValue",detail:"tokenのExpireをリマインドする時間の値が不正です",solution:"正しい時間を指定してください"},invalidTokenAppId:{name:"invalidTokenAppId",detail:"tokenのappIdが正しくありません",solution:"正しいappIdを含むTokenを使用してください"},mediaDevicesNotFound:{name:"mediaDevicesNotFound",detail:"navigator.mediaDevicesがみつかりません",solution:"アプリケーションをhttps,localhost,127.0.0.1のいずれかの環境で動作させてください"},canNotUseReplaceStream:{name:"canNotUseReplaceStream",detail:"remoteのPublicationからreplaceStreamできません",solution:"対象のPublicationがLocalのものか確認してください"},canNotEnableRemotePublication:{name:"canNotEnableRemotePublication",detail:"remoteのPublicationをenableすることはできません",solution:"対象のPublicationがLocalのものか確認してください"}};W();W();W();var SP=Xn(Ax());Xn(qr());var wP=Xn(sy()),xP=new De("packages/core/src/util.ts");function Sa(e){const t=[];return e.forEach(n=>{t.push(n)}),t}function Qe(e){return B(this,arguments,function*({operationName:t,channel:n}){const r={operationName:t,appId:n.appId,channelId:n.id};if(n.localPerson){const i=n.localPerson,a=yield Promise.all(i.publications.map(u=>B(null,null,function*(){var p,h,y;const f={id:u.id,contentType:u.contentType,state:u.state,stats:{},connectionStats:{}};if(u.stream)for(const{memberId:_,stats:w}of yield u.stream._getStatsAll()){const R=w.find(F=>F.type.includes("local-candidate"));f.stats[_]={transportType:(p=R==null?void 0:R.protocol)!=null?p:"none",relayProtocol:(h=R==null?void 0:R.relayProtocol)!=null?h:"none",callType:(y=u.subscriptions.find(F=>F.subscriber.id===_))==null?void 0:y.subscriber.subtype,outbound:w.find(F=>F.type.includes("outbound-rtp")),localCandidate:R}}if(u.stream)for(const{memberId:_,connectionState:w}of u.stream._getConnectionStateAll())f.connectionStats[_]=w;return f})));r.publishing=a;const o=yield Promise.all(i.subscriptions.map(u=>B(null,null,function*(){const p={id:u.id,contentType:u.contentType,stats:{}};if(p.callType=u.publication.publisher.subtype,u.stream){const h=yield u.stream.getStats();p.stats=h.find(f=>f.type.includes("inbound-rtp"));const y=h.find(f=>f.type.includes("local-candidate"));p.transportType=y==null?void 0:y.protocol,p.relayProtocol=y==null?void 0:y.relayProtocol}return u.stream&&(p.connectionState=u.stream.getConnectionState()),p})));r.subscribing=o}return r})}function Wt({member:e,detail:t,channel:n,operationName:r,payload:i}){const a={operationName:r,payload:i,detail:t};return e&&(a.appId=e.channel.appId,a.channelId=e.channel.id,a.memberId=e.id),n&&(a.appId=n.appId,a.channelId=n.id),a}function we({operationName:e,context:t,info:n,error:r,path:i,payload:a,channel:o}){const u={operationName:e,payload:a};return o&&(u.appId=o.appId,u.channelId=o.id,o.localPerson&&(u.memberId=o.localPerson.id)),t&&(u.info=t.info,u.plugins=t.plugins.map(p=>p.subtype)),new Kn({error:r,info:n,payload:u,path:i})}var fg=e=>B(null,[e],function*({stream:t,remoteMember:n,end:r,interval:i,timeout:a}){return new Promise((o,u)=>B(null,null,function*(){i??(i=100),a??(a=1e4);for(let p=0;;p+=i){if(p>=a){u(we({operationName:"Peer.waitForStats",info:de(ee({},Ae.timeout),{detail:"waitForStats timeout"}),path:xP.prefix}));break}const h=yield t._getStats(n);if(r(h)){o(h);break}yield new Promise(y=>setTimeout(y,i))}}))}),CP=(e,t)=>{var n,r;return n_((r=(n=e.find(i=>i.payload===t))==null?void 0:n.config)!=null?r:"")},n_=e=>e.split(";").reduce((n,r)=>{const[i,a]=r.split("=");return i&&(n[i]=isNaN(Number(a))?a:Number(a)),n},{}),r_=({isNotBrowser:e}={})=>{if(e)return e;const t=SP.default.getParser(window.navigator.userAgent),n=t.getOSName(),r=t.getOSVersion(),i=t.getBrowserName(),a=t.getBrowserVersion();return{browserName:i,browserVersion:a,osName:n,osVersion:r}};function mg(){var e,t,n,r,i,a,o,u;if(typeof navigator=="object"&&navigator.product==="ReactNative")return typeof RTCPeerConnection>"u"?void 0:typeof RTCRtpTransceiver<"u"?"ReactNativeUnifiedPlan":"ReactNative";if(typeof navigator=="object"&&typeof navigator.userAgent=="string"){const p=navigator.userAgent,h=new wP.UAParser(p),y=h.getBrowser(),f=(t=(e=y.name)==null?void 0:e.toLowerCase())!=null?t:"",_=parseInt((n=y.major)!=null?n:"0"),R=(i=(r=h.getEngine().name)==null?void 0:r.toLowerCase())!=null?i:"",F=h.getOS(),S=(o=(a=F.name)==null?void 0:a.toLowerCase())!=null?o:"",b=parseFloat((u=F.version)!=null?u:"0"),x=S==="ios",k=["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(f),L=["firefox","mobile firefox","mobile focus"].includes(f),G=["safari","mobile safari"].includes(f),K=["edge"].includes(f);if((k||K)&&!x&&_>=111)return"Chrome111";if(k&&!x&&_>=74||K&&!x&&_>=88)return"Chrome74";if(k&&!x&&_>=70)return"Chrome70";if(k&&!x&&_>=67)return"Chrome67";if(k&&!x&&_>=55)return"Chrome55";if(L&&!x&&_>=60)return"Firefox60";if(L&&x&&b>=14.3)return"Safari12";if(G&&_>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(G&&_>=11)return"Safari11";if(K&&!x&&_>=11&&_<=18)return"Edge11";if(R==="webkit"&&x&&b>=14.3&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(R==="blink"){const z=p.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(z){const U=Number(z[1]);return U>=111?"Chrome111":U>=74?"Chrome74":U>=70?"Chrome70":U>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else return}else return}var Nd=new De("packages/core/src/member/index.ts"),Lu=class{constructor(e){this._state="joined",this._events=new ai,this.onLeft=this._events.make(),this.onMetadataUpdated=this._events.make(),this.channel=e.channel,this.id=e.id,this.name=e.name,this._metadata=e.metadata,this.context=e.context}get metadata(){return this._metadata}get state(){return this._state}get publications(){return this.channel.publications.filter(e=>e.publisher.id===this.id)}get subscriptions(){return this.channel.subscriptions.filter(e=>e.subscriber.id===this.id)}toJSON(){return{id:this.id,name:this.name,type:this.type,subtype:this.subtype,metadata:this.metadata}}_left(){this._state="left",this.onLeft.emit(),this._events.dispose()}_metadataUpdated(e){this._metadata=e,this.onMetadataUpdated.emit(e)}updateMetadata(e){return B(this,null,function*(){yield this.channel._updateMemberMetadata(this.id,e)})}leave(){return B(this,null,function*(){const e=Nd.info("[start] leave",yield Qe({operationName:"localPerson.leave",channel:this.channel}));if(this.state==="left")throw we({operationName:"localPerson.leave",info:Ae.localPersonNotJoinedChannel,path:Nd.prefix,context:this.context,channel:this.channel});yield this.channel.leave(this),Nd.elapsed(e,"[end] leave")})}};W();W();var Vc=new De("packages/core/src/plugin/internal/unknown/connection.ts"),EP=class{constructor(e,t){this.localPerson=e,this.remoteMember=t,this.type="unknown",this.onDisconnect=new Me,this.onClose=new Me,this.closed=!1}close(){this.closed=!0,this.onClose.emit()}startPublishing(e){return B(this,null,function*(){Vc.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{publication:e})})}stopPublishing(e){return B(this,null,function*(){Vc.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{publication:e})})}startSubscribing(e){return B(this,null,function*(){Vc.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{subscription:e})})}stopSubscribing(e){return B(this,null,function*(){Vc.debug(`this is unknown type connection. should install ${this.remoteMember.subtype} plugin`,{subscription:e})})}},i_=class extends Lu{constructor(e){super(e),this.type="bot",this.side="remote",this._connections={},this.plugin=e.plugin,this.subtype=e.subtype}_getConnection(e){return this._connections[e]}_getOrCreateConnection(e){var t;return(t=this._getConnection(e.id))!=null?t:this._createConnection(e,this)}_createConnection(e,t){return new EP(e,t)}_dispose(){}};W();W();W();W();W();W();var s_=new De("packages/core/src/media/stream/base.ts");function a_(e,t){var n;if(((n=e??{})==null?void 0:n.srcObject)===void 0)throw we({operationName:"attachElement",info:Ae.invalidElement,payload:{element:e},path:s_.prefix});if(e.srcObject){const r=e.srcObject,i=r.getTracks().find(o=>o.readyState==="ended");i&&r.removeTrack(i);const a=r.getTracks().find(o=>o.kind===t.kind);a&&r.removeTrack(a),r.addTrack(t)}else e.srcObject=new MediaStream([t])}function o_(e,t){var n;if(((n=e??{})==null?void 0:n.srcObject)===void 0)throw we({operationName:"attachElement",info:Ae.invalidElement,payload:{element:e},path:s_.prefix});const r=e.srcObject;r.getTracks().length>0&&r.removeTrack(t),r.getTracks().length===0&&(e.srcObject=null)}W();W();W();W();var qc,PP=new Uint8Array(16);function kP(){if(!qc&&(qc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!qc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return qc(PP)}W();W();W();var TP=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function RP(e){return typeof e=="string"&&TP.test(e)}var AP=RP,un=[];for(let e=0;e<256;++e)un.push((e+256).toString(16).slice(1));function IP(e,t=0){return un[e[t+0]]+un[e[t+1]]+un[e[t+2]]+un[e[t+3]]+"-"+un[e[t+4]]+un[e[t+5]]+"-"+un[e[t+6]]+un[e[t+7]]+"-"+un[e[t+8]]+un[e[t+9]]+"-"+un[e[t+10]]+un[e[t+11]]+un[e[t+12]]+un[e[t+13]]+un[e[t+14]]+un[e[t+15]]}W();W();var FP=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),gg={randomUUID:FP};function DP(e,t,n){if(gg.randomUUID&&!t&&!e)return gg.randomUUID();e=e||{};const r=e.random||(e.rng||kP)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let i=0;i<16;++i)t[n+i]=r[i];return t}return IP(r)}var $r=DP;W();var NP=Xn(Dx());W();function $h(e){this.message=e}$h.prototype=new Error,$h.prototype.name="InvalidCharacterError";var vg=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new $h("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i=0,a=0,o="";r=t.charAt(a++);~r&&(n=i%4?64*n+r:r,i++%4)?o+=String.fromCharCode(255&n>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return o};function OP(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(n){return decodeURIComponent(vg(n).replace(/(.)/g,function(r,i){var a=i.charCodeAt(0).toString(16).toUpperCase();return a.length<2&&(a="0"+a),"%"+a}))}(t)}catch{return vg(t)}}function Gl(e){this.message=e}function MP(e,t){if(typeof e!="string")throw new Gl("Invalid token specified");var n=(t=t||{}).header===!0?0:1;try{return JSON.parse(OP(e.split(".")[n]))}catch(r){throw new Gl("Invalid token specified: "+r.message)}}Gl.prototype=new Error,Gl.prototype.name="InvalidTokenError";var LP=MP;W();W();var Ie={};ty(Ie,{BRAND:()=>lk,DIRTY:()=>ra,EMPTY_PATH:()=>HP,INVALID:()=>Ve,NEVER:()=>$k,OK:()=>Nn,ParseStatus:()=>Qn,Schema:()=>Xe,ZodAny:()=>Ca,ZodArray:()=>Fs,ZodBigInt:()=>Bo,ZodBoolean:()=>Uo,ZodBranded:()=>mf,ZodCatch:()=>Jo,ZodDate:()=>Ho,ZodDefault:()=>Zo,ZodDiscriminatedUnion:()=>m_,ZodEffects:()=>Vr,ZodEnum:()=>lc,ZodError:()=>Ur,ZodFirstPartyTypeKind:()=>qe,ZodFunction:()=>__,ZodIntersection:()=>Ko,ZodIssueCode:()=>Te,ZodLazy:()=>$o,ZodLiteral:()=>Wo,ZodMap:()=>Yl,ZodNaN:()=>tu,ZodNativeEnum:()=>Go,ZodNever:()=>bi,ZodNull:()=>qo,ZodNullable:()=>Xi,ZodNumber:()=>jo,ZodObject:()=>wr,ZodOptional:()=>ii,ZodParsedType:()=>Oe,ZodPipeline:()=>gf,ZodPromise:()=>Ea,ZodReadonly:()=>Qo,ZodRecord:()=>y_,ZodSchema:()=>Xe,ZodSet:()=>eu,ZodString:()=>xa,ZodSymbol:()=>Ql,ZodTransformer:()=>Vr,ZodTuple:()=>Qi,ZodType:()=>Xe,ZodUndefined:()=>Vo,ZodUnion:()=>zo,ZodUnknown:()=>xs,ZodVoid:()=>Xl,addIssueToContext:()=>Fe,any:()=>yk,array:()=>wk,bigint:()=>pk,boolean:()=>E_,coerce:()=>Kk,custom:()=>w_,date:()=>fk,datetimeRegex:()=>p_,defaultErrorMap:()=>wa,discriminatedUnion:()=>Pk,effect:()=>bg,enum:()=>Ok,function:()=>Fk,getErrorMap:()=>Zl,getParsedType:()=>di,instanceof:()=>dk,intersection:()=>kk,isAborted:()=>Gh,isAsync:()=>Lo,isDirty:()=>Zh,isValid:()=>Is,late:()=>uk,lazy:()=>Dk,literal:()=>Nk,makeIssue:()=>Jl,map:()=>Ak,nan:()=>hk,nativeEnum:()=>Mk,never:()=>bk,null:()=>vk,nullable:()=>Bk,number:()=>C_,object:()=>xk,objectUtil:()=>Wh,oboolean:()=>zk,onumber:()=>qk,optional:()=>jk,ostring:()=>Vk,pipeline:()=>Hk,preprocess:()=>Uk,promise:()=>Lk,quotelessJson:()=>jP,record:()=>Rk,set:()=>Ik,setErrorMap:()=>UP,strictObject:()=>Ck,string:()=>x_,symbol:()=>mk,transformer:()=>bg,tuple:()=>Tk,undefined:()=>gk,union:()=>Ek,unknown:()=>_k,util:()=>at,void:()=>Sk});W();W();W();W();W();var at;(function(e){e.assertEqual=i=>{};function t(i){}e.assertIs=t;function n(i){throw new Error}e.assertNever=n,e.arrayToEnum=i=>{const a={};for(const o of i)a[o]=o;return a},e.getValidEnumValues=i=>{const a=e.objectKeys(i).filter(u=>typeof i[i[u]]!="number"),o={};for(const u of a)o[u]=i[u];return e.objectValues(o)},e.objectValues=i=>e.objectKeys(i).map(function(a){return i[a]}),e.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const a=[];for(const o in i)Object.prototype.hasOwnProperty.call(i,o)&&a.push(o);return a},e.find=(i,a)=>{for(const o of i)if(a(o))return o},e.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,a=" | "){return i.map(o=>typeof o=="string"?`'${o}'`:o).join(a)}e.joinValues=r,e.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(at||(at={}));var Wh;(function(e){e.mergeShapes=(t,n)=>ee(ee({},t),n)})(Wh||(Wh={}));var Oe=at.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),di=e=>{switch(typeof e){case"undefined":return Oe.undefined;case"string":return Oe.string;case"number":return Number.isNaN(e)?Oe.nan:Oe.number;case"boolean":return Oe.boolean;case"function":return Oe.function;case"bigint":return Oe.bigint;case"symbol":return Oe.symbol;case"object":return Array.isArray(e)?Oe.array:e===null?Oe.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Oe.promise:typeof Map<"u"&&e instanceof Map?Oe.map:typeof Set<"u"&&e instanceof Set?Oe.set:typeof Date<"u"&&e instanceof Date?Oe.date:Oe.object;default:return Oe.unknown}},Te=at.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),jP=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),Ur=class c_ extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(a){return a.message},r={_errors:[]},i=a=>{for(const o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(i);else if(o.code==="invalid_return_type")i(o.returnTypeError);else if(o.code==="invalid_arguments")i(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let u=r,p=0;for(;p<o.path.length;){const h=o.path[p];p===o.path.length-1?(u[h]=u[h]||{_errors:[]},u[h]._errors.push(n(o))):u[h]=u[h]||{_errors:[]},u=u[h],p++}}};return i(this),r}static assert(t){if(!(t instanceof c_))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,at.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const i of this.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(t(i))):r.push(t(i));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};Ur.create=e=>new Ur(e);var BP=(e,t)=>{let n;switch(e.code){case Te.invalid_type:e.received===Oe.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case Te.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,at.jsonStringifyReplacer)}`;break;case Te.unrecognized_keys:n=`Unrecognized key(s) in object: ${at.joinValues(e.keys,", ")}`;break;case Te.invalid_union:n="Invalid input";break;case Te.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${at.joinValues(e.options)}`;break;case Te.invalid_enum_value:n=`Invalid enum value. Expected ${at.joinValues(e.options)}, received '${e.received}'`;break;case Te.invalid_arguments:n="Invalid function arguments";break;case Te.invalid_return_type:n="Invalid function return type";break;case Te.invalid_date:n="Invalid date";break;case Te.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:at.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case Te.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case Te.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case Te.custom:n="Invalid input";break;case Te.invalid_intersection_types:n="Intersection results could not be merged";break;case Te.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Te.not_finite:n="Number must be finite";break;default:n=t.defaultError,at.assertNever(e)}return{message:n}},wa=BP,l_=wa;function UP(e){l_=e}function Zl(){return l_}W();var Jl=e=>{const{data:t,path:n,errorMaps:r,issueData:i}=e,a=[...n,...i.path||[]],o=de(ee({},i),{path:a});if(i.message!==void 0)return de(ee({},i),{path:a,message:i.message});let u="";const p=r.filter(h=>!!h).slice().reverse();for(const h of p)u=h(o,{data:t,defaultError:u}).message;return de(ee({},i),{path:a,message:u})},HP=[];function Fe(e,t){const n=Zl(),r=Jl({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===wa?void 0:wa].filter(i=>!!i)});e.common.issues.push(r)}var Qn=class u_{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const i of n){if(i.status==="aborted")return Ve;i.status==="dirty"&&t.dirty(),r.push(i.value)}return{status:t.value,value:r}}static mergeObjectAsync(t,n){return B(this,null,function*(){const r=[];for(const i of n){const a=yield i.key,o=yield i.value;r.push({key:a,value:o})}return u_.mergeObjectSync(t,r)})}static mergeObjectSync(t,n){const r={};for(const i of n){const{key:a,value:o}=i;if(a.status==="aborted"||o.status==="aborted")return Ve;a.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),a.value!=="__proto__"&&(typeof o.value<"u"||i.alwaysSet)&&(r[a.value]=o.value)}return{status:t.value,value:r}}},Ve=Object.freeze({status:"aborted"}),ra=e=>({status:"dirty",value:e}),Nn=e=>({status:"valid",value:e}),Gh=e=>e.status==="aborted",Zh=e=>e.status==="dirty",Is=e=>e.status==="valid",Lo=e=>typeof Promise<"u"&&e instanceof Promise;W();W();W();var Ue;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Ue||(Ue={}));var si=class{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},yg=(e,t)=>{if(Is(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Ur(e.common.issues);return this._error=n,this._error}}};function Ze(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:i}:{errorMap:(o,u)=>{var p,h;const{message:y}=e;return o.code==="invalid_enum_value"?{message:y??u.defaultError}:typeof u.data>"u"?{message:(p=y??r)!=null?p:u.defaultError}:o.code!=="invalid_type"?{message:u.defaultError}:{message:(h=y??n)!=null?h:u.defaultError}},description:i}}var Xe=class{get description(){return this._def.description}_getType(e){return di(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:di(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Qn,ctx:{common:e.parent.common,data:e.data,parsedType:di(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Lo(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:(n=t==null?void 0:t.async)!=null?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:di(e)},i=this._parseSync({data:e,path:r.path,parent:r});return yg(r,i)}"~validate"(e){var t,n;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:di(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:r});return Is(i)?{value:i.value}:{issues:r.common.issues}}catch(i){(n=(t=i==null?void 0:i.message)==null?void 0:t.toLowerCase())!=null&&n.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(i=>Is(i)?{value:i.value}:{issues:r.common.issues})}parseAsync(e,t){return B(this,null,function*(){const n=yield this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error})}safeParseAsync(e,t){return B(this,null,function*(){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:di(e)},r=this._parse({data:e,path:n.path,parent:n}),i=yield Lo(r)?r:Promise.resolve(r);return yg(n,i)})}refine(e,t){const n=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,i)=>{const a=e(r),o=()=>i.addIssue(ee({code:Te.custom},n(r)));return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,r)=>e(n)?!0:(r.addIssue(typeof t=="function"?t(n,r):t),!1))}_refinement(e){return new Vr({schema:this,typeName:qe.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return ii.create(this,this._def)}nullable(){return Xi.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Fs.create(this)}promise(){return Ea.create(this,this._def)}or(e){return zo.create([this,e],this._def)}and(e){return Ko.create(this,e,this._def)}transform(e){return new Vr(de(ee({},Ze(this._def)),{schema:this,typeName:qe.ZodEffects,effect:{type:"transform",transform:e}}))}default(e){const t=typeof e=="function"?e:()=>e;return new Zo(de(ee({},Ze(this._def)),{innerType:this,defaultValue:t,typeName:qe.ZodDefault}))}brand(){return new mf(ee({typeName:qe.ZodBranded,type:this},Ze(this._def)))}catch(e){const t=typeof e=="function"?e:()=>e;return new Jo(de(ee({},Ze(this._def)),{innerType:this,catchValue:t,typeName:qe.ZodCatch}))}describe(e){const t=this.constructor;return new t(de(ee({},this._def),{description:e}))}pipe(e){return gf.create(this,e)}readonly(){return Qo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},VP=/^c[^\s-]{8,}$/i,qP=/^[0-9a-z]+$/,zP=/^[0-9A-HJKMNP-TV-Z]{26}$/i,KP=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,$P=/^[a-z0-9_-]{21}$/i,WP=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,GP=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ZP=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,JP="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Od,QP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,XP=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,YP=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ek=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,tk=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nk=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",rk=new RegExp(`^${d_}$`);function h_(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function ik(e){return new RegExp(`^${h_(e)}$`)}function p_(e){let t=`${d_}T${h_(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function sk(e,t){return!!((t==="v4"||!t)&&QP.test(e)||(t==="v6"||!t)&&YP.test(e))}function ak(e,t){if(!WP.test(e))return!1;try{const[n]=e.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||t&&i.alg!==t)}catch{return!1}}function ok(e,t){return!!((t==="v4"||!t)&&XP.test(e)||(t==="v6"||!t)&&ek.test(e))}var xa=class oo extends Xe{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Oe.string){const a=this._getOrReturnCtx(t);return Fe(a,{code:Te.invalid_type,expected:Oe.string,received:a.parsedType}),Ve}const r=new Qn;let i;for(const a of this._def.checks)if(a.kind==="min")t.data.length<a.value&&(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")t.data.length>a.value&&(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const o=t.data.length>a.value,u=t.data.length<a.value;(o||u)&&(i=this._getOrReturnCtx(t,i),o?Fe(i,{code:Te.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):u&&Fe(i,{code:Te.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")ZP.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"email",code:Te.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Od||(Od=new RegExp(JP,"u")),Od.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"emoji",code:Te.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")KP.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"uuid",code:Te.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")$P.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"nanoid",code:Te.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")VP.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"cuid",code:Te.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")qP.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"cuid2",code:Te.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")zP.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"ulid",code:Te.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(t.data)}catch{i=this._getOrReturnCtx(t,i),Fe(i,{validation:"url",code:Te.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"regex",code:Te.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?t.data=t.data.trim():a.kind==="includes"?t.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?t.data=t.data.toLowerCase():a.kind==="toUpperCase"?t.data=t.data.toUpperCase():a.kind==="startsWith"?t.data.startsWith(a.value)||(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?t.data.endsWith(a.value)||(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?p_(a).test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?rk.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?ik(a).test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?GP.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"duration",code:Te.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?sk(t.data,a.version)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"ip",code:Te.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?ak(t.data,a.alg)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"jwt",code:Te.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?ok(t.data,a.version)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"cidr",code:Te.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?tk.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"base64",code:Te.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?nk.test(t.data)||(i=this._getOrReturnCtx(t,i),Fe(i,{validation:"base64url",code:Te.invalid_string,message:a.message}),r.dirty()):at.assertNever(a);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(i=>t.test(i),ee({validation:n,code:Te.invalid_string},Ue.errToObj(r)))}_addCheck(t){return new oo(de(ee({},this._def),{checks:[...this._def.checks,t]}))}email(t){return this._addCheck(ee({kind:"email"},Ue.errToObj(t)))}url(t){return this._addCheck(ee({kind:"url"},Ue.errToObj(t)))}emoji(t){return this._addCheck(ee({kind:"emoji"},Ue.errToObj(t)))}uuid(t){return this._addCheck(ee({kind:"uuid"},Ue.errToObj(t)))}nanoid(t){return this._addCheck(ee({kind:"nanoid"},Ue.errToObj(t)))}cuid(t){return this._addCheck(ee({kind:"cuid"},Ue.errToObj(t)))}cuid2(t){return this._addCheck(ee({kind:"cuid2"},Ue.errToObj(t)))}ulid(t){return this._addCheck(ee({kind:"ulid"},Ue.errToObj(t)))}base64(t){return this._addCheck(ee({kind:"base64"},Ue.errToObj(t)))}base64url(t){return this._addCheck(ee({kind:"base64url"},Ue.errToObj(t)))}jwt(t){return this._addCheck(ee({kind:"jwt"},Ue.errToObj(t)))}ip(t){return this._addCheck(ee({kind:"ip"},Ue.errToObj(t)))}cidr(t){return this._addCheck(ee({kind:"cidr"},Ue.errToObj(t)))}datetime(t){var n,r;return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck(ee({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(n=t==null?void 0:t.offset)!=null?n:!1,local:(r=t==null?void 0:t.local)!=null?r:!1},Ue.errToObj(t==null?void 0:t.message)))}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck(ee({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision},Ue.errToObj(t==null?void 0:t.message)))}duration(t){return this._addCheck(ee({kind:"duration"},Ue.errToObj(t)))}regex(t,n){return this._addCheck(ee({kind:"regex",regex:t},Ue.errToObj(n)))}includes(t,n){return this._addCheck(ee({kind:"includes",value:t,position:n==null?void 0:n.position},Ue.errToObj(n==null?void 0:n.message)))}startsWith(t,n){return this._addCheck(ee({kind:"startsWith",value:t},Ue.errToObj(n)))}endsWith(t,n){return this._addCheck(ee({kind:"endsWith",value:t},Ue.errToObj(n)))}min(t,n){return this._addCheck(ee({kind:"min",value:t},Ue.errToObj(n)))}max(t,n){return this._addCheck(ee({kind:"max",value:t},Ue.errToObj(n)))}length(t,n){return this._addCheck(ee({kind:"length",value:t},Ue.errToObj(n)))}nonempty(t){return this.min(1,Ue.errToObj(t))}trim(){return new oo(de(ee({},this._def),{checks:[...this._def.checks,{kind:"trim"}]}))}toLowerCase(){return new oo(de(ee({},this._def),{checks:[...this._def.checks,{kind:"toLowerCase"}]}))}toUpperCase(){return new oo(de(ee({},this._def),{checks:[...this._def.checks,{kind:"toUpperCase"}]}))}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};xa.create=e=>{var t;return new xa(ee({checks:[],typeName:qe.ZodString,coerce:(t=e==null?void 0:e.coerce)!=null?t:!1},Ze(e)))};function ck(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=n>r?n:r,a=Number.parseInt(e.toFixed(i).replace(".","")),o=Number.parseInt(t.toFixed(i).replace(".",""));return a%o/_i(10,i)}var jo=class Jh extends Xe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Oe.number){const a=this._getOrReturnCtx(t);return Fe(a,{code:Te.invalid_type,expected:Oe.number,received:a.parsedType}),Ve}let r;const i=new Qn;for(const a of this._def.checks)a.kind==="int"?at.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),Fe(r,{code:Te.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(r=this._getOrReturnCtx(t,r),Fe(r,{code:Te.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(r=this._getOrReturnCtx(t,r),Fe(r,{code:Te.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?ck(t.data,a.value)!==0&&(r=this._getOrReturnCtx(t,r),Fe(r,{code:Te.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),Fe(r,{code:Te.not_finite,message:a.message}),i.dirty()):at.assertNever(a);return{status:i.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,Ue.toString(n))}gt(t,n){return this.setLimit("min",t,!1,Ue.toString(n))}lte(t,n){return this.setLimit("max",t,!0,Ue.toString(n))}lt(t,n){return this.setLimit("max",t,!1,Ue.toString(n))}setLimit(t,n,r,i){return new Jh(de(ee({},this._def),{checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:Ue.toString(i)}]}))}_addCheck(t){return new Jh(de(ee({},this._def),{checks:[...this._def.checks,t]}))}int(t){return this._addCheck({kind:"int",message:Ue.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ue.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ue.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ue.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ue.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:Ue.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:Ue.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ue.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ue.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&at.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}};jo.create=e=>new jo(ee({checks:[],typeName:qe.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1},Ze(e)));var Bo=class Qh extends Xe{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Oe.bigint)return this._getInvalidInput(t);let r;const i=new Qn;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?t.data<a.value:t.data<=a.value)&&(r=this._getOrReturnCtx(t,r),Fe(r,{code:Te.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?t.data>a.value:t.data>=a.value)&&(r=this._getOrReturnCtx(t,r),Fe(r,{code:Te.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?t.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),Fe(r,{code:Te.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):at.assertNever(a);return{status:i.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return Fe(n,{code:Te.invalid_type,expected:Oe.bigint,received:n.parsedType}),Ve}gte(t,n){return this.setLimit("min",t,!0,Ue.toString(n))}gt(t,n){return this.setLimit("min",t,!1,Ue.toString(n))}lte(t,n){return this.setLimit("max",t,!0,Ue.toString(n))}lt(t,n){return this.setLimit("max",t,!1,Ue.toString(n))}setLimit(t,n,r,i){return new Qh(de(ee({},this._def),{checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:Ue.toString(i)}]}))}_addCheck(t){return new Qh(de(ee({},this._def),{checks:[...this._def.checks,t]}))}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ue.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ue.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ue.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ue.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:Ue.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}};Bo.create=e=>{var t;return new Bo(ee({checks:[],typeName:qe.ZodBigInt,coerce:(t=e==null?void 0:e.coerce)!=null?t:!1},Ze(e)))};var Uo=class extends Xe{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Oe.boolean){const n=this._getOrReturnCtx(e);return Fe(n,{code:Te.invalid_type,expected:Oe.boolean,received:n.parsedType}),Ve}return Nn(e.data)}};Uo.create=e=>new Uo(ee({typeName:qe.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1},Ze(e)));var Ho=class f_ extends Xe{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Oe.date){const a=this._getOrReturnCtx(t);return Fe(a,{code:Te.invalid_type,expected:Oe.date,received:a.parsedType}),Ve}if(Number.isNaN(t.data.getTime())){const a=this._getOrReturnCtx(t);return Fe(a,{code:Te.invalid_date}),Ve}const r=new Qn;let i;for(const a of this._def.checks)a.kind==="min"?t.data.getTime()<a.value&&(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?t.data.getTime()>a.value&&(i=this._getOrReturnCtx(t,i),Fe(i,{code:Te.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):at.assertNever(a);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new f_(de(ee({},this._def),{checks:[...this._def.checks,t]}))}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:Ue.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:Ue.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}};Ho.create=e=>new Ho(ee({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:qe.ZodDate},Ze(e)));var Ql=class extends Xe{_parse(e){if(this._getType(e)!==Oe.symbol){const n=this._getOrReturnCtx(e);return Fe(n,{code:Te.invalid_type,expected:Oe.symbol,received:n.parsedType}),Ve}return Nn(e.data)}};Ql.create=e=>new Ql(ee({typeName:qe.ZodSymbol},Ze(e)));var Vo=class extends Xe{_parse(e){if(this._getType(e)!==Oe.undefined){const n=this._getOrReturnCtx(e);return Fe(n,{code:Te.invalid_type,expected:Oe.undefined,received:n.parsedType}),Ve}return Nn(e.data)}};Vo.create=e=>new Vo(ee({typeName:qe.ZodUndefined},Ze(e)));var qo=class extends Xe{_parse(e){if(this._getType(e)!==Oe.null){const n=this._getOrReturnCtx(e);return Fe(n,{code:Te.invalid_type,expected:Oe.null,received:n.parsedType}),Ve}return Nn(e.data)}};qo.create=e=>new qo(ee({typeName:qe.ZodNull},Ze(e)));var Ca=class extends Xe{constructor(){super(...arguments),this._any=!0}_parse(e){return Nn(e.data)}};Ca.create=e=>new Ca(ee({typeName:qe.ZodAny},Ze(e)));var xs=class extends Xe{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Nn(e.data)}};xs.create=e=>new xs(ee({typeName:qe.ZodUnknown},Ze(e)));var bi=class extends Xe{_parse(e){const t=this._getOrReturnCtx(e);return Fe(t,{code:Te.invalid_type,expected:Oe.never,received:t.parsedType}),Ve}};bi.create=e=>new bi(ee({typeName:qe.ZodNever},Ze(e)));var Xl=class extends Xe{_parse(e){if(this._getType(e)!==Oe.undefined){const n=this._getOrReturnCtx(e);return Fe(n,{code:Te.invalid_type,expected:Oe.void,received:n.parsedType}),Ve}return Nn(e.data)}};Xl.create=e=>new Xl(ee({typeName:qe.ZodVoid},Ze(e)));var Fs=class gl extends Xe{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),i=this._def;if(n.parsedType!==Oe.array)return Fe(n,{code:Te.invalid_type,expected:Oe.array,received:n.parsedType}),Ve;if(i.exactLength!==null){const o=n.data.length>i.exactLength.value,u=n.data.length<i.exactLength.value;(o||u)&&(Fe(n,{code:o?Te.too_big:Te.too_small,minimum:u?i.exactLength.value:void 0,maximum:o?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(Fe(n,{code:Te.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(Fe(n,{code:Te.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,u)=>i.type._parseAsync(new si(n,o,n.path,u)))).then(o=>Qn.mergeArray(r,o));const a=[...n.data].map((o,u)=>i.type._parseSync(new si(n,o,n.path,u)));return Qn.mergeArray(r,a)}get element(){return this._def.type}min(t,n){return new gl(de(ee({},this._def),{minLength:{value:t,message:Ue.toString(n)}}))}max(t,n){return new gl(de(ee({},this._def),{maxLength:{value:t,message:Ue.toString(n)}}))}length(t,n){return new gl(de(ee({},this._def),{exactLength:{value:t,message:Ue.toString(n)}}))}nonempty(t){return this.min(1,t)}};Fs.create=(e,t)=>new Fs(ee({type:e,minLength:null,maxLength:null,exactLength:null,typeName:qe.ZodArray},Ze(t)));function zs(e){if(e instanceof wr){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=ii.create(zs(r))}return new wr(de(ee({},e._def),{shape:()=>t}))}else return e instanceof Fs?new Fs(de(ee({},e._def),{type:zs(e.element)})):e instanceof ii?ii.create(zs(e.unwrap())):e instanceof Xi?Xi.create(zs(e.unwrap())):e instanceof Qi?Qi.create(e.items.map(t=>zs(t))):e}var wr=class Ir extends Xe{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=at.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==Oe.object){const h=this._getOrReturnCtx(t);return Fe(h,{code:Te.invalid_type,expected:Oe.object,received:h.parsedType}),Ve}const{status:r,ctx:i}=this._processInputParams(t),{shape:a,keys:o}=this._getCached(),u=[];if(!(this._def.catchall instanceof bi&&this._def.unknownKeys==="strip"))for(const h in i.data)o.includes(h)||u.push(h);const p=[];for(const h of o){const y=a[h],f=i.data[h];p.push({key:{status:"valid",value:h},value:y._parse(new si(i,f,i.path,h)),alwaysSet:h in i.data})}if(this._def.catchall instanceof bi){const h=this._def.unknownKeys;if(h==="passthrough")for(const y of u)p.push({key:{status:"valid",value:y},value:{status:"valid",value:i.data[y]}});else if(h==="strict")u.length>0&&(Fe(i,{code:Te.unrecognized_keys,keys:u}),r.dirty());else if(h!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const h=this._def.catchall;for(const y of u){const f=i.data[y];p.push({key:{status:"valid",value:y},value:h._parse(new si(i,f,i.path,y)),alwaysSet:y in i.data})}}return i.common.async?Promise.resolve().then(()=>B(this,null,function*(){const h=[];for(const y of p){const f=yield y.key,_=yield y.value;h.push({key:f,value:_,alwaysSet:y.alwaysSet})}return h})).then(h=>Qn.mergeObjectSync(r,h)):Qn.mergeObjectSync(r,p)}get shape(){return this._def.shape()}strict(t){return Ue.errToObj,new Ir(ee(de(ee({},this._def),{unknownKeys:"strict"}),t!==void 0?{errorMap:(n,r)=>{var i,a,o,u;const p=(o=(a=(i=this._def).errorMap)==null?void 0:a.call(i,n,r).message)!=null?o:r.defaultError;return n.code==="unrecognized_keys"?{message:(u=Ue.errToObj(t).message)!=null?u:p}:{message:p}}}:{}))}strip(){return new Ir(de(ee({},this._def),{unknownKeys:"strip"}))}passthrough(){return new Ir(de(ee({},this._def),{unknownKeys:"passthrough"}))}extend(t){return new Ir(de(ee({},this._def),{shape:()=>ee(ee({},this._def.shape()),t)}))}merge(t){return new Ir({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>ee(ee({},this._def.shape()),t._def.shape()),typeName:qe.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new Ir(de(ee({},this._def),{catchall:t}))}pick(t){const n={};for(const r of at.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new Ir(de(ee({},this._def),{shape:()=>n}))}omit(t){const n={};for(const r of at.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new Ir(de(ee({},this._def),{shape:()=>n}))}deepPartial(){return zs(this)}partial(t){const n={};for(const r of at.objectKeys(this.shape)){const i=this.shape[r];t&&!t[r]?n[r]=i:n[r]=i.optional()}return new Ir(de(ee({},this._def),{shape:()=>n}))}required(t){const n={};for(const r of at.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof ii;)a=a._def.innerType;n[r]=a}return new Ir(de(ee({},this._def),{shape:()=>n}))}keyof(){return b_(at.objectKeys(this.shape))}};wr.create=(e,t)=>new wr(ee({shape:()=>e,unknownKeys:"strip",catchall:bi.create(),typeName:qe.ZodObject},Ze(t)));wr.strictCreate=(e,t)=>new wr(ee({shape:()=>e,unknownKeys:"strict",catchall:bi.create(),typeName:qe.ZodObject},Ze(t)));wr.lazycreate=(e,t)=>new wr(ee({shape:e,unknownKeys:"strip",catchall:bi.create(),typeName:qe.ZodObject},Ze(t)));var zo=class extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function r(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Ur(o.ctx.common.issues));return Fe(t,{code:Te.invalid_union,unionErrors:a}),Ve}if(t.common.async)return Promise.all(n.map(i=>B(this,null,function*(){const a=de(ee({},t),{common:de(ee({},t.common),{issues:[]}),parent:null});return{result:yield i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}}))).then(r);{let i;const a=[];for(const u of n){const p=de(ee({},t),{common:de(ee({},t.common),{issues:[]}),parent:null}),h=u._parseSync({data:t.data,path:t.path,parent:p});if(h.status==="valid")return h;h.status==="dirty"&&!i&&(i={result:h,ctx:p}),p.common.issues.length&&a.push(p.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(u=>new Ur(u));return Fe(t,{code:Te.invalid_union,unionErrors:o}),Ve}}get options(){return this._def.options}};zo.create=(e,t)=>new zo(ee({options:e,typeName:qe.ZodUnion},Ze(t)));var ci=e=>e instanceof $o?ci(e.schema):e instanceof Vr?ci(e.innerType()):e instanceof Wo?[e.value]:e instanceof lc?e.options:e instanceof Go?at.objectValues(e.enum):e instanceof Zo?ci(e._def.innerType):e instanceof Vo?[void 0]:e instanceof qo?[null]:e instanceof ii?[void 0,...ci(e.unwrap())]:e instanceof Xi?[null,...ci(e.unwrap())]:e instanceof mf||e instanceof Qo?ci(e.unwrap()):e instanceof Jo?ci(e._def.innerType):[],m_=class g_ extends Xe{_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==Oe.object)return Fe(n,{code:Te.invalid_type,expected:Oe.object,received:n.parsedType}),Ve;const r=this.discriminator,i=n.data[r],a=this.optionsMap.get(i);return a?n.common.async?a._parseAsync({data:n.data,path:n.path,parent:n}):a._parseSync({data:n.data,path:n.path,parent:n}):(Fe(n,{code:Te.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Ve)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(t,n,r){const i=new Map;for(const a of n){const o=ci(a.shape[t]);if(!o.length)throw new Error(`A discriminator value for key \`${t}\` could not be extracted from all schema options`);for(const u of o){if(i.has(u))throw new Error(`Discriminator property ${String(t)} has duplicate value ${String(u)}`);i.set(u,a)}}return new g_(ee({typeName:qe.ZodDiscriminatedUnion,discriminator:t,options:n,optionsMap:i},Ze(r)))}};function Xh(e,t){const n=di(e),r=di(t);if(e===t)return{valid:!0,data:e};if(n===Oe.object&&r===Oe.object){const i=at.objectKeys(t),a=at.objectKeys(e).filter(u=>i.indexOf(u)!==-1),o=ee(ee({},e),t);for(const u of a){const p=Xh(e[u],t[u]);if(!p.valid)return{valid:!1};o[u]=p.data}return{valid:!0,data:o}}else if(n===Oe.array&&r===Oe.array){if(e.length!==t.length)return{valid:!1};const i=[];for(let a=0;a<e.length;a++){const o=e[a],u=t[a],p=Xh(o,u);if(!p.valid)return{valid:!1};i.push(p.data)}return{valid:!0,data:i}}else return n===Oe.date&&r===Oe.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}var Ko=class extends Xe{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(i,a)=>{if(Gh(i)||Gh(a))return Ve;const o=Xh(i.value,a.value);return o.valid?((Zh(i)||Zh(a))&&t.dirty(),{status:t.value,value:o.data}):(Fe(n,{code:Te.invalid_intersection_types}),Ve)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>r(i,a)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};Ko.create=(e,t,n)=>new Ko(ee({left:e,right:t,typeName:qe.ZodIntersection},Ze(n)));var Qi=class v_ extends Xe{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Oe.array)return Fe(r,{code:Te.invalid_type,expected:Oe.array,received:r.parsedType}),Ve;if(r.data.length<this._def.items.length)return Fe(r,{code:Te.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ve;!this._def.rest&&r.data.length>this._def.items.length&&(Fe(r,{code:Te.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...r.data].map((o,u)=>{const p=this._def.items[u]||this._def.rest;return p?p._parse(new si(r,o,r.path,u)):null}).filter(o=>!!o);return r.common.async?Promise.all(a).then(o=>Qn.mergeArray(n,o)):Qn.mergeArray(n,a)}get items(){return this._def.items}rest(t){return new v_(de(ee({},this._def),{rest:t}))}};Qi.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Qi(ee({items:e,typeName:qe.ZodTuple,rest:null},Ze(t)))};var y_=class Yh extends Xe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Oe.object)return Fe(r,{code:Te.invalid_type,expected:Oe.object,received:r.parsedType}),Ve;const i=[],a=this._def.keyType,o=this._def.valueType;for(const u in r.data)i.push({key:a._parse(new si(r,u,r.path,u)),value:o._parse(new si(r,r.data[u],r.path,u)),alwaysSet:u in r.data});return r.common.async?Qn.mergeObjectAsync(n,i):Qn.mergeObjectSync(n,i)}get element(){return this._def.valueType}static create(t,n,r){return n instanceof Xe?new Yh(ee({keyType:t,valueType:n,typeName:qe.ZodRecord},Ze(r))):new Yh(ee({keyType:xa.create(),valueType:t,typeName:qe.ZodRecord},Ze(n)))}},Yl=class extends Xe{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Oe.map)return Fe(n,{code:Te.invalid_type,expected:Oe.map,received:n.parsedType}),Ve;const r=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,u],p)=>({key:r._parse(new si(n,o,n.path,[p,"key"])),value:i._parse(new si(n,u,n.path,[p,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(()=>B(this,null,function*(){for(const u of a){const p=yield u.key,h=yield u.value;if(p.status==="aborted"||h.status==="aborted")return Ve;(p.status==="dirty"||h.status==="dirty")&&t.dirty(),o.set(p.value,h.value)}return{status:t.value,value:o}}))}else{const o=new Map;for(const u of a){const p=u.key,h=u.value;if(p.status==="aborted"||h.status==="aborted")return Ve;(p.status==="dirty"||h.status==="dirty")&&t.dirty(),o.set(p.value,h.value)}return{status:t.value,value:o}}}};Yl.create=(e,t,n)=>new Yl(ee({valueType:t,keyType:e,typeName:qe.ZodMap},Ze(n)));var eu=class ep extends Xe{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Oe.set)return Fe(r,{code:Te.invalid_type,expected:Oe.set,received:r.parsedType}),Ve;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(Fe(r,{code:Te.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(Fe(r,{code:Te.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const a=this._def.valueType;function o(p){const h=new Set;for(const y of p){if(y.status==="aborted")return Ve;y.status==="dirty"&&n.dirty(),h.add(y.value)}return{status:n.value,value:h}}const u=[...r.data.values()].map((p,h)=>a._parse(new si(r,p,r.path,h)));return r.common.async?Promise.all(u).then(p=>o(p)):o(u)}min(t,n){return new ep(de(ee({},this._def),{minSize:{value:t,message:Ue.toString(n)}}))}max(t,n){return new ep(de(ee({},this._def),{maxSize:{value:t,message:Ue.toString(n)}}))}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}};eu.create=(e,t)=>new eu(ee({valueType:e,minSize:null,maxSize:null,typeName:qe.ZodSet},Ze(t)));var __=class vl extends Xe{constructor(){super(...arguments),this.validate=this.implement}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==Oe.function)return Fe(n,{code:Te.invalid_type,expected:Oe.function,received:n.parsedType}),Ve;function r(u,p){return Jl({data:u,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Zl(),wa].filter(h=>!!h),issueData:{code:Te.invalid_arguments,argumentsError:p}})}function i(u,p){return Jl({data:u,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,Zl(),wa].filter(h=>!!h),issueData:{code:Te.invalid_return_type,returnTypeError:p}})}const a={errorMap:n.common.contextualErrorMap},o=n.data;if(this._def.returns instanceof Ea){const u=this;return Nn(function(...p){return B(this,null,function*(){const h=new Ur([]),y=yield u._def.args.parseAsync(p,a).catch(w=>{throw h.addIssue(r(p,w)),h}),f=yield Reflect.apply(o,this,y);return yield u._def.returns._def.type.parseAsync(f,a).catch(w=>{throw h.addIssue(i(f,w)),h})})})}else{const u=this;return Nn(function(...p){const h=u._def.args.safeParse(p,a);if(!h.success)throw new Ur([r(p,h.error)]);const y=Reflect.apply(o,this,h.data),f=u._def.returns.safeParse(y,a);if(!f.success)throw new Ur([i(y,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...t){return new vl(de(ee({},this._def),{args:Qi.create(t).rest(xs.create())}))}returns(t){return new vl(de(ee({},this._def),{returns:t}))}implement(t){return this.parse(t)}strictImplement(t){return this.parse(t)}static create(t,n,r){return new vl(ee({args:t||Qi.create([]).rest(xs.create()),returns:n||xs.create(),typeName:qe.ZodFunction},Ze(r)))}},$o=class extends Xe{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};$o.create=(e,t)=>new $o(ee({getter:e,typeName:qe.ZodLazy},Ze(t)));var Wo=class extends Xe{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Fe(t,{received:t.data,code:Te.invalid_literal,expected:this._def.value}),Ve}return{status:"valid",value:e.data}}get value(){return this._def.value}};Wo.create=(e,t)=>new Wo(ee({value:e,typeName:qe.ZodLiteral},Ze(t)));function b_(e,t){return new lc(ee({values:e,typeName:qe.ZodEnum},Ze(t)))}var lc=class tp extends Xe{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return Fe(n,{expected:at.joinValues(r),received:n.parsedType,code:Te.invalid_type}),Ve}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return Fe(n,{received:n.data,code:Te.invalid_enum_value,options:r}),Ve}return Nn(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return tp.create(t,ee(ee({},this._def),n))}exclude(t,n=this._def){return tp.create(this.options.filter(r=>!t.includes(r)),ee(ee({},this._def),n))}};lc.create=b_;var Go=class extends Xe{_parse(e){const t=at.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Oe.string&&n.parsedType!==Oe.number){const r=at.objectValues(t);return Fe(n,{expected:at.joinValues(r),received:n.parsedType,code:Te.invalid_type}),Ve}if(this._cache||(this._cache=new Set(at.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const r=at.objectValues(t);return Fe(n,{received:n.data,code:Te.invalid_enum_value,options:r}),Ve}return Nn(e.data)}get enum(){return this._def.values}};Go.create=(e,t)=>new Go(ee({values:e,typeName:qe.ZodNativeEnum},Ze(t)));var Ea=class extends Xe{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Oe.promise&&t.common.async===!1)return Fe(t,{code:Te.invalid_type,expected:Oe.promise,received:t.parsedType}),Ve;const n=t.parsedType===Oe.promise?t.data:Promise.resolve(t.data);return Nn(n.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Ea.create=(e,t)=>new Ea(ee({type:e,typeName:qe.ZodPromise},Ze(t)));var Vr=class extends Xe{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===qe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:a=>{Fe(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),r.type==="preprocess"){const a=r.transform(n.data,i);if(n.common.async)return Promise.resolve(a).then(o=>B(this,null,function*(){if(t.value==="aborted")return Ve;const u=yield this._def.schema._parseAsync({data:o,path:n.path,parent:n});return u.status==="aborted"?Ve:u.status==="dirty"||t.value==="dirty"?ra(u.value):u}));{if(t.value==="aborted")return Ve;const o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?Ve:o.status==="dirty"||t.value==="dirty"?ra(o.value):o}}if(r.type==="refinement"){const a=o=>{const u=r.refinement(o,i);if(n.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?Ve:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?Ve:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(r.type==="transform")if(n.common.async===!1){const a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Is(a))return Ve;const o=r.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>Is(a)?Promise.resolve(r.transform(a.value,i)).then(o=>({status:t.value,value:o})):Ve);at.assertNever(r)}};Vr.create=(e,t,n)=>new Vr(ee({schema:e,typeName:qe.ZodEffects,effect:t},Ze(n)));Vr.createWithPreprocess=(e,t,n)=>new Vr(ee({schema:t,effect:{type:"preprocess",transform:e},typeName:qe.ZodEffects},Ze(n)));var ii=class extends Xe{_parse(e){return this._getType(e)===Oe.undefined?Nn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ii.create=(e,t)=>new ii(ee({innerType:e,typeName:qe.ZodOptional},Ze(t)));var Xi=class extends Xe{_parse(e){return this._getType(e)===Oe.null?Nn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Xi.create=(e,t)=>new Xi(ee({innerType:e,typeName:qe.ZodNullable},Ze(t)));var Zo=class extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Oe.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Zo.create=(e,t)=>new Zo(ee({innerType:e,typeName:qe.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default},Ze(t)));var Jo=class extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e),n=de(ee({},t),{common:de(ee({},t.common),{issues:[]})}),r=this._def.innerType._parse({data:n.data,path:n.path,parent:ee({},n)});return Lo(r)?r.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ur(n.common.issues)},input:n.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Ur(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};Jo.create=(e,t)=>new Jo(ee({innerType:e,typeName:qe.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch},Ze(t)));var tu=class extends Xe{_parse(e){if(this._getType(e)!==Oe.nan){const n=this._getOrReturnCtx(e);return Fe(n,{code:Te.invalid_type,expected:Oe.nan,received:n.parsedType}),Ve}return{status:"valid",value:e.data}}};tu.create=e=>new tu(ee({typeName:qe.ZodNaN},Ze(e)));var lk=Symbol("zod_brand"),mf=class extends Xe{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},gf=class S_ extends Xe{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return B(this,null,function*(){const a=yield this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?Ve:a.status==="dirty"?(n.dirty(),ra(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})});{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Ve:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(t,n){return new S_({in:t,out:n,typeName:qe.ZodPipeline})}},Qo=class extends Xe{_parse(e){const t=this._def.innerType._parse(e),n=r=>(Is(r)&&(r.value=Object.freeze(r.value)),r);return Lo(t)?t.then(r=>n(r)):n(t)}unwrap(){return this._def.innerType}};Qo.create=(e,t)=>new Qo(ee({innerType:e,typeName:qe.ZodReadonly},Ze(t)));function _g(e,t){const n=typeof e=="function"?e(t):typeof e=="string"?{message:e}:e;return typeof n=="string"?{message:n}:n}function w_(e,t={},n){return e?Ca.create().superRefine((r,i)=>{var a,o;const u=e(r);if(u instanceof Promise)return u.then(p=>{var h,y;if(!p){const f=_g(t,r),_=(y=(h=f.fatal)!=null?h:n)!=null?y:!0;i.addIssue(de(ee({code:"custom"},f),{fatal:_}))}});if(!u){const p=_g(t,r),h=(o=(a=p.fatal)!=null?a:n)!=null?o:!0;i.addIssue(de(ee({code:"custom"},p),{fatal:h}))}}):Ca.create()}var uk={object:wr.lazycreate},qe;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(qe||(qe={}));var dk=(e,t={message:`Input not instance of ${e.name}`})=>w_(n=>n instanceof e,t),x_=xa.create,C_=jo.create,hk=tu.create,pk=Bo.create,E_=Uo.create,fk=Ho.create,mk=Ql.create,gk=Vo.create,vk=qo.create,yk=Ca.create,_k=xs.create,bk=bi.create,Sk=Xl.create,wk=Fs.create,xk=wr.create,Ck=wr.strictCreate,Ek=zo.create,Pk=m_.create,kk=Ko.create,Tk=Qi.create,Rk=y_.create,Ak=Yl.create,Ik=eu.create,Fk=__.create,Dk=$o.create,Nk=Wo.create,Ok=lc.create,Mk=Go.create,Lk=Ea.create,bg=Vr.create,jk=ii.create,Bk=Xi.create,Uk=Vr.createWithPreprocess,Hk=gf.create,Vk=()=>x_().optional(),qk=()=>C_().optional(),zk=()=>E_().optional(),Kk={string:e=>xa.create(de(ee({},e),{coerce:!0})),number:e=>jo.create(de(ee({},e),{coerce:!0})),boolean:e=>Uo.create(de(ee({},e),{coerce:!0})),bigint:e=>Bo.create(de(ee({},e),{coerce:!0})),date:e=>Ho.create(de(ee({},e),{coerce:!0}))},$k=Ve,Qa=new De("packages/token/src/encoder.ts"),Xo=class P_{constructor(t){let n;try{n=y4.parse(t)}catch(r){throw r instanceof Ie.ZodError?new Kn({path:Qa.prefix,info:Xa.invalidParameter,error:new Error("Received invalid token. Please check your SkyWayAuthToken.")}):new Kn({path:Qa.prefix,info:Xa.invalidParameter,error:new Error("Received invalid token. Please check your SkyWayAuthToken.")})}Object.assign(this,n)}static Decode(t){try{const n=LP(t),r=new P_(n);return r.tokenString=t,r}catch(n){throw new Kn({path:Qa.prefix,info:Xa.invalidParameter,error:n})}}encode(t){const n={jti:this.jti,iat:this.iat,exp:this.exp,scope:this.scope,version:this.version};return this.tokenString=NP.default.KJUR.jws.JWS.sign("HS256",JSON.stringify({alg:"HS256",typ:"JWT"}),JSON.stringify(n),t),this.tokenString}toJSON(){return{jti:this.jti,iat:this.iat,exp:this.exp,scope:this.scope,encoded:this.tokenString,version:this.version}}getAppId(){switch(this.version){case void 0:case 1:case 2:return this.scope.app.id;case 3:return this.scope.appId;default:throw new Kn({path:Qa.prefix,info:Xa.invalidParameter,error:new Error(`invalid token version: version ${this.version} is not supported.`)})}}getAnalyticsEnabled(){var t,n,r;switch(this.version){case void 0:case 1:case 2:return(t=this.scope.app.analytics)!=null?t:!1;case 3:return(r=(n=this.scope.analytics)==null?void 0:n.enabled)!=null?r:!0;default:throw new Kn({path:Qa.prefix,info:Xa.invalidParameter,error:new Error(`invalid token version: version ${this.version} is not supported.`)})}}};W();var Wk=["create","write","delete"],Gk=Ie.object({actions:Ie.array(Ie.enum(Wk).refine(e=>typeof e=="string"))}).passthrough(),Zk=["create","write","delete"],Jk=Ie.object({actions:Ie.array(Ie.enum(Zk).refine(e=>typeof e=="string")),forwardings:Ie.array(Gk)}).passthrough();W();var Qk=["write","create","delete","updateMetadata","enable","disable"],Xk=Ie.object({actions:Ie.array(Ie.enum(Qk).refine(e=>typeof e=="string"))}).passthrough(),Yk=["write","create","delete"],e4=Ie.object({actions:Ie.array(Ie.enum(Yk).refine(e=>typeof e=="string"))}).passthrough(),t4=["write","create","delete","updateMetadata","signal"],n4=Ie.object({id:Ie.string().optional(),name:Ie.string().optional()}).refine(e=>e.id!==void 0||e.name!==void 0,{message:"Either id or name is required."}),r4=Ie.intersection(n4,Ie.object({actions:Ie.array(Ie.enum(t4).refine(e=>typeof e=="string")),publication:Xk.optional(),subscription:e4.optional()}).passthrough()),i4=["write","read","create","delete","updateMetadata"],s4=Ie.object({id:Ie.string().optional(),name:Ie.string().optional()}).refine(e=>e.id!==void 0||e.name!==void 0,{message:"Either id or name is required."}),a4=Ie.intersection(s4,Ie.object({actions:Ie.array(Ie.enum(i4).refine(e=>typeof e=="string")),members:Ie.array(r4),sfuBots:Ie.array(Jk).optional()}).passthrough()),o4=["listChannels","read","write"],c4=Ie.object({id:Ie.string(),analytics:Ie.boolean().optional(),actions:Ie.array(Ie.enum(o4).refine(e=>typeof e=="string")).optional(),channels:Ie.array(a4).optional(),turn:Ie.boolean().optional()}).passthrough();W();var l4=["publish","subscribe","updateMetadata"],u4=Ie.object({id:Ie.string().optional(),name:Ie.string().optional()}).refine(e=>e.id!==void 0||e.name!==void 0,{message:"Either id or name is required."}),d4=Ie.intersection(u4,Ie.object({methods:Ie.array(Ie.enum(l4).refine(e=>typeof e=="string"))}).passthrough()),h4=["create","close","updateMetadata"],p4=Ie.object({id:Ie.string().optional(),name:Ie.string().optional()}).refine(e=>e.id!==void 0||e.name!==void 0,{message:"Either id or name is required."}),f4=Ie.intersection(p4,Ie.object({methods:Ie.array(Ie.enum(h4).refine(e=>typeof e=="string")),member:d4.optional(),sfu:Ie.object({enabled:Ie.boolean().optional(),maxSubscribersLimit:Ie.number().optional()}).optional()}).passthrough()),m4=Ie.object({appId:Ie.string(),analytics:Ie.object({enabled:Ie.boolean().optional()}).optional(),noiseCancelling:Ie.object({enabled:Ie.boolean().optional()}).optional(),turn:Ie.object({enabled:Ie.boolean().optional()}).optional(),rooms:Ie.array(f4)}).passthrough();W();var k_=Ie.object({jti:Ie.string().uuid(),iat:Ie.number().nonnegative(),exp:Ie.number().nonnegative()}),g4=Ie.intersection(k_,Ie.object({scope:Ie.object({app:c4}),version:Ie.union([Ie.literal(1),Ie.literal(2),Ie.literal(void 0)]).optional()})),v4=Ie.intersection(k_,Ie.object({scope:m4,version:Ie.literal(3)})),y4=Ie.union([g4,v4]);W();var Xa={invalidParameter:{name:"invalidParameter",detail:"failed to decode token",solution:"Use the correct token according to the specification"}};W();var Sg=()=>Math.floor(Date.now()/1e3),Da=$r,T_=class{constructor(e){this.contentType=e,this.side="local",this.onConnectionStateChanged=new Me,this._onConnectionStateChanged=new Me,this.id=Da(),this._label="",this.published=!1,this._getTransportCallbacks={},this._getStatsCallbacks={},this._connectionState={},this._onConnectionStateChanged.pipe(this.onConnectionStateChanged)}_setLabel(e){this._label=e}_unpublished(){this.published=!1,this._getTransportCallbacks={},this._getStatsCallbacks={}}_getTransport(e){var t,n;const r=typeof e=="string"?e:e.id;return(n=(t=this._getTransportCallbacks)[r])==null?void 0:n.call(t)}_setConnectionState(e,t){this._connectionState[e.id]!==t&&(this._connectionState[e.id]=t,this._onConnectionStateChanged.emit({remoteMember:e,state:t}))}getStats(e){return this._getStats(e)}_getStats(e){var t,n,r;const i=typeof e=="string"?e:e.id;return(r=(n=(t=this._getStatsCallbacks)[i])==null?void 0:n.call(t))!=null?r:[]}_getStatsAll(){return Promise.all(Object.entries(this._getStatsCallbacks).map(e=>B(this,[e],function*([t,n]){return{memberId:t,stats:yield n().catch(()=>[])}})))}getRTCPeerConnection(e){return this._getRTCPeerConnection(e)}_getRTCPeerConnection(e){var t;return(t=this._getTransport(e))==null?void 0:t.rtcPeerConnection}getConnectionState(e){return this._getConnectionState(e)}_getConnectionState(e){var t;const n=typeof e=="string"?e:e.id;return(t=this._connectionState[n])!=null?t:"new"}_getConnectionStateAll(){return Object.keys(this._getTransportCallbacks).map(e=>({memberId:e,connectionState:this._getConnectionState(e)}))}toJSON(){return{label:this._label,contentType:this.contentType,id:this.id,side:this.side}}},_4=new De("packages/core/src/media/stream/local/media.ts"),vf=class extends T_{constructor(e,t,n={}){super(t),this.onTrackUpdated=new Me,this.onDestroyed=new Me,this._disposer=new lr,this._trackConstraints={},this._replacingTrack=!1,this._onReplacingTrackDone=new Me,this._onEnableChanged=new Me,this._track=e,this._listenTrackEvent(),this._options=n,this._trackConstraints=ee({},n)}get trackConstraints(){return this._trackConstraints}toJSON(){const e=super.toJSON();return de(ee({},e),{trackConstraints:this.trackConstraints,isEnabled:this.isEnabled,_options:this._options})}get track(){return this._track}attach(e){this._element=e,a_(e,this._track)}detach(){this._element&&(o_(this._element,this._track),this._element=void 0)}_disable(e){this._options.stopTrackWhenDisabled?(this._trackConstraints=ee(ee({},this.trackConstraints),this.track.getConstraints()),this.track.stop()):this._oldTrack=this.track;const t=e==="video"?A_:b4;t.enabled=!1,this._onEnableChanged.emit(t),this._updateTrack(t)}_updateTrack(e){this._track=e,this._element&&this.attach(this._element),this.onTrackUpdated.emit(e),this._listenTrackEvent()}_listenTrackEvent(){const e=()=>{_4.info("onDestroyed",this.toJSON()),this.onDestroyed.emit()};this._track.addEventListener("ended",e),this._disposer.push(()=>this._track.removeEventListener("ended",e))}release(){this._disposer.dispose(),this._track.stop()}},R_=new RTCPeerConnection,b4=R_.addTransceiver("audio").receiver.track,A_=R_.addTransceiver("video").receiver.track,Md=new De("packages/core/src/media/stream/local/audio.ts"),Ld=class extends vf{constructor(e,t={}){if(super(e,"audio",t),this.contentType="audio",this._isEnabled=!0,this._promiseQueue=new is,e.kind!=="audio")throw we({operationName:"LocalAudioStream.constructor",path:Md.prefix,info:Ae.invalidTrackKind,payload:{track:e}})}setEnabled(e){return B(this,null,function*(){yield this._promiseQueue.push(()=>B(this,null,function*(){if(this._isEnabled===!0&&e===!1)this._isEnabled=e,this._disable("audio"),Md.debug("stopped");else if(this._isEnabled===!1&&e===!0){if(this._isEnabled=e,this._options.stopTrackWhenDisabled){const t=this._options.isDisplayMedia===!0?yield this.enableDisplay():yield this.enableMic();this._updateTrack(t),this._onEnableChanged.emit(t)}else this._oldTrack&&(this._updateTrack(this._oldTrack),this._onEnableChanged.emit(this._oldTrack));Md.debug("resumed")}}))})}get isEnabled(){return this._isEnabled}enableMic(){return B(this,null,function*(){const[e]=(yield navigator.mediaDevices.getUserMedia({audio:this.trackConstraints})).getAudioTracks();return e})}enableDisplay(){return B(this,null,function*(){const[e]=(yield navigator.mediaDevices.getDisplayMedia({audio:this.trackConstraints})).getAudioTracks();return e})}};W();var S4=new De("packages/core/src/media/stream/local/customVideo.ts"),w4=class extends vf{constructor(e={}){super(A_,"video",e),this.contentType="video",this._isEnabled=!0,this._promiseQueue=new is,this._stream=null}setStream(e){return B(this,null,function*(){if(this._stream)throw new Error("ProcessedStream is already exists");this._stream=e,this._updateTrack(e.track)})}setEnabled(e){return B(this,null,function*(){yield this._promiseQueue.push(()=>B(this,null,function*(){var t;yield(t=this._stream)==null?void 0:t.setEnabled(e)}))})}updateTrack(e){return B(this,null,function*(){this._updateTrack(e),this._onEnableChanged.emit(e)})}get isEnabled(){return this._isEnabled}release(){var e;(e=this._stream)==null||e.dispose().catch(()=>{S4.error("release failed")})}};W();var zc=new De("packages/core/src/media/stream/local/video.ts"),jd=class extends vf{constructor(e,t={}){if(super(e,"video",t),this.contentType="video",this._isEnabled=!0,this._promiseQueue=new is,e.kind!=="video")throw we({operationName:"LocalVideoStream.constructor",path:zc.prefix,info:Ae.invalidTrackKind,payload:{track:e}});zc.debug("LocalVideoStream spawned",this.toJSON())}setEnabled(e){return B(this,null,function*(){yield this._promiseQueue.push(()=>B(this,null,function*(){if(this._isEnabled===!0&&e===!1)this._isEnabled=e,this._disable("video"),zc.debug("stopped",this.toJSON());else if(this._isEnabled===!1&&e===!0){if(this._isEnabled=e,this._options.stopTrackWhenDisabled){const t=this._options.isDisplayMedia===!0?yield this.enableDisplay():yield this.enableCamera();this._updateTrack(t),this._onEnableChanged.emit(t)}else this._oldTrack&&(this._updateTrack(this._oldTrack),this._onEnableChanged.emit(this._oldTrack));zc.debug("resumed",this.toJSON())}}))})}get isEnabled(){return this._isEnabled}enableCamera(){return B(this,null,function*(){const[e]=(yield navigator.mediaDevices.getUserMedia({video:this.trackConstraints})).getVideoTracks();return e})}enableDisplay(){return B(this,null,function*(){const[e]=(yield navigator.mediaDevices.getDisplayMedia({video:this.trackConstraints})).getVideoTracks();return e})}},x4=new De("packages/core/src/media/stream/local/data.ts"),yf=class extends T_{constructor(e={}){super("data"),this.options=e,this.contentType="data",this._onWriteData=new Me,this._isEnabled=!0,this._setLabel("LocalDataStream")}get isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}write(e){if(!this._isEnabled)throw we({operationName:"LocalDataStream.write",path:x4.prefix,info:Ae.disabledDataStream});!ArrayBuffer.isView(e)&&typeof e!="string"&&(e=np+JSON.stringify(e)),this._onWriteData.emit(e)}},np="skyway_object:";W();function C4(e,{publisherId:t,stream:n,origin:r,metadata:i,codecCapabilities:a,encodings:o,contentType:u,id:p,isEnabled:h}){const y=e._getPublication(p);if(y)return y;u=u.toLowerCase();const f=r?e._getPublication(r):void 0;return f&&o.length===0&&(o=f.encodings),new I_({id:p,channel:e,publisher:e._getMember(t),contentType:u,metadata:i,origin:f,stream:n,codecCapabilities:a??[],encodings:o,isEnabled:h})}var Nt=new De("packages/core/src/publication/index.ts"),I_=class{constructor(e){this._codecCapabilities=[],this._encodings=[],this._state="enabled",this._events=new ai,this.onCanceled=this._events.make(),this.onSubscribed=this._events.make(),this.onUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onEnabled=this._events.make(),this.onDisabled=this._events.make(),this.onStateChanged=this._events.make(),this.onConnectionStateChanged=new Me,this._onEncodingsChanged=this._events.make(),this._onReplaceStream=this._events.make(),this._onEnabled=this._events.make(),this.streamEventDisposer=new lr,this.cancel=()=>new Promise((i,a)=>{let o=!1;this._channel._unpublish(this.id).catch(u=>{o=!0,a(u)}),this._setStream(void 0),this.onCanceled.asPromise(this._context.config.rtcApi.timeout).then(()=>i()).catch(u=>{o||a(u)})}),this.updateMetadata=i=>new Promise((a,o)=>B(this,null,function*(){const u=Nt.info("[start] updateMetadata",yield Qe({operationName:"Publication.updateMetadata",channel:this._channel}),this);let p=!1;this._channel._updatePublicationMetadata(this.id,i).catch(h=>{p=!0,o(h)}),this.onMetadataUpdated.watch(h=>h.metadata===i,this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){a(),Nt.elapsed(u,"[end] updateMetadata",yield Qe({operationName:"Publication.updateMetadata",channel:this._channel}),this)})).catch(h=>{if(!p)throw we({operationName:"PublicationImpl.updateMetadata",info:de(ee({},Ae.timeout),{detail:"publication onMetadataUpdated"}),path:Nt.prefix,context:this._context,channel:this._channel,error:h})})})),this.disable=()=>new Promise((i,a)=>B(this,null,function*(){if(this.state==="disabled"){i();return}const o=Nt.info("[start] disable",yield Qe({operationName:"Publication.disable",channel:this._channel}),this);yield this._disableStream();let u=!1;this._channel._disablePublication(this.id).catch(p=>{u=!0,a(p)}),this.onDisabled.asPromise(this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){i(),Nt.elapsed(o,"[end] disable",yield Qe({operationName:"Publication.disable",channel:this._channel}),this)})).catch(p=>{u||a(p)})})),this.enable=()=>new Promise((i,a)=>B(this,null,function*(){if(this.stream==null){a(we({operationName:"Publication.enable",context:this._context,info:Ae.canNotEnableRemotePublication,path:Nt.prefix}));return}if(this.state==="enabled"){i();return}const o=Nt.info("[start] enable",yield Qe({operationName:"Publication.enable",channel:this._channel}),this);let u=!1;this._channel._enablePublication(this.id).catch(p=>{u=!0,a(p)}),this._onEnabled.asPromise(this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){yield this._enableStream(),this.onEnabled.emit(),this.onStateChanged.emit(),Nt.elapsed(o,"[end] enable",yield Qe({operationName:"Publication.enable",channel:this._channel}),this),i()})).catch(p=>{u||a(p)})}));var t,n,r;this.id=e.id,this._channel=e.channel,this._context=this._channel._context,this.publisher=e.publisher,this.contentType=e.contentType,this._metadata=e.metadata,this.origin=e.origin,this.setCodecCapabilities((t=e.codecCapabilities)!=null?t:[]),this.setEncodings(rp((n=e.encodings)!=null?n:[])),this._state=e.isEnabled?"enabled":"disabled",e.stream&&this._setStream(e.stream),this._analytics=(r=this._channel.localPerson)==null?void 0:r._analytics,Nt.debug("publication spawned",this.toJSON())}get codecCapabilities(){return this._codecCapabilities}setCodecCapabilities(e){this._codecCapabilities=e}get encodings(){return this._encodings}setEncodings(e){this._encodings=e}get stream(){return this._stream}_setStream(e){this._stream=e,e?e._onConnectionStateChanged.add(t=>{Nt.debug("onConnectionStateChanged",this.id,t),this.onConnectionStateChanged.emit(t)}).disposer(this.streamEventDisposer):this.streamEventDisposer.dispose()}get metadata(){return this._metadata}get state(){return this._state}get deviceName(){if(!(this.stream instanceof yf))return this.stream.track.label}get subscriptions(){return this._channel.subscriptions.filter(e=>e.publication.id===this.id)}_updateMetadata(e){this._metadata=e,this.onMetadataUpdated.emit({metadata:e})}_disable(){return B(this,null,function*(){yield this._disableStream(),this.onDisabled.emit(),this.onStateChanged.emit()})}_enable(){this.stream?this._onEnabled.emit():(this._state="enabled",this.onEnabled.emit(),this.onStateChanged.emit())}_unpublished(){this._state="canceled",this.stream&&this.stream._unpublished(),this.onCanceled.emit(),this.onStateChanged.emit(),this._dispose()}_subscribed(e){this.onSubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit()}_unsubscribed(e){this.onUnsubscribed.emit({subscription:e}),this.onSubscriptionListChanged.emit()}updateEncodings(e){Nt.info("updateEncodings",{encodings:e},this),this.setEncodings(rp(F_(e))),this._onEncodingsChanged.emit(e),this._analytics&&!this._analytics.isClosed()&&this._analytics.client.sendPublicationUpdateEncodingsReport({publicationId:this.id,encodings:this.encodings,updatedAt:Date.now()})}_disableStream(){return B(this,null,function*(){this.state!=="disabled"&&(this._state="disabled",this.stream&&(this.stream.contentType==="data"?this.stream.setIsEnabled(!1):yield this.stream.setEnabled(!1).catch(e=>{Nt.warn(Wt({channel:this._channel,operationName:"Publication._disableStream",payload:e,detail:"setEnabled failed"}))}),Qe({operationName:"Publication._disableStream",channel:this._channel}).then(e=>Nt.info("publication _disableStream",e,{publication:this})).catch(()=>{})))})}_enableStream(){return B(this,null,function*(){this.state!=="enabled"&&(this._state="enabled",this.stream&&(Qe({operationName:"Publication._enableStream",channel:this._channel}).then(e=>Nt.info("publication _enableStream",e,{publication:this})).catch(()=>{}),this.stream.contentType==="data"?this.stream.setIsEnabled(!0):yield this.stream.setEnabled(!0).catch(e=>{Nt.warn(Wt({channel:this._channel,operationName:"Publication._disableStream",payload:e,detail:"setEnabled failed"}))})))})}replaceStream(e,t={}){var n;if(Nt.info("replaceStream",{stream:e,options:t},this),!this.stream)throw we({operationName:"PublicationImpl.replaceStream",context:this._context,info:Ae.canNotUseReplaceStream,path:Nt.prefix});if(e.contentType!==this.contentType)throw we({operationName:"PublicationImpl.replaceStream",context:this._context,info:Ae.invalidContentType,path:Nt.prefix});((n=t.releaseOldStream)==null||n)&&this.stream.release(),Qe({operationName:"PublicationImpl.replaceStream",channel:this._channel}).then(i=>Nt.debug(i,{old:this.stream,new:e})).catch(i=>i),e.setEnabled(this.stream.isEnabled).catch(i=>{Nt.error("replaceStream stream.setEnabled",i,this.toJSON())});const r=this._stream;this._setStream(e),this._onReplaceStream.emit({newStream:e,oldStream:r}),this._analytics&&!this._analytics.isClosed()&&this._analytics.client.sendMediaDeviceReport({publicationId:this.id,mediaDeviceName:this.deviceName,mediaDeviceTrigger:"replaceStream",updatedAt:Date.now()})}getStats(e){if(!this.stream)throw we({operationName:"PublicationImpl.getStats",context:this._context,info:Ae.streamNotExistInSubscription,path:Nt.prefix});return this.stream._getStats(e)}getRTCPeerConnection(e){if(!this.stream)throw we({operationName:"PublicationImpl.getRTCPeerConnection",context:this._context,info:Ae.streamNotExistInSubscription,path:Nt.prefix});return this.stream._getRTCPeerConnection(e)}getConnectionState(e){if(!this.stream)throw we({operationName:"PublicationImpl.getConnectionState",context:this._context,info:Ae.streamNotExistInSubscription,path:Nt.prefix});return this.stream._getConnectionState(e)}toJSON(){var e;return{id:this.id,channelId:this._channel.id,publisherId:this.publisher.id,origin:(e=this.origin)==null?void 0:e.id,contentType:this.contentType,metadata:this.metadata,codecCapabilities:this.codecCapabilities,encodings:this.encodings,state:this.state,stream:this.stream}}_dispose(){this._events.dispose()}},rp=e=>e.map((t,n)=>{var r;return de(ee({},t),{id:(r=t.id)!=null?r:n.toString()})}),F_=e=>{const[t]=e;return t.maxBitrate?e.sort((n,r)=>n.maxBitrate-r.maxBitrate):t.scaleResolutionDownBy?e.sort((n,r)=>r.scaleResolutionDownBy-n.scaleResolutionDownBy):t.maxFramerate?e.sort((n,r)=>n.maxFramerate-r.maxFramerate):e};W();function E4(e){return e==null?!1:e.side==="remote"}W();W();var wg=new De("packages/core/src/dataPlane/agent/publishing.ts"),P4=class{constructor(e){this._localPerson=e,this.context=this._localPerson.context}startPublishing(e){return B(this,null,function*(){if(this.context.config.internal.disableDPlane){yield new Promise(i=>setTimeout(i,500));return}const t=e.publication,n=e.subscriber;t.stream||(yield this._localPerson.onStreamPublished.watch(i=>i.publication.id===t.id,this.context.config.rtcApi.timeout).catch(i=>{throw we({operationName:"PublishingAgent.startPublishing",context:this.context,channel:this._localPerson.channel,info:de(ee({},Ae.timeout),{detail:"PublishingAgent onStreamPublished"}),path:wg.prefix,payload:{publication:t},error:i})}));const r=n._getOrCreateConnection(this._localPerson);r.startPublishing&&(yield r.startPublishing(t,e.id))})}stopPublishing(e,t){return B(this,null,function*(){const n=t._getConnection(this._localPerson.id);n!=null&&n.stopPublishing&&n.stopPublishing(e).catch(r=>{wg.error("stopPublishing failed",r)})})}};W();var k4=class{constructor(e){this._localPerson=e,this._disposers={},this._context=this._localPerson.context}startSubscribing(e){return B(this,null,function*(){if(this._context.config.internal.disableDPlane){yield new Promise(r=>setTimeout(r,500));return}const n=e.publication.publisher._getOrCreateConnection(this._localPerson);if(n.startSubscribing){yield n.startSubscribing(e);const{removeListener:r}=e._onChangeEncoding.add(()=>B(this,null,function*(){var i;yield(i=n.changePreferredEncoding)==null?void 0:i.call(n,e)}));this._disposers[e.id]=r}})}stopSubscribing(e){return B(this,null,function*(){var t,n;const i=e.publication.publisher._getConnection(this._localPerson.id);i!=null&&i.stopSubscribing&&(yield i.stopSubscribing(e),(n=(t=this._disposers)[e.id])==null||n.call(t))})}};W();var xg=class{constructor(e){this._impl=e,this._events=new ai,this.onLeft=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberStateChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onFatalError=this._events.make(),this.apply(e)}get keepaliveIntervalSec(){return this._impl.keepaliveIntervalSec}get keepaliveIntervalGapSec(){return this._impl.keepaliveIntervalGapSec}get disableSignaling(){return this._impl.disableSignaling}get disableAnalytics(){return this._impl.disableAnalytics}get type(){return this._impl.type}get subtype(){return this._impl.subtype}get side(){return this._impl.side}get id(){return this._impl.id}get name(){return this._impl.name}get channel(){return this._impl.channel}get metadata(){return this._impl.metadata}get state(){return this._impl.state}get publications(){return this._impl.publications}get subscriptions(){return this._impl.subscriptions}apply(e){this._impl=e,e.onLeft.pipe(this.onLeft),e.onMetadataUpdated.pipe(this.onMetadataUpdated),e.onStreamPublished.pipe(this.onStreamPublished),e.onStreamUnpublished.pipe(this.onStreamUnpublished),e.onPublicationListChanged.pipe(this.onPublicationListChanged),e.onPublicationSubscribed.pipe(this.onPublicationSubscribed),e.onPublicationUnsubscribed.pipe(this.onPublicationUnsubscribed),e.onSubscriptionListChanged.pipe(this.onSubscriptionListChanged),e.onFatalError.pipe(this.onFatalError)}subscribe(e,t){return this._impl.subscribe(e,t)}unsubscribe(e){return this._impl.unsubscribe(e)}publish(e,t={}){return this._impl.publish(e,t)}unpublish(e){return this._impl.unpublish(e)}updateMetadata(e){return this._impl.updateMetadata(e)}leave(){return B(this,null,function*(){yield this._impl.leave()})}dispose(){this._impl.dispose()}};W();W();var T4=24*60*60;W();var Cg=new De("packages/core/src/external/ice.ts"),R4=class{constructor(e){this.args=e,this.domain=this.args.domain,this.version=this.args.version,this.secure=this.args.secure,this.memberId=this.args.memberId,this.channelId=this.args.channelId,this.ttl=this.args.ttl,this.context=this.args.context,this._stunServers=[],this._turnServers=[],this._endpoint=`http${this.secure?"s":""}://${this.domain}/v${this.version}`,this.http=new ff(this._endpoint)}updateIceParams(){return B(this,null,function*(){const e={memberId:this.memberId,channelId:this.channelId,ttl:this.ttl};Cg.debug("[start] fetch iceParams");const t=new Mr({times:6,interval:500,jitter:100}),{turn:n,stun:r}=yield this.http.post("/ice-params",e,{headers:{authorization:`Bearer ${this.context.authTokenString}`},retry:()=>t.wait()});n&&(this._turnServers=[{credential:n.credential,urls:`turn:${n.domain}:${n.port}?transport=tcp`,username:n.username},{credential:n.credential,urls:`turn:${n.domain}:${n.port}?transport=udp`,username:n.username},{credential:n.credential,urls:`turns:${n.domain}:${n.port}?transport=tcp`,username:n.username}]),this._stunServers=[{urls:`stun:${r.domain}:${r.port}`}],Cg.debug("[end] fetch iceParams",{turn:n,stun:r})})}get iceServers(){let e=[...this._stunServers];const t=this._turnServers.filter(n=>{const r=n.urls;switch(this.context.config.rtcConfig.turnProtocol){case"all":return!0;case"udp":return r.endsWith("udp");case"tcp":return!r.startsWith("turns")&&r.endsWith("tcp");case"tls":return r.startsWith("turns")}});return this.context.config.rtcConfig.turnPolicy!=="disable"&&(e=[...e,...t]),e}};W();W();W();W();var A4=20480,Kc=class{constructor(e,t={}){if(this.event=e,this.payload=t,this.eventId=$r(),this.data=JSON.stringify({event:this.event,eventId:this.eventId,payload:this.payload}),this.data.length>A4)throw new Error("payload size exceeds the upper limit")}};W();var I4=["rateLimitExceeded","targetNotFound","payloadLengthExceeded","invalidPayload","unknown","parameterError","permissionError"];function Eg(e){return!(!e||typeof e!="object"||!D_(e.src)||!e.data||typeof e.data!="object")}function F4(e){return!(!e||typeof e!="object"||typeof e.eventId!="string"||typeof e.ok!="boolean"||typeof e.reason<"u"&&(typeof e.reason!="string"||!I4.includes(e.reason)))}function D_(e){return!(e===void 0||Array.isArray(e)||typeof e!="object"||typeof e.id!="string"||typeof e.name<"u"&&typeof e.name!="string")}W();var Pg=Xn(sf());W();var _s=class{constructor(){this._listeners=new Map,this._listenerIndex=0,this.emit=e=>{this._listeners.forEach(t=>t(e))},this.removeAllListeners=()=>{this._listeners.clear()},this.addListener=e=>{const t=this._listenerIndex;return this._listeners.set(t,e),this._listenerIndex++,{removeListener:()=>{this._listeners.delete(t)}}},this.addOneTimeListener=e=>{const t=this.addListener(n=>{t.removeListener(),e(n)});return t},this.asPromise=e=>new Promise((t,n)=>{let r=()=>{};const i=e&&setTimeout(()=>{n("Event asPromise timeout"),r()},e);r=this.addOneTimeListener(o=>{i&&clearTimeout(i),t(o)}).removeListener})}};W();var D4="1.0.4",N4=["open","sendRequestSignalingMessage","sendResponseSignalingMessage","acknowledge"],O4=e=>(_i(2,e)+Math.random())*1e3,M4=class{constructor({channelId:e,channelName:t,memberId:n,memberName:r,sessionEndpoint:i,token:a,logger:o}){this._isOpen=!1,this._isDestroyed=!1,this._reconnectCount=0,this.connectionState="closed",this.onConnectionStateChanged=new _s,this.onOpened=new _s,this.onEventReceived=new _s,this.onConnectionFailed=new _s,this._sessionEndpoint=i,this._channelId=e,this._channelName=t,this._memberId=n,this._memberName=r,this._token=a,this._logger=o,this._connect()}_setConnectionState(e){this._logger.debug(`connectionState changed : ${e}`),this.connectionState=e,this.onConnectionStateChanged.emit(e)}_connect(){let e;try{const t=`SkyWayAuthToken!${this._token}`,n={channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,platform:"javascript",version:D4},r=Object.entries(n).filter(([a,o])=>o!==void 0).map(a=>a.join("=")).join("&"),i=`${this._sessionEndpoint}?${r}`;e=new Pg.default(i,t),this._logger.debug(`Connecting to signaling-server: ${this._sessionEndpoint}`),e.onerror=a=>{this._logger.error("WebSocket error occurred",a.error),e.close(4202)}}catch(t){const n=t instanceof Error?t:new Error;this._logger.error("Failed to create WebSocket instance",n),this.reconnect();return}e.onopen=()=>{this._logger.debug("Connected to signaling-server")},e.onclose=t=>{const n="Close event fired: "+JSON.stringify({code:t.code,reason:t.reason,type:t.type});if(4100<=t.code&&t.code<=4199?this._logger.error(n,new Error):this._logger.debug(n),t.code!==1e3&&!(4e3<=t.code&&t.code<=4199)){this.reconnect();return}t.code!==4e3&&(this._logger.debug("Closed the connection to signaling-server"),this.onConnectionFailed.emit(),this.destroy())},e.onmessage=t=>{this._messageHandler(t.data)},this._ws=e}updateAuthToken(e){this._token=e}reconnect(){if(this._ws!==void 0&&this._ws.close(4e3),this._ws=void 0,this._isOpen=!1,this._reconnectCount>=8)this.onConnectionFailed.emit(),this.destroy(),this._logger.error("Failed to reconnect for eight times",new Error);else{this._setConnectionState("reconnecting");const e=O4(this._reconnectCount);this._reconnectTimer=setTimeout(()=>{this._connect(),this._reconnectCount++,this._logger.debug(`Try to reconnect: count = ${this._reconnectCount}`)},e)}}destroy(){this._isDestroyed=!0,this._setConnectionState("closed"),this.onConnectionStateChanged.removeAllListeners(),this.onOpened.removeAllListeners(),this.onEventReceived.removeAllListeners(),this.onConnectionFailed.removeAllListeners(),this._reconnectTimer&&clearTimeout(this._reconnectTimer),this._ws!==void 0&&this._ws.close(1e3)}send(e){return new Promise((t,n)=>{const r=()=>{this.onOpened.addOneTimeListener(()=>{this.send(e).then(()=>{t()}).catch(i=>{n(i)})}),this.onConnectionFailed.addOneTimeListener(()=>{n(new Error("Connection failed"))})};if(this._isDestroyed){n(new Error("The socket is already destroyed"));return}if(this._ws===void 0||!this._isOpen){this._logger.debug("Retry send the client event when connected because WebSocket is undefined or isOpen = false"),r();return}this._logger.debug(`Send the event: ${e.data}`),this._ws.send(e.data,i=>{if(i){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==Pg.default.OPEN){this._logger.debug("Retry send the client event when connected because WebSocket.send failed"),r();return}n(i)}else t()})})}_messageHandler(e){if(typeof e!="string"){this._logger.error("Received invalid message: not string",new Error);return}let t;try{t=JSON.parse(e)}catch(n){const r=n instanceof Error?n:new Error;this._logger.error("Received invalid message: parse error",r);return}if(!L4(t)){this._logger.error(`Received invalid message: ${t}`,new Error);return}t.event==="open"?(this._logger.debug("Received a open event"),this._isOpen=!0,this._setConnectionState("connected"),this._reconnectCount!==0&&(this._reconnectCount=0,this._logger.debug("Succeeded to reconnect")),this.onOpened.emit()):(this._logger.debug(`Received the event: ${t.event}, payload: ${JSON.stringify(t.payload)}`),this.onEventReceived.emit(t))}};function L4(e){return!(!e||typeof e!="object"||typeof e.event!="string"||!N4.includes(e.event)||typeof e.eventId!="string"||e.payload&&typeof e.payload!="object")}var kg="signaling.skyway.ntt.com",j4="v1",B4=class{constructor({token:e,channelId:t,channelName:n,memberId:r,memberName:i},a){this.onConnectionStateChanged=new _s,this.onConnectionFailed=new _s,this.onRequested=new _s,this._connectivityCheckTimers=new Map,this._responseCallbacks=new Map,this._acknowledgeCallbacks=new Map,this._token=e,this._channelId=t,this._channelName=n,this._memberId=r,this._memberName=i;const o={connectivityCheckIntervalSec:30,signalingServerDomain:kg,secure:!0,logger:{debug:u=>{console.debug(u)},error:u=>{console.error(u)}}};this._options=Object.assign({},o,a??{}),this._logger=this._options.logger,this._logger.debug(`Created instance with the options: ${this._options}`)}get connectionState(){var e,t;return(t=(e=this._socket)==null?void 0:e.connectionState)!=null?t:"closed"}connect(){return B(this,null,function*(){const e=this._options.secure?"wss":"ws",t=this._options.signalingServerDomain||kg;this._socket=new M4({sessionEndpoint:`${e}://${t}/${j4}/ws`,channelId:this._channelId,channelName:this._channelName,memberId:this._memberId,memberName:this._memberName,token:this._token,logger:this._logger}),this._socket.onEventReceived.addListener(n=>{try{this._eventReceivedHandler(n)}catch(r){this._logger.error("in _eventReceivedHandler",r)}}),this._socket.onConnectionFailed.addListener(()=>{this.onConnectionFailed.emit()}),this._socket.onConnectionStateChanged.addListener(n=>{this.onConnectionStateChanged.emit(n)}),yield this._socket.onOpened.asPromise(15*1e3),this._startConnectivityCheck()})}disconnect(){var e;this._stopConnectivityCheck(),(e=this._socket)==null||e.destroy(),this._socket=void 0,this._responseCallbacks.clear(),this._acknowledgeCallbacks.clear()}_startConnectivityCheck(){if(this._connectivityCheckInterval){this._logger.debug("connectivity check timer is already set");return}this._connectivityCheckInterval=setInterval(()=>{var e;const t=new Kc("checkConnectivity");(e=this._socket)==null||e.send(t).catch(()=>{this._acknowledgeCallbacks.delete(t.eventId)}),this._connectivityCheckTimers.set(t.eventId,setTimeout(()=>{var n;this._acknowledgeCallbacks.delete(t.eventId),(n=this._socket)==null||n.reconnect(),this._logger.debug("connectivity check timer is expired")},5*1e3)),this._setAcknowledgeCallback(t.eventId,n=>{var r;const i=this._connectivityCheckTimers.get(t.eventId);i&&(clearTimeout(i),this._connectivityCheckTimers.delete(t.eventId)),n.ok||((r=this._socket)==null||r.reconnect(),this._logger.debug("connectivity check response from server was not ok"))})},this._options.connectivityCheckIntervalSec*1e3),this._logger.debug("Started connectivity check timer")}_stopConnectivityCheck(){if(!this._connectivityCheckInterval){this._logger.debug("connectivity check timer is not set");return}clearInterval(this._connectivityCheckInterval),this._connectivityCheckInterval=void 0,this._logger.debug("Stopped connectivity check timer");for(const[e,t]of this._connectivityCheckTimers)clearTimeout(t);this._connectivityCheckTimers.clear()}request(e,t,n=10){return U4(e),Tg(t),new Promise((r,i)=>{if(this._socket===void 0){i(new Error("websocket is not connected"));return}const a={dst:e,data:t},o=new Kc("sendRequestSignalingMessage",a),u=setTimeout(()=>{this._acknowledgeCallbacks.delete(o.eventId),i(new Error("request timeout"))},n*1e3);this._setResponseCallback(o.eventId,p=>{clearTimeout(u),r(p)}),this._setAcknowledgeCallback(o.eventId,p=>{p.ok||(clearTimeout(u),i(p))}),this._socket.send(o).catch(p=>{this._acknowledgeCallbacks.delete(o.eventId),clearTimeout(u),i(p)})})}_response(e,t,n,r){return new Promise((i,a)=>{if(Tg(n),this._socket===void 0){a(new Error("websocket is not connected"));return}const o={dst:e,requestEventId:t,data:n},u=new Kc("sendResponseSignalingMessage",o),p=setTimeout(()=>{this._acknowledgeCallbacks.delete(u.eventId),a(new Error("response timeout"))},r*1e3);this._setAcknowledgeCallback(u.eventId,h=>{clearTimeout(p),h.ok?i():a(h)}),this._socket.send(u).catch(h=>{this._acknowledgeCallbacks.delete(u.eventId),clearTimeout(p),a(h)})})}updateSkyWayAuthToken(e,t=10){return new Promise((n,r)=>{if(this._socket===void 0){r(new Error("websocket is not connected"));return}const i={token:e},a=new Kc("updateSkyWayAuthToken",i),o=setTimeout(()=>{this._acknowledgeCallbacks.delete(a.eventId),r(new Error("updateSkyWayAuthToken timeout"))},t*1e3);this._setAcknowledgeCallback(a.eventId,u=>{if(clearTimeout(o),u.ok){if(this._socket===void 0){r(new Error("websocket is not connected"));return}this._socket.updateAuthToken(e),n()}else r(u)}),this._socket.send(a).catch(u=>{this._acknowledgeCallbacks.delete(a.eventId),clearTimeout(o),r(u)})})}_eventReceivedHandler(e){switch(e.event){case"acknowledge":this._acknowledgeHandler(e.payload);break;case"sendRequestSignalingMessage":this._eventMessageRequestHandler(e.payload);break;case"sendResponseSignalingMessage":this._eventMessageResponseHandler(e.payload);break;case"open":break;default:e.event,this._logger.debug(`Unknown event: ${e.event}`)}}_acknowledgeHandler(e){if(!F4(e))throw new Error("Invalid payload");const{eventId:t}=e;if(!this._acknowledgeCallbacks.has(t))throw new Error(`acknowledge event has unknown eventId: ${t}`);const n=this._acknowledgeCallbacks.get(t);n&&(this._acknowledgeCallbacks.delete(t),n(e))}_eventMessageRequestHandler(e){if(!Eg(e))throw new Error("Invalid payload");if(!e.requestEventId)throw new Error("Invalid payload");const t=e.src,n=e.requestEventId,r=(i,a=10)=>B(this,null,function*(){yield this._response(t,n,i,a)});this.onRequested.emit({data:e.data,reply:r,requestEventId:e.requestEventId,src:e.src})}_eventMessageResponseHandler(e){if(!Eg(e))throw new Error("Invalid payload");if(!e.requestEventId||!this._responseCallbacks.has(e.requestEventId))throw new Error(`received response has unknown eventId: ${e.requestEventId}`);const t=this._responseCallbacks.get(e.requestEventId);t&&(this._responseCallbacks.delete(e.requestEventId),t(e.data))}_setResponseCallback(e,t){this._responseCallbacks.set(e,t)}_setAcknowledgeCallback(e,t){this._acknowledgeCallbacks.set(e,t)}};function Tg(e){if(!e||typeof e!="object")throw new Error("the type of data must be object")}function U4(e){if(!D_(e))throw new Error("the type of target must be {id: string, name: string}");if(!AP(e.id))throw new Error("the type of target.id must be uuid format")}W();var mr=new De("packages/core/src/external/signaling.ts");function H4(e,t,n){return B(this,null,function*(){const{signalingService:r}=e.config,i=new B4({token:e.authTokenString,channelId:t.id,channelName:t.name,memberId:n.id,memberName:n.name},{logger:{error:o=>B(null,null,function*(){mr.error("SignalingClient error",we({operationName:"SignalingClient.logger",context:e,info:de(ee({},Ae.internal),{detail:"signalingClient error"}),error:o,path:mr.prefix,channel:t}))}),debug:o=>{}},signalingServerDomain:r.domain,secure:r.secure}),a=new V4(i,e);return yield a.connect(),a})}var V4=class{constructor(e,t){this._client=e,this.context=t,this.onConnectionFailed=new Me,this.onConnectionStateChanged=new Me,this.onMessage=new Me,this.closed=!1,this._chunkedMessageBuffer={},this._backoffUpdateSkyWayAuthToken=new Mr({times:8,interval:100,jitter:100}),this._disposer=new lr,this._listen(),t._onTokenUpdated.add(n=>B(this,null,function*(){yield this._updateSkyWayAuthToken(n)})).disposer(this._disposer)}updateClient(e){this._client=e,this._listen()}_listen(){this._client.onConnectionFailed.addOneTimeListener(()=>{this.onConnectionFailed.emit({})}),this._client.onConnectionStateChanged.addListener(e=>{mr.debug("signalingClient onConnectionStateChanged",e),this.onConnectionStateChanged.emit(e)}),this._client.onRequested.addListener(e=>B(this,[e],function*({data:t,src:n,reply:r}){var i;const a=t,{chunk:o,length:u,offset:p,id:h,type:y}=a;if(y===Bd){if(u===0)this.onMessage.emit({src:n,data:JSON.parse(o)});else if(this._chunkedMessageBuffer[h]=[...(i=this._chunkedMessageBuffer[h])!=null?i:[],a.chunk],u===p){const f=this._chunkedMessageBuffer[h].join("");delete this._chunkedMessageBuffer[h],this.onMessage.emit({src:n,data:JSON.parse(f)})}yield r({}).catch(f=>{this.closed||mr.warn("failed to reply",Wt({operationName:"SignalingSession.reply",detail:"SignalingClient failed to reply"}),f)})}}))}_updateSkyWayAuthToken(e){return B(this,null,function*(){if(this._backoffUpdateSkyWayAuthToken.exceeded){mr.error("[failed] updateSkyWayAuthToken");return}yield this._backoffUpdateSkyWayAuthToken.wait(),mr.debug("[start] updateSkyWayAuthToken",{count:this._backoffUpdateSkyWayAuthToken.count});const t=yield this._client.updateSkyWayAuthToken(e).catch(n=>n);if(t){mr.warn("[retry] updateSkyWayAuthToken",Wt({operationName:"SignalingSession._updateSkyWayAuthToken",detail:"[retry] updateSkyWayAuthToken"}),t),yield this._updateSkyWayAuthToken(e);return}mr.debug("[end] updateSkyWayAuthToken"),this._backoffUpdateSkyWayAuthToken.reset()})}get connectionState(){return this._client.connectionState}connect(){return B(this,null,function*(){mr.debug("[start] connect signalingService"),yield this._client.connect().catch(e=>{throw we({operationName:"signalingSession.connect",path:mr.prefix,info:de(ee({},Ae.internal),{detail:"signalingClient failed to connect Server"}),context:this.context,error:e})}),mr.debug("[end] connect signalingService")})}close(){this.closed=!0,this._disposer.dispose(),this._client.disconnect()}send(e,t,n=1e4){return B(this,null,function*(){var r;try{const i=JSON.stringify(t),a=Da();if(i.length>20480){const o=(r=i.match(/.{1,20480}/g))!=null?r:[];let u=0;for(const p of o){const h={type:Bd,length:o.length-1,offset:u++,chunk:p,id:a};yield this._client.request(e,h,n/1e3)}}else{const o={type:Bd,length:0,offset:0,chunk:i,id:a};yield this._client.request(e,o,n/1e3)}}catch(i){if(this.closed||e.state!=="joined")return;throw we({operationName:"SignalingSession.send",context:this.context,info:de(ee({},Ae.internal),{detail:"signalingClient"}),error:i,path:mr.prefix,payload:{target:e,data:t}})}})}},Bd="signalingMessage",Rg=new De("packages/core/src/member/person/local/factory.ts");function q4(e,t,n){return B(this,arguments,function*(r,i,a,{keepaliveIntervalSec:o,keepaliveIntervalGapSec:u,preventAutoLeaveOnBeforeUnload:p,disableSignaling:h}={}){var y;Rg.debug("createLocalPerson",{channel:i,memberDto:a,keepaliveIntervalSec:o,keepaliveIntervalGapSec:u,preventAutoLeaveOnBeforeUnload:p});const{iceParamServer:f}=r.config,_=h===!0?void 0:yield H4(r,i,a),w=new R4(de(ee({},f),{memberId:a.id,channelId:i.id,ttl:T4,context:r}));yield w.updateIceParams().catch(F=>{throw we({operationName:"createLocalPerson",context:r,channel:i,info:de(ee({},Ae.internal),{detail:"updateIceParams failed"}),path:Rg.prefix,error:F})});const R=yield z4.Create({iceManager:w,channel:i,signaling:_,analytics:r.analyticsSession,metadata:a.metadata,name:a.name,id:a.id,keepaliveIntervalSec:o,keepaliveIntervalGapSec:u,preventAutoLeaveOnBeforeUnload:p,context:r});for(const F of r.plugins)yield(y=F._whenCreateLocalPerson)==null?void 0:y.call(F,R),R._onDisposed.once(()=>B(null,null,function*(){var S;yield(S=F._whenDisposeLocalPerson)==null?void 0:S.call(F,R)}));return R})}var $e=new De("packages/core/src/member/localPerson/index.ts"),z4=class N_ extends Lu{constructor(t){super(t),this.args=t,this.type="person",this.subtype="person",this.side="local",this.keepaliveIntervalSec=this.args.keepaliveIntervalSec,this.keepaliveIntervalGapSec=this.args.keepaliveIntervalGapSec,this.preventAutoLeaveOnBeforeUnload=this.args.preventAutoLeaveOnBeforeUnload,this.disableSignaling=this.args.disableSignaling,this.disableAnalytics=this.args.disableAnalytics,this.config=this.context.config,this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onFatalError=this._events.make(),this._onStreamSubscribeFailed=this._events.make(),this._onDisposed=this._events.make(),this._disposer=new lr,this._subscribing={},this._requestQueue=new is,this.iceManager=this.args.iceManager,this._disposed=!1,this._publishingAgent=new P4(this),this._subscribingAgent=new k4(this),this._signaling=t.signaling,this._analytics=t.analytics,this._listenChannelEvent(),this._listenBeforeUnload()}static Create(...t){return B(this,null,function*(){const n=new N_(...t);return yield n._setupTtlTimer(),n._analytics&&n._analytics.client.sendJoinReport({memberId:n.id}),n})}_listenChannelEvent(){this.channel.onPublicationSubscribed.add(t=>B(this,[t],function*({subscription:n}){yield this._handleOnPublicationSubscribe(n).catch(r=>$e.error("_handleOnStreamSubscribe",r))})).disposer(this._disposer),this.channel.onPublicationUnsubscribed.add(t=>B(this,[t],function*({subscription:n}){yield this._handleOnPublicationUnsubscribe(n).catch(r=>$e.error("_handleOnStreamUnsubscribe",r))})).disposer(this._disposer),this.channel._onDisposed.once(()=>{this.dispose()}),this.onLeft.once(()=>{this.dispose()})}_setupTtlTimer(){return B(this,null,function*(){const{keepaliveIntervalSec:t,keepaliveIntervalGapSec:n}=this;if(t==null||($e.debug("_setupTtlTimer",this.toJSON(),{keepaliveIntervalSec:t,keepaliveIntervalGapSec:n}),t===-1))return;const r=()=>B(this,null,function*(){if(this._disposed)return;const i=yield this.context._api.getServerUnixtimeInSec();this.ttlSec=Math.floor(i+t+(n??0));try{yield this.channel._updateMemberTtl(this.id,this.ttlSec),$e.debug("updateTtl",this.toJSON(),{now:i,ttlSec:this.ttlSec,keepaliveIntervalSec:t??0,keepaliveIntervalGapSec:n??0,diff:this.ttlSec-i})}catch(a){if(this._disposed)return;throw a}});yield r(),this.ttlInterval=setInterval(()=>B(this,null,function*(){yield r().catch(i=>{this._disposed||(this.onFatalError.emit(we({operationName:"localPerson._setupTtlTimer",path:$e.prefix,info:de(ee({},Ae.internal),{detail:"updateMemberTtl failed"}),channel:this.channel,context:this.context,error:i})),this.dispose())})}),t*1e3)})}_listenBeforeUnload(){if(window&&!this.preventAutoLeaveOnBeforeUnload){const t=()=>B(this,null,function*(){window.removeEventListener("beforeunload",t),this.state==="joined"&&($e.debug("leave by beforeunload",this.toJSON()),yield this.leave())});window.addEventListener("beforeunload",t)}}_handleOnPublicationSubscribe(t){return B(this,null,function*(){var n;if(t.subscriber.id===this.id)try{const r=$e.info("[start] startSubscribing",yield Qe({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:t}),i=(n=this._subscribing[t.publication.id])==null?void 0:n.options;i&&(t.preferredEncoding=i.preferredEncodingId),yield this._subscribingAgent.startSubscribing(t),this.onPublicationSubscribed.emit({subscription:t,stream:t.stream}),this.onSubscriptionListChanged.emit(),$e.elapsed(r,"[end] startSubscribing",yield Qe({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:t})}catch(r){throw this._onStreamSubscribeFailed.emit({error:r,subscription:t}),r}if(t.publication.publisher.id===this.id){if(t.subscriber.id===this.id)throw we({operationName:"localPerson._handleOnStreamSubscribe",path:$e.prefix,info:de(ee({},Ae.internal),{detail:"can not subscribe own Publication"}),channel:this.channel,context:this.context});const r=$e.info("[start] startPublishing",yield Qe({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:t});yield this._publishingAgent.startPublishing(t).catch(i=>{throw $e.error("[failed] startPublishing",i,{subscription:t}),i}),$e.elapsed(r,"[end] startPublishing",yield Qe({operationName:"onPublicationSubscribed",channel:this.channel}),{subscription:t})}})}_handleOnPublicationUnsubscribe(t){return B(this,null,function*(){if(t.publication.publisher.id===this.id){const n=$e.info("[start] stopPublishing",yield Qe({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:t});yield this._publishingAgent.stopPublishing(t.publication,t.subscriber).catch(r=>{throw $e.error("[failed] stopPublishing",r,{subscription:t}),r}),$e.elapsed(n,"[end] stopPublishing",yield Qe({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:t})}if(t.subscriber.id===this.id){const n=$e.info("[start] stopSubscribing",yield Qe({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:t});yield this._subscribingAgent.stopSubscribing(t).catch(r=>{throw $e.error("[failed] stopSubscribing",{subscription:t},r),r}),this.onPublicationUnsubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit(),$e.elapsed(n,"[end] stopSubscribing",yield Qe({operationName:"onPublicationUnsubscribed",channel:this.channel}),{subscription:t})}})}publish(t){return B(this,arguments,function*(n,r={}){var i,a,o,u;const p=$e.info("[start] publish",yield Qe({operationName:"localPerson.publish",channel:this.channel}),{options:r});if(this.state!=="joined")throw we({operationName:"localPerson.publish",info:Ae.localPersonNotJoinedChannel,path:$e.prefix,channel:this.channel,context:this.context});if(n.published)throw we({operationName:"localPerson.publish",channel:this.channel,context:this.context,info:Ae.alreadyPublishedStream,path:$e.prefix});n.published=!0,r.codecCapabilities&&(r.codecCapabilities=r.codecCapabilities.filter(_=>_!=null));const h={metadata:r.metadata,publisher:this.id,channel:this.channel.id,contentType:n.contentType,codecCapabilities:(i=r.codecCapabilities)!=null?i:[],isEnabled:r.isEnabled};n.contentType==="video"&&h.codecCapabilities.length===0&&(h.codecCapabilities=[{mimeType:"video/vp8"}]),r.encodings&&r.encodings.length>0&&(h.encodings=rp(F_(r.encodings)));const y=yield this._requestQueue.push(()=>this.channel._publish(h).catch(_=>{throw we({operationName:"localPerson.publish",context:this.context,channel:this.channel,info:_.info,path:$e.prefix,error:_})}));n.contentType==="data"?n.setIsEnabled(y.isEnabled):yield n.setEnabled(y.isEnabled);const f=this.channel._addPublication(y);if(f._setStream(n),(a=h.codecCapabilities)!=null&&a.length&&f.setCodecCapabilities(h.codecCapabilities),(o=h.encodings)!=null&&o.length&&f.setEncodings(h.encodings),yield this._handleOnStreamPublish(f),$e.elapsed(p,"[end] publish",yield Qe({operationName:"localPerson.publish",channel:this.channel}),{publication:f}),["video","audio"].includes(f.contentType)&&this._analytics&&!this._analytics.isClosed()){this._analytics.client.sendMediaDeviceReport({publicationId:f.id,mediaDeviceName:f.deviceName,mediaDeviceTrigger:"publish",updatedAt:Date.now()});const _=(u=h.encodings)!=null?u:[];this._analytics.client.sendPublicationUpdateEncodingsReport({publicationId:f.id,encodings:_,updatedAt:Date.now()})}return f})}_handleOnStreamPublish(t){return B(this,null,function*(){$e.info("onStreamPublished",yield Qe({operationName:"onStreamPublished",channel:this.channel})),this.onStreamPublished.emit({publication:t}),this.onPublicationListChanged.emit()})}unpublish(t){return B(this,null,function*(){const n=$e.info("[start] unpublish",yield Qe({operationName:"localPerson.unpublish",channel:this.channel})),r=typeof t=="string"?t:t.id;if(this.state!=="joined")throw we({operationName:"localPerson.unpublish",info:Ae.localPersonNotJoinedChannel,path:$e.prefix,context:this.context,channel:this.channel});const i=this.channel._getPublication(r);if(!i)throw we({operationName:"localPerson.unpublish",info:Ae.publicationNotExist,path:$e.prefix,context:this.context,channel:this.channel,payload:{publicationId:r}});i.stream&&i.stream._unpublished(),yield this._requestQueue.push(()=>this.channel._unpublish(r)),i.subscriptions.map(a=>a.subscriber).forEach(a=>{E4(a)&&this._publishingAgent.stopPublishing(i,a).catch(o=>{$e.error("[failed] stopPublishing",o,{publication:i})})}),yield this._handleOnStreamUnpublished(i),$e.elapsed(n,"[end] unpublish",yield Qe({operationName:"localPerson.unpublish",channel:this.channel}),{publication:i})})}_handleOnStreamUnpublished(t){return B(this,null,function*(){$e.info("onStreamUnpublished",yield Qe({operationName:"onStreamUnpublished",channel:this.channel})),this.onStreamUnpublished.emit({publication:t}),this.onPublicationListChanged.emit()})}subscribe(t){return B(this,arguments,function*(n,r={}){const i=$e.info("[start] subscribe",yield Qe({operationName:"localPerson.subscribe",channel:this.channel}),{target:n}),a=typeof n=="string"?n:n.id;if(this.state!=="joined")throw we({operationName:"localPerson.subscribe",info:Ae.localPersonNotJoinedChannel,path:$e.prefix,context:this.context,channel:this.channel,payload:{target:n}});const o=this.channel._getPublication(a);if(o==null)throw we({operationName:"localPerson.subscribe",info:Ae.publicationNotExist,path:$e.prefix,context:this.context,channel:this.channel,payload:o});this._validatePublicationForSubscribe(o),this._subscribing[o.id]={options:r,processing:!0};const u=this._subscribing[o.id];try{const p=yield this._requestQueue.push(()=>this.channel._subscribe(this.id,a));$e.elapsed(i,"[elapsed] subscribe / subscriptionDto received",{subscriptionDto:p});const h=this.channel._addSubscription(p);return h.stream||(yield Promise.race([new Promise((y,f)=>{this.onPublicationSubscribed.watch(({subscription:_})=>_.publication.id===a,this.context.config.rtcApi.timeout).then(y).catch(_=>B(this,null,function*(){u.processing&&f(we({operationName:"localPerson.subscribe",info:de(ee({},Ae.timeout),{detail:"failed to subscribe publication. maybe publisher already left room"}),path:$e.prefix,context:this.context,channel:this.channel,payload:{subscription:h,publication:o},error:_}))}))}),new Promise((y,f)=>{this.channel.onMemberLeft.watch(_=>_.member.id===o.publisher.id,this.context.config.rtcApi.timeout+1e3).then(()=>{u.processing&&f(we({operationName:"localPerson.subscribe",info:de(ee({},Ae.internal),{detail:"failed to subscribe publication. publisher already left room"}),path:$e.prefix,context:this.context,channel:this.channel,payload:{subscription:h,publication:o}}))}).catch(y)}),new Promise((y,f)=>{this._onStreamSubscribeFailed.watch(_=>_.subscription.publication.id===o.id,this.context.config.rtcApi.timeout+1e3).then(_=>{var w,R;if(u.processing){const F=(R=(w=_==null?void 0:_.error)==null?void 0:w.info)!=null?R:de(ee({},Ae.internal),{detail:"subscribe _onStreamSubscribeFailed"});f(we({operationName:"localPerson.subscribe",info:F,path:$e.prefix,context:this.context,channel:this.channel,error:_.error,payload:{subscription:h,publication:o}}))}}).catch(y)})])),u.processing=!1,$e.elapsed(i,"[end] subscribe",yield Qe({operationName:"localPerson.subscribe",channel:this.channel}),{subscription:h,publication:o}),{subscription:h,stream:h.stream}}catch(p){throw u.processing=!1,$e.warn("[failed] subscribe",p,{publication:o}),p}})}_validatePublicationForSubscribe(t){if(t.publisher.id===this.id)throw we({operationName:"localPerson._validatePublicationForSubscribe",info:Ae.publicationNotExist,path:$e.prefix,context:this.context,channel:this.channel,payload:{publication:t}});if(t.publisher instanceof i_)throw we({operationName:"localPerson._validatePublicationForSubscribe",info:Ae.unknownMemberType,path:$e.prefix,context:this.context,channel:this.channel,payload:{publication:t}});if(this.subscriptions.find(n=>n.publication.id===t.id))throw we({operationName:"localPerson._validatePublicationForSubscribe",info:Ae.alreadySubscribedPublication,path:$e.prefix,context:this.context,channel:this.channel,payload:{publication:t}})}unsubscribe(t){return B(this,null,function*(){const n=$e.info("[start] unsubscribe",yield Qe({operationName:"localPerson.unsubscribe",channel:this.channel})),r=typeof t=="string"?t:t.id;if(this.state!=="joined")throw we({operationName:"localPerson.unsubscribe",info:Ae.localPersonNotJoinedChannel,path:$e.prefix,context:this.context,channel:this.channel});const i=this.subscriptions.find(a=>a.id===r);if(!i)throw we({operationName:"localPerson.unsubscribe",info:Ae.subscriptionNotExist,path:$e.prefix,context:this.context,channel:this.channel,payload:{subscriptionId:r}});delete this._subscribing[i.publication.id],yield this._requestQueue.push(()=>this.channel._unsubscribe(r)),$e.elapsed(n,"[end] unsubscribe",yield Qe({operationName:"localPerson.unsubscribe",channel:this.channel}),{subscription:i})})}_getConnections(){return this.channel.members.map(r=>r._getConnection(this.id)).filter(r=>(r==null?void 0:r.closed)===!1)}dispose(){this._disposed||(this._disposed=!0,$e.debug("disposed",this.toJSON()),clearInterval(this.ttlInterval),this._signaling&&this._signaling.close(),this._analytics&&this._analytics.close(),this._getConnections().forEach(t=>t.close({reason:"localPerson disposed"})),this._onDisposed.emit(),this._events.dispose(),this._disposer.dispose())}};W();W();var Yr=new De("packages/core/src/subscription/index.ts"),K4=class{constructor(e){this._disposer=new lr,this._state="enabled",this.onCanceled=new Me,this.onStreamAttached=new Me,this.onConnectionStateChanged=new Me,this._onChangeEncoding=new Me,this.cancel=()=>new Promise((t,n)=>{let r=!1;this._channel._unsubscribe(this.id).catch(i=>{r=!0,n(i)}),this.onCanceled.asPromise(this._context.config.rtcApi.timeout).then(()=>t()).catch(i=>{r||n(i)})}),this._channel=e.channel,this._context=this._channel._context,this.id=e.id,this.contentType=e.contentType,this.subscriber=e.subscriber,this.publication=e.publication,Yr.debug("subscription spawned",this.toJSON()),this._handlePublicationEnabled()}get state(){return this._state}_handlePublicationEnabled(){this.publication.onDisabled.add(()=>{this.stream&&(Yr.debug("disabled",this),this.stream.setIsEnabled(!1))}).disposer(this._disposer),this.publication.onEnabled.add(()=>{this.stream&&(Yr.debug("enabled",this),this.stream.setIsEnabled(!0))}).disposer(this._disposer),this.stream&&this.stream.setIsEnabled(this.publication.state==="enabled")}_setStream(e){this._stream=e,this.onStreamAttached.emit(),e._onConnectionStateChanged.add(t=>{Yr.debug("onConnectionStateChanged",this.id,t),this.onConnectionStateChanged.emit(t)})}get stream(){return this._stream}toJSON(){return{id:this.id,contentType:this.contentType,subscriber:this.subscriber,publication:this.publication,channelId:this._channel.id,state:this.state,stream:this.stream}}_canceled(){this._state="canceled",this.onCanceled.emit(),this._disposer.dispose()}changePreferredEncoding(e){if(!this.stream)throw we({operationName:"SubscriptionImpl.changePreferredEncoding",info:Ae.streamNotExistInSubscription,path:Yr.prefix,context:this._context,channel:this._channel});if(this.stream.contentType==="data")throw we({operationName:"SubscriptionImpl.changePreferredEncoding",info:Ae.dataStreamNotSupportEncoding,path:Yr.prefix,context:this._context,channel:this._channel});if(!this.publication.encodings.map(t=>t.id).includes(e))throw we({operationName:"SubscriptionImpl.changePreferredEncoding",info:Ae.correspondingEncodeNotExistForId,path:Yr.prefix,context:this._context,channel:this._channel});this.preferredEncoding=e,this._onChangeEncoding.emit()}getStats(){if(!this.stream)throw we({operationName:"SubscriptionImpl.getStats",info:Ae.streamNotExistInSubscription,path:Yr.prefix,context:this._context,channel:this._channel});return this.stream._getStats()}getRTCPeerConnection(){if(!this.stream)throw we({operationName:"SubscriptionImpl.getRTCPeerConnection",info:Ae.streamNotExistInSubscription,path:Yr.prefix,context:this._context,channel:this._channel});return this.stream._getRTCPeerConnection()}getConnectionState(){if(!this.stream)throw we({operationName:"SubscriptionImpl.getConnectionState",info:Ae.streamNotExistInSubscription,path:Yr.prefix,context:this._context,channel:this._channel});return this.stream._getConnectionState()}};function $4(e,{subscriberId:t,publicationId:n,id:r}){const i=e._getSubscription(r);if(i)return i;const o=e._getPublication(n).contentType;return new K4({channel:e,id:r,subscriber:e._getMember(t),publication:e._getPublication(n),contentType:o})}var bt=new De("packages/core/src/channel/index.ts"),Ud=class{constructor(e,t){this._context=e,this._channelImpl=t,this.id=this._channelImpl.id,this.name=this._channelImpl.name,this.appId=this._context.appId,this.disposed=!1,this.config=this._context.config,this._state="opened",this._api=this._context._api,this._members={},this._getMember=n=>this._members[n],this._publications={},this._getPublication=n=>this._publications[n],this._subscriptions={},this._getSubscription=n=>this._subscriptions[n],this._events=new ai,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this._onDisposed=this._events.make(),this.leave=n=>B(this,null,function*(){return this._channelImpl.leave(this.id,n.id)}),this.updateMetadata=n=>this._channelImpl.updateChannelMetadata(n),this.close=()=>new Promise((n,r)=>B(this,null,function*(){if(this.state==="closed"){r(we({operationName:"SkyWayChannelImpl.close",path:bt.prefix,info:Ae.alreadyChannelClosed,channel:this,context:this._context,payload:this.toJSON()}));return}const i=bt.info("[start] close channel",yield Qe({operationName:"SkyWayChannelImpl.close",channel:this}));try{yield this._channelImpl.close().catch(a=>{throw we({operationName:"SkyWayChannelImpl.close",context:this._context,info:de(ee({},Ae.internal),{detail:"_api.deleteChannel failed"}),error:a,path:bt.prefix,channel:this})}),this._state!=="closed"&&(yield this.onClosed.asPromise(this._context.config.rtcApi.timeout).catch(a=>{throw we({operationName:"SkyWayChannelImpl.close",context:this._context,info:de(ee({},Ae.timeout),{detail:"channel.onClosed"}),error:a,path:bt.prefix,channel:this})}))}catch(a){bt.error(a.message,a),r(a)}bt.elapsed(i,"[end] close channel",yield Qe({operationName:"SkyWayChannelImpl.close",channel:this})),n()})),this._updateMemberTtl=(n,r)=>this._channelImpl.updateMemberTtl(n,r),this._updateMemberMetadata=(n,r)=>this._channelImpl.updateMemberMetadata(n,r),this._publish=n=>this._channelImpl.publish(n),this._unpublish=n=>B(this,null,function*(){return this._channelImpl.unpublish(n)}),this._subscribe=(n,r)=>{const i=this._getPublication(r),a=this._getMember(n);if(a==null)throw we({operationName:"SkyWayChannelImpl._subscribe",path:bt.prefix,info:de(ee({},Ae.internal),{detail:"subscriber not found"}),channel:this,context:this._context,payload:{subscriberId:n,publicationId:r}});return this._channelImpl.subscribe({publication:i.toJSON(),subscriber:a.toJSON()})},this._unsubscribe=n=>B(this,null,function*(){if(!this._getSubscription(n))throw we({operationName:"SkyWayChannelImpl._unsubscribe",path:bt.prefix,info:de(ee({},Ae.internal),{detail:"can't unsubscribe not exist subscription"}),channel:this,context:this._context,payload:{subscriptionId:n}});yield this._channelImpl.unsubscribe(n)}),this._updatePublicationMetadata=(n,r)=>this._channelImpl.updatePublicationMetadata(n,r),this._disablePublication=n=>this._channelImpl.disablePublication(n),this._enablePublication=n=>this._channelImpl.enablePublication(n),this._setupPropertiesFromChannel(),this._setupListenChannelEvent(),e._onDisposed.once(()=>{this.dispose()}),bt.debug("channel spawned",this.toJSON())}_addMember(e){const t=this._getMember(e.id);if(t)return t;const n=this._context._createRemoteMember(this,e);return this._members[n.id]=n,n}_removeMember(e){delete this._members[e]}_addPublication(e){const t=this._getPublication(e.id);if(t)return t;const n=C4(this,e);return this._publications[e.id]=n,n}_removePublication(e){delete this._publications[e]}_addSubscription(e){const t=this._getSubscription(e.id);if(t)return t;const n=$4(this,e);return this._subscriptions[e.id]=n,n}_removeSubscription(e){delete this._subscriptions[e]}get localPerson(){return this._localPerson}get members(){return Object.values(this._members)}get bots(){return this.members.filter(e=>e.type==="bot")}get publications(){return Object.values(this._publications)}get subscriptions(){return Object.values(this._subscriptions)}get metadata(){return this._channelImpl.metadata}get state(){return this._state}toJSON(){return{id:this.id,name:this.name,appId:this.appId,metadata:this.metadata,members:this.members,publications:this.publications,subscriptions:this.subscriptions}}_setupPropertiesFromChannel(){this._channelImpl.members.forEach(e=>{this._addMember(e)}),this._channelImpl.publications.forEach(e=>{this._addPublication(e)}),this._channelImpl.subscriptions.forEach(e=>{this._addSubscription(e)})}_setupListenChannelEvent(){this._channelImpl.onClosed.add(()=>this._handleOnChannelClose()),this._channelImpl.onMetadataUpdated.add(({channel:e})=>this._handleOnChannelMetadataUpdate(e.metadata)),this._channelImpl.onMemberJoined.add(({member:e})=>{this._handleOnMemberJoin(e)}),this._channelImpl.onMemberLeft.add(({member:e})=>{this._handleOnMemberLeft(e)}),this._channelImpl.onMemberListChanged.pipe(this.onMemberListChanged),this._channelImpl.onMemberMetadataUpdated.add(({member:e})=>{this._handleOnMemberMetadataUpdate(e,e.metadata)}),this._channelImpl.onStreamPublished.add(({publication:e})=>{this._handleOnStreamPublish(e)}),this._channelImpl.onStreamUnpublished.add(({publication:e})=>{this._handleOnStreamUnpublish(e)}),this._channelImpl.onPublicationListChanged.pipe(this.onPublicationListChanged),this._channelImpl.onPublicationMetadataUpdated.add(({publication:e})=>{this._handleOnPublicationMetadataUpdate(e,e.metadata)}),this._channelImpl.onPublicationEnabled.add(e=>B(this,[e],function*({publication:t}){return yield this._handleOnPublicationEnabled(t)})),this._channelImpl.onPublicationDisabled.add(e=>B(this,[e],function*({publication:t}){return yield this._handleOnPublicationDisabled(t)})),this._channelImpl.onPublicationSubscribed.add(({subscription:e})=>{this._handleOnStreamSubscribe(e)}),this._channelImpl.onPublicationUnsubscribed.add(({subscription:e})=>{this._handleOnStreamUnsubscribe(e)}),this._channelImpl.onSubscriptionListChanged.pipe(this.onSubscriptionListChanged)}_handleOnChannelClose(){this._state="closed",this.onClosed.emit({}),this.dispose()}_handleOnChannelMetadataUpdate(e){this.onMetadataUpdated.emit({metadata:e})}_handleOnMemberJoin(e){const t=this._addMember(e);this.onMemberJoined.emit({member:t})}_handleOnMemberLeft(e){var t;const n=this._getMember(e.id);this._removeMember(n.id),n._left(),((t=this.localPerson)==null?void 0:t.id)===e.id&&(this.localPerson._left(),this._localPerson=void 0),this.onMemberLeft.emit({member:n})}_handleOnMemberMetadataUpdate(e,t){var n;const r=this._getMember(e.id);r._metadataUpdated(t),((n=this.localPerson)==null?void 0:n.id)===e.id&&this.localPerson._metadataUpdated(t),this.onMemberMetadataUpdated.emit({member:r,metadata:t})}_handleOnStreamPublish(e){const t=this._addPublication(e);this.onStreamPublished.emit({publication:t})}_handleOnStreamUnpublish(e){const t=this._getPublication(e.id);this._removePublication(t.id),t._unpublished(),this.onStreamUnpublished.emit({publication:t})}_handleOnPublicationMetadataUpdate(e,t){const n=this._getPublication(e.id);n._updateMetadata(t),this.onPublicationMetadataUpdated.emit({publication:n,metadata:t})}_handleOnPublicationEnabled(e){return B(this,null,function*(){const t=this._getPublication(e.id);t._enable(),this.onPublicationEnabled.emit({publication:t})})}_handleOnPublicationDisabled(e){return B(this,null,function*(){const t=this._getPublication(e.id);yield t._disable(),this.onPublicationDisabled.emit({publication:t})})}_handleOnStreamSubscribe(e){const t=this._addSubscription(e);this._getPublication(t.publication.id)._subscribed(t),this.onPublicationSubscribed.emit({subscription:t})}_handleOnStreamUnsubscribe(e){const t=this._getSubscription(e.id);this._removeSubscription(t.id),t._canceled(),this._getPublication(t.publication.id)._unsubscribed(t),this.onPublicationUnsubscribed.emit({subscription:t})}join(){return B(this,arguments,function*(e={}){var t,n,r;const i=bt.info("[start] join",yield Qe({operationName:"SkyWayChannelImpl.join",channel:this}));if(this._localPerson)throw we({operationName:"SkyWayChannelImpl.join",path:bt.prefix,info:Ae.alreadyLocalPersonExist,channel:this,context:this._context});if(e.name!=null&&this.members.find(y=>y.name===e.name))throw we({operationName:"SkyWayChannelImpl.join",path:bt.prefix,info:Ae.alreadySameNameMemberExist,channel:this,context:this._context,payload:e});(t=e.keepaliveIntervalSec)!=null||(e.keepaliveIntervalSec=this.config.member.keepaliveIntervalSec),(n=e.keepaliveIntervalGapSec)!=null||(e.keepaliveIntervalGapSec=this.config.member.keepaliveIntervalGapSec),(r=e.preventAutoLeaveOnBeforeUnload)!=null||(e.preventAutoLeaveOnBeforeUnload=this.config.member.preventAutoLeaveOnBeforeUnload);const a=de(ee({},e),{type:"person",subtype:"person"});e.keepaliveIntervalSec!==null&&(a.ttlSec=(yield this._context._api.getServerUnixtimeInSec())+e.keepaliveIntervalSec);const o=yield this._channelImpl.joinChannel(a).catch(h=>{throw bt.error("[failed] join",h),h});bt.elapsed(i,"[elapsed] join / channelImpl.joinChannel",{member:o});const u=yield this._createLocalPerson(o,e),p=new xg(u);return bt.elapsed(i,"[end] join",{person:u}),p})}moveChannel(e){return B(this,null,function*(){if(this._localPerson)throw we({operationName:"SkyWayChannelImpl.moveChannel",path:bt.prefix,info:Ae.alreadyLocalPersonExist,channel:this,context:this._context});if(!(e instanceof xg))throw we({operationName:"SkyWayChannelImpl.moveChannel",path:bt.prefix,info:Ae.invalidArgumentValue,channel:this,context:this._context});const t=e.channel;if(this.id===t.id)throw we({operationName:"SkyWayChannelImpl.moveChannel",path:bt.prefix,info:Ae.cantMoveSameIdChannel,channel:this,context:this._context});yield t.leave(e);const n={name:e.name,type:e.type,subtype:e.subtype,metadata:e.metadata};e.keepaliveIntervalSec!=null&&(n.ttlSec=(yield this._context._api.getServerUnixtimeInSec())+e.keepaliveIntervalSec);const r=yield this._channelImpl.joinChannel(n),i=yield this._createLocalPerson(r,{keepaliveIntervalSec:e.keepaliveIntervalSec,keepaliveIntervalGapSec:e.keepaliveIntervalGapSec,disableSignaling:e.disableSignaling,disableAnalytics:e.disableAnalytics});e.apply(i)})}_createLocalPerson(e,t){return B(this,null,function*(){const n=yield q4(this._context,this,e,t);return this._localPerson=n,n})}dispose(){this.disposed||(this.disposed=!0,bt.debug("disposed",this.toJSON()),this._channelImpl.dispose(),this._onDisposed.emit(),this._events.dispose())}},_f=class{static Create(e){return B(this,arguments,function*(t,n={}){const r=bt.info("[start] createChannel",{operationName:"SkyWayChannel.Create"}),i=yield t._api.createChannel(n).catch(o=>{throw bt.error("[failed] createChannel",o),o}),a=new Ud(t,i);return bt.elapsed(r,"[end] createChannel"),a})}static Find(e,t){return B(this,null,function*(){const n=bt.info("[start] findChannel",{operationName:"SkyWayChannel.Find"}),r=yield e._api.findChannel(t).catch(a=>{throw bt.error("[failed] findChannel",a),a}),i=new Ud(e,r);return bt.elapsed(n,"[end] findChannel"),i})}static FindOrCreate(e,t){return B(this,null,function*(){const n=bt.info("[start] findOrCreateChannel",{operationName:"SkyWayChannel.FindOrCreate"}),r=yield e._api.findOrCreateChannel(t).catch(a=>{throw bt.error("[failed] findOrCreateChannel",a),a}),i=new Ud(e,r);return bt.elapsed(n,"[end] findOrCreateChannel"),i})}constructor(){}};W();W();var W4=Xn(ay()),G4=class{constructor(e={}){this.rtcApi={domain:"rtc-api.skyway.ntt.com",timeout:3e4,secure:!0,eventSubscribeTimeout:5e3},this.iceParamServer={domain:"ice-params.skyway.ntt.com",version:1,secure:!0},this.signalingService={domain:"signaling.skyway.ntt.com",secure:!0},this.analyticsService={domain:"analytics-logging.skyway.ntt.com",secure:!0},this.rtcConfig={timeout:3e4,turnPolicy:"enable",turnProtocol:"all",encodedInsertableStreams:!1,iceDisconnectBufferTimeout:5e3},this.token={updateReminderSec:30},this.log={level:"error",format:"string"},this.internal={disableDPlane:!1},this.member={keepaliveIntervalGapSec:30,keepaliveIntervalSec:30,preventAutoLeaveOnBeforeUnload:!1},Object.assign(this,(0,W4.default)(this,e))}};W();W();W();W();W();W();var Z4="rtc-api.skyway.ntt.com",cs=2e4,J4=8;W();var bn={timeout:{name:"timeout",detail:"",solution:""},internalError:{name:"internalError",detail:"",solution:""},invalidParameter:{name:"invalidParameter",detail:"",solution:""},connectionDisconnected:{name:"connectionDisconnected",detail:"",solution:""},websocketConnectionFailure:{name:"connectionFailure",detail:"サーバへの接続に失敗しました",solution:"ネットワーク接続状況およびフリープランをご利用の場合はリソース利用量を確認してください"},rpcResponseError:{name:"rpcResponseError",detail:"",solution:"",error:{}},onClosedWhileRequesting:{name:"onClosedWhileRequesting",detail:"request中にクライアントが終了されました",solution:"リクエストの完了を確認してからクライアントを終了させてください"},failedToConnectRtcAPI:{name:"failedToConnectRtcAPI",detail:"rtc-api serverへの接続に失敗しました",solution:"インターネット接続状況とTokenの内容が正しいか、またフリープランをご利用の場合はリソース利用量を確かめてください"},failedToUpdateMemberTTL:{name:"failedToUpdateMemberTTL",detail:"updateMemberTTLを再試行しましたが、失敗しました",solution:"インターネット接続状況を確認してください"}};W();var Q4=Xn(sf());W();function qn({operationName:e,info:t,error:n,path:r,payload:i,channelId:a,appId:o,memberId:u}){return new Kn({error:n,info:t,payload:{payload:i,operationName:e,channelId:a,appId:o,memberId:u},path:r})}function Dr({appId:e,detail:t,channelId:n,operationName:r,payload:i,memberId:a}){return{operationName:r,payload:i,detail:t,appId:e,channelId:n,memberId:a}}var $t=new De("packages/rtc-rpc-api-client/src/rpc.ts"),X4=4291,Y4=class{constructor(){this._id=$r(),this.closed=!1,this.negotiated=!1,this._reconnecting=!1,this._pendingRequests=[],this._events=new ai,this._onMessage=this._events.make(),this.onNotify=this._events.make(),this.onFatalError=this._events.make(),this.onDisconnected=this._events.make(),this.onClosed=this._events.make(),this._send=e=>new Promise((t,n)=>B(this,null,function*(){if(yield new Promise(r=>setTimeout(r,0)),this._ws.readyState!==this._ws.OPEN){n(qn({operationName:"RPC._send",info:de(ee({},bn.internalError),{detail:"wrong state"}),path:$t.prefix,payload:{request:e,wsReadyState:Ag[this._ws.readyState]}}));return}this._ws.send(JSON.stringify(e),r=>{if(r)throw n(qn({operationName:"RPC._send",info:de(ee({},bn.internalError),{detail:"failed to send rpc message"}),path:$t.prefix,error:r}))}),t()}))}set reconnecting(e){this._reconnecting=e}get reconnecting(){return this._reconnecting}connect(e){return B(this,arguments,function*({domain:t,token:n,secure:r}){const i=n;this._ws=new Q4.default(`${r?"wss":"ws"}://${t}/ws`,i),this._ws.onmessage=o=>{this._onMessage.emit(JSON.parse(o.data))},this._ws.onclose=o=>B(this,null,function*(){$t.debug("websocket closed",{id:this._id,code:o.code,reason:o.reason}),o.code===X4?this.close():this.onDisconnected.emit()}),this._onMessage.add(o=>{eT(o)&&this.onNotify.emit(o)});const a=yield new Promise((o,u)=>{const p=setTimeout(()=>{u(qn({operationName:"RPC.connect",info:de(ee({},bn.timeout),{detail:"ws.open"}),path:$t.prefix}))},5e3);this._ws.onerror=h=>{u(qn({operationName:"RPC.connect",info:bn.websocketConnectionFailure,path:$t.prefix,error:h}))},this._ws.onopen=()=>{clearTimeout(p),o()}}).catch(o=>o);if(a)throw a;this.negotiated=!0})}close(){this.closed||(this.closed=!0,$t.debug("closed"),this._ws.close(),this.onClosed.emit(),this._events.dispose())}resolvePendingRequests(){$t.debug("resolve pendingRequests",[...this._pendingRequests]),this._pendingRequests.forEach(e=>B(this,null,function*(){yield this._send(e)})),this._pendingRequests=[]}request(e,t){return B(this,null,function*(){if(this.closed)throw qn({operationName:"RPC.request",info:de(ee({},bn.internalError),{detail:"rpc closed"}),path:$t.prefix,payload:{method:e,params:t,id:this._id}});let n=!1;try{const r=Hd(e,t),i=()=>B(this,null,function*(){return yield this._onMessage.watch(u=>u.id===r.id,cs).catch(()=>{if(!n)throw qn({operationName:"RPC.request",info:de(ee({},bn.timeout),{detail:"rpc request timeout"}),path:$t.prefix,payload:{rpcTimeout:cs,method:e,params:t,wsReadyState:Ag[this._ws.readyState],id:this._id}})})}),a=()=>B(this,null,function*(){$t.warn("[start] reconnecting. pending request",Dr({operationName:"RPC.request",detail:"[start] reconnecting. pending request",payload:{request:r,id:this._id}})),this._pendingRequests.push(r);const u=yield Promise.race([i(),this.onFatalError.asPromise(cs+100).then(p=>{throw n||$t.error("[failed] reconnecting. pending request",qn({operationName:"RPC.request",info:de(ee({},bn.internalError),{detail:"onFatalError while request"}),path:$t.prefix}),p),p})]);return n=!0,$t.warn("[end] reconnecting. pending request",Dr({operationName:"RPC.request",detail:"[end] reconnecting. pending request",payload:{request:r,id:this._id}})),u});let o;if(this._reconnecting?o=yield a():(this._send(r).catch(u=>{$t.error("send error",u)}),o=yield Promise.race([i(),B(this,null,function*(){if(yield this.onDisconnected.asPromise(cs+100),n)return{};try{const u=yield a();return $t.warn(Dr({operationName:"request.pendingRequest",detail:"success to handle disconnected"})),u}catch(u){throw qn({operationName:"RPC.request",info:bn.connectionDisconnected,path:$t.prefix,error:u})}}),this.onFatalError.asPromise(cs+100).then(u=>{if(n)return{};throw qn({operationName:"RPC.request",info:de(ee({},bn.internalError),{detail:"onFatalError while requesting"}),path:$t.prefix,error:u})}),this.onClosed.asPromise(cs+100).then(()=>{if(n)return{};throw qn({operationName:"RPC.request",info:bn.onClosedWhileRequesting,path:$t.prefix,payload:{method:e,params:t}})})]),n=!0),o.error)throw $t.warn("[failed] request ",{message:o,method:e,params:t}),qn({operationName:"RPC.request",info:de(ee({},bn.rpcResponseError),{detail:e,error:o.error}),payload:{message:o,method:e,params:t},path:$t.prefix});return o.result}catch(r){throw n=!0,r}})}notify(e,t){return B(this,null,function*(){const n=Hd(e,t,!0);yield this._send(n)})}batch(e){return B(this,null,function*(){const t=e.map(({method:r,params:i})=>Hd(r,i));return this._send(t).catch(r=>{throw r}),yield Promise.all(t.map(r=>B(this,[r],function*({id:i}){return yield this._onMessage.watch(o=>o.id===i,cs)})))})}},Hd=(e,t,n)=>{if(n)return{jsonrpc:"2.0",method:e,params:t};const r=$r();return{jsonrpc:"2.0",method:e,params:t,id:r}},eT=e=>{const t=e;return!!(t.method&&t.id==null)},Ag=["CONNECTING","OPEN","CLOSING","CLOSED"],Vt=new De("packages/rtc-rpc-api-client/src/client.ts"),Ig,Fg,tT=class{constructor(e){this.config=e,this.closed=!1,this._domain=(Ig=this.config.domain)!=null?Ig:Z4,this._secure=(Fg=this.config.secure)!=null?Fg:!0,this._token=this.config.token,this._rpc=new Y4,this._subscribingChannelEvents=new Set,this._subscribingChannelVersions={},this._httpClient=new ff(`http${this.config.secure?"s":""}://${this.config.domain}`),this._reconnectCount=0,this._reconnectLimit=J4,this._events=new ai,this.onEvent=this._events.make(),this.onFatalError=this._events.make(),this.onClose=this._events.make(),this.onReconnected=this._events.make();var t,n,r,i;De.level=(n=(t=e.log)==null?void 0:t.level)!=null?n:De.level,De.format=(i=(r=e.log)==null?void 0:r.format)!=null?i:De.format,Vt.debug("RtcRpcApiClient spawned",e),this._rpc.onNotify.add(a=>{if(a.method==="channelEventNotification"){const o=a.params;this._subscribingChannelVersions[o.data.channel.id]=o.data.channel.version,this.onEvent.emit({channelId:o.data.channel.id,event:o})}}),this._rpc.onDisconnected.add(()=>B(this,null,function*(){this._rpc.negotiated&&!this._rpc.closed&&!this._rpc.reconnecting&&(yield this._reconnect())})),this._rpc.onFatalError.once(a=>{Vt.error("fatal error",a),this.onFatalError.emit(a),this.close()})}get token(){return this._token}_reconnect(){return B(this,null,function*(){if(this._reconnectCount>=this._reconnectLimit){this._rpc.onFatalError.emit(qn({operationName:"RtcRpcApiClient._reconnect",info:{name:"failed to reconnect",detail:"_reconnectLimit exceeded",solution:""},path:Vt.prefix})),this.close();return}this._rpc.reconnecting=!0,Vt.warn("[start] reconnect",Dr({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect start",payload:{reconnectCount:this._reconnectCount,limit:this._reconnectLimit}})),this._reconnectCount++;const e=_i(this._reconnectCount,2)*100+_i(this._reconnectCount,2)*100*Math.random();yield new Promise(t=>setTimeout(t,e));try{yield this.connect().catch(t=>{throw Vt.warn("[failed] reconnect rtc api",Dr({operationName:"RtcRpcApiClient._reconnect",detail:"connect rpc failed",payload:{reconnectCount:this._reconnectCount}}),t),t}),this._rpc.reconnecting=!1,this._reconnectCount=0,this._rpc.resolvePendingRequests(),yield Promise.all([...this._subscribingChannelEvents].map(t=>B(this,null,function*(){const[n,r]=t.split(":"),i=this._subscribingChannelVersions[r];yield this.subscribeChannelEvents({appId:n,channelId:r,offset:i})}))).catch(t=>{throw Vt.warn("subscribeChannelEvents failed",Dr({operationName:"RtcRpcApiClient._reconnect",detail:"subscribeChannelEvents failed",payload:{reconnectCount:this._reconnectCount}}),t),t}),Vt.warn("[end] reconnect",Dr({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect finished",payload:{reconnectCount:this._reconnectCount}})),this.onReconnected.emit()}catch(t){Vt.warn("[failed] reconnect",Dr({operationName:"RtcRpcApiClient._reconnect",detail:"reconnect failed",payload:{reconnectCount:this._reconnectCount}}),t),yield this._reconnect()}})}updateToken(e){return B(this,null,function*(){Vt.debug("token update",{token:e}),this._token=e,yield this._updateAuthToken()})}close(){this.closed||(this.closed=!0,Vt.debug("closed"),this._rpc.close(),this.onClose.emit(),this._events.dispose())}health(){return B(this,null,function*(){return yield this._httpClient.get("/health")})}connect(){return B(this,null,function*(){Vt.debug("connect to rtc api rpc",this._domain),yield this._rpc.connect({domain:this._domain,token:this.token,secure:this._secure}).catch(e=>{throw qn({operationName:"RtcRpcApiClient.connect",info:bn.failedToConnectRtcAPI,error:e,path:Vt.prefix})})})}_channelSubscribed(e,t){this._subscribingChannelEvents.add(e+":"+t),Vt.debug("_channelSubscribed",{appId:e,channelId:t,_subscribingChannelEvents:[...this._subscribingChannelEvents]})}_isSubscribingChannel(e,t){return this._subscribingChannelEvents.has(e+":"+t)}createChannel(e){return B(this,arguments,function*({name:t,metadata:n,appId:r}){const{channel:i}=yield this._rpc.request("createChannel",{name:t,metadata:n,appId:r,authToken:this.token});return this._channelSubscribed(r,i.id),i})}findOrCreateChannel(e){return B(this,arguments,function*({name:t,metadata:n,appId:r}){const{channel:i}=yield this._rpc.request("findOrCreateChannel",{name:t,metadata:n,appId:r,authToken:this.token});return this._channelSubscribed(r,i.id),i})}getChannel(e){return B(this,arguments,function*({appId:t,id:n}){const r=yield this._rpc.request("getChannel",{id:n,appId:t,authToken:this.token});return this._isSubscribingChannel(t,n)||(this._channelSubscribed(t,n),yield this.subscribeChannelEvents({appId:t,channelId:n,offset:r.channel.version})),r.channel})}getChannelByName(e){return B(this,arguments,function*({name:t,appId:n}){const r=yield this._rpc.request("getChannelByName",{name:t,appId:n,authToken:this.token}),i=r.channel.id;return this._isSubscribingChannel(n,i)||(this._channelSubscribed(n,i),yield this.subscribeChannelEvents({appId:n,channelId:i,offset:r.channel.version})),r.channel})}deleteChannel(e){return B(this,arguments,function*({id:t,appId:n}){yield this._rpc.request("deleteChannel",{id:t,appId:n,authToken:this.token})})}updateChannelMetadata(e){return B(this,arguments,function*({id:t,metadata:n,appId:r}){yield this._rpc.request("updateChannelMetadata",{id:t,metadata:n,appId:r,authToken:this.token})})}addMember(e){return B(this,arguments,function*({channelId:t,name:n,metadata:r,subscribeChannelEvents:i,appId:a,ttlSec:o,subtype:u,type:p}){return yield this._rpc.request("addMember",{channelId:t,name:n,metadata:r,subscribeChannelEvents:i,appId:a,ttlSec:o&&parseInt(o.toString()),authToken:this.token,subtype:u,type:p})})}updateMemberTtl(e){return B(this,arguments,function*(t,n=new Mr({times:8})){const{appId:r,channelId:i,memberId:a,ttlSec:o}=t;try{yield this._rpc.request("updateMemberTtl",{appId:r,channelId:i,memberId:a,ttlSec:o&&parseInt(o.toString()),authToken:this.token})}catch(u){if(!n.exceeded)Vt.warn("retry updateMemberTtl",Dr({operationName:"RtcRpcApiClient.updateMemberTtl",detail:"retry updateMemberTtl",appId:r,channelId:i,memberId:a,payload:{backoff:n.count}}),u),yield n.wait(),yield this.updateMemberTtl(t,n);else throw new Kn({path:Vt.prefix,info:bn.failedToUpdateMemberTTL,error:u})}})}updateMemberMetadata(e){return B(this,arguments,function*({channelId:t,memberId:n,metadata:r,appId:i}){yield this._rpc.request("updateMemberMetadata",{channelId:t,memberId:n,metadata:r,appId:i,authToken:this.token})})}leaveChannel(e){return B(this,arguments,function*({channelId:t,id:n,appId:r}){yield this._rpc.request("removeMember",{channelId:t,id:n,appId:r,authToken:this.token})})}publishStream(e){return B(this,arguments,function*({appId:t,channelId:n,publisherId:r,contentType:i,metadata:a,origin:o,codecCapabilities:u,encodings:p,isEnabled:h}){return{publicationId:(yield this._rpc.request("publishStream",{channelId:n,publisherId:r,contentType:i[0].toUpperCase()+i.slice(1),metadata:a,origin:o,codecCapabilities:u,encodings:p==null?void 0:p.map(f=>({id:f.id})),isEnabled:h,appId:t,authToken:this.token})).id}})}disablePublication(e){return B(this,arguments,function*({channelId:t,publicationId:n,appId:r}){yield this._rpc.request("disablePublication",{channelId:t,appId:r,publicationId:n,authToken:this.token})})}enablePublication(e){return B(this,arguments,function*({channelId:t,publicationId:n,appId:r}){yield this._rpc.request("enablePublication",{channelId:t,appId:r,publicationId:n,authToken:this.token})})}updatePublicationMetadata(e){return B(this,arguments,function*({channelId:t,publicationId:n,appId:r,metadata:i}){yield this._rpc.request("updatePublicationMetadata",{channelId:t,publicationId:n,metadata:i,appId:r,authToken:this.token})})}unpublishStream(e){return B(this,arguments,function*({channelId:t,publicationId:n,appId:r}){yield this._rpc.request("unpublishStream",{channelId:t,publicationId:n,appId:r,authToken:this.token})})}subscribeStream(e){return B(this,arguments,function*({channelId:t,subscriberId:n,publicationId:r,appId:i}){return{subscriptionId:(yield this._rpc.request("subscribeStream",{channelId:t,subscriberId:n,publicationId:r,appId:i,authToken:this.token})).id}})}unsubscribeStream(e){return B(this,arguments,function*({channelId:t,subscriptionId:n,appId:r}){yield this._rpc.request("unsubscribeStream",{channelId:t,subscriptionId:n,appId:r,authToken:this.token})})}getServerUnixtime(e){return B(this,arguments,function*(t,n=new Mr({times:8})){const{appId:r}=t;try{return(yield this._rpc.request("getServerUnixtime",{appId:r,authToken:this.token})).unixtime}catch(i){if(n.exceeded)throw i;return Vt.warn(Dr({operationName:"RtcRpcApiClient.getServerUnixtime",detail:"retry getServerUnixtime",appId:r,payload:{backoff:n.count}}),i),yield n.wait(),this.getServerUnixtime(t,n)}})}_updateAuthToken(){return B(this,null,function*(){yield this._rpc.request("updateAuthToken",{authToken:this.token})})}subscribeChannelEvents(e){return B(this,arguments,function*({appId:t,channelId:n,offset:r}){try{Vt.debug("[start] subscribeChannelEvents",{offset:r}),yield this._rpc.request("subscribeChannelEvents",{appId:t,authToken:this.token,channelId:n,offset:r}),Vt.debug("[end] subscribeChannelEvents",{offset:r})}catch(i){if(i instanceof Kn&&i.info.name===bn.connectionDisconnected.name)Vt.warn("reconnect happened while subscribeChannelEvents. retry",Dr({operationName:"RtcRpcApiClient.subscribeChannelEvents",detail:"reconnect happened while subscribeChannelEvents. retry",appId:t,channelId:n,payload:{offset:r}}),i),yield this.subscribeChannelEvents({appId:t,channelId:n,offset:r});else throw Vt.error("[failed] subscribeChannelEvents",qn({operationName:"RtcRpcApiClient.subscribeChannelEvents",info:de(ee({},bn.internalError),{detail:"subscribeChannelEvents failed"}),path:Vt.prefix,error:i,payload:{offset:r},appId:t,channelId:n})),i}})}};W();W();var nT=Xn(ay()),rT=class{constructor(e={}){this.rtcApi={domain:"rtc-api.skyway.ntt.com",timeout:3e4,secure:!0,eventSubscribeTimeout:5e3},this.log={level:"error",format:"object"},Object.assign(this,(0,nT.default)(this,e))}};W();W();var je=de(ee({},bn),{invalidParameter:{name:"invalidParameter",detail:"",solution:""},notFound:{name:"notFound",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internalError:{name:"internalError",detail:"",solution:""},invalidRequestParameter:{name:"invalidRequestParameter",detail:"リクエストのパラメーターが正しくありません",solution:"API仕様を確認し正しい値を入力してください"},insufficientPermissions:{name:"insufficientPermissions",detail:"tokenの権限が不足しています Token permissions are insufficient",solution:"Tokenに必要な権限を加えてください Add the necessary permissions to the Token"},publicationNestedTooMuch:{name:"publicationNestedTooMuch",detail:"originが設定されているPublicationをPublicationのoriginに指定することは出来ません It is not possible to specify the origin of a publication for which Origin has been set",solution:"仕様上の制約なので解決法はありません There is no solution because it is a specification limitation"},channelNotFound:{name:"channelNotFound",detail:"参照しようとしたchannelは存在しません The channel you tried to reference does not exist.",solution:"channelIdやchannelNameが正しいか確かめてください Make sure that the Channel id and channel name are correct."},memberNotFound:{name:"memberNotFound",detail:"参照しようとしたMemberは存在しません The member you tried to reference does not exist.",solution:"memberIdやmemberNameが正しいか確かめてください Make sure that the member id and member name is correct."},publicationNotFound:{name:"publicationNotFound",detail:"参照しようとしたPublicationは存在しません The Publication you tried to reference does not exist.",solution:"publicationIdが正しいか確かめてください Make sure that the publication id is correct."},subscriptionNotFound:{name:"subscriptionNotFound",detail:"参照しようとしたSubscriptionは存在しません The Subscription you tried to reference does not exist.",solution:"subscriptionIdが正しいか確かめてください Make sure that the subscription id is correct."},operationConflicted:{name:"operationConflicted",detail:"与えられた名前のチャネルは、今までの競合する要求によって、すでに作成されています The channel with the given name has already been created by a conflicting request up to now",solution:"別の名前を使ってchannelを作成してください"},channelNameDuplicated:{name:"channelNameDuplicated",detail:"その名前のChannelはすでに存在します A channel with that name already exists",solution:"別の名前を使ってchannelを作成してください"},memberNameDuplicated:{name:"memberNameDuplicated",detail:"その名前のMemberはすでに存在します A member with that name already exists",solution:"別の名前を使ってmemberを作成してください"},subscriptionAlreadyExists:{name:"subscriptionAlreadyExists",detail:"PublicationはすでにSubscribeされています",solution:"publicationIdが正しいか確かめてください"},rateLimitExceeded:{name:"rateLimitExceeded",detail:"リソースを規定仕様以上に消費しています",solution:"リソースの消費量を減らしてください"},projectUsageLimitExceeded:{name:"projectUsageLimitExceeded",detail:"フリープランプロジェクトのリソース利用上限に達しています",solution:"エンタープライズプランにアップグレードしてください"},invalidAuthToken:{name:"invalidAuthToken",detail:"AuthTokenが無効です",solution:"適切なAuthTokenを使用してください"},authTokenExpired:{name:"authTokenExpired",detail:"AuthTokenが期限切れです",solution:"適切なExpを設定したAuthTokenを使用してください"},serverBusy:{name:"serverBusy",detail:"サービス側の問題です",solution:"しばらく時間を置いて再試行してください"}});W();function Dg({appId:e,detail:t,channelId:n,operationName:r,payload:i}){return{operationName:r,payload:i,detail:t,appId:e,channelId:n}}function Be({operationName:e,info:t,error:n,path:r,channelId:i,appId:a,payload:o}){return new Kn({error:n,info:t,payload:{payload:o,operationName:e,channelId:i,appId:a},path:r})}var We=new De("packages/rtc-api-client/src/infrastructure/api.ts"),iT=class{constructor(e){this._client=e,this.closed=!1,this.onClose=new Me,this.onFatalError=new Me,this._token=Xo.Decode(this._client.token),e.onClose.once(()=>{this.close()}),e.onFatalError.add(t=>{this.onFatalError.emit(t)})}connect(){return B(this,null,function*(){yield this._client.connect()})}updateAuthToken(e){return B(this,null,function*(){this._token=Xo.Decode(e),yield this._client.updateToken(e).catch(t=>{var n,r,i,a,o;const{info:u}=t;if(((r=(n=u==null?void 0:u.error)==null?void 0:n.data)==null?void 0:r.code)===429001)throw Be({operationName:"RtcApiImpl.updateAuthToken",path:We.prefix,info:je.projectUsageLimitExceeded,error:t});const p=this._commonError("RtcApiImpl.updateAuthToken",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,t);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 401:throw Be({operationName:"RtcApiImpl.updateAuthToken",path:We.prefix,info:je.invalidAuthToken,error:t});default:throw Be({operationName:"RtcApiImpl.updateAuthToken",path:We.prefix,info:je.internalError,error:t})}})})}close(){this.closed||(this.closed=!0,We.debug("closed"),this._client.close(),this.onClose.emit(),this.onClose.removeAllListeners())}_commonError(e,t,n){switch(t){case-32602:return Be({operationName:e,info:je.invalidRequestParameter,path:We.prefix,error:n});case-32603:return Be({operationName:e,info:je.internalError,path:We.prefix,error:n});case 403:case 4030:return Be({operationName:e,info:je.insufficientPermissions,path:We.prefix,error:n});case 429:return Be({operationName:e,info:je.rateLimitExceeded,path:We.prefix,error:n})}}createChannel(e,t){return B(this,null,function*(){const{id:n}=yield this._client.createChannel({appId:e,name:t.name,metadata:t.metadata}).catch(i=>{var a,o,u;const{info:p}=i,h=this._commonError("RtcApiImpl.createChannel",(o=(a=p==null?void 0:p.error)==null?void 0:a.code)!=null?o:-1,i);if(h)throw h;switch((u=p==null?void 0:p.error)==null?void 0:u.code){case 404:throw Be({operationName:"RtcApiImpl.createChannel",path:We.prefix,info:je.channelNotFound,error:i});case 409:throw Be({operationName:"RtcApiImpl.createChannel",path:We.prefix,info:je.channelNameDuplicated,error:i});default:throw Be({operationName:"RtcApiImpl.createChannel",path:We.prefix,info:je.internalError,error:i})}});return yield this.getChannel(e,{id:n})})}getChannel(e,t){return B(this,arguments,function*(n,{name:r,id:i}){if(i)return yield this._client.getChannel({appId:n,id:i}).catch(a=>{var o,u,p;const{info:h}=a,y=this._commonError("RtcApiImpl.getChannel",(u=(o=h==null?void 0:h.error)==null?void 0:o.code)!=null?u:-1,a);if(y)throw y;switch((p=h==null?void 0:h.error)==null?void 0:p.code){case 404:throw Be({operationName:"RtcApiImpl.getChannel",path:We.prefix,info:je.channelNotFound,error:a});default:throw Be({operationName:"RtcApiImpl.getChannel",path:We.prefix,info:je.internalError,error:a})}});if(r)return yield this._client.getChannelByName({appId:n,name:r}).catch(a=>{var o,u,p;const{info:h}=a,y=this._commonError("RtcApiImpl.getChannel",(u=(o=h==null?void 0:h.error)==null?void 0:o.code)!=null?u:-1,a);if(y)throw y;switch((p=h==null?void 0:h.error)==null?void 0:p.code){case 404:throw Be({operationName:"getChannel",path:We.prefix,info:je.channelNotFound,error:a});default:throw Be({operationName:"getChannel",path:We.prefix,info:je.internalError,error:a})}});throw Be({operationName:"RtcApiImpl.createChannel",path:We.prefix,info:je.invalidRequestParameter})})}findOrCreateChannel(e,t){return B(this,null,function*(){return this._client.findOrCreateChannel(de(ee({},t),{appId:e})).catch(n=>{var r,i,a,o;const{info:u}=n,p=this._commonError("RtcApiImpl.findOrCreateChannel",(i=(r=u==null?void 0:u.error)==null?void 0:r.code)!=null?i:-1,n);if(p)throw p;if(t.name&&((a=u==null?void 0:u.error)==null?void 0:a.code)===409)return this.getChannel(e,{name:t.name});switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 404:throw Be({operationName:"RtcApiImpl.findOrCreateChannel",path:We.prefix,info:je.channelNotFound,error:n});case 409:throw Be({operationName:"RtcApiImpl.findOrCreateChannel",path:We.prefix,info:je.channelNameDuplicated,error:n});default:throw Be({operationName:"RtcApiImpl.findOrCreateChannel",path:We.prefix,info:je.internalError,error:n})}})})}deleteChannel(e,t){return B(this,null,function*(){yield this._client.deleteChannel({appId:e,id:t}).catch(n=>{var r,i,a;const{info:o}=n,u=this._commonError("RtcApiImpl.deleteChannel",(i=(r=o==null?void 0:o.error)==null?void 0:r.code)!=null?i:-1,n);if(u)throw u;switch((a=o==null?void 0:o.error)==null?void 0:a.code){case 404:throw Be({operationName:"RtcApiImpl.deleteChannel",path:We.prefix,info:je.channelNotFound,error:n});default:throw Be({operationName:"RtcApiImpl.deleteChannel",path:We.prefix,info:je.internalError,error:n})}})})}updateChannelMetadata(e,t,n){return B(this,null,function*(){yield this._client.updateChannelMetadata({appId:e,id:t,metadata:n}).catch(r=>{var i,a,o;const{info:u}=r,p=this._commonError("RtcApiImpl.updateChannelMetadata",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,r);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 404:throw Be({operationName:"RtcApiImpl.updateChannelMetadata",path:We.prefix,info:je.channelNotFound,error:r});default:throw Be({operationName:"RtcApiImpl.updateChannelMetadata",path:We.prefix,info:je.internalError,error:r})}})})}join(e,t,n){return B(this,null,function*(){const{memberId:r}=yield this._client.addMember({appId:e,channelId:t,name:n.name,metadata:n.metadata,ttlSec:n.ttlSec,type:n.type,subtype:n.subtype}).catch(a=>{var o,u,p;const{info:h}=a,y=this._commonError("RtcApiImpl.addMember",(u=(o=h==null?void 0:h.error)==null?void 0:o.code)!=null?u:-1,a);if(y)throw y;switch((p=h==null?void 0:h.error)==null?void 0:p.code){case 404:throw Be({operationName:"RtcApiImpl.addMember",path:We.prefix,info:je.channelNotFound,error:a});case 409:throw Be({operationName:"RtcApiImpl.addMember",path:We.prefix,info:je.memberNameDuplicated,error:a});default:throw Be({operationName:"RtcApiImpl.addMember",path:We.prefix,info:je.internalError,error:a})}});return{id:r,name:n.name,type:n.type,subtype:n.subtype,metadata:n.metadata}})}updateMemberTtl(e,t,n,r){return B(this,null,function*(){yield this._client.updateMemberTtl({appId:e,channelId:t,memberId:n,ttlSec:r}).catch(i=>{var a,o,u;const{info:p}=i,h=this._commonError("RtcApiImpl.updateMemberTtl",(o=(a=p==null?void 0:p.error)==null?void 0:a.code)!=null?o:-1,i);if(h)throw h;switch((u=p==null?void 0:p.error)==null?void 0:u.code){case 404:throw Be({operationName:"RtcApiImpl.updateMemberTtl",path:We.prefix,info:je.memberNotFound,error:i});default:throw Be({operationName:"RtcApiImpl.updateMemberTtl",path:We.prefix,info:je.internalError,error:i})}})})}getServerUnixtime(e){return B(this,null,function*(){return yield this._client.getServerUnixtime({appId:e}).catch(t=>{var n,r;const{info:i}=t,a=this._commonError("RtcApiImpl.getServerUnixtime",(r=(n=i==null?void 0:i.error)==null?void 0:n.code)!=null?r:-1,t);throw a||Be({operationName:"RtcApiImpl.getServerUnixtime",path:We.prefix,info:je.internalError,error:t})})})}updateMemberMetadata(e,t,n,r){return B(this,null,function*(){yield this._client.updateMemberMetadata({appId:e,channelId:t,memberId:n,metadata:r}).catch(i=>{var a,o,u;const{info:p}=i,h=this._commonError("RtcApiImpl.updateMemberMetadata",(o=(a=p==null?void 0:p.error)==null?void 0:a.code)!=null?o:-1,i);if(h)throw h;switch((u=p==null?void 0:p.error)==null?void 0:u.code){case 404:throw Be({operationName:"RtcApiImpl.updateMemberMetadata",path:We.prefix,info:je.memberNotFound,error:i});default:throw Be({operationName:"RtcApiImpl.updateMemberMetadata",path:We.prefix,info:je.internalError,error:i})}})})}leave(e,t,n){return B(this,null,function*(){yield this._client.leaveChannel({channelId:t,id:n,appId:e}).catch(r=>{var i,a,o;const{info:u}=r,p=this._commonError("RtcApiImpl.leaveChannel",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,r);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 404:throw Be({operationName:"RtcApiImpl.leaveChannel",path:We.prefix,info:je.memberNotFound,error:r});default:throw Be({operationName:"RtcApiImpl.leaveChannel",path:We.prefix,info:je.internalError,error:r})}})})}publish(e,t){return B(this,null,function*(){const{publicationId:n}=yield this._client.publishStream({channelId:t.channel,publisherId:t.publisher,contentType:t.contentType,metadata:t.metadata,origin:t.origin,codecCapabilities:t.codecCapabilities,encodings:t.encodings,isEnabled:t.isEnabled,appId:e}).catch(r=>{var i,a,o;const{info:u}=r,p=this._commonError("RtcApiImpl.publish",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,r);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){default:throw Be({operationName:"RtcApiImpl.publish",path:We.prefix,info:je.internalError,error:r})}});return n})}updatePublicationMetadata(e,t,n,r){return B(this,null,function*(){yield this._client.updatePublicationMetadata({channelId:t,publicationId:n,metadata:r,appId:e}).catch(i=>{var a,o,u;const{info:p}=i,h=this._commonError("RtcApiImpl.updatePublicationMetadata",(o=(a=p==null?void 0:p.error)==null?void 0:a.code)!=null?o:-1,i);if(h)throw h;switch((u=p==null?void 0:p.error)==null?void 0:u.code){case 404:throw Be({operationName:"RtcApiImpl.updatePublicationMetadata",path:We.prefix,info:je.publicationNotFound,error:i});default:throw Be({operationName:"RtcApiImpl.updatePublicationMetadata",path:We.prefix,info:je.internalError,error:i})}})})}disablePublication(e,t,n){return B(this,null,function*(){yield this._client.disablePublication({channelId:t,publicationId:n,appId:e}).catch(r=>{var i,a,o;const{info:u}=r,p=this._commonError("RtcApiImpl.disablePublication",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,r);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 404:throw Be({operationName:"RtcApiImpl.disablePublication",path:We.prefix,info:je.publicationNotFound,error:r});default:throw Be({operationName:"RtcApiImpl.disablePublication",path:We.prefix,info:je.internalError,error:r})}})})}enablePublication(e,t,n){return B(this,null,function*(){yield this._client.enablePublication({channelId:t,publicationId:n,appId:e}).catch(r=>{var i,a,o;const{info:u}=r,p=this._commonError("RtcApiImpl.enablePublication",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,r);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 404:throw Be({operationName:"RtcApiImpl.enablePublication",path:We.prefix,info:je.publicationNotFound,error:r});default:throw Be({operationName:"RtcApiImpl.enablePublication",path:We.prefix,info:je.internalError,error:r})}})})}unpublish(e,t,n){return B(this,null,function*(){yield this._client.unpublishStream({channelId:t,publicationId:n,appId:e}).catch(r=>{var i,a,o;const{info:u}=r,p=this._commonError("RtcApiImpl.unpublishStream",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,r);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 404:throw Be({operationName:"RtcApiImpl.unpublishStream",path:We.prefix,info:je.publicationNotFound,error:r});default:throw Be({operationName:"RtcApiImpl.unpublishStream",path:We.prefix,info:je.internalError,error:r})}})})}subscribe(e,t){return B(this,null,function*(){const{subscriptionId:n}=yield this._client.subscribeStream({channelId:t.channel.id,subscriberId:t.subscriber.id,publicationId:t.publication.id,appId:e}).catch(r=>{var i,a,o;const{info:u}=r,p=this._commonError("RtcApiImpl.subscribeStream",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,r);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 404:throw Be({operationName:"RtcApiImpl.subscribeStream",path:We.prefix,info:je.publicationNotFound,error:r});case 409:throw Be({operationName:"RtcApiImpl.subscribeStream",path:We.prefix,info:je.subscriptionAlreadyExists,error:r});default:throw Be({operationName:"RtcApiImpl.subscribeStream",path:We.prefix,info:je.internalError,error:r})}});return n})}unsubscribe(e,t,n){return B(this,null,function*(){yield this._client.unsubscribeStream({appId:e,channelId:t,subscriptionId:n}).catch(r=>{var i,a,o;const{info:u}=r,p=this._commonError("RtcApiImpl.unsubscribeStream",(a=(i=u==null?void 0:u.error)==null?void 0:i.code)!=null?a:-1,r);if(p)throw p;switch((o=u==null?void 0:u.error)==null?void 0:o.code){case 404:throw Be({operationName:"RtcApiImpl.unsubscribeStream",path:We.prefix,info:je.publicationNotFound,error:r});default:throw Be({operationName:"RtcApiImpl.unsubscribeStream",path:We.prefix,info:je.internalError,error:r})}})})}};W();var ps=new De("packages/rtc-api-client/src/infrastructure/eventObserver.ts"),sT=class{constructor(e,t,n,r){this.onEvent=new Me,this._disposer=[];const i=new aT(n.version,a=>B(null,null,function*(){yield t.subscribeChannelEvents({appId:e,channelId:n.id,offset:a}),yield new Promise(o=>setTimeout(o,r.eventSubscribeTimeout)),i.packetLostHappened&&ps.error(Be({operationName:"EventObserverImpl.eventJitterBuffer",info:de(ee({},je.internalError),{detail:"failed to resolve event lost"}),channelId:n.id,appId:e,path:ps.prefix}))}));this._disposer=[t.onEvent.add(a=>B(this,[a],function*({channelId:o,event:u}){o===n.id&&i.push({event:u,version:u.data.channel.version})})).removeListener,i.onEvent.add(a=>{this.onEvent.emit(a)}).removeListener]}dispose(){this._disposer.forEach(e=>e()),this.onEvent.removeAllListeners()}},aT=class{constructor(e,t,n=1e3){this.presentVersion=e,this.onPacketLost=t,this.packetLifetime=n,this.onEvent=new Me,this.eventBuffer={},this.packetLostHappened=!1}get expectNextVersion(){return this.presentVersion+1}push(e){const t=e.version;if(t<this.expectNextVersion){ps.debug("duplicate event",de(ee({},e),{presentVersion:this.presentVersion}));return}if(t>this.expectNextVersion){ps.debug("maybe miss order event received",de(ee({},e),{presentVersion:this.presentVersion})),this.eventBuffer[t]=e,this.handlePacketLifetime();return}this.packetLostHappened&&(ps.warn("event packetLost resolved",Dg({operationName:"EventJitterBuffer.push",detail:"event packetLost resolved",payload:{eventFrame:e}})),this.packetLostHappened=!1),this.eventBuffer[t]=e,this.resolveEvents()}handlePacketLifetime(){const[e]=Object.keys(this.eventBuffer).sort().map(t=>this.eventBuffer[Number(t)]);this.packetLifeTimer==null&&e&&(ps.debug("set event packetLost timer",de(ee({},e),{presentVersion:this.presentVersion})),this.packetLifeTimer=setTimeout(()=>B(this,null,function*(){if(this.presentVersion<e.version){if(ps.warn("event packetLost",Dg({operationName:"EventJitterBuffer.handlePacketLifetime",detail:"eventPacket lost",payload:{oldestBufferedEvent:e,eventBufferLength:Object.keys(this.eventBuffer).length,presentVersion:this.presentVersion}})),this.packetLostHappened)return;this.packetLostHappened=!0,yield this.onPacketLost(this.expectNextVersion)}this.packetLifeTimer=void 0,this.handlePacketLifetime()}),this.packetLifetime))}resolveEvents(){const e=[];for(let t=this.expectNextVersion;;t++){const n=this.eventBuffer[t];if(n)e.push(n),delete this.eventBuffer[t];else break}e.length>0&&(this.presentVersion=e.slice(-1)[0].version,e.forEach(t=>{this.onEvent.emit(t.event)}))}},Rr=new De("packages/rtc-api-client/src/client.ts"),oT=class O_{constructor(t,n,r,i){this.appId=t,this.config=n,this.apiClient=r,this._eventObserverFactory=i,this.closed=!1,this.onFatalError=new Me,this.apiClient.onFatalError.pipe(this.onFatalError)}static Create(t){return B(this,null,function*(){const n=new rT(t);n.log&&(De.level=n.log.level,De.format=n.log.format),Rr.debug("RtcApiClient spawned",n);const r=new tT(de(ee({},n.rtcApi),{token:t.token,log:n.log})),i=new iT(r);yield i.connect();const a=(o,u)=>new sT(o,r,u,n.rtcApi);return new O_(t.appId,n,i,a)})}updateAuthToken(t){return B(this,null,function*(){yield this.apiClient.updateAuthToken(t)})}getServerUnixtimeInMs(){return B(this,null,function*(){return this.apiClient.getServerUnixtime(this.appId)})}getServerUnixtimeInSec(){return B(this,null,function*(){return Math.floor((yield this.getServerUnixtimeInMs())/1e3)})}createChannel(){return B(this,arguments,function*(t={}){Rr.debug("[start] apiClient.createChannel",{init:t});const n=yield this.apiClient.createChannel(this.appId,t).catch(i=>{throw Rr.debug("[failed] apiClient.createChannel",{init:t,e:i}),i});return Rr.debug("[end] apiClient.createChannel",{init:t,channelDto:n}),Vd(this.appId,this._eventObserverFactory(this.appId,n),this.apiClient,n,this.config)})}findChannel(t){return B(this,null,function*(){Rr.debug("[start] apiClient.getChannel",{query:t});const n=yield this.apiClient.getChannel(this.appId,t).catch(i=>{throw Rr.debug("[failed] apiClient.getChannel",{query:t,e:i}),i}),r=Vd(this.appId,this._eventObserverFactory(this.appId,n),this.apiClient,n,this.config);return Rr.debug("[end] apiClient.getChannel",{channelId:r.id}),r})}findOrCreateChannel(t){return B(this,null,function*(){Rr.debug("[start] apiClient.findOrCreateChannel",{query:t});const n=yield this.apiClient.findOrCreateChannel(this.appId,t).catch(i=>{throw Rr.debug("[failed] apiClient.findOrCreateChannel",{query:t,e:i}),i});return Rr.debug("[end] apiClient.findOrCreateChannel",{query:t}),Vd(this.appId,this._eventObserverFactory(this.appId,n),this.apiClient,n,this.config)})}deleteChannel(t){return this.apiClient.deleteChannel(this.appId,t)}close(){this.closed||(this.closed=!0,Rr.debug("closed",{appid:this.appId}),this.apiClient.close())}};W();W();var cT={};W();var pt=new De("packages/rtc-api-client/src/domain/channel.ts"),lT=class{constructor(e,{id:t,name:n,members:r,metadata:i,publications:a,subscriptions:o,version:u},p,h,y){this.appId=e,this.eventObserver=p,this.apiClient=h,this.config=y,this.disposed=!1,this._events=new ai,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.updateChannelMetadata=f=>new Promise((_,w)=>{let R=!1;this.apiClient.updateChannelMetadata(this.appId,this.id,f).catch(F=>{R=!0,w(F)}),this.onMetadataUpdated.watch(F=>F.channel.metadata===f).then(()=>_()).catch(F=>{R||w(Be({operationName:"ChannelImpl.updateChannelMetadata",info:de(ee({},je.timeout),{detail:"onMetadataUpdated"}),path:pt.prefix,error:F,appId:this.appId,channelId:this.id}))})}),this.leave=(f,_)=>new Promise((w,R)=>{let F=!1;this.apiClient.leave(this.appId,f,_).catch(S=>{F=!0,R(S)}),this.onMemberLeft.watch(S=>S.member.id===_,this.config.rtcApi.timeout).then(()=>w()).catch(S=>{F||R(Be({operationName:"ChannelImpl.leave",info:de(ee({},je.timeout),{detail:"onMemberLeft"}),path:pt.prefix,error:S,appId:this.appId,channelId:this.id}))})}),this.updateMemberMetadata=(f,_)=>new Promise((w,R)=>{let F=!1;this.apiClient.updateMemberMetadata(this.appId,this.id,f,_).catch(S=>{F=!0,R(S)}),this.onMemberMetadataUpdated.watch(S=>S.member.id===f&&S.member.metadata===_).then(()=>w()).catch(S=>{F||R(Be({operationName:"ChannelImpl.updateMemberMetadata",info:de(ee({},je.timeout),{detail:"onMemberMetadataUpdated"}),path:pt.prefix,error:S,appId:this.appId,channelId:this.id}))})}),this.unpublish=f=>new Promise((_,w)=>{let R=!1;this.apiClient.unpublish(this.appId,this.id,f).catch(F=>{R=!0,w(F)}),this.onStreamUnpublished.watch(F=>F.publication.id===f).then(()=>_()).catch(F=>{R||w(Be({operationName:"ChannelImpl.unpublish",info:de(ee({},je.timeout),{detail:"onStreamUnpublished"}),path:pt.prefix,error:F,payload:{publicationId:f},appId:this.appId,channelId:this.id}))})}),this.updatePublicationMetadata=(f,_)=>new Promise((w,R)=>{let F=!1;this.apiClient.updatePublicationMetadata(this.appId,this.id,f,_).catch(S=>{F=!0,R(S)}),this.onPublicationMetadataUpdated.watch(S=>S.publication.id===f&&S.publication.metadata===_).then(()=>w()).catch(S=>{F||R(Be({operationName:"ChannelImpl.updatePublicationMetadata",info:de(ee({},je.timeout),{detail:"onPublicationMetadataUpdated"}),path:pt.prefix,error:S,payload:{publicationId:f},appId:this.appId,channelId:this.id}))})}),this.disablePublication=f=>new Promise((_,w)=>{let R=!1;this.apiClient.disablePublication(this.appId,this.id,f).catch(F=>{R=!0,w(F)}),this.onPublicationDisabled.watch(F=>F.publication.id===f).then(()=>_()).catch(F=>{R||w(Be({operationName:"ChannelImpl.disablePublication",info:de(ee({},je.timeout),{detail:"onPublicationDisabled"}),path:pt.prefix,error:F,payload:{publicationId:f},appId:this.appId,channelId:this.id}))})}),this.enablePublication=f=>new Promise((_,w)=>{let R=!1;this.apiClient.enablePublication(this.appId,this.id,f).catch(F=>{R=!0,w(F)}),this.onPublicationEnabled.watch(F=>F.publication.id===f).then(()=>_()).catch(F=>{R||w(Be({operationName:"ChannelImpl.enablePublication",info:de(ee({},je.timeout),{detail:"onPublicationEnabled"}),path:pt.prefix,error:F,payload:{publicationId:f},appId:this.appId,channelId:this.id}))})}),this.unsubscribe=f=>new Promise((_,w)=>{let R=!1;this.apiClient.unsubscribe(this.appId,this.id,f).catch(F=>{R=!0,w(F)}),this.onPublicationUnsubscribed.watch(F=>F.subscription.id===f).then(()=>_()).catch(F=>{R||w(Be({operationName:"ChannelImpl.unsubscribe",info:de(ee({},je.timeout),{detail:"onPublicationUnsubscribed"}),path:pt.prefix,error:F,payload:{subscriptionId:f},appId:this.appId,channelId:this.id}))})}),this.id=t,this.name=n,this.metadata=i,this.members=r,this.publications=a,this.subscriptions=o,this.version=u,p.onEvent.add(f=>{pt.debug("received event: ",f),this.version=f.data.channel.version;try{switch(f.type){case"ChannelDeleted":this._channelClosed();break;case"ChannelMetadataUpdated":this._channelMetadataUpdated(f.data);break;case"MemberAdded":this._memberJoined(f.data);break;case"MemberRemoved":this._memberLeft(f.data);break;case"MemberMetadataUpdated":this._memberMetadataUpdated(f.data);break;case"StreamPublished":this._streamPublished(f.data);break;case"StreamUnpublished":this._streamUnpublished(f.data);break;case"PublicationMetadataUpdated":this._publicationMetadataUpdated(f.data);break;case"PublicationDisabled":this._publicationDisabled(f.data);break;case"PublicationEnabled":this._publicationEnabled(f.data);break;case"StreamSubscribed":this._streamSubscribed(f.data);break;case"StreamUnsubscribed":this._streamUnsubscribed(f.data);break}}catch(_){pt.error(_)}}),h.onClose.once(()=>{this.dispose()})}getMember(e){return this.members.find(t=>t.id===e)}addMember(e){const t=this.getMember(e.id);return t||(this.members.push(e),e)}deleteMember(e){this.members=this.members.filter(t=>t.id!==e)}getPublication(e){return this.publications.find(t=>t.id===e)}addPublication(e){var t,n;const r=this.getPublication(e.id);if(r)return r;const i=de(ee({},e),{channelId:this.id,codecCapabilities:(t=e.codecCapabilities)!=null?t:[],encodings:(n=e.encodings)!=null?n:[]});return this.publications.push(i),i}deletePublication(e){this.publications=this.publications.filter(t=>t.id!==e)}getSubscription(e){return this.subscriptions.find(t=>t.id===e)}addSubscription(e){const t=this.getSubscription(e.id);if(t)return t;const n=this.getPublication(e.publicationId),r=de(ee({},e),{channelId:this.id,publisherId:n.publisherId,contentType:n.contentType});return this.subscriptions.push(r),r}deleteSubscription(e){this.subscriptions=this.subscriptions.filter(t=>t.id!==e)}_channelClosed(){this.onClosed.emit({})}_channelMetadataUpdated(e){this.metadata=e.channel.metadata,this.onMetadataUpdated.emit(e)}_memberJoined(e){this.addMember(e.member),this.onMemberJoined.emit(e),this.onMemberListChanged.emit({})}_memberLeft(e){const t=this.getMember(e.member.id);if(!t)throw Be({operationName:"ChannelImpl._memberLeft",info:je.memberNotFound,path:pt.prefix,payload:{event:e},appId:this.appId,channelId:this.id});this.deleteMember(t.id),this.onMemberLeft.emit({member:t}),this.onMemberListChanged.emit({})}_memberMetadataUpdated(e){const t=this.getMember(e.member.id);if(!t)throw Be({operationName:"ChannelImpl._memberMetadataUpdated",info:je.memberNotFound,path:pt.prefix,payload:{event:e},appId:this.appId,channelId:this.id});t.metadata=e.member.metadata,this.onMemberMetadataUpdated.emit(e)}_streamPublished(e){const t=this.addPublication(e.publication),n=de(ee({},e),{publication:t});this.onStreamPublished.emit(n),this.onPublicationListChanged.emit({})}_streamUnpublished(e){const t=this.getPublication(e.publication.id);if(!t)throw Be({operationName:"ChannelImpl._streamUnpublished",info:je.publicationNotFound,path:pt.prefix,payload:{event:e},appId:this.appId,channelId:this.id});this.deletePublication(t.id);const n=de(ee({},e),{publication:t});this.onStreamUnpublished.emit(n),this.onPublicationListChanged.emit({})}_publicationMetadataUpdated(e){const t=this.getPublication(e.publication.id);if(!t)throw Be({operationName:"ChannelImpl._publicationMetadataUpdated",info:je.publicationNotFound,path:pt.prefix,payload:{event:e},appId:this.appId,channelId:this.id});t.metadata=e.publication.metadata;const n=de(ee({},e),{publication:t});this.onPublicationMetadataUpdated.emit(n)}_publicationDisabled(e){const t=this.getPublication(e.publication.id);if(!t)throw Be({operationName:"ChannelImpl._publicationDisabled",info:je.publicationNotFound,path:pt.prefix,payload:{event:e},appId:this.appId,channelId:this.id});t.isEnabled=e.publication.isEnabled;const n={publication:t};this.onPublicationDisabled.emit(n)}_publicationEnabled(e){const t=this.getPublication(e.publication.id);if(!t)throw Be({operationName:"ChannelImpl._publicationEnabled",info:je.publicationNotFound,path:pt.prefix,payload:{event:cT},appId:this.appId,channelId:this.id});t.isEnabled=e.publication.isEnabled;const n={publication:t};this.onPublicationEnabled.emit(n)}_streamSubscribed(e){const t=this.addSubscription(e.subscription),n=de(ee({},e),{subscription:t});this.onPublicationSubscribed.emit(n),this.onSubscriptionListChanged.emit({})}_streamUnsubscribed(e){const t=this.getSubscription(e.subscription.id);if(!t)throw Be({operationName:"ChannelImpl._streamUnsubscribed",info:je.subscriptionNotFound,path:pt.prefix,payload:{event:e},appId:this.appId,channelId:this.id});this.deleteSubscription(t.id);const n=de(ee({},e),{subscription:t});this.onPublicationUnsubscribed.emit(n),this.onSubscriptionListChanged.emit({})}joinChannel(e){return B(this,null,function*(){var t;e.type&&(e.type=e.type[0].toUpperCase()+e.type.slice(1)),e.subtype&&(e.subtype=e.subtype[0].toUpperCase()+e.subtype.slice(1)),pt.debug("[start] joinChannel",{memberInit:e});const n=yield this.apiClient.join(this.appId,this.id,ee({},e)),r=(t=this.getMember(n.id))!=null?t:(yield this.onMemberJoined.watch(i=>i.member.id===n.id,this.config.rtcApi.timeout).catch(i=>{throw Be({operationName:"ChannelImpl.joinChannel",info:de(ee({},je.timeout),{detail:"onMemberJoined"}),path:pt.prefix,error:i,appId:this.appId,channelId:this.id})})).member;return pt.debug("[end] joinChannel",{member:r}),r})}updateMemberTtl(e,t){return this.apiClient.updateMemberTtl(this.appId,this.id,e,t)}publish(e){return B(this,null,function*(){var t,n,r;const i=pt.debug("[start] apiClient.publish",{init:e}),a=this.id,o=yield this.apiClient.publish(this.appId,de(ee({},e),{channel:a})),u={id:o,channelId:a,publisherId:e.publisher,origin:e.origin,contentType:e.contentType,metadata:e.metadata,codecCapabilities:(t=e.codecCapabilities)!=null?t:[],encodings:(n=e.encodings)!=null?n:[],isEnabled:(r=e.isEnabled)!=null?r:!0};pt.elapsed(i,"[ongoing] apiClient.publish",{publicationDto:u});const p=this.getPublication(o);if(p)return p;const{publication:h}=yield this.onStreamPublished.watch(y=>y.publication.id===o,this.config.rtcApi.timeout).catch(y=>{throw Be({operationName:"ChannelImpl.publish",info:de(ee({},je.timeout),{detail:"onStreamPublished"}),path:pt.prefix,error:y,payload:{publicationDto:u},appId:this.appId,channelId:this.id})});return pt.elapsed(i,"[end] apiClient.publish",{publicationDto:u}),h})}subscribe(e){return B(this,null,function*(){const t=pt.debug("[start] apiClient.subscribe",{init:e}),n=yield this.apiClient.subscribe(this.appId,de(ee({},e),{channel:this})),r={id:n,publicationId:e.publication.id,channelId:this.id,publisherId:e.publication.publisherId,subscriberId:e.subscriber.id,contentType:e.publication.contentType};pt.elapsed(t,"[ongoing] apiClient.subscribe",{subscriptionDto:r});const i=this.getSubscription(n);if(i)return pt.elapsed(t,"[end] apiClient.subscribe",{subscriptionDto:r}),i;const{subscription:a}=yield this.onPublicationSubscribed.watch(o=>o.subscription.id===n,this.config.rtcApi.timeout).catch(o=>{throw pt.elapsed(t,"[fail] apiClient.subscribe",o),Be({operationName:"ChannelImpl.subscribe",info:de(ee({},je.timeout),{detail:"onPublicationSubscribed"}),path:pt.prefix,error:o,payload:{subscriptionDto:r}})});return pt.elapsed(t,"[end] apiClient.subscribe",{subscriptionDto:r}),a})}close(){return this.apiClient.deleteChannel(this.appId,this.id)}dispose(){this.disposed||(this.disposed=!0,pt.debug("disposed",{id:this.id}),this.eventObserver.dispose(),this._events.dispose())}};function Vd(e,t,n,r,i){return new lT(e,r,t,n,i)}W();W();W();W();var Ti=class{constructor(e,t){this.id=$r(),this.type=e,this.payload=t}toJSON(){return{id:this.id,type:this.type,payload:this.payload}}};W();function uT(e){return!(typeof e!="object"||e===null||Array.isArray(e))}function dT(e){if(!e||typeof e!="object"||!e.statsRequest||typeof e.statsRequest!="object"||!e.statsRequest.intervalSec||typeof e.statsRequest.intervalSec!="number"||!e.statsRequest.types||!Array.isArray(e.statsRequest.types))return!1;for(const t of e.statsRequest.types){if(!t.type||typeof t.type!="string"||!t.properties||!uT(t.properties))return!1;for(const n of Object.keys(t.properties))if(!("normalization"in t.properties[n])||typeof t.properties[n].normalization!="boolean"||!t.properties[n].outputKey||typeof t.properties[n].outputKey!="string")return!1}return!0}var hT=["invalidPayload","unexpected"];function Ng(e){return!(!e||typeof e!="object"||typeof e.eventId!="string"||typeof e.ok!="boolean"||typeof e.reason<"u"&&(typeof e.reason!="string"||!hT.includes(e.reason)))}W();var qd=Xn(sf());W();var Li=class{constructor(){this._listeners=new Map,this._listenerIndex=0,this.emit=e=>{this._listeners.forEach(t=>t(e))},this.removeAllListeners=()=>{this._listeners.clear()},this.addListener=e=>{const t=this._listenerIndex;return this._listeners.set(t,e),this._listenerIndex++,{removeListener:()=>{this._listeners.delete(t)}}},this.addOneTimeListener=e=>{const t=this.addListener(n=>{t.removeListener(),e(n)});return t},this.asPromise=e=>new Promise((t,n)=>{let r=()=>{};const i=e&&setTimeout(()=>{n("Event asPromise timeout"),r()},e);r=this.addOneTimeListener(o=>{i&&clearTimeout(i),t(o)}).removeListener})}},pT=["Open","Acknowledge"],fT=e=>(_i(2,e)+Math.random())*1e3,mT=class{constructor({sessionEndpoint:e,token:t,logger:n,sdkVersion:r,contextId:i}){this._isOpen=!1,this._isClosed=!1,this._reconnectCount=0,this.connectionState="connecting",this.onConnectionStateChanged=new Li,this.onOpened=new Li,this.onTokenExpired=new Li,this.onEventReceived=new Li,this.onConnectionFailed=new Li,this._resendClientEvents=[],this._sessionEndpoint=e,this._token=t,this._logger=n,this._sdkVersion=r,this._contextId=i,this._connect()}_setConnectionState(e){this.connectionState!==e&&(this._logger.debug(`connectionState changed : ${e}`),this.connectionState=e,this.onConnectionStateChanged.emit(e))}_connect(){let e;try{const t=`SkyWayAuthToken!${this._token}`,n={sdkPlatform:"js",sdkVersion:this._sdkVersion,contextId:this._contextId},r=Object.entries(n).filter(([a,o])=>o!==void 0).map(a=>a.join("=")).join("&"),i=`${this._sessionEndpoint}?${r}`;e=new qd.default(i,t),this._logger.debug(`Connecting to analytics-logging-server: ${this._sessionEndpoint}`),e.onerror=a=>{this._logger.error("WebSocket error occurred",a.error),e.close(4202)}}catch(t){const n=t instanceof Error?t:new Error;this._logger.error("Failed to create WebSocket instance",n),this.reconnect();return}e.onopen=()=>{this._logger.debug("Connected to analytics-logging-server")},e.onclose=t=>{const n="Close event fired: "+JSON.stringify({code:t.code,reason:t.reason,type:t.type});if(4100<=t.code&&t.code<=4199||t.code===1009?this._logger.error(n,new Error):this._logger.debug(n),t.code!==1e3&&t.code!==1009&&!(4e3<=t.code&&t.code<=4199)){t.code===4200?this.onTokenExpired.emit():this.reconnect();return}this._logger.debug("Closed the connection to analytics-logging-server"),this.onConnectionFailed.emit({code:t.code,reason:t.reason}),this.close()},e.onmessage=t=>{this._messageHandler(t.data)},this._ws=e}updateAuthToken(e){this._token=e}reconnect(){if(this._ws!==void 0&&this._ws.close(4e3),this._ws=void 0,this._isOpen=!1,this._reconnectCount>=5)this.onConnectionFailed.emit({}),this.close(),this._logger.error("Failed to reconnect for five times",new Error);else{this._setConnectionState("reconnecting");const e=fT(this._reconnectCount);this._reconnectTimer=setTimeout(()=>{this._connect(),this._reconnectCount++,this._logger.debug(`Try to reconnect: count = ${this._reconnectCount}`)},e)}}close(){this._isClosed=!0,this.destroy()}destroy(){this._setConnectionState("closed"),this.onConnectionStateChanged.removeAllListeners(),this.onOpened.removeAllListeners(),this.onEventReceived.removeAllListeners(),this.onConnectionFailed.removeAllListeners(),this._reconnectTimer&&clearTimeout(this._reconnectTimer),this._ws!==void 0&&this._ws.close(1e3)}send(e){return B(this,null,function*(){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==qd.default.OPEN){this._logger.debug("Try to reconnect because connection is lost"),this.resendAfterReconnect(e);return}const t=JSON.stringify(e.toJSON());this._ws.send(t,n=>{if(n){this._logger.debug(`Try to reconnect because failed to send: ${n.message}`),this.resendAfterReconnect(e);return}})})}resendAfterReconnect(e){this._resendClientEvents.some(n=>n.id===e.id)||this._resendClientEvents.push(e),this.connectionState!=="reconnecting"&&this.reconnect()}pushResendClientEventsQueue(e){this._resendClientEvents.push(e)}isClosed(){return this._isClosed}_messageHandler(e){if(typeof e!="string"){this._logger.error("Received invalid message: not string",new Error);return}let t;try{t=JSON.parse(e)}catch(n){const r=n instanceof Error?n:new Error;this._logger.error("Received invalid message: parse error",r);return}if(!gT(t)){this._logger.error(`Received invalid message: ${JSON.stringify(t)}`,new Error);return}if(t.type==="Open"){if(!dT(t.payload)){this._logger.error(`Received invalid message: ${JSON.stringify(t.payload)}`,new Error);return}if(this._logger.debug("Received a open event"),this._isOpen=!0,this._setConnectionState("connected"),this._reconnectCount!==0&&(this._reconnectCount=0,this._logger.debug("Succeeded to reconnect")),this._resendClientEvents.length>0){for(const n of this._resendClientEvents){if(this._ws===void 0||!this._isOpen||this._ws.readyState!==qd.default.OPEN){this._logger.error(`Failed to resend event because connection lost after reconnect: ${n}`,new Error);continue}const r=JSON.stringify(n.toJSON());this._ws.send(r,i=>{if(i){this._logger.error(`Failed to resend event: ${n}`,i);return}this._logger.debug(`Succeed to resend ClientEvent: ${n}`)})}this._logger.debug("Process of resending ClientEvents is completed"),this._resendClientEvents=[]}this.onOpened.emit(t.payload)}else this._logger.debug(`Received the event: ${t.type}, payload: ${JSON.stringify(t.payload)}`),this.onEventReceived.emit(t)}};function gT(e){return!(!e||typeof e!="object"||typeof e.type!="string"||!pT.includes(e.type)||typeof e.id!="string"||e.payload&&typeof e.payload!="object")}W();var vT=class{constructor(e={}){this.count=0,this.times=8,this.interval=100,this.jitter=0,Object.assign(this,e)}wait(){return B(this,null,function*(){if(this.exceeded)return!1;const e=this.timeout;return this.count++,yield new Promise(t=>setTimeout(t,e)),!0})}get timeout(){return _i(this.count,2)*this.interval+_i(this.count,2)*this.jitter*Math.random()}get exceeded(){return this.count>=this.times}reset(){this.count=0}stop(){this.count=this.times}},Og="analytics-logging.skyway.ntt.com",yT="v2",_T=5,M_=class L_{constructor({token:t,sdkVersion:n,contextId:r},i){this.onConnectionStateChanged=new Li,this.onConnectionFailed=new Li,this.onAnalyticsNotEnabledError=new Li,this._isClosed=!1,this._responseCallbacks=new Map,this._acknowledgeCallbacks=new Map,this._mediaDeviceVersion=new Map,this._encodingsVersion=new Map,this._preferredEncodingVersion=new Map,this._previousSubscriptionStats=new Map,this._statsRequest={intervalSec:5,types:[]},this._pendingSdkLogs=[],this._token=t,this._newToken=void 0,this._sdkVersion=n,this._contextId=r;const a={analyticsLoggingServerDomain:Og,secure:!0,logger:{debug:(o,...u)=>{console.debug(o,...u)},warn:(o,...u)=>{console.warn(o,...u)},error:o=>{console.error(o)}}};this._options=Object.assign({},a,i??{}),this._logger=this._options.logger,this._logger.debug(`Created instance with the options: ${this._options}`),this._sdkLogTimer=setInterval(()=>{if(this._pendingSdkLogs.length>0){const o=this._pendingSdkLogs.splice(0,this._pendingSdkLogs.length);this.sendSdkLogReport(o).catch(u=>{this._logger.warn("sendSdkLogReport (interval) failed",u)})}},5*1e3)}get connectionState(){var t,n;return(n=(t=this._socket)==null?void 0:t.connectionState)!=null?n:"closed"}connect(){return B(this,null,function*(){const t=this._options.secure?"wss":"ws",n=this._options.analyticsLoggingServerDomain||Og;this._socket=new mT({sessionEndpoint:`${t}://${n}/${yT}/client/ws`,contextId:this._contextId,token:this._token,logger:this._logger,sdkVersion:this._sdkVersion}),this._socket.onEventReceived.addListener(i=>{try{this._eventReceivedHandler(i)}catch(a){this._logger.error("in _eventReceivedHandler",a)}}),this._socket.onConnectionFailed.addListener(i=>{i.code===4e3&&this.onAnalyticsNotEnabledError.emit(i),this.onConnectionFailed.emit(),this.dispose()}),this._socket.onConnectionStateChanged.addListener(i=>{var a;i==="closed"&&!this.isClosed()&&((a=this._socket)!=null&&a.isClosed())&&(this._isClosed=!0,this.dispose()),this.onConnectionStateChanged.emit(i)}),this._socket.onTokenExpired.addListener(()=>{this._reconnectWithNewSkyWayAuthToken()});const r=yield this._socket.onOpened.asPromise();if(r!==void 0){this._statsRequest=r.statsRequest;return}else{this._logger.error("First time connection payload is undefined",new Error),this.onConnectionFailed.emit();return}})}bufferOrSendSdkLog(t){const n=t.level==="warn"||t.level==="error";if(this._pendingSdkLogs.push(t),n||this._pendingSdkLogs.length>=L_.MAX_PENDING_SDK_LOGS){const r=[...this._pendingSdkLogs];this._pendingSdkLogs.length=0,this.sendSdkLogReport(r).catch(i=>{this._logger.warn("sendSdkLogReport failed",i)})}}dispose(){clearInterval(this._sdkLogTimer),this._disconnect(),this._cleanupAnalyticsClientMaps()}setNewSkyWayAuthToken(t){this._socket!==void 0&&(this._newToken=t,this._logger.debug("setNewSkyWayAuthToken is success"))}cleanupOnUnpublished(t){this._mediaDeviceVersion.delete(t),this._encodingsVersion.delete(t)}cleanupOnUnsubscribed(t){this._preferredEncodingVersion.delete(t),this._previousSubscriptionStats.delete(t)}_disconnect(){var t;(t=this._socket)==null||t.destroy(),this._socket=void 0,this._responseCallbacks.clear(),this._acknowledgeCallbacks.clear()}sendMediaDeviceReport(t){return B(this,null,function*(){let n=this._mediaDeviceVersion.get(t.publicationId);n===void 0?n=0:n++,this._mediaDeviceVersion.set(t.publicationId,n);const r={publicationId:t.publicationId,mediaDeviceName:t.mediaDeviceName,mediaDeviceVersion:n,mediaDeviceTrigger:t.mediaDeviceTrigger,updatedAt:t.updatedAt},i=new Ti("MediaDeviceReport",r);yield this._sendClientEvent(i).catch(a=>{this._logger.warn("_sendClientEvent in sendMediaDeviceReport is failed",a)})})}sendSdkLogReport(t){return B(this,null,function*(){if(t.length===0)return;const n=t.map(i=>({timestamp:i.timestamp,level:i.level,message:Array.isArray(i.message)?i.message.map(a=>typeof a=="string"?a:JSON.stringify(a)).join(","):String(i.message)})),r=new Ti("SdkLog",{sdkLogs:n,contextId:this._contextId});yield this._sendClientEvent(r).catch(i=>{this._logger.warn("_sendClientEvent in sendSdkLogReport is failed",i)})})}sendBindingRtcPeerConnectionToSubscription(t){return B(this,null,function*(){const n=new Ti("BindingRtcPeerConnectionToSubscription",t);yield this._sendClientEvent(n).catch(r=>{this._logger.warn("_sendClientEvent in sendBindingRtcPeerConnectionToSubscription is failed",r)})})}filterStatsReport(t){const n=Array.from(t.values()).find(o=>o.type==="transport"&&o.dtlsState==="connected"),r=[];if(n){const o=Array.from(t.values()).find(u=>u.type==="candidate-pair"&&u.nominated&&u.id===(n==null?void 0:n.selectedCandidatePairId));o&&r.push(o.id,o.localCandidateId,o.remoteCandidateId,o.transportId)}else{const o=Array.from(t.values()).find(u=>u.type==="candidate-pair"&&u.nominated&&u.selected);o&&r.push(o.id,o.localCandidateId,o.remoteCandidateId,o.transportId)}const i=new Map,a=["candidate-pair","local-candidate","remote-candidate","transport"];for(const[o,u]of t.entries())a.includes(u.type)?r.includes(u.id)&&i.set(o,u):i.set(o,u);return i}bundleStatsReportByStatsType(t){const n={};for(const r of t.values())n[r.type]=r;return n}sendSubscriptionStatsReport(t,n){return B(this,null,function*(){var r;const i=this._previousSubscriptionStats.get(n.subscriptionId);if(this._previousSubscriptionStats.set(n.subscriptionId,{stats:t,createdAt:n.createdAt}),i===void 0)return;const a=this.filterStatsReport(i.stats),o=this.bundleStatsReportByStatsType(a),u=i.createdAt,p=(n.createdAt-u)/1e3;if(p<=0)throw new Error("duration must be greater than 0. also sendSubscriptionStatsReport was duplicated.");const h=this.filterStatsReport(t),y=this.bundleStatsReportByStatsType(h),f={};for(const{type:R,properties:F}of this._statsRequest.types)for(const[S,{normalization:b,outputKey:x,contentType:k}]of Object.entries(F)){if(!k.includes(n.contentType))continue;const L=y[R];if(!(L===void 0||L[S]===void 0))if(b){const G=(r=o[R])==null?void 0:r[S];if(G===void 0){this._logger.warn(`${R} in previous statsReport is undefined`);continue}const K=(Number(L[S])-Number(G))/p;f[R]=de(ee({},f[R]),{[x]:String(K)})}else f[R]=de(ee({},f[R]),{[x]:String(L[S])})}const _={subscriptionId:n.subscriptionId,stats:f,role:n.role,createdAt:n.createdAt},w=new Ti("SubscriptionStatsReport",_);yield this._sendClientEvent(w).catch(R=>{this._logger.warn("_sendClientEvent in sendSubscriptionStatsReport is failed",R)})})}sendRtcPeerConnectionEventReport(t){return B(this,null,function*(){const n=new Ti("RtcPeerConnectionEventReport",t);yield this._sendClientEvent(n).catch(r=>{this._logger.warn("_sendClientEvent in sendRtcPeerConnectionEventReport is failed",r)})})}sendPublicationUpdateEncodingsReport(t){return B(this,null,function*(){let n=this._encodingsVersion.get(t.publicationId);n===void 0?n=0:n++,this._encodingsVersion.set(t.publicationId,n);const r={publicationId:t.publicationId,encodings:t.encodings,encodingsVersion:n,updatedAt:t.updatedAt},i=new Ti("PublicationUpdateEncodingsReport",r);yield this._sendClientEvent(i).catch(a=>{this._logger.warn("_sendClientEvent in sendPublicationUpdateEncodingsReport is failed",a)})})}sendSubscriptionUpdatePreferredEncodingReport(t){return B(this,null,function*(){let n=this._preferredEncodingVersion.get(t.subscriptionId);n===void 0?n=0:n++,this._preferredEncodingVersion.set(t.subscriptionId,n);const r={subscriptionId:t.subscriptionId,preferredEncodingIndex:t.preferredEncodingIndex,preferredEncodingVersion:n,updatedAt:t.updatedAt},i=new Ti("SubscriptionUpdatePreferredEncodingReport",r);yield this._sendClientEvent(i).catch(a=>{this._logger.warn("_sendClientEvent in sendSubscriptionUpdatePreferredEncodingReport is failed",a)})})}sendJoinReport(t){return B(this,null,function*(){const n=new Ti("JoinReport",t);yield this._sendClientEvent(n).catch(r=>{this._logger.warn("_sendClientEvent in sendJoinReport is failed",r)})})}_sendClientEvent(t){return B(this,null,function*(){return new Promise((n,r)=>B(this,null,function*(){if(this._socket===void 0||this._socket.connectionState==="closed"){r(new Error("websocket is not connected"));return}if(this._socket.connectionState==="connecting"){this._socket.pushResendClientEventsQueue(t),this._setAcknowledgeCallback(t.id,a=>B(this,null,function*(){a.ok?(this._acknowledgeCallbacks.delete(t.id),n()):(this._acknowledgeCallbacks.delete(t.id),r(a))})),this._logger.debug(`pushResendClientEventsQueue and setAcknowledgeCallback. clientEvent.id: ${t.id}`),r(new Error("websocket is connecting now"));return}const i=new vT({times:6,interval:500,jitter:100});for(;!i.exceeded;){const a=setTimeout(()=>B(this,null,function*(){if(this._socket===void 0){this._acknowledgeCallbacks.delete(t.id),r(new Error("Socket closed when trying to resend"));return}else this._socket.resendAfterReconnect(t);r(new Error("Timeout to send data"))}),_T*1e3);this._logger.debug(`send clientEvent, ${JSON.stringify(t)}`),this._socket.send(t).catch(u=>{this._acknowledgeCallbacks.delete(t.id),clearTimeout(a),r(u)});const o=yield this._waitForAcknowledge(t.id).catch(u=>u);if(clearTimeout(a),Ng(o))if(o.reason==="unexpected")yield i.wait();else{r(o);return}else{n();return}}r(new Error("unexpected has occurred at server"))}))})}_waitForAcknowledge(t){return B(this,null,function*(){return new Promise((n,r)=>{this._setAcknowledgeCallback(t,i=>B(this,null,function*(){i.ok?(this._acknowledgeCallbacks.delete(t),n()):(this._acknowledgeCallbacks.delete(t),r(i))}))})})}_reconnectWithNewSkyWayAuthToken(){return B(this,null,function*(){this._disconnect(),this._newToken!==void 0?(this._token=this._newToken,this._newToken=void 0,yield this.connect()):this._logger.warn("new token is not set. so not reconnect.")})}_eventReceivedHandler(t){switch(t.type){case"Acknowledge":this._acknowledgeHandler(t.payload);break;case"Open":break;default:t.type,this._logger.warn(`Unknown event: ${t.type}`)}}_acknowledgeHandler(t){if(!Ng(t))throw new Error("Invalid payload");const{eventId:n}=t;if(!this._acknowledgeCallbacks.has(n))throw new Error(`acknowledge event has unknown eventId: ${n}`);const r=this._acknowledgeCallbacks.get(n);r&&(this._acknowledgeCallbacks.delete(n),r(t))}_setAcknowledgeCallback(t,n){this._acknowledgeCallbacks.set(t,n)}_cleanupAnalyticsClientMaps(){this._mediaDeviceVersion.clear(),this._encodingsVersion.clear(),this._preferredEncodingVersion.clear(),this._previousSubscriptionStats.clear()}getIntervalSec(){return this._statsRequest.intervalSec}isConnectionEstablished(){return!(!this._socket||this._socket.connectionState==="connecting"||this._socket.connectionState==="closed")}isClosed(){return this._isClosed}};M_.MAX_PENDING_SDK_LOGS=50;var bT=M_;W();var j_="packages/core/src/external/analytics.ts",nr=new De(j_);function ST(e){return B(this,null,function*(){const{analyticsService:t}=e.config,n=new bT({token:e.authTokenString,sdkVersion:sp.version,contextId:sp.id},{logger:{error:(i,a)=>B(null,null,function*(){nr.error(`AnalyticsClient error: ${i}`,we({operationName:"AnalyticsClient.logger",context:e,info:de(ee({},Ae.internal),{detail:"AnalyticsClient error"}),error:a,path:nr.prefix}))}),debug:(i,...a)=>{nr.debug("[analytics]:",i,...a)},warn:(i,...a)=>{nr.warn("[analytics]:",i,...a)}},analyticsLoggingServerDomain:t.domain,secure:t.secure}),r=new wT(n,e);return De._onLogForAnalytics=i=>{i.prefix!==j_&&n.bufferOrSendSdkLog(i)},r.connectWithTimeout().catch(i=>{r.close(),nr.error(`AnalyticsClient error: ${i.message}`,we({operationName:"AnalyticsClient.logger",context:e,info:de(ee({},Ae.internal),{detail:"AnalyticsClient error"}),error:i,path:nr.prefix})),r.onConnectionFailed.emit({})}),r})}var wT=class{constructor(e,t){this.client=e,this.context=t,this.onConnectionFailed=new Me,this.onConnectionStateChanged=new Me,this.onMessage=new Me,this._isClosed=!1,this._listen(),t._onTokenUpdated.add(n=>{this.client.setNewSkyWayAuthToken(n)})}_listen(){this.client.onConnectionFailed.addOneTimeListener(()=>{this.onConnectionFailed.emit({})}),this.client.onConnectionStateChanged.addListener(e=>{e==="closed"&&!this.isClosed()&&this.client.isClosed()&&this.close(),this.onConnectionStateChanged.emit(e)})}get connectionState(){return this.client.connectionState}_connect(){return B(this,null,function*(){nr.debug("[start] connect analyticsService"),yield this.client.connect().then(()=>{nr.debug("[end] connect analyticsService")}).catch(e=>{this.close(),nr.debug("[end] failed connect analyticsService: also unreachable to server"),nr.error(`AnalyticsClient error: ${e.message}`,we({operationName:"AnalyticsClient.logger",info:de(ee({},Ae.internal),{detail:"AnalyticsClient error"}),error:e,path:nr.prefix})),this.onConnectionFailed.emit({})})})}connectWithTimeout(){return B(this,null,function*(){let e;const t=new Promise((r,i)=>{e=setTimeout(()=>{nr.debug("[end] failed connect analyticsService: no initial response from the server"),i(new Error("failed connect analyticsService"))},3e4)}),n=new Promise((r,i)=>{this.client.onAnalyticsNotEnabledError.addOneTimeListener(a=>{nr.warn(`[end] failed connect analyticsService: ${a.reason}`),r()})});return Promise.race([this._connect(),t,n]).finally(()=>{clearTimeout(e)})})}close(){this._isClosed=!0,this.onConnectionFailed.removeAllListeners(),this.onConnectionStateChanged.removeAllListeners(),this.onMessage.removeAllListeners()}isClosed(){return this._isClosed}};W();W();var bf=class{constructor(){this._onContextAttached=new Me}_attachContext(e){this._context=e,this._onContextAttached.emit(e)}};W();var xT=new De("packages/core/src/plugin/internal/person/connection/messageBuffer.ts"),CT=class{constructor(e){this.signaling=e,this._indicateMessageBuffer={},this._excludeConnectionIndicateBuffering=new Set,this._disposer=new lr,this.signaling.onMessage.add(t=>{const n=t.src.id+t.src.name;this._excludeConnectionIndicateBuffering.has(n)||(this._indicateMessageBuffer[n]||(this._indicateMessageBuffer[n]=[]),this._indicateMessageBuffer[n].push(t))}).disposer(this._disposer)}resolveMessagingBuffer({id:e,name:t}){const n=e+t,r=this._indicateMessageBuffer[n];(r==null?void 0:r.length)>0&&(xT.debug("resolveMessagingBuffer",{length:r.length}),r.forEach(i=>{this.signaling.onMessage.emit(i)}),delete this._indicateMessageBuffer[n]),this._excludeConnectionIndicateBuffering.add(n)}close(){this._disposer.dispose(),this._indicateMessageBuffer={},this._excludeConnectionIndicateBuffering=new Set}};W();W();W();var Ya=Xn(qr());W();W();W();W();var B_=class{constructor(e,t){this.id=e,this.contentType=t,this.side="remote",this.onConnectionStateChanged=new Me,this._onConnectionStateChanged=new Me,this._connectionState="new",this._getTransport=()=>{},this.getStats=()=>this._getStats(),this._getStats=()=>B(null,null,function*(){return[]}),this._onConnectionStateChanged.pipe(this.onConnectionStateChanged)}_setConnectionState(e){this._connectionState!==e&&(this._connectionState=e,this._onConnectionStateChanged.emit(e))}getRTCPeerConnection(){return this._getRTCPeerConnection()}_getRTCPeerConnection(){var e;return(e=this._getTransport())==null?void 0:e.rtcPeerConnection}getConnectionState(){return this._getConnectionState()}_getConnectionState(){return this._connectionState}toJSON(){return{contentType:this.contentType,id:this.id,codec:this.codec,side:this.side}}},U_=class extends B_{constructor(e,t,n){super(e,t),this.id=e,this.contentType=t,this.track=n}get isEnabled(){return this.track.enabled}setIsEnabled(e){this.track.enabled=e}attach(e){this._element=e,a_(e,this.track)}detach(){this._element&&(o_(this._element,this.track),this._element=void 0)}},ET=class extends U_{constructor(e,t){super(e,"audio",t),this.track=t,this.contentType="audio"}};W();var PT=class extends B_{constructor(e,t){super(e,"data"),this._datachannel=t,this._isEnabled=!0,this.contentType="data",this.onData=new Me,t.onmessage=({data:n})=>{this.isEnabled&&(typeof n=="string"&&n.includes(np)&&(n=JSON.parse(n.slice(np.length))),this.onData.emit(n))}}get isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}};W();var kT=class extends U_{constructor(e,t){super(e,"video",t),this.track=t,this.contentType="video"}},TT=new De("packages/core/src/media/stream/remote/factory.ts"),ip=(e,t,n)=>{if(t instanceof RTCDataChannel){const r=new PT(e,t);return r.codec=n,r}else if(t.kind==="audio"){const r=new ET(e,t);return r.codec=n,r}else if(t.kind==="video"){const r=new kT(e,t);return r.codec=n,r}throw we({operationName:"createRemoteStream",path:TT.prefix,info:de(ee({},Ae.invalidArgumentValue),{detail:"invalid stream type"})})};W();var RT=new De("packages/core/src/plugin/internal/person/util.ts"),yo=(e,t)=>B(null,null,function*(){const n=RT.createBlock({label:"setEncodingParams"}),r=e.getParameters();n.debug("getParameters",{params:r,newEncodings:t}),r.encodings==null&&(r.encodings=[]),r.encodings=t.map((i,a)=>ee(ee({},r.encodings[a]||{}),i)),yield e.setParameters(r)}),H_=()=>mg()==="Safari12"||mg()==="Safari11";function AT(e){switch(e){case"closed":case"disconnected":case"failed":return"disconnected";case"connected":return"connected";case"connecting":return"connecting";case"new":return"new";case"reconnecting":return"reconnecting"}}var IT=e=>{const t=[];return e.forEach(n=>{t.push(JSON.parse(JSON.stringify(n)))}),t};W();var V_=class q_{constructor(t,n){this.publicationId=t,this.streamId=n}static fromLabel(t){const{p:n,s:r}=JSON.parse(t);return new q_(n,r)}toLabel(){return JSON.stringify({p:this.publicationId,s:this.streamId})}};W();var Ar=new De("packages/core/src/plugin/internal/person/connection/peer.ts"),z_=class{constructor(e,t,n,r,i,a,o){this._context=e,this._iceManager=t,this.signaling=n,this.analytics=r,this.localPerson=i,this.endpoint=a,this.role=o,this._pendingCandidates=[],this.pc=new RTCPeerConnection(de(ee({},this._context.config.rtcConfig),{iceTransportPolicy:this._context.config.rtcConfig.turnPolicy==="turnOnly"?"relay":void 0,iceServers:this._iceManager.iceServers})),this.onSignalingStateChanged=new Me,this.onPeerConnectionStateChanged=new Me,this.onDisconnect=new Me,this.connected=!1,this.disconnected=!1,this.rtcPeerConnectionId=Da(),this._onICECandidate=h=>B(this,null,function*(){if(h.candidate==null||h.candidate===""||this.pc.connectionState==="closed")return;const y={kind:"iceCandidateMessage",payload:{candidate:h.candidate,role:this.role}};Ar.debug("[start] send candidate",{message:y,localPerson:this.localPerson}),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceCandidate",data:{candidate:JSON.stringify(h.candidate)},createdAt:Date.now()});try{yield this.signaling.send(this.endpoint,y),Ar.debug("[end] send candidate",{message:y,localPerson:this.localPerson})}catch(f){Ar.warn("[failed] send candidate",Wt({operationName:"Peer._onICECandidate",channel:this.localPerson.channel,detail:"[failed] send candidate",payload:{message:y}}),f)}}),this._onICECandidateError=h=>B(this,null,function*(){this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceCandidateError",data:{event:JSON.stringify(h)},createdAt:Date.now()})}),this._onIceGatheringStateChange=h=>B(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const y=this.pc.iceGatheringState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceGatheringStateChange",data:{event:y},createdAt:Date.now()})}}),this._onConnectionStateChange=()=>B(this,null,function*(){const h=this.pc.connectionState;switch(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"connectionStateChange",data:{connectionState:h},createdAt:Date.now()}),h){case"connected":this.connected=!0,this._pendingCandidates=[];break}this.onPeerConnectionStateChanged.emit(this.pc.connectionState)}),this._onIceConnectionStateChange=()=>B(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const h=this.pc.iceConnectionState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"iceConnectionStateChange",data:{iceConnectionState:h},createdAt:Date.now()})}}),this._onSignalingStateChange=()=>B(this,null,function*(){if(this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const h=this.pc.signalingState;this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"signalingStateChange",data:{signalingState:h},createdAt:Date.now()})}}),this.waitForSignalingState=(h,y=1e4)=>B(this,null,function*(){this.pc.signalingState!==h&&(yield this.onSignalingStateChanged.watch(()=>this.pc.signalingState===h,y).catch(f=>{throw we({operationName:"Peer.waitForSignalingState",info:de(ee({},Ae.timeout),{detail:"waitForSignalingState timeout"}),path:Ar.prefix,context:this._context,channel:this.localPerson.channel,error:f})}))}),this.waitForConnectionState=(h,y=1e4)=>B(this,null,function*(){h!==this.pc.connectionState&&(yield this.onPeerConnectionStateChanged.watch(()=>h===this.pc.connectionState,y).catch(f=>{throw we({operationName:"Peer.waitForConnectionState",info:de(ee({},Ae.timeout),{detail:"waitForConnectionState timeout"}),path:Ar.prefix,context:this._context,channel:this.localPerson.channel,error:f})}))}),this.waitForStats=h=>B(this,[h],function*({track:y,cb:f,interval:_,timeout:w,logging:R}){_??(_=100),w??(w=1e4);for(let F=0;;F+=_){if(F>=w)throw we({operationName:"Peer.waitForStats",info:de(ee({},Ae.timeout),{detail:"waitForStats timeout"}),path:Ar.prefix,context:this._context,channel:this.localPerson.channel});const S=yield this.pc.getStats(y),b=IT(S);if(R&&Ar.debug("Peer.waitForStats",b),f(b))break;yield new Promise(x=>setTimeout(x,_))}});var u;Ar.debug("peerConfig",this.pc.getConfiguration()),this.setPeerConnectionListener();const p=(u=this.pc)==null?void 0:u.peerIdentity;p&&p.catch(h=>{Ar.debug("firefox peerIdentity",h)})}setPeerConnectionListener(){this.pc.onicecandidate=this._onICECandidate,this.pc.onicecandidateerror=this._onICECandidateError,this.pc.onicegatheringstatechange=this._onIceGatheringStateChange,this.pc.onconnectionstatechange=this._onConnectionStateChange,this.pc.oniceconnectionstatechange=this._onIceConnectionStateChange,this.pc.onsignalingstatechange=()=>{this._onSignalingStateChange(),this.onSignalingStateChanged.emit(this.pc.signalingState)}}unSetPeerConnectionListener(){this.pc.onicecandidate=null,this.pc.onicecandidateerror=null,this.pc.onicegatheringstatechange=null,this.pc.onconnectionstatechange=null,this.pc.oniceconnectionstatechange=null,this.pc.onsignalingstatechange=null}handleCandidate(e){return B(this,null,function*(){this._pendingCandidates.push(e),this.pc.remoteDescription&&(yield this.resolveCandidates())})}resolveCandidates(){return B(this,null,function*(){const e=[...this._pendingCandidates];this._pendingCandidates=[],Ar.debug("addIceCandidates",e),yield Promise.all(e.map(t=>{this.pc.signalingState!=="closed"&&this.pc.addIceCandidate(t).catch(n=>{Ar.warn("[failed] add ice candidate",Wt({operationName:"Peer.resolveCandidates",channel:this.localPerson.channel,detail:"[failed] send candidate",payload:{endpointId:this.endpoint.id}}),n)})}))})}},Ri=new De("packages/core/src/plugin/internal/person/connection/receiver.ts"),FT=class extends z_{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a,"receiver"),this.id=$r(),this.onConnectionStateChanged=new Me,this.onStreamAdded=new Me,this.onError=new Me,this._connectionState="new",this._publicationInfo={},this.streams={},this._subscriptions={},this._promiseQueue=new is,this._disposer=new lr,this._log=Ri.createBlock({localPersonId:this.localPerson.id,id:this.id}),this._log.debug("spawned"),this.signaling.onMessage.add(o=>B(this,[o],function*({src:u,data:p}){if(!(u.id===a.id&&u.name===a.name))return;const h=p;switch(h.kind){case"senderProduceMessage":this._promiseQueue.push(()=>this._handleSenderProduce(h.payload)).catch(y=>this._log.error("handle senderProduceMessage failed",y,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"senderUnproduceMessage":this._promiseQueue.push(()=>this._handleSenderUnproduce(h.payload)).catch(y=>this._log.error("handle handleSenderUnproduce",y,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"senderRestartIceMessage":this._promiseQueue.push(()=>this._handleSenderRestartIce(h.payload)).catch(y=>this._log.error("_handleSenderRestartIce",y,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}));break;case"iceCandidateMessage":{const{role:y,candidate:f}=h.payload;y==="sender"&&(yield this.handleCandidate(f))}break}})).disposer(this._disposer),this.pc.ontrack=o=>B(this,[o],function*({track:u,transceiver:p}){if(!p.mid)throw we({operationName:"Receiver.pc.ontrack",info:de(ee({},Ae.missingProperty),{detail:"mid missing"}),path:Ri.prefix,context:this._context,channel:this.localPerson.channel});const h=Object.values(this._publicationInfo).find(w=>{var R;return w.mid===((R=p.mid)==null?void 0:R.toString())});if(!h){const w=we({operationName:"Receiver.pc.ontrack",info:de(ee({},Ae.notFound),{detail:"publicationInfo not found"}),path:Ri.prefix,context:this._context,channel:i.channel,payload:{endpointId:this.endpoint.id,publicationInfo:this._publicationInfo,mid:p.mid}});this.onError.emit(w),this._log.error(w);return}const y=Ya.parse(this.pc.remoteDescription.sdp),f=this._getCodecFromSdp(y,p,u.kind),_=ip(h.streamId,u,f);_.codec=f,this._setupTransportAccessForStream(_),this.streams[h.publicationId]=_,this._log.debug("MediaStreamTrack added",h,u,f),this.onStreamAdded.emit({publicationId:h.publicationId,stream:_})}),this.pc.ondatachannel=o=>B(this,[o],function*({channel:u}){const{publicationId:p,streamId:h}=V_.fromLabel(u.label),y={mimeType:"datachannel"},f=ip(h,u,y);this._setupTransportAccessForStream(f),this.streams[p]=f,this._log.debug("DataChannel added",p,u,y),this.onStreamAdded.emit({publicationId:p,stream:f})}),this.onPeerConnectionStateChanged.add(o=>{switch(o){case"connecting":case"connected":this._setConnectionState(o);break;case"failed":case"closed":this._setConnectionState("disconnected");break}}).disposer(this._disposer)}_setConnectionState(e){this._connectionState!==e&&(this._log.debug("onConnectionStateChanged",this.id,this._connectionState,e),this._connectionState=e,this.onConnectionStateChanged.emit(e))}_setupTransportAccessForStream(e){e._getTransport=()=>({rtcPeerConnection:this.pc,connectionState:AT(this.pc.connectionState)}),e._getStats=()=>B(this,null,function*(){if(e.contentType==="data"){const r=yield this.pc.getStats();return Sa(r)}const t=yield this.pc.getStats(e.track);return Sa(t)}),this._disposer.push(()=>{e._getTransport=()=>{}}),this.onConnectionStateChanged.add(t=>{e._setConnectionState(t),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"skywayConnectionStateChange",data:{skywayConnectionState:t},createdAt:Date.now()})}).disposer(this._disposer)}_getCodecFromSdp(e,t,n){var r;const i=e.media.find(f=>{var _,w;return((_=f.mid)==null?void 0:_.toString())===((w=t.mid)==null?void 0:w.toString())});if(!i)throw we({operationName:"Receiver._getCodecFromSdp",info:de(ee({},Ae.notFound),{detail:"m-line not exist"}),path:Ri.prefix,context:this._context,channel:this.localPerson.channel});const a=(r=i.payloads)==null?void 0:r.toString().split(" ")[0],o=i.rtp.find(f=>f.payload.toString()===a),u=`${n}/${o.codec}`.toLowerCase();let p={};const h=i.fmtp.find(f=>f.payload.toString()===a);return h!=null&&h.config&&(p=n_(h.config)),{mimeType:u,parameters:p}}get hasMedia(){const e=Object.values(this.streams).length;return this._log.debug("hasMedia",{count:e}),e>0}close(){this._log.debug("closed"),this.unSetPeerConnectionListener(),this.pc.close(),this._setConnectionState("disconnected"),this._disposer.dispose()}add(e){this._subscriptions[e.id]=e}remove(e){const t=this._subscriptions[e];if(!t)return;delete this._subscriptions[t.id];const n=t.publication.id;this.streams[n]&&delete this.streams[n]}_validateRemoteOffer(e){const t=Ya.parse(e);this._log.debug("_validateRemoteOffer",{sdpObject:t});for(const n of t.media){if(n.direction==="inactive")continue;if(!Object.values(this._publicationInfo).find(i=>{var a;return((a=n.mid)==null?void 0:a.toString())===i.mid})){const i=we({operationName:"Receiver._validateRemoteOffer",info:de(ee({},Ae.notFound),{detail:"mismatch between sdp and state"}),path:Ri.prefix,context:this._context,channel:this.localPerson.channel,payload:{sdpMedia:t.media,sdpMediaLine:n,info:this._publicationInfo}});throw this.onError.emit(i),i}}}get isWrongSignalingState(){return this.pc.signalingState==="have-local-offer"&&this.pc.remoteDescription||this.pc.signalingState==="have-remote-offer"}_handleSenderProduce(e){return B(this,arguments,function*({sdp:t,publicationId:n,info:r}){if(this.pc.signalingState!=="closed"){if(this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("_handleSenderProduce wait for be stable",Wt({operationName:"Receiver._handleSenderProduce",channel:this.localPerson.channel,detail:"_handleSenderProduce wait for be stable",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderProduce({sdp:t,publicationId:n,info:r});return}throw we({operationName:"Receiver._handleSenderProduce",context:this._context,channel:this.localPerson.channel,info:de(ee({},Ae.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:Ri.prefix})}this._log.debug("_handleSenderProduce",{info:r,publicationId:n,publicationInfo:Object.values(this._publicationInfo)}),this._publicationInfo[r.publicationId]=r,this._validateRemoteOffer(t.sdp),yield this.sendAnswer(t),yield this.resolveCandidates()}})}_handleSenderUnproduce(e){return B(this,arguments,function*({sdp:t,publicationId:n}){if(this.pc.signalingState==="closed"){this._log.warn("signalingState closed",Wt({channel:this.localPerson.channel,detail:"signalingState closed",operationName:"Receiver._handleSenderUnproduce"}));return}if(this._log.debug("<handleSenderUnproduce> start",{sdp:t,publicationId:n}),this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("signalingState is not stable",Wt({channel:this.localPerson.channel,detail:"signalingState is not stable",operationName:"Receiver._handleSenderUnproduce",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderUnproduce({sdp:t,publicationId:n});return}throw we({operationName:"Receiver._handleSenderProduce",context:this._context,channel:this.localPerson.channel,info:de(ee({},Ae.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:Ri.prefix})}delete this._publicationInfo[n],yield this.sendAnswer(t),yield this.resolveCandidates(),this._log.debug("<handleSenderUnproduce> end",{publicationId:n})})}_handleSenderRestartIce(e){return B(this,arguments,function*({sdp:t}){if(this.pc.signalingState!=="closed"){if(this.pc.signalingState!=="stable"){if(this.isWrongSignalingState){this._log.warn("signalingState is not stable",Wt({channel:this.localPerson.channel,detail:"signalingState is not stable",operationName:"Receiver._handleSenderRestartIce",payload:{signalingState:this.pc.signalingState}})),yield this.waitForSignalingState("stable"),yield this._handleSenderRestartIce({sdp:t});return}throw we({operationName:"Receiver._handleSenderRestartIce",context:this._context,channel:this.localPerson.channel,info:de(ee({},Ae.internal),{detail:"wrong signalingState"}),payload:{signalingState:this.pc.signalingState},path:Ri.prefix})}this._setConnectionState("reconnecting"),yield this.sendAnswer(t),yield this.resolveCandidates(),this.pc.connectionState==="connected"&&this._setConnectionState("connected")}})}sendAnswer(e){return B(this,null,function*(){this._log.debug("[receiver] start: sendAnswer"),yield this.pc.setRemoteDescription(e);const t=yield this.pc.createAnswer();this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"answer",data:{answer:JSON.stringify(t)},createdAt:Date.now()});const n=Ya.parse(this.pc.remoteDescription.sdp),r=Ya.parse(t.sdp);n.media.forEach((o,u)=>{const p=r.media[u];p.fmtp=bP(p.fmtp).map(h=>{const y=o.fmtp.find(f=>f.payload===h.payload);return y||h})});const i=Ya.write(r);yield this.pc.setLocalDescription({type:"answer",sdp:i});const a={kind:"receiverAnswerMessage",payload:{sdp:this.pc.localDescription}};yield this.signaling.send(this.endpoint,a).catch(o=>this._log.error("failed to send answer",o,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id})),this._log.debug("[receiver] end: sendAnswer")})}get subscriptions(){return this._subscriptions}};W();var DT=Xn(vy()),Mg=Xn(qr()),Rn=new De("packages/core/src/plugin/internal/person/connection/sender.ts"),NT=class extends z_{constructor(e,t,n,r,i,a){super(e,t,n,r,i,a,"sender"),this.id=$r(),this.onConnectionStateChanged=new Me,this.publications={},this.transceivers={},this.datachannels={},this._pendingPublications=[],this._isNegotiating=!1,this.promiseQueue=new is,this._disposer=new lr,this._ms=new MediaStream,this._backoffIceRestarted=new Mr({times:8,interval:100,jitter:100}),this._connectionState="new",this._log=Rn.createBlock({localPersonId:this.localPerson.id,id:this.id}),this._unsubscribeStreamEnableChange={},this._cleanupStreamCallbacks={},this.restartIce=()=>B(this,null,function*(){if(this._backoffIceRestarted.exceeded){this._log.error(we({operationName:"Sender.restartIce",context:this._context,channel:this.localPerson.channel,info:de(ee({},Ae.internal),{detail:"restartIce limit exceeded"}),path:Rn.prefix})),this._setConnectionState("disconnected");return}this._log.warn("[start] restartIce",Wt({operationName:"Sender.restartIce",detail:"start restartIce",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}));const o=()=>{if(this.endpoint.state==="left")return this._log.warn("endpointMemberLeft",Wt({operationName:"restartIce",detail:"endpointMemberLeft",channel:this.localPerson.channel,payload:{endpointId:this.endpoint.id}})),this._setConnectionState("disconnected"),!0;if(this.pc.connectionState==="connected")return this._log.warn("[end] restartIce",Wt({operationName:"restartIce",detail:"reconnected",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}})),this._backoffIceRestarted.reset(),this._setConnectionState("connected"),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"restartIce",data:void 0,createdAt:Date.now()}),!0};if(this._setConnectionState("reconnecting"),yield this._backoffIceRestarted.wait(),o())return;let u=yield this._iceManager.updateIceParams().catch(y=>y);if(u){this._log.warn("[failed] restartIce",Wt({operationName:"restartIce",detail:"update IceParams failed",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}),u),yield this.restartIce();return}if(this.pc.setConfiguration&&(this.pc.setConfiguration(de(ee({},this.pc.getConfiguration()),{iceServers:this._iceManager.iceServers})),this._log.debug("<restartIce> setConfiguration",{iceServers:this._iceManager.iceServers})),o())return;if(this.signaling.connectionState!=="connected"){if(this._log.warn("<restartIce> reconnect signaling service",Wt({operationName:"restartIce",detail:"reconnect signaling service",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}})),u=yield this.signaling.onConnectionStateChanged.watch(y=>y==="connected",1e4).catch(y=>y).then(()=>{}),u instanceof Kn){yield this.restartIce();return}if(o())return}const p=yield this.pc.createOffer({iceRestart:!0});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(p)},createdAt:Date.now()}),yield this.pc.setLocalDescription(p);const h={kind:"senderRestartIceMessage",payload:{sdp:this.pc.localDescription}};if(u=yield this.signaling.send(this.endpoint,h,1e4).catch(y=>y),u){this._log.warn("<restartIce> [failed]",Wt({operationName:"restartIce",detail:"timeout send signaling message",channel:this.localPerson.channel,payload:{count:this._backoffIceRestarted.count}}),u),yield this.restartIce();return}u=yield this.waitForConnectionState("connected",this._context.config.rtcConfig.iceDisconnectBufferTimeout).catch(y=>y),!(!u&&o())&&(yield this.restartIce())}),this._log.debug("spawned"),this.signaling.onMessage.add(o=>B(this,[o],function*({src:u,data:p}){if(!(u.id===a.id&&u.name===a.name))return;const h=p;switch(h.kind){case"receiverAnswerMessage":this.promiseQueue.push(()=>this._handleReceiverAnswer(h.payload)).catch(y=>this._log.error("handle receiverAnswerMessage",{localPersonId:this.localPerson.id,endpointId:this.endpoint.id,err:y}));break;case"iceCandidateMessage":{const{role:y,candidate:f}=h.payload;y==="receiver"&&(yield this.handleCandidate(f))}break}})).disposer(this._disposer),this.onPeerConnectionStateChanged.add(o=>B(this,null,function*(){try{switch(Rn.debug("onPeerConnectionStateChanged",{state:o}),o){case"disconnected":case"failed":(yield this.waitForConnectionState("connected",e.config.rtcConfig.iceDisconnectBufferTimeout).catch(p=>p))&&this._connectionState!=="reconnecting"&&(yield this.restartIce());break;case"connecting":case"connected":this._setConnectionState(o);break;case"closed":this._setConnectionState("disconnected");break}}catch(u){Rn.error("onPeerConnectionStateChanged",u,this.id)}})).disposer(this._disposer)}_setConnectionState(e){this._connectionState!==e&&(this._log.debug("onConnectionStateChanged",this.id,this._connectionState,e),this._connectionState=e,this.onConnectionStateChanged.emit(e))}get hasMedia(){const e=Object.keys(this.publications).length;return this._log.debug("hasMedia",{count:e}),e>0}_getMid(e,t){if(e.contentType==="data"){const n=t.media.find(r=>r.type==="application");if((n==null?void 0:n.mid)==null)throw we({operationName:"Sender._getMid",info:de(ee({},Ae.missingProperty),{detail:"datachannel mid undefined"}),path:Rn.prefix,context:this._context,channel:this.localPerson.channel});return n.mid.toString()}else{const r=this.transceivers[e.id].mid;if(r==null)throw we({operationName:"Sender._getMid",info:de(ee({},Ae.missingProperty),{detail:"media mid undefined"}),path:Rn.prefix,context:this._context,channel:this.localPerson.channel});return r.toString()}}_listenStreamEnableChange(e,t){this._unsubscribeStreamEnableChange[t]&&this._unsubscribeStreamEnableChange[t]();const{removeListener:n}=e._onEnableChanged.add(r=>B(this,null,function*(){yield this._replaceTrack(t,r).catch(i=>{Rn.warn(Wt({member:this.localPerson,detail:"_replaceTrack failed",operationName:"Sender._listenStreamEnableChange",payload:i}))})}));this._unsubscribeStreamEnableChange[t]=n}add(e){return B(this,null,function*(){var t,n;if(this._isNegotiating||this.pc.signalingState!=="stable"){this._pendingPublications.push(e),this._log.debug("<add> isNegotiating",{publication:e,isNegotiating:this._isNegotiating,signalingState:this.pc.signalingState,pendingPublications:this._pendingPublications.length});return}this._isNegotiating=!0,this._log.debug("<add> add publication",{publication:e}),this.publications[e.id]=e;const r=e.stream;if(!r)throw we({operationName:"Sender.add",info:de(ee({},Ae.missingProperty),{detail:"<add> stream not found"}),path:Rn.prefix,context:this._context,channel:this.localPerson.channel});if(this._cleanupStreamCallbacks[r.id]=this._setupTransportAccessForStream(r),r.contentType==="data"){const p=this.pc.createDataChannel(new V_(e.id,r.id).toLabel(),r.options);r._onWriteData.add(h=>{p.readyState==="open"&&p.send(h)}).disposer(this._disposer),this.datachannels[e.id]=p}else{e._onReplaceStream.add(h=>B(this,[h],function*({newStream:y,oldStream:f}){y._replacingTrack=!0,this._listenStreamEnableChange(y,e.id),this._cleanupStreamCallbacks[f.id]&&this._cleanupStreamCallbacks[f.id](),this._cleanupStreamCallbacks[y.id]=this._setupTransportAccessForStream(y),yield this._replaceTrack(e.id,y.track),y._replacingTrack=!1,y._onReplacingTrackDone.emit()})).disposer(this._disposer),this._listenStreamEnableChange(r,e.id);const p=this.pc.addTransceiver(r.track,{direction:"sendonly",streams:[this._ms]});e._onEncodingsChanged.add(h=>B(this,null,function*(){yield yo(p.sender,h).catch(y=>{this._log.error("_onEncodingsChanged failed",y)})})).disposer(this._disposer),this.transceivers[e.id]=p}const i=yield this.pc.createOffer().catch(p=>{throw we({operationName:"Sender.add",info:de(ee({},Ae.internal),{detail:"can't create offer"}),path:Rn.prefix,context:this._context,channel:this.localPerson.channel,error:p})});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(i)},createdAt:Date.now()}),yield this.pc.setLocalDescription(i);const a=Mg.parse(this.pc.localDescription.sdp);this._log.debug("<add> create offer base",a);const o=this._getMid(e,a);if(e.contentType!=="data"){OT((t=e.codecCapabilities)!=null?t:[],o,a);const p=Mg.write(a);if(yield this.pc.setLocalDescription({type:"offer",sdp:p}),this._log.debug("<add> create offer",this.pc.localDescription),((n=e.encodings)==null?void 0:n.length)>0)if(H_())this._safariSetupEncoding(e);else{const h=this.transceivers[e.id];yield yo(h.sender,[e.encodings[0]])}}const u={kind:"senderProduceMessage",payload:{sdp:this.pc.localDescription,publicationId:e.id,info:{publicationId:e.id,streamId:r.id,mid:o}}};this._log.debug("[start] send message",u),yield this.signaling.send(this.endpoint,u).catch(p=>{throw this._log.error("[failed] send message :",p,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}),p}),this._log.debug("[end] send message",u)})}_setupTransportAccessForStream(e){e._getTransportCallbacks[this.endpoint.id]=()=>({rtcPeerConnection:this.pc,connectionState:this._connectionState}),e._getStatsCallbacks[this.endpoint.id]=()=>B(this,null,function*(){if(e.contentType==="data"){const i=yield this.pc.getStats();return Sa(i)}e._replacingTrack&&(yield e._onReplacingTrackDone.asPromise(200));const n=yield this.pc.getStats(e.track);return Sa(n)});const t=()=>{delete e._getTransportCallbacks[this.endpoint.id],delete e._getStatsCallbacks[this.endpoint.id]};return this._disposer.push(()=>{t()}),this.onConnectionStateChanged.add(n=>{e._setConnectionState(this.endpoint,n),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"skywayConnectionStateChange",data:{skywayConnectionState:n},createdAt:Date.now()})}).disposer(this._disposer),t}remove(e){return B(this,null,function*(){const t=this.publications[e];if(!t){this._log.warn("<remove> publication not found",Wt({operationName:"Sender.remove",detail:"publication already removed",channel:this.localPerson.channel,payload:{publicationId:e}}));return}if(delete this.publications[e],this._isNegotiating||this.pc.signalingState!=="stable"){this._pendingPublications.push(e),this._log.debug("<remove> isNegotiating",{publicationId:e,_isNegotiating:this._isNegotiating,signalingState:this.pc.signalingState});return}this._isNegotiating=!0,this._log.debug("<remove> [start]",{publicationId:e});const n=t.stream;if(!n)throw we({operationName:"Sender.remove",info:de(ee({},Ae.missingProperty),{detail:"<remove> publication not have stream"}),path:Rn.prefix,context:this._context,channel:this.localPerson.channel,payload:{publication:t}});n.contentType==="data"?(this.datachannels[e].close(),delete this.datachannels[e]):(this.transceivers[e].stop(),delete this.transceivers[e]);const r=yield this.pc.createOffer().catch(a=>{throw we({operationName:"Sender.remove",info:de(ee({},Ae.internal),{detail:"<remove> can't create offer"}),path:Rn.prefix,context:this._context,channel:this.localPerson.channel,error:a})});this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.rtcPeerConnectionId,type:"offer",data:{offer:JSON.stringify(r)},createdAt:Date.now()}),yield this.pc.setLocalDescription(r);const i={kind:"senderUnproduceMessage",payload:{sdp:this.pc.localDescription,publicationId:e}};this._log.debug("<remove> send message",{message:i}),yield this.signaling.send(this.endpoint,i).catch(a=>{throw this._log.error("<remove> in remote error :",a,{localPersonId:this.localPerson.id,endpointId:this.endpoint.id}),a}),this._log.debug("<remove> [end]",{publicationId:e})})}_replaceTrack(e,t){return B(this,null,function*(){const n=this.transceivers[e];if(!n){this._log.warn("can't replace track, transceiver not found",Wt({operationName:"Sender._replaceTrack",detail:"transceiver already removed",channel:this.localPerson.channel,payload:{publicationId:e}}));return}yield n.sender.replaceTrack(t).catch(r=>{throw we({operationName:"Sender._replaceTrack",context:this._context,info:Ae.internal,error:r,path:Rn.prefix,channel:this.localPerson.channel})})})}_handleReceiverAnswer(e){return B(this,arguments,function*({sdp:t}){this.pc.signalingState!=="closed"&&(this._log.debug("<handleReceiverAnswer> [start]"),yield this.pc.setRemoteDescription(new RTCSessionDescription(t)).catch(n=>{const r=we({operationName:"Sender._handleReceiverAnswer",context:this._context,info:de(ee({},Ae.internal),{detail:"failed to setRemoteDescription"}),path:Rn.prefix,payload:{sdp:t},channel:this.localPerson.channel,error:n});throw this._log.error(r),r}),this._log.debug("<handleReceiverAnswer> sRD"),yield this.resolveCandidates(),this._log.debug("<handleReceiverAnswer> resolveCandidates"),yield this.waitForSignalingState("stable"),this._log.debug("<handleReceiverAnswer> waitForSignalingState"),this._isNegotiating=!1,yield this._resolvePendingSender(),this._log.debug("<handleReceiverAnswer> _resolvePendingSender",this._pendingPublications.length),this._log.debug("<handleReceiverAnswer> [end]"))})}_safariSetupEncoding(e){const t=this.transceivers[e.id],n=e.stream;this.waitForStats({track:n.track,cb:r=>{const i=r.find(a=>a.id.includes("RTCOutboundRTP")||a.type.includes("outbound-rtp"));return(i==null?void 0:i.keyFramesEncoded)>0},interval:10,timeout:this._context.config.rtcConfig.timeout}).then(()=>{Rn.debug("safari wait for stats resolved, setEncodingParams"),yo(t.sender,[e.encodings[0]]).catch(r=>{this._log.error("setEncodingParams failed",r)})}).catch(r=>{this._log.error("waitForStats",r)})}_resolvePendingSender(){return B(this,null,function*(){const e=this._pendingPublications.shift();e&&(this._log.debug("resolve pending sender",{publication:e}),typeof e=="string"?yield this.remove(e):yield this.add(e))})}close(){this._log.debug("closed"),this.unSetPeerConnectionListener(),Object.values(this._unsubscribeStreamEnableChange).forEach(e=>e()),this.pc.close(),this._setConnectionState("disconnected"),this._disposer.dispose()}};function OT(e,t,n){var r,i;const a=n.media.find(h=>{var y;return((y=h.mid)==null?void 0:y.toString())===t});if(!a)throw we({operationName:"applyCodecCapabilities",info:de(ee({},Ae.notFound),{detail:"media not found"}),path:Rn.prefix});e.forEach(h=>{var y;if(h.parameters)for(const[f,_]of Object.entries((y=h.parameters)!=null?y:{})){if(_===!1||!h.parameters[f])return;f==="usedtx"&&_&&(h.parameters[f]=1)}});const o=(h,y,f)=>{var _;const w=y.map(S=>de(ee({},S),{parameters:CP(f,S.payload)})),R=Lg(h.mimeType);return R&&(_=w.find(S=>{var b,x;return S.codec.toLowerCase()!==R.toLowerCase()?!1:Object.keys((b=h.parameters)!=null?b:{}).length===0||MT(h.mimeType)==="audio"?!0:(0,DT.default)(S.parameters,(x=h.parameters)!=null?x:{})}))!=null?_:void 0},u=e.map(h=>o(h,a.rtp,a.fmtp)).filter(h=>h!=null),p=[...u,...a.rtp.filter(h=>!u.find(y=>y.payload===h.payload))];for(const h of a.fmtp){const y=h.payload,f=p.find(R=>R.payload===y);if(f){const R=e.find(F=>o(F,[f],a.fmtp));R&&R.parameters&&Object.keys(R.parameters).length>0&&(h.config="",Object.entries(R.parameters).forEach(([F,S])=>{S===!1||h.config.includes(F)||(h.config.length>0?h.config+=`;${F}=${S}`:h.config=`${F}=${S}`)}))}const _=p.find(R=>R.codec.toLowerCase()==="opus"),w=(i=(r=e.find(R=>Lg(R.mimeType).toLowerCase()==="opus"))==null?void 0:r.parameters)==null?void 0:i.usedtx;_&&w!==!1&&h.payload===_.payload&&!h.config.includes("usedtx")&&(h.config.length>0?h.config+=";usedtx=1":h.config="usedtx=1")}a.payloads=p.map(h=>h.payload.toString()).join(" ")}var Lg=e=>e.split("/")[1],MT=e=>e.split("/")[0],$c=new De("packages/core/src/plugin/internal/person/connection/index.ts"),LT=class{constructor(e,t,n,r,i,a,o){this._iceManager=e,this._signaling=t,this._analytics=n,this._context=r,this.channelId=i,this.localPerson=a,this.remoteMember=o,this.id=$r(),this.type="p2p",this.onDisconnect=new Me,this.onClose=new Me,this.closed=!1,this.disconnected=!1,this._log=$c.createBlock({id:this.id,localPersonId:this.localPerson.id}),this._pubsubQueue=new is,this.sendSubscriptionStatsReportTimers=new Map,this._waitingSendSubscriptionStatsReportsFromPublish=new Map,this._waitingSendSubscriptionStatsReportsFromSubscribe=[],this.sender=new NT(this._context,this._iceManager,this._signaling,this._analytics,this.localPerson,this.remoteMember),this.receiver=new FT(this._context,this._iceManager,this._signaling,this._analytics,this.localPerson,this.remoteMember),this.sender.onDisconnect.once(()=>{this.disconnected=!0,this.onDisconnect.emit()}),this.receiver.onDisconnect.once(()=>{this.disconnected=!0,this.onDisconnect.emit()}),this._analytics&&this._analytics.onConnectionStateChanged.add(u=>{if(u==="connected"){if(this._waitingSendSubscriptionStatsReportsFromPublish.size>0){for(const[p,h]of this._waitingSendSubscriptionStatsReportsFromPublish){const y=this.sender.publications[h];y&&this.startSendSubscriptionStatsReportTimer(y,p)}this._waitingSendSubscriptionStatsReportsFromPublish.clear()}if(this._waitingSendSubscriptionStatsReportsFromSubscribe.length>0){for(const p of this._waitingSendSubscriptionStatsReportsFromSubscribe){const h=this.receiver.subscriptions[p];h&&this.startSendSubscriptionStatsReportTimer(h,p)}this._waitingSendSubscriptionStatsReportsFromSubscribe=[]}}})}startPublishing(e,t){return B(this,null,function*(){yield this._pubsubQueue.push(()=>B(this,null,function*(){this._log.debug("startPublishing",{publication:e}),yield this.sender.add(e)})),this._analytics&&!this._analytics.isClosed()&&(this._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:t,role:"sender",rtcPeerConnectionId:this.sender.rtcPeerConnectionId}),this._analytics.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer(e,t):this._waitingSendSubscriptionStatsReportsFromPublish.set(t,e.id))})}stopPublishing(e){return B(this,null,function*(){yield this._pubsubQueue.push(()=>B(this,null,function*(){this._log.debug("<stopPublishing> start",{publication:e}),this.sender.remove(e.id).then(()=>{this._log.debug("<stopPublishing> removed",{publication:e})}).catch(n=>{this._log.error("<stopPublishing> remove failed",n,{publication:e})}),this._closeIfNeeded(),this._log.debug("<stopPublishing> end",{publication:e})}));const t=this.sendSubscriptionStatsReportTimers.get(e.id);t&&(clearInterval(t),this.sendSubscriptionStatsReportTimers.delete(e.id))})}startSubscribing(e){return B(this,null,function*(){yield this._pubsubQueue.push(()=>B(this,null,function*(){this._log.debug("startSubscribing",{subscription:e}),this.receiver.add(e);const t=e.publication.id;let n=this.receiver.streams[t];n||(yield this.receiver.onStreamAdded.watch(r=>r.publicationId===t,this._context.config.rtcConfig.timeout).catch(()=>{throw we({operationName:"P2PConnection.startSubscribing",info:de(ee({},Ae.timeout),{detail:"onStreamAdded"}),path:$c.prefix,context:this._context,channel:this.localPerson.channel,payload:{subscription:e}})}),n=this.receiver.streams[t]),n.setIsEnabled(e.publication.state==="enabled"),e.codec=n.codec,e._setStream(n),this._analytics&&!this._analytics.isClosed()&&(this._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:e.id,role:"receiver",rtcPeerConnectionId:this.receiver.rtcPeerConnectionId}),this._analytics.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer(e,e.id):this._waitingSendSubscriptionStatsReportsFromSubscribe.push(e.id))}))})}stopSubscribing(e){return B(this,null,function*(){yield this._pubsubQueue.push(()=>B(this,null,function*(){this._log.debug("stopSubscribing",{subscription:e}),this.receiver.remove(e.id),this._closeIfNeeded()}));const t=this.sendSubscriptionStatsReportTimers.get(e.id);t&&(clearInterval(t),this.sendSubscriptionStatsReportTimers.delete(e.id))})}_closeIfNeeded(){this.sender.hasMedia||this.receiver.hasMedia||this.close({reason:"no media"})}getStats(e){return B(this,null,function*(){const t=e.stream;if(!t)throw we({operationName:"P2PConnection.getStats",info:de(ee({},Ae.invalidArgumentValue),{detail:"Subscription or Publication must has stream"}),path:$c.prefix,context:this._context,channel:this.localPerson.channel});return t.side==="local"?t.contentType==="data"?this.sender.pc.getStats():this.sender.pc.getStats(t.track):t.contentType==="data"?this.receiver.pc.getStats():this.receiver.pc.getStats(t.track)})}close({reason:e}={}){if(!this.closed){this.closed=!0,this._log.debug("closed",{endpointId:this.remoteMember.id,reason:e,sender:this.sender.id,receiver:this.receiver.id,id:this.id}),this.sender.close(),this.receiver.close();for(const t of this.sendSubscriptionStatsReportTimers.values())clearInterval(t);this.sendSubscriptionStatsReportTimers.clear(),this._waitingSendSubscriptionStatsReportsFromPublish.clear(),this._waitingSendSubscriptionStatsReportsFromSubscribe=[],this.onClose.emit()}}startSendSubscriptionStatsReportTimer(e,t){if(this._analytics){const n=e instanceof I_?"sender":"receiver",r=this._analytics.client.getIntervalSec();this.sendSubscriptionStatsReportTimers.set(e.id,setInterval(()=>B(this,null,function*(){if(!this._analytics)throw we({operationName:"P2PConnection.sendSubscriptionStatsReportTimer",info:de(ee({},Ae.missingProperty),{detail:"AnalyticsSession not exist"}),path:$c.prefix,context:this._context,channel:this.localPerson.channel});if(this._analytics.isClosed()){const a=this.sendSubscriptionStatsReportTimers.get(e.id);a&&(clearInterval(a),this.sendSubscriptionStatsReportTimers.delete(e.id));return}const i=yield this.getStats(e);i&&this._analytics.client.sendSubscriptionStatsReport(i,{subscriptionId:t,role:n,contentType:e.contentType,createdAt:Date.now()})}),r*1e3))}}},eo=new De("packages/core/src/plugin/internal/person/member.ts"),yl=class extends Lu{constructor(e){super(e),this.args=e,this.type="person",this.subtype="person",this.side="remote",this._connections={},this._context=this.args.channel._context,this._disposer=new lr,this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.subscribe=t=>new Promise((n,r)=>{let i=!1;this.channel._subscribe(this.id,t).catch(a=>{i=!0,r(a)}),this.onPublicationSubscribed.watch(({subscription:a})=>a.publication.id===t,this._context.config.rtcApi.timeout).then(({subscription:a})=>{n({subscription:a})}).catch(()=>{i||r(we({operationName:"RemotePersonImpl.subscribe",info:de(ee({},Ae.timeout),{detail:"onPublicationSubscribed"}),path:eo.prefix,context:this._context,channel:this.channel}))})}),this.plugin=e.plugin,this.channel.onPublicationUnsubscribed.add(({subscription:t})=>{t.subscriber.id===this.id&&(this.onPublicationUnsubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this.channel.onPublicationSubscribed.add(({subscription:t})=>{t.subscriber.id===this.id&&(this.onPublicationSubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this.channel.onStreamPublished.add(({publication:t})=>{t.publisher.id===this.id&&this.onPublicationListChanged.emit()}).disposer(this._disposer),this.channel.onStreamUnpublished.add(({publication:t})=>{t.publisher.id===this.id&&this.onPublicationListChanged.emit()}).disposer(this._disposer),this.onLeft.once(()=>{eo.debug("RemotePerson left: ",this.toJSON()),Object.values(this._connections).forEach(t=>{t.close({reason:"remote person left"})}),this._connections={}})}_getConnection(e){return this._connections[e]}_getOrCreateConnection(e){var t;return(t=this._getConnection(e.id))!=null?t:this._createConnection(this.channel,e,this)}_createConnection(e,t,n){if(t.side!=="local")throw we({operationName:"RemotePersonImpl._createConnection",info:de(ee({},Ae.invalidArgumentValue),{detail:"wrong localPerson type"}),path:eo.prefix,context:this._context,channel:this.channel});if(!t._signaling)throw we({operationName:"RemotePersonImpl._createConnection",info:de(ee({},Ae.missingProperty),{detail:"signalingSession not exist"}),path:eo.prefix,context:this._context,channel:this.channel});const r=new LT(t.iceManager,t._signaling,t._analytics,this._context,e.id,t,n);return this.plugin._messageBuffers[t.id].resolveMessagingBuffer(n),r.onClose.once(()=>{eo.debug("connection closed",this.toJSON(),{connectionId:r.id}),delete this._connections[t.id]}),this._connections[t.id]=r,r}unsubscribe(e){return B(this,null,function*(){yield this.channel._unsubscribe(e)})}_dispose(){this._disposer.dispose()}},jT=class extends bf{constructor(){super(...arguments),this.subtype="person",this._messageBuffers={},this._whenCreateLocalPerson=e=>B(this,null,function*(){e._signaling&&(this._messageBuffers[e.id]=new CT(e._signaling))}),this._whenDisposeLocalPerson=e=>B(this,null,function*(){const t=this._messageBuffers[e.id];t&&(t.close(),delete this._messageBuffers[e.id])}),this._createRemoteMember=(e,t)=>new yl(de(ee({},this._context),{context:this._context,channel:e,metadata:t.metadata,id:t.id,name:t.name,plugin:this}))}},BT=e=>{const t=new jT;return e.registerPlugin(t),t};W();var UT=class extends bf{constructor(){super(...arguments),this.subtype="unknown",this._createRemoteMember=(e,t)=>new i_(de(ee({},this._context),{context:this._context,channel:e,metadata:t.metadata,id:t.id,name:t.name,plugin:this,subtype:t.subtype}))}};W();var HT="1.15.0",Vn=new De("packages/core/src/context.ts"),Sf=class K_{constructor(t,n,r,i){this.config=n,this.authToken=r,this.info=i,this.disposed=!1,this.plugins=[],this._unknownPlugin=new UT,this._reminderSec=this.config.token.updateReminderSec,this._events=new ai,this.onTokenUpdateReminder=this._events.make(),this.onTokenExpired=this._events.make(),this.onFatalError=this._events.make(),this._onTokenUpdated=this._events.make(),this._onDisposed=this._events.make(),this._authTokenString=r.tokenString,this.appId=this.authToken.getAppId(),BT(this),this._api=t,this._api.onFatalError.once(a=>{Vn.error("onFatalError",{appId:this.appId,error:a}),this.onFatalError.emit(we({operationName:"SkyWayContext._api.onFatalError",context:this,info:Ae.rtcApiFatalError,error:a,path:Vn.prefix})),this.dispose()})}static Create(t){return B(this,arguments,function*(n,r={}){const i=new G4(r);De.level=i.log.level,De.format=i.log.format;const a=Xo.Decode(n),{osName:o,osVersion:u,browserName:p,browserVersion:h}=r_(),y={sdkName:"core",sdkVersion:this.version,osName:o,osVersion:u,browserName:p,browserVersion:h},f={rapi:i.rtcApi.domain,signaling:i.signalingService.domain,ice:i.iceParamServer.domain};Vn.info("core sdk spawned",{operationName:"SkyWayContext.Create",runtime:y,endpoint:f,config:i,token:a});try{const _=a.getAppId(),w=yield oT.Create({appId:_,token:n,log:i.log,rtcApi:i.rtcApi}),R=new K_(w,i,a,{endpoint:f,runtime:y});return yield R._setTokenExpireTimer(),a.getAnalyticsEnabled()&&(R.analyticsSession=yield ST(R)),R}catch(_){throw we({operationName:"SkyWayContext.Create",info:Ae.connectRtcApiFailed,error:_,path:Vn.prefix})}})}get authTokenString(){return this._authTokenString}_setTokenExpireTimer(){return B(this,null,function*(){const t=yield this._api.getServerUnixtimeInSec(),n=this.authToken.exp-t;if(n<0)throw we({operationName:"SkyWayContext._setTokenExpireTimer",context:this,info:Ae.invalidExpireTokenValue,path:Vn.prefix,payload:{exp:this.authToken.exp,now:t}});this.tokenUpdateReminderTimer&&clearTimeout(this.tokenUpdateReminderTimer);const r=n-this._reminderSec;if(r<0)throw we({operationName:"SkyWayContext._setTokenExpireTimer",context:this,info:Ae.invalidRemindExpireTokenValue,path:Vn.prefix,payload:{expiresInSec:n,reminderSec:this._reminderSec}});Vn.debug("_setTokenExpireTimer",{expiresInSec:n,tokenExpireReminderTimeSec:r}),this.tokenUpdateReminderTimer=setTimeout(()=>{Vn.debug("tokenUpdateReminder",{appid:this.appId}),this.onTokenUpdateReminder.emit()},r*1e3),this.tokenExpiredTimer&&clearTimeout(this.tokenExpiredTimer),this.tokenExpiredTimer=setTimeout(()=>{Vn.debug("tokenExpired",{appid:this.appId}),this.onTokenExpired.emit()},n*1e3)})}updateAuthToken(t){return B(this,null,function*(){const n=Xo.Decode(t),r=n.getAppId();if(Vn.info({operationName:"SkyWayContext.updateAuthToken"},{oldToken:this.authToken,newToken:n}),r!==this.appId)throw we({operationName:"SkyWayContext.updateAuthToken",context:this,info:Ae.invalidTokenAppId,path:Vn.prefix,payload:{invalid:r,expect:this.appId}});this._authTokenString=t,this.authToken=n,this._onTokenUpdated.emit(t),yield this._setTokenExpireTimer(),yield this._api.updateAuthToken(t).catch(i=>{var a;throw Vn.warn("[failed] SkyWayContext.updateAuthToken",{detail:i}),i instanceof Kn&&((a=i.info)==null?void 0:a.name)==="projectUsageLimitExceeded"&&(this.dispose(),clearTimeout(this.tokenExpiredTimer)),i})})}registerPlugin(t){this.plugins.find(n=>n.subtype===t.subtype)||(t._attachContext(this),this.plugins.push(t))}_createRemoteMember(t,n){const r=t._getMember(n.id);if(r)return r;Vn.debug("createRemoteMember",{memberDto:n}),n.type=n.type.toLowerCase(),n.subtype=n.subtype.toLowerCase();let i=this.plugins.find(o=>o.subtype===n.subtype);return i||(i=this._unknownPlugin),i._createRemoteMember(t,n)}dispose(){this.disposed||(this.disposed=!0,Vn.debug("disposed",{appid:this.appId}),clearTimeout(this.tokenUpdateReminderTimer),this._onDisposed.emit(),this._events.dispose(),this._api.close(),De._onLogForAnalytics=()=>{})}};Sf.version=HT;Sf.id=$r();var sp=Sf;W();W();var zd=new De("packages/core/src/media/factory.ts"),VT=class{constructor(){if(this.onDeviceChange=new Me,this._devices=[],!(navigator!=null&&navigator.mediaDevices))throw we({operationName:"StreamFactory.constructor",info:Ae.mediaDevicesNotFound,path:zd.prefix});navigator.mediaDevices.addEventListener("devicechange",()=>B(this,null,function*(){const e=yield this._enumerateDevicesArray(),t=[];this._devices.forEach(r=>{e.map(i=>i.id).includes(r.id)||t.push(r)});const n=[];e.map(r=>r.id).forEach(r=>{this._devices.map(i=>i.id).includes(r)||n.push(e.find(i=>i.id===r))}),zd.debug("device changed",{added:n,removed:t}),t.forEach(r=>{this.onDeviceChange.emit({state:"removed",device:r})}),n.forEach(r=>{this.onDeviceChange.emit({state:"added",device:r})}),this._devices=e}))}_enumerateDevicesArray(){return B(this,null,function*(){return(yield navigator.mediaDevices.enumerateDevices()).map(t=>new zT(t)).filter(t=>t.id.length>0)})}_enumerateDevicesWithAuth(){return B(this,arguments,function*({video:e,audio:t}={audio:!0,video:!0}){let n=[];return(e||t)&&(n=(yield navigator.mediaDevices.getUserMedia({video:e,audio:t})).getTracks()),this._devices=yield this._enumerateDevicesArray(),n.forEach(r=>r.stop()),this._devices})}enumerateDevices(){return B(this,null,function*(){return yield this._enumerateDevicesWithAuth()})}enumerateInputVideoDevices(){return B(this,null,function*(){return(yield this._enumerateDevicesWithAuth({video:!0})).filter(t=>t.kind==="videoinput")})}enumerateInputAudioDevices(){return B(this,null,function*(){return(yield this._enumerateDevicesWithAuth({audio:!0})).filter(t=>t.kind==="audioinput")})}enumerateOutputAudioDevices(){return B(this,null,function*(){return(yield this._enumerateDevicesWithAuth({audio:!0})).filter(t=>t.kind==="audiooutput")})}createCameraVideoStream(){return B(this,arguments,function*(e={}){var t;e.stopTrackWhenDisabled=(t=e.stopTrackWhenDisabled)!=null?t:!0;const[n]=(yield navigator.mediaDevices.getUserMedia({video:e})).getTracks(),r=new jd(n,e);return r._setLabel("camera"),r})}createMicrophoneAudioStream(){return B(this,arguments,function*(e={}){var t;e.stopTrackWhenDisabled=(t=e.stopTrackWhenDisabled)!=null?t:!0;const[n]=(yield navigator.mediaDevices.getUserMedia({audio:e})).getTracks(),r=new Ld(n,e);return r._setLabel("microphone"),r})}createDisplayStreams(){return B(this,arguments,function*(e={}){var t,n,r;const i=(t=e.video)!=null?t:{};(n=i.stopTrackWhenDisabled)!=null||(i.stopTrackWhenDisabled=!0);let a=e.audio;a&&(a=typeof a=="boolean"?{}:a,(r=a.stopTrackWhenDisabled)!=null||(a.stopTrackWhenDisabled=!0)),e={audio:a,video:i};const o=yield navigator.mediaDevices.getDisplayMedia(e),[u]=o.getVideoTracks(),[p]=o.getAudioTracks();e.audio&&!p&&zd.warn(Wt({operationName:"StreamFactory.createDisplayStreams",detail:"This client does not support device audio capture"}));const h=new jd(u,de(ee({},i),{isDisplayMedia:!0}));h._setLabel("displayVideo");const y=p?new Ld(p,de(ee({},a),{isDisplayMedia:!0})):void 0;return y&&y._setLabel("displayAudio"),{video:h,audio:y}})}createDataStream(){return B(this,arguments,function*(e={}){return new yf(e)})}createMicrophoneAudioAndCameraStream(){return B(this,arguments,function*({audio:e,video:t}={}){var n,r;const i=yield navigator.mediaDevices.getUserMedia({audio:e??!0,video:t??!0}),[a]=i.getAudioTracks(),[o]=i.getVideoTracks();e=e??{},e.stopTrackWhenDisabled=(n=e.stopTrackWhenDisabled)!=null?n:!0;const u=new Ld(a,e);u._setLabel("microphone"),t=t??{},t.stopTrackWhenDisabled=(r=t.stopTrackWhenDisabled)!=null?r:!0;const p=new jd(o,t);return p._setLabel("camera"),{audio:u,video:p}})}createCustomVideoStream(e){return B(this,arguments,function*(t,n={}){var r,i;n.stopTrackWhenDisabled=(r=n.stopTrackWhenDisabled)!=null?r:!0;const a=new w4(n),o=yield t.createProcessedStream({constraints:(i=n.constraints)!=null?i:{},stopTrackWhenDisabled:n.stopTrackWhenDisabled,onUpdateTrack:u=>a.updateTrack(u)});return yield a.setStream(o),a})}},qT=new VT,zT=class{constructor(e){this.id=e.deviceId,this.label=e.label,this.kind=e.kind}};W();W();W();W();W();W();W();W();W();W();var $_={domain:"sfu.skyway.ntt.com",secure:!0,version:4};W();var Fi={invalidParameter:{name:"invalidParameter",detail:"",solution:""},invalidRequestParameter:{name:"invalidRequestParameter",detail:"リクエストの値が不正です",solution:"正しい値を入力してください"},notFound:{name:"notFound",detail:"対象のリソースが見つかりません",solution:"対象のリソースが存在するか確かめてください"},maxSubscriberExceededError:{name:"maxSubscribersExceededError",detail:"forwardingのmaxSubscribersの制限を超えています。maxSubscribersの値を超えてSubscribeすることはできません",solution:"maxSubscribersの範囲内でご利用ください"},quotaExceededError:{name:"quotaExceededError",detail:"リソースの制限量を超えてリソースを利用することはできません",solution:"リソース制限量の範囲内でご利用ください"},timeout:{name:"timeout",detail:"",solution:""},insufficientPermissions:{name:"insufficientPermissions",detail:"tokenの権限が不足しています",solution:"tokenに必要な権限を付与してください"},backendError:{name:"backendError:",detail:"",solution:""},notAllowedConsumeError:{name:"notAllowedConsumeError",detail:"ForwardingからのConsume許可がありません",solution:"Forwardingしているmemberによる許可操作が必要です"}};W();function ls({operationName:e,info:t,error:n,path:r,payload:i}){return new Kn({error:n,info:t,payload:{payload:i,operationName:e},path:r})}function to({appId:e,detail:t,channelId:n,operationName:r,payload:i,memberId:a,botId:o}){return{operationName:r,payload:i,detail:t,appId:e,channelId:n,memberId:a,botId:o}}var kn=new De("packages/sfu-api-client/src/api.ts"),KT=class{constructor(e,t){this._token=e,this._headers={authorization:`Bearer ${this._token}`},this.options=ee(ee({},$_),t),this.endpoint=`http${this.options.secure?"s":""}://${this.options.domain}/v${this.options.version}`,this.http=new ff(this.endpoint),De.level=this.options.log.level,De.format=this.options.log.format,kn.debug("SfuRestApiClient spawned",{endpoint:this.endpoint})}updateToken(e){this._token=e}_commonErrorHandler(e,t){switch(e==null?void 0:e.status){case 401:return ls({operationName:t,info:Fi.invalidRequestParameter,path:kn.prefix,payload:e});case 403:return ls({operationName:t,info:Fi.insufficientPermissions,path:kn.prefix,payload:e});case 404:return ls({operationName:t,info:Fi.notFound,path:kn.prefix,payload:e});case 429:return ls({operationName:t,info:Fi.quotaExceededError,path:kn.prefix,payload:e});default:return ls({operationName:t,info:Fi.backendError,path:kn.prefix,payload:e})}}createBot(e){return B(this,arguments,function*({appId:t,channelId:n}){return(yield this.http.post("/bots",{appId:t,channelId:n},{headers:{authorization:`Bearer ${this._token}`}}).catch(i=>{throw this._commonErrorHandler(i,"SfuRestApiClient.createBot")})).id})}deleteBot(e){return B(this,arguments,function*({botId:t}){yield this.http.delete(`/bots/${t}`,{headers:{authorization:`Bearer ${this._token}`}}).catch(n=>{throw this._commonErrorHandler(n,"SfuRestApiClient.deleteBot")})})}startForwarding(e){return B(this,arguments,function*({botId:t,publicationId:n,maxSubscribers:r,contentType:i,publisherId:a}){const o=new Mr,u={publicationId:n,maxSubscribers:r,contentType:i[0].toUpperCase()+i.slice(1),publisherId:a},p=yield this.http.post(`/bots/${t}/forwardings`,u,{headers:{authorization:`Bearer ${this._token}`},retry:h=>B(this,null,function*(){return[400,403,429].includes(h.status)?!1:yield o.wait()})}).catch(h=>{throw this._commonErrorHandler(h,"SfuRestApiClient.startForwarding")});return o.count>0&&kn.warn("success to retry startForwarding",to({operationName:"SfuRestApiClient.startForwarding",detail:"success to retry startForwarding",botId:t,memberId:a,payload:{publicationId:n,count:o.count}})),p})}createProducer(e){return B(this,arguments,function*({botId:t,forwardingId:n,transportId:r,producerOptions:i}){const a=new Mr,o=yield this.http.put(`/bots/${t}/forwardings/${n}/transports/producers`,{transportId:r,producerOptions:i},{headers:{authorization:`Bearer ${this._token}`},retry:()=>B(this,null,function*(){return yield a.wait()})}).catch(u=>{throw this._commonErrorHandler(u,"SfuRestApiClient.createProducer")});return a.count>0&&kn.warn("success to retry createProducer",to({operationName:"SfuRestApiClient.createProducer",detail:"success to retry createProducer",botId:t,payload:{forwardingId:n,transportId:r,count:a.count}})),o})}createConsumer(e){return B(this,arguments,function*({botId:t,forwardingId:n,rtpCapabilities:r,subscriptionId:i,subscriberId:a,spatialLayer:o,originPublicationId:u}){const p=new Mr({times:5,interval:100}),h={rtpCapabilities:r,subscriptionId:i,subscriberId:a,spatialLayer:o,originPublicationId:u},y=yield this.http.post(`/bots/${t}/forwardings/${n}/transports/consumers`,h,{retry:f=>B(this,null,function*(){return[400,403,429].includes(f.status)?!1:yield p.wait()}),headers:{authorization:`Bearer ${this._token}`}}).catch(f=>{throw f.status===429?ls({operationName:"SfuRestApiClient.createConsumer",info:Fi.maxSubscriberExceededError,path:kn.prefix,payload:f}):f.status===403?ls({operationName:"SfuRestApiClient.createConsumer",info:Fi.notAllowedConsumeError,path:kn.prefix,payload:f}):this._commonErrorHandler(f,"SfuRestApiClient.createConsumer")});return p.count>0&&kn.warn("success to retry createConsumer",to({operationName:"SfuRestApiClient.createConsumer",detail:"success to retry createConsumer",botId:t,payload:{forwardingId:n,count:p.count}})),kn.debug("response of createConsumer",y),y})}connect(e){return B(this,arguments,function*({transportId:t,dtlsParameters:n}){const r=new Mr,i={transportId:t,dtlsParameters:n},a=yield this.http.put("/transports/connections",i,{headers:{authorization:`Bearer ${this._token}`},retry:()=>B(this,null,function*(){return yield r.wait()})}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.connect")});return r.count>0&&kn.warn("success to retry connect",to({operationName:"SfuRestApiClient.connect",detail:"success to retry connect",payload:{transportId:t,count:r.count}})),a})}changeConsumerLayer(e){return B(this,arguments,function*({transportId:t,consumerId:n,spatialLayer:r,publicationId:i}){return yield this.http.put(`transports/consumers/${n}/layers`,{transportId:t,spatialLayer:r,publicationId:i},{headers:{authorization:`Bearer ${this._token}`}}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.changeConsumerLayer")})})}stopForwarding({botId:e,forwardingId:t}){let n=!1;return{promise:this.http.delete(`/bots/${e}/forwardings/${t}`,{headers:{authorization:`Bearer ${this._token}`}}).catch(i=>{throw this._commonErrorHandler(i,"SfuRestApiClient.stopForwarding")}).then(i=>{n=i}),fulfilled:n}}iceRestart(e){return B(this,arguments,function*({transportId:t}){return(yield this.http.put("/transports/connections/ice",{transportId:t},{headers:this._headers}).catch(r=>{throw this._commonErrorHandler(r,"SfuRestApiClient.iceRestart")})).iceParameters})}getRtpCapabilities(e){return B(this,arguments,function*({botId:t,forwardingId:n,originPublicationId:r}){const i=new Mr,a=yield this.http.get(`/bots/${t}/forwardings/${n}/transports/rtp-capabilities?originPublicationId=${r}`,{headers:{authorization:`Bearer ${this._token}`},retry:()=>B(this,null,function*(){return yield i.wait()})}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.getRtpCapabilities")});return i.count>0&&kn.warn("getCapabilities to retry connect",to({operationName:"SfuRestApiClient.getRtpCapabilities",detail:"getCapabilities to retry connect",botId:t,payload:{forwardingId:n,count:i.count}})),a.rtpCapabilities})}confirmSubscription(e){return B(this,arguments,function*({forwardingId:t,subscriptionId:n,identifierKey:r}){const i={forwardingId:t,subscriptionId:n,identifierKey:r},a=yield this.http.post("/confirm-subscription",i,{headers:{authorization:`Bearer ${this._token}`}}).catch(o=>{throw this._commonErrorHandler(o,"SfuRestApiClient.confirmSubscription")});return kn.debug("response of confirmSubscription",a),a})}},mt=de(ee({},Fi),{invalidParameter:{name:"invalidParameter",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internal:{name:"internal",detail:"",solution:""},sfuBotNotInChannel:{name:"sfuBotNotInChannel",detail:"SfuBotがChannelに存在しません",solution:"操作しようとしているSfuBotが正しいか確かめてください"},remotePublisherId:{name:"remotePublisherId",detail:"publisherがremoteのPublicationをForwardingすることはできません",solution:"PublicationがLocalでPublishされたものか確かめてください"},dataStreamNotSupported:{name:"dataStreamNotSupported",detail:"dataStreamはSFUに対応していません",solution:"ありません"},streamNotExistInPublication:{name:"streamNotExistInPublication",detail:"PublicationにStreamがありません。RemoteMemberのPublicationのStreamにはアクセスできません",solution:"参照しているPublicationが目的のものか確かめてください。"},invalidPreferredEncoding:{name:"invalidPreferredEncoding",detail:"preferredEncodingの値が不正です。エンコード設定切り替え機能が使えません",solution:"正しい文字列を入力してください"},invalidEncodings:{name:"invalidEncodings",detail:"エンコード設定が設定されていません。エンコード設定切り替え機能が使えません",solution:"エンコード設定切り替え機能を利用する場合はエンコード設定をしたPublicationをForwardingしてください"},receiverNotFound:{name:"receiverNotFound",detail:"SFUはRemoteMemberのSubscriptionを操作できません",solution:"SFUでsubscriptionの操作をする際にはLocalPersonがSubscribeしているSubscriptionインスタンスを利用してください"},consumerNotFound:{name:"consumerNotFound",detail:"SFUはLocalPersonがUnsubscribeしたSubscriptionを操出来ません",solution:"操作対象のSubscriptionが正しいか確かめてください"},forwardingNotFound:{name:"forwardingNotFound",detail:"存在しないForwardingを操作しようとしています",solution:"対象のForwardingが正しいか確かめてください"},netWorkError:{name:"netWorkError",detail:"通信環境に問題があります",solution:"ネットワーク接続状況を確認してください"},confirmSubscriptionFailed:{name:"confirmSubscriptionFailed",detail:"Forwardingのconsume許可を出すのに失敗しました",solution:"ありません"}});W();function ap(e,t){let n=0;for(;n<t.length&&t[n].id!==e;n++);return n}function fs({channel:e,detail:t,operationName:n,payload:r,bot:i}){var a;const o={operationName:n,payload:r,detail:t};return e&&(o.appId=e.appId,o.channelId=e.id,e.localPerson&&(o.memberId=e.localPerson.id)),i&&(o.botId=i.id,o.appId=i.channel.appId,o.channelId=i.channel.id,o.memberId=(a=i.channel.localPerson)==null?void 0:a.id),o}W();var pr=new De("packages/sfu-bot/src/connection/receiver.ts"),$T=class{constructor(e,t,n,r,i,a,o){this.subscription=e,this._api=t,this._transportRepository=n,this._localPerson=r,this._bot=i,this._iceManager=a,this._context=o,this._disposer=new lr,this.sendSubscriptionStatsReportTimer=null,this._waitingSendSubscriptionStatsReports=[];const u=this._localPerson._analytics;u&&u.onConnectionStateChanged.add(p=>{if(p==="connected"&&this._waitingSendSubscriptionStatsReports.length>0){for(const h of this._waitingSendSubscriptionStatsReports)this.consumer&&this.consumer.id===h&&this.startSendSubscriptionStatsReportTimer();this._waitingSendSubscriptionStatsReports=[]}})}toJSON(){return{transport:this.transport,subscription:this.subscription}}consume(){return B(this,null,function*(){var e,t;let n=this._transportRepository.rtpCapabilities;n||(pr.debug("[start] getCapabilities"),n=yield this._api.getRtpCapabilities({botId:this._bot.id,forwardingId:this.subscription.publication.id,originPublicationId:this.subscription.publication.origin.id}),pr.debug("[end] getCapabilities"),yield this._transportRepository.loadDevice(n).catch(w=>{throw we({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:de(ee({},mt.internal),{detail:"sfu loadDevice failed"}),path:pr.prefix,error:w})}));const r=this.subscription.preferredEncoding?ap(this.subscription.preferredEncoding,(t=(e=this.subscription.publication.origin)==null?void 0:e.encodings)!=null?t:[]):void 0;pr.debug("[start] createConsumer",{subscription:this.subscription});const{consumerOptions:i,transportOptions:a,transportId:o,producerId:u}=yield this._api.createConsumer({botId:this._bot.id,forwardingId:this.subscription.publication.id,rtpCapabilities:n,subscriptionId:this.subscription.id,subscriberId:this.subscription.subscriber.id,spatialLayer:r,originPublicationId:this.subscription.publication.origin.id});a&&this._transportRepository.createTransport(this._localPerson.id,this._bot,a,"recv",this._iceManager,this._localPerson._analytics),this.transport=this._transportRepository.getTransport(this._localPerson.id,o),this.transport||(pr.warn("transport is under race condition",{transportId:o}),yield this._transportRepository.onTransportCreated.watch(w=>w===o,this._bot.options.endpointTimeout).catch(w=>{throw we({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:de(ee({},mt.timeout),{detail:"receiver sfuTransport not found"}),path:pr.prefix,error:w,payload:{transportOptions:a,transportId:o,producerId:u,consumerOptions:i,subscription:this.subscription}})}),this.transport=this._transportRepository.getTransport(this._localPerson.id,o)),this._localPerson._analytics&&!this._localPerson._analytics.isClosed()&&this._localPerson._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:this.subscription.id,role:"receiver",rtcPeerConnectionId:this.transport.id}),pr.debug("[end] createConsumer"),pr.debug("[start] consume",{consumerOptions:i,subscription:this.subscription});const p=yield this.transport.msTransport.consume(de(ee({},i),{producerId:u})).catch(w=>{throw we({operationName:"Receiver.consume",context:this._context,channel:this._localPerson.channel,info:de(ee({},mt.internal),{detail:"consume failed, maybe subscribing unsupported codec"}),path:pr.prefix,error:w})});this.consumer=p,pr.debug("[end] consume",{subscription:this.subscription});const[h]=p.rtpParameters.codecs,y=ip(Da(),p.track,h),f={mimeType:h.mimeType,parameters:h.parameters};this._setupTransportAccessForStream(y,p);const _=this._localPerson._analytics;return _&&!_.isClosed()&&(_.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer():this._waitingSendSubscriptionStatsReports.push(p.id)),{stream:y,codec:f}})}_setupTransportAccessForStream(e,t){const n=this.transport,r=this.pc;e._getTransport=()=>({rtcPeerConnection:r,connectionState:n.connectionState,info:this}),e._getStats=()=>B(this,null,function*(){const i=yield t.getStats();let a=Sa(i);return a=a.map(o=>(o.sfuTransportId=n.id,o)),a}),this._disposer.push(()=>{e._getTransport=()=>{}}),n.onConnectionStateChanged.add(i=>{pr.debug("transport connection state changed",n.id,i),e._setConnectionState(i)})}unconsume(){if(!this.consumer){pr.debug("unconsume failed, consumer not exist",{subscription:this.subscription});return}this.consumer.close(),this.consumer=void 0,this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer)}close(){this._disposer.dispose()}get pc(){var e;return(e=this.transport)==null?void 0:e.pc}startSendSubscriptionStatsReportTimer(){const e=this._localPerson._analytics;if(e){const t=e.client.getIntervalSec();this.sendSubscriptionStatsReportTimer=setInterval(()=>B(this,null,function*(){if(!e||e.isClosed()){this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer);return}if(this.consumer){const n=yield this.consumer.getStats();n&&e.client.sendSubscriptionStatsReport(n,{subscriptionId:this.subscription.id,role:"receiver",contentType:this.subscription.contentType,createdAt:Date.now()})}}),t*1e3)}}};W();var jg=Xn(vy());W();var Wc=new De("packages/sfu-bot/src/connection/sender.ts"),WT=class{constructor(e){this.props=e,this.state="started",this.configure=this.props.configure,this.originPublication=this.props.originPublication,this.relayingPublication=this.props.relayingPublication,this._identifierKey=this.props.identifierKey,this._api=this.props.api,this._context=this.props.context,this.onStopped=new Me,this.relayingPublication.onSubscribed.add(t=>B(this,null,function*(){yield this.confirmSubscription(t.subscription).catch(n=>n)})),this.relayingPublication.subscriptions.forEach(t=>B(this,null,function*(){yield this.confirmSubscription(t).catch(n=>n)}))}get id(){return this.relayingPublication.id}_stop(){this.state="stopped",this.onStopped.emit()}toJSON(){return{id:this.id,configure:this.configure,originPublication:this.originPublication,relayingPublication:this.relayingPublication}}confirmSubscription(e){return B(this,null,function*(){Wc.debug("[start] Forwarding confirmSubscription");const{message:t}=yield this._api.confirmSubscription({forwardingId:this.id,subscriptionId:e.id,identifierKey:this._identifierKey}).catch(n=>{throw Wc.error("Forwarding confirmSubscription failed:",n),we({operationName:"Forwarding.confirmSubscription",context:this._context,info:mt.confirmSubscriptionFailed,path:Wc.prefix,payload:n})});Wc.debug("[end] Forwarding confirmSubscription",{message:t})})}},Et=new De("packages/sfu-bot/src/connection/sender.ts"),GT=class{constructor(e,t,n,r,i,a,o,u){this.publication=e,this.channel=t,this._api=n,this._transportRepository=r,this._localPerson=i,this._bot=a,this._iceManager=o,this._context=u,this._disposer=new lr,this._connectionState="new",this.onConnectionStateChanged=new Me,this.closed=!1,this.sendSubscriptionStatsReportTimer=null,this._waitingSendSubscriptionStatsReports=[];const p=this._localPerson._analytics;p&&p.onConnectionStateChanged.add(h=>{if(h==="connected"&&this._waitingSendSubscriptionStatsReports.length>0){for(const y of this._waitingSendSubscriptionStatsReports)this._producer&&this._producer.id===y&&this.startSendSubscriptionStatsReportTimer();this._waitingSendSubscriptionStatsReports=[]}})}_setConnectionState(e){this._connectionState!==e&&(Et.debug("_setConnectionState",{state:e,forwardingId:this.forwardingId}),this._connectionState=e,this.onConnectionStateChanged.emit(e))}toJSON(){return{forwarding:this.forwarding,broadcasterTransport:this._broadcasterTransport,_connectionState:this._connectionState}}startForwarding(e){return B(this,null,function*(){if(this.publication.contentType==="data")throw we({operationName:"Sender.startForwarding",context:this._context,info:mt.dataStreamNotSupported,path:Et.prefix,channel:this.channel});const t=this.publication.stream;if(!t)throw we({operationName:"Sender.startForwarding",context:this._context,info:mt.streamNotExistInPublication,path:Et.prefix,channel:this.channel});this.onConnectionStateChanged.add(w=>{var R;Et.debug("transport connection state changed",(R=this._broadcasterTransport)==null?void 0:R.id,w),t._setConnectionState(this._bot,w)}).disposer(this._disposer),Et.debug("[start] Sender startForwarding",{botId:this._bot.id,publicationId:this.publication.id,contentType:this.publication.contentType,maxSubscribers:e.maxSubscribers});const{forwardingId:n,broadcasterTransportId:r,broadcasterTransportOptions:i,rtpCapabilities:a,identifierKey:o}=yield this._api.startForwarding({botId:this._bot.id,publicationId:this.publication.id,contentType:this.publication.contentType,maxSubscribers:e.maxSubscribers,publisherId:this.publication.publisher.id});if(this.forwardingId=n,i&&(Et.debug("sender create new transport",{broadcasterTransportOptions:i}),yield this._transportRepository.loadDevice(a),this._broadcasterTransport=this._transportRepository.createTransport(this._localPerson.id,this._bot,i,"send",this._iceManager,this._localPerson._analytics)),this._broadcasterTransport=this._transportRepository.getTransport(this._localPerson.id,r),!this._broadcasterTransport)throw we({operationName:"Sender.startForwarding",context:this._context,info:de(ee({},mt.internal),{detail:"_broadcasterTransport not found"}),path:Et.prefix,channel:this.channel,payload:{broadcasterTransportOptions:i}});this._broadcasterTransport.onConnectionStateChanged.add(w=>{this._setConnectionState(w)}).disposer(this._disposer),this._setConnectionState(this._broadcasterTransport.connectionState);const u=yield this._produce(t,this._broadcasterTransport);this._cleanupStreamCallbacks=this._setupTransportAccessForStream(t,this._broadcasterTransport,u);const p=this._localPerson._analytics;p&&!p.isClosed()&&(p.client.isConnectionEstablished()?this.startSendSubscriptionStatsReportTimer():this._waitingSendSubscriptionStatsReports.push(u.id)),Et.debug("[end] Sender startForwarding",{forwardingId:n});let h=this.channel._getPublication(n);h||(h=(yield this.channel.onStreamPublished.watch(w=>w.publication.id===n,this._context.config.rtcApi.timeout).catch(()=>{throw we({operationName:"Sender.startForwarding",context:this._context,info:de(ee({},mt.timeout),{detail:"SfuBotMember onStreamPublished"}),path:Et.prefix,channel:this.channel,payload:{forwardingId:n}})})).publication);const y=new WT({configure:e,originPublication:this.publication,relayingPublication:h,api:this._api,context:this._context,identifierKey:o});this.forwarding=y;const f=this.channel.subscriptions.find(w=>w.publication.id===this.publication.id),[_]=u.rtpParameters.codecs;return f.codec=_,this._localPerson._analytics&&this._localPerson._analytics.client.connectionState!=="closed"&&this._localPerson._analytics.client.sendBindingRtcPeerConnectionToSubscription({subscriptionId:f.id,role:"sender",rtcPeerConnectionId:this._broadcasterTransport.id}),H_()&&fg({stream:t,remoteMember:this._bot.id,end:w=>{const R=w.find(F=>F.id.includes("RTCOutboundRTP")||F.type.includes("outbound-rtp"));return(R==null?void 0:R.keyFramesEncoded)>0},interval:10}).then(()=>B(this,null,function*(){const w=this.publication.encodings;(w==null?void 0:w.length)>0&&(yield yo(u.rtpSender,w).catch(R=>{Et.error("_onEncodingsChanged failed",R,this)}))})).catch(w=>{Et.error("setEncodingParams waitForLocalStats failed",w,this)}),fg({stream:t,remoteMember:this._bot.id,end:w=>!!w.find(R=>R.type.includes("local-candidate"))}).then(()=>B(this,null,function*(){const w=yield Qe({operationName:"startForwarding/waitForLocalStats",channel:this.channel});Et.debug(w,"forwarding connection connected",{broadcasterTransportId:r})})).catch(()=>{}),y})}_listenStreamEnableChange(e){this._unsubscribeStreamEnableChange&&this._unsubscribeStreamEnableChange();const{removeListener:t}=e._onEnableChanged.add(n=>B(this,null,function*(){yield this._replaceTrack(n).catch(r=>{Et.warn(fs({detail:"replaceTrack failed",operationName:"Sender._listenStreamEnableChange",bot:this._bot,payload:r}))})}));this._unsubscribeStreamEnableChange=t}_produce(e,t){return B(this,null,function*(){var n,r,i,a,o,u,p,h;this.publication._onReplaceStream.add(b=>B(this,[b],function*({newStream:x}){if(!this._broadcasterTransport)throw we({operationName:"Sender._produce",context:this._context,info:de(ee({},mt.internal),{detail:"_broadcasterTransport not found"}),path:Et.prefix,channel:this.channel});this._listenStreamEnableChange(x),this._cleanupStreamCallbacks&&this._cleanupStreamCallbacks(),this._cleanupStreamCallbacks=this._setupTransportAccessForStream(x,this._broadcasterTransport,S),yield this._replaceTrack(x.track)})).disposer(this._disposer),this._listenStreamEnableChange(e);const y=Da(),f={track:e.track,stopTracks:!1,appData:{transactionId:y},disableTrackOnPause:!1},_=this.publication.encodings;_&&(f.encodings=_),this.publication._onEncodingsChanged.add(b=>B(this,null,function*(){yield yo(S.rtpSender,b).catch(x=>{Et.error("_onEncodingsChanged failed",x,this)})})).disposer(this._disposer);const w=this.publication.codecCapabilities,R=(r=(n=this._transportRepository.rtpCapabilities)==null?void 0:n.codecs)!=null?r:[];Et.debug("select codec",{codecCapabilities:w,deviceCodecs:R});const[F]=w.map(b=>b.mimeType.toLowerCase().includes("video")?R.find(L=>{var G;return!(L.mimeType.toLowerCase()!==b.mimeType.toLowerCase()||Object.keys((G=b.parameters)!=null?G:{}).length>0&&!(0,jg.default)(b.parameters,L.parameters))}):R.find(k=>k.mimeType.toLowerCase()===b.mimeType.toLowerCase()));if(Et.debug("selected codec",{codec:F}),F){const[b,x]=F.mimeType.split("/");f.codec=de(ee({},F),{mimeType:`${b}/${x.toUpperCase()}`}),e.contentType==="video"&&this._fixVideoCodecWithParametersOrder(F)}else w.length>0&&Et.warn("preferred codec not supported",fs({channel:this.channel,detail:"preferred codec not supported",operationName:"Sender._produce",bot:this._bot,payload:{codecCapabilities:w,deviceCodecs:R}}));e.contentType==="audio"&&(((a=(i=w.find(L=>L.mimeType.toLowerCase()==="audio/opus"))==null?void 0:i.parameters)==null?void 0:a.usedtx)!==!1&&(f.codecOptions=de(ee({},f.codecOptions),{opusDtx:!0})),(u=(o=w.find(L=>L.mimeType.toLowerCase()==="audio/opus"))==null?void 0:o.parameters)!=null&&u.stereo&&(f.codecOptions=de(ee({},f.codecOptions),{opusStereo:!0})),(h=(p=w.find(L=>L.mimeType.toLowerCase()==="audio/opus"))==null?void 0:p.parameters)!=null&&h.useinbandfec&&(f.codecOptions=de(ee({},f.codecOptions),{opusFec:!0}))),t.onProduce.watch(b=>{var x;return((x=b.producerOptions.appData)==null?void 0:x.transactionId)===y},this._context.config.rtcConfig.timeout).then(b=>B(this,null,function*(){try{const{producerId:x}=yield this._api.createProducer({botId:this._bot.id,transportId:t.id,forwardingId:this.forwardingId,producerOptions:b.producerOptions});b.callback({id:x})}catch(x){b.errback(x)}})).catch(b=>{Et.error("onProduce failed",b,this)}),Et.debug("[start] msTransport.produce",this);const S=yield t.msTransport.produce(f).catch(b=>{throw we({operationName:"Sender._produce",context:this._context,info:de(ee({},mt.internal),{detail:"msTransport.produce failed"}),path:Et.prefix,channel:this.channel,error:b})});return Et.debug("[end] msTransport.produce",this),this._producer=S,S})}_fixVideoCodecWithParametersOrder(e){const t=this._broadcasterTransport.msTransport._handler,n=i=>i.mimeType===e.mimeType?e.parameters&&Object.keys(e.parameters).length>0?!!(0,jg.default)(i.parameters,e.parameters):!0:!1,r=(i,a)=>{for(const o of Object.keys(i))o!=="payloadType"&&(i[o]=a[o])};if(t._sendingRtpParametersByKind){const i=t._sendingRtpParametersByKind.video,a=i.codecs.find(n);if(i&&a){const o=JSON.parse(JSON.stringify(i)),[u]=i.codecs,p=JSON.parse(JSON.stringify(u));r(u,a),r(a,p),Et.debug("sort _sendingRtpParametersByKind",{origin:o,new:i.codecs})}}if(t._sendingRemoteRtpParametersByKind){const i=t._sendingRemoteRtpParametersByKind.video,a=i.codecs.find(n);if(i&&a){const o=JSON.parse(JSON.stringify(i)),[u]=i.codecs,p=JSON.parse(JSON.stringify(u));r(u,a),r(a,p),Et.debug("sort _sendingRemoteRtpParametersByKind",{origin:o,new:i.codecs})}}}_setupTransportAccessForStream(e,t,n){e._getTransportCallbacks[this._bot.id]=()=>({rtcPeerConnection:t.pc,connectionState:t.connectionState,info:this}),e._getStatsCallbacks[this._bot.id]=()=>B(this,null,function*(){if(n.closed)return delete e._getStatsCallbacks[this._bot.id],[];const i=yield n.getStats();let a=Sa(i);return a=a.map(o=>(o.sfuTransportId=t.id,o)),a});const r=()=>{delete e._getTransportCallbacks[this._bot.id],delete e._getStatsCallbacks[this._bot.id]};return this._disposer.push(()=>{r()}),r}unproduce(){this._producer&&(this._producer.close(),this._producer=void 0,this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer))}_replaceTrack(e){return B(this,null,function*(){var t,n;yield(n=(t=this._producer)==null?void 0:t.replaceTrack)==null?void 0:n.call(t,{track:e}).catch(r=>{throw we({operationName:"Sender._replaceTrack",context:this._context,info:mt.internal,error:r,path:Et.prefix,channel:this.channel})})})}close(){this.closed=!0,this._unsubscribeStreamEnableChange&&this._unsubscribeStreamEnableChange(),this._setConnectionState("disconnected"),this._disposer.dispose()}get pc(){var e;return(e=this._broadcasterTransport)==null?void 0:e.pc}startSendSubscriptionStatsReportTimer(){const e=this._localPerson._analytics,t=this._bot.subscriptions.find(n=>n.publication.id===this.publication.id);if(t&&e){const n=e.client.getIntervalSec();this.sendSubscriptionStatsReportTimer=setInterval(()=>B(this,null,function*(){if(!e||e.isClosed()){this.sendSubscriptionStatsReportTimer&&clearInterval(this.sendSubscriptionStatsReportTimer);return}if(this._producer){const r=yield this._producer.getStats();r&&e.client.sendSubscriptionStatsReport(r,{subscriptionId:t.id,role:"sender",contentType:this.publication.contentType,createdAt:Date.now()})}}),n*1e3)}}},fr=new De("packages/sfu-bot/src/connection/index.ts"),ZT=class{constructor(e,t,n,r,i,a){this._api=e,this.channel=t,this.localPerson=n,this.remoteMember=r,this._transportRepository=i,this._context=a,this.type="sfu",this.onDisconnect=new Me,this.onClose=new Me,this.closed=!1,this._receivers={},this._senders={}}addSender(e){const t=new GT(e,this.channel,this._api,this._transportRepository,this.localPerson,this.remoteMember,this.localPerson.iceManager,this._context);return this._senders[e.id]=t,t}removeSender(e){fr.debug("removeSender",e);const t=this._senders[e];t&&t.unproduce()}startSubscribing(e){return B(this,null,function*(){var t;const n=new $T(e,this._api,this._transportRepository,this.localPerson,this.remoteMember,this.localPerson.iceManager,this._context);this._receivers[e.id]=n;const r=fr.debug("[start] _startSubscribing consume"),{stream:i,codec:a}=yield n.consume().catch(o=>{throw fr.error("[failed] _startSubscribing consume",we({operationName:"SFUConnection.startSubscribing",context:this._context,channel:this.channel,info:de(ee({},mt.internal),{detail:"failed to receiver.consume"}),error:o,path:fr.prefix,payload:{subscription:e.toJSON()}})),o});if(fr.elapsed(r,"[end] _startSubscribing consume"),i.setIsEnabled(e.publication.state==="enabled"),e.codec=a,e._setStream(i),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()){const o=e.preferredEncoding,u=(t=e.publication.origin)==null?void 0:t.encodings;if(!o||!u||u.length===0)return;const p=ap(o,u);this.localPerson._analytics.client.sendSubscriptionUpdatePreferredEncodingReport({subscriptionId:e.id,preferredEncodingIndex:p,updatedAt:Date.now()})}})}stopSubscribing(e){return B(this,null,function*(){const t=this._receivers[e.id];t&&t.unconsume()})}stopPublishing(e){return B(this,null,function*(){this.removeSender(e.id)})}close({reason:e}={}){this.closed||(fr.debug("close sfu connection",{remote:this.remoteMember,local:this.localPerson,reason:e}),this.closed=!0,Object.values(this._senders).forEach(t=>{t.close()}),Object.values(this._receivers).forEach(t=>{t.close()}),this._senders={},this._receivers={},this.onClose.emit())}_getReceiver(e){return this._receivers[e]}changePreferredEncoding(e){return B(this,null,function*(){var t;const n=e.preferredEncoding,r=(t=e.publication.origin)==null?void 0:t.encodings;if(fr.debug("changePreferredEncoding",{preferredEncoding:n,encodings:r,subscription:e}),!n)throw we({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:mt.invalidPreferredEncoding,path:fr.prefix,payload:{subscription:e}});if(!r||r.length===0)throw we({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:mt.invalidEncodings,path:fr.prefix,payload:{subscription:e}});const i=ap(n,r),a=this._getReceiver(e.id);if(!a)throw we({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:mt.receiverNotFound,path:fr.prefix,payload:{subscription:e}});const o=a.transport;if(!o)throw we({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:de(ee({},mt.internal),{detail:"transport not found"}),path:fr.prefix,payload:{subscription:e}});const u=a.consumer;if(!u)throw we({operationName:"SFUConnection.changePreferredEncoding",context:this._context,channel:this.channel,info:mt.consumerNotFound,path:fr.prefix,payload:{subscription:e}});yield this._api.changeConsumerLayer({transportId:o.id,consumerId:u.id,publicationId:e.publication.id,spatialLayer:i}),this.localPerson._analytics&&!this.localPerson._analytics.isClosed()&&this.localPerson._analytics.client.sendSubscriptionUpdatePreferredEncodingReport({subscriptionId:e.id,preferredEncodingIndex:i,updatedAt:Date.now()})})}};W();W();var JT=10,Tn=new De("packages/sfu-bot/src/member.ts"),W_=class G_ extends Lu{constructor(t){super(t),this.side="remote",this.subtype=G_.subtype,this.type="bot",this._connections={},this.onForwardingStarted=new Me,this.onForwardingStopped=new Me,this.onForwardingListChanged=new Me,this._startForwardQueue=new is,this._forwardings={},this.stopForwarding=n=>new Promise((r,i)=>B(this,null,function*(){const a=Tn.info("[start] stopForwarding",yield Qe({operationName:"SfuBotMember.stopForwarding",channel:this.channel}));if(this.state!=="joined"){i(we({operationName:"SfuBotMember.stopForwarding",context:this._context,info:mt.sfuBotNotInChannel,path:Tn.prefix,channel:this.channel,payload:{status:this.state}}));return}const o=typeof n=="string"?n:n.id,u=this._forwardings[o];if(!u){i(we({operationName:"SfuBotMember.stopForwarding",context:this._context,info:mt.forwardingNotFound,path:Tn.prefix,channel:this.channel,payload:{forwardingId:o,_forwardings:Object.keys(this._forwardings)}}));return}delete this._forwardings[u.id];const{promise:p,fulfilled:h}=this._api.stopForwarding({botId:this.id,forwardingId:o});let y=!1;p.catch(f=>{y=!0,i(f)}),this.onForwardingStopped.watch(f=>f.forwarding.id===o,this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){Tn.elapsed(a,"[end] stopForwarding",yield Qe({operationName:"SfuBotMember.stopForwarding",channel:this.channel})),r()})).catch(f=>{y||i(we({operationName:"SfuBotMember.stopForwarding",context:this._context,info:de(ee({},mt.timeout),{detail:"onForwardingStopped"}),path:Tn.prefix,channel:this.channel,payload:{fulfilled:h},error:f}))})})),this._api=t.api,this._context=t.context,this._transportRepository=t.transportRepository,this.options=t.options,this.onLeft.once(()=>{Tn.debug("SfuBotMember left: ",{id:this.id}),Object.values(this._connections).forEach(n=>{n.close({reason:"sfu bot left"})}),this._connections={}})}get forwardings(){return Object.values(this._forwardings)}_getConnection(t){return this._connections[t]}_getOrCreateConnection(t){var n;return(n=this._getConnection(t.id))!=null?n:this._createConnection(this.channel,t,this)}_createConnection(t,n,r){const i=new ZT(r._api,t,n,r,this._transportRepository,this._context);return i.onClose.once(()=>{delete this._connections[n.id]}),this._connections[n.id]=i,i}startForwarding(t){return B(this,arguments,function*(n,r={}){const i=Tn.info("[start] startForwarding",yield Qe({operationName:"SfuBotMember.startForwarding",channel:this.channel})),a=yield this._startForwardQueue.push(()=>this._startForwarding(n,r));return Tn.elapsed(i,"[end] startForwarding",yield Qe({operationName:"SfuBotMember.startForwarding",channel:this.channel})),a})}_startForwarding(t,n){return B(this,null,function*(){if(n.maxSubscribers==null&&(n.maxSubscribers=JT),this.state!=="joined")throw we({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:mt.sfuBotNotInChannel,path:Tn.prefix,payload:{status:this.state}});if(!this.channel._getPublication(t.id))throw we({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:Ae.publicationNotExist,path:Tn.prefix});const r=this.channel.localPerson;if(!r)throw we({operationName:"SfuBotMember._startForwarding",context:this._context,channel:this.channel,info:Ae.localPersonNotJoinedChannel,path:Tn.prefix});if(r.id!==t.publisher.id)throw we({operationName:"SfuBotMember._startForwarding",context:this._context,info:mt.remotePublisherId,path:Tn.prefix,channel:this.channel});const i=Tn.debug("[start] SfuBotMember startForwarding",{publication:t.toJSON(),configure:n}),u=yield this._getOrCreateConnection(r).addSender(t).startForwarding(n).catch(p=>{throw we({operationName:"SfuBotMember._startForwarding",context:this._context,info:de(ee({},mt.internal),{detail:"[failed] SfuBotMember startForwarding"}),path:Tn.prefix,channel:this.channel,error:p,payload:{publication:t.toJSON()}})});return this._forwardings[u.id]=u,this.listenStopForwardEvent(u),this.onForwardingStarted.emit({forwarding:u}),this.onForwardingListChanged.emit(),Tn.elapsed(i,"[end] SfuBotMember startForwarding",{forwarding:u.toJSON()}),u})}listenStopForwardEvent(t){const{removeListener:n}=this.channel.onStreamUnpublished.add(r=>{if(r.publication.id===t.id){n(),t._stop();const i=t.originPublication,a=this._getConnection(i.publisher.id);a&&a.removeSender(i.id),this.onForwardingStopped.emit({forwarding:t}),this.onForwardingListChanged.emit()}})}_dispose(){}};W_.subtype="sfu";var Cs=W_;W();var QT=de(ee({},$_),{endpointTimeout:3e4,ackTimeout:1e4,disableRestartIce:!1});W();W();var Bg=Xn(DC());W();var ln=new De("packages/sfu-bot/src/connection/transport/transport.ts"),XT=class{constructor(e,t,n,r,i,a){this.msTransport=e,this._bot=t,this._iceManager=n,this._sfuApi=r,this._context=i,this._analyticsSession=a,this._backoffIceRestart=new Mr({times:8,interval:100,jitter:100}),this._connectionState="new",this.onProduce=new Me,this.onProduceData=new Me,this.onMediasoupConnectionStateChanged=new Me,this.onConnectionStateChanged=new Me,this.restartIce=()=>B(this,null,function*(){if(this._backoffIceRestart.exceeded){ln.error("_iceRestartedCount exceeded",we({operationName:"SfuTransport.restartIce",context:this._context,info:mt.netWorkError,path:ln.prefix})),this._setConnectionState("disconnected");return}ln.warn("[start] restartIce",fs({bot:this._bot,detail:"start restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}}));const y=()=>{if(this._bot.state==="left")return ln.debug("bot already left",this),this._setConnectionState("disconnected"),ln.warn("[end] restartIce",fs({bot:this._bot,detail:"end restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}})),!0;if(this.msTransport.connectionState==="connected")return this._backoffIceRestart.reset(),this._setConnectionState("connected"),ln.warn("[end] restartIce",fs({bot:this._bot,detail:"end restartIce",operationName:"SfuTransport.restartIce",payload:{count:this._backoffIceRestart.count,transport:this}})),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"restartIce",data:void 0,createdAt:Date.now()}),!0};if(this._setConnectionState("reconnecting"),yield this._backoffIceRestart.wait(),y())return;let f=yield this._iceManager.updateIceParams().catch(w=>w);if(f){ln.warn("updateIceParams failed",fs({operationName:"SfuTransport.restartIce",detail:"updateIceParams failed",bot:this._bot,payload:{transport:this}}),f),yield this.restartIce();return}if(yield this.msTransport.updateIceServers({iceServers:this._iceManager.iceServers}),y())return;const _=yield this._mediasoupRestartIce();if(f=yield this._waitForMsConnectionState("connected",this._context.config.rtcConfig.iceDisconnectBufferTimeout).catch(w=>w),!f&&y())return _;yield this.restartIce()}),this._waitForMsConnectionState=(y,f=1e4)=>B(this,null,function*(){y!==this.msTransport.connectionState&&(yield this.onMediasoupConnectionStateChanged.watch(()=>y===this.msTransport.connectionState,f).catch(_=>{throw we({operationName:"SfuTransport._waitForMsConnectionState",context:this._context,info:de(ee({},mt.timeout),{detail:"waitForConnectionState timeout"}),error:_,path:ln.prefix})}))}),this._onConnect=y=>(f,_,w)=>B(this,[f,_,w],function*({dtlsParameters:R},F,S){try{ln.debug("[start] transport connect",{transportId:y}),yield this._sfuApi.connect({transportId:y,dtlsParameters:R}),ln.debug("[end] transport connect",{transportId:y}),F()}catch(b){ln.error("[failed] transport connect",{error:b,transportId:y}),S(b)}});var o,u,p;const h=i.plugins.find(y=>y.subtype===ju.subtype);this._options=h.options,ln.debug("peerConfig",(p=(u=(o=this.pc)==null?void 0:o.getConfiguration)==null?void 0:u.call(o))!=null?p:{}),e.on("connect",(y,f,_)=>this._onConnect(e.id)(y,f,_)),e.on("connectionstatechange",y=>{this.onMediasoupConnectionStateChanged.emit(y),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"connectionStateChange",data:{connectionState:y},createdAt:Date.now()})}),e.on("produce",(y,f,_)=>{this.onProduce.emit({producerOptions:y,callback:f,errback:_})}),e.on("producedata",(y,f,_)=>{this.onProduceData.emit({producerOptions:y,callback:f,errback:_})}),this.onMediasoupConnectionStateChanged.add(y=>B(this,null,function*(){switch(Qe({operationName:"onMediasoupConnectionStateChanged",channel:this._bot.channel}).then(f=>{ln.debug(f,{state:y,transportId:this.id,bot:t})}).catch(()=>{}),y){case"disconnected":case"failed":{if(this._connectionState==="reconnecting")return;(yield this._waitForMsConnectionState("connected",i.config.rtcConfig.iceDisconnectBufferTimeout).catch(_=>_))&&this._connectionState!=="reconnecting"&&t.options.disableRestartIce!==!0&&(yield this.restartIce())}break;case"connecting":case"connected":this._setConnectionState(y);break;case"closed":this._setConnectionState("disconnected");break}ln.debug("onMediasoupConnectionStateChanged",this)}))}get pc(){var e,t,n;return(n=(t=(e=this.msTransport)==null?void 0:e._handler)==null?void 0:t._pc)!=null?n:{}}get id(){return this.msTransport.id}get connectionState(){return this._connectionState}toJSON(){return{id:this.id,direction:this.msTransport.direction,connectionState:this._connectionState}}close(){var e;ln.debug("close",this.id),(e=this.pc)!=null&&e.peerIdentity&&this.pc.peerIdentity.catch(()=>{}),this.msTransport.close(),this._setConnectionState("disconnected")}_setConnectionState(e){this._connectionState!==e&&(ln.debug("onConnectionStateChanged",this._connectionState,e,this),this._connectionState=e,this.onConnectionStateChanged.emit(e),this._analyticsSession&&!this._analyticsSession.isClosed()&&this._analyticsSession.client.sendRtcPeerConnectionEventReport({rtcPeerConnectionId:this.id,type:"skywayConnectionStateChange",data:{skywayConnectionState:e},createdAt:Date.now()}))}_mediasoupRestartIce(){return B(this,null,function*(){const e=yield this._sfuApi.iceRestart({transportId:this.id}).catch(t=>t);if(e instanceof Error){ln.warn("iceRestart failed",fs({operationName:"SfuTransport._mediasoupRestartIce",detail:"iceRestart failed",bot:this._bot,payload:{transport:this}}),e),yield this.restartIce();return}return yield this.msTransport.restartIce({iceParameters:e}),e})}},Kd=new De("packages/sfu-bot/src/connection/transport/transportRepository.ts"),YT=class{constructor(e,t){this._context=e,this._api=t,this.onTransportCreated=new Me,this._transports={},this.getTransport=(i,a)=>this._transports[i+a];const{browserName:n,browserVersion:r}=r_();Kd.debug("runtime info",{browserName:n,browserVersion:r}),n==="Safari"&&r==null?this._device=new Bg.Device({handlerName:"Safari12"}):this._device=new Bg.Device}get rtpCapabilities(){if(this._device.loaded)return this._device.rtpCapabilities}loadDevice(e){return B(this,null,function*(){this._device.loaded||(yield this._device.load({routerRtpCapabilities:e}).catch(t=>{throw we({operationName:"TransportRepository.loadDevice",context:this._context,info:de(ee({},mt.internal),{detail:"loadDevice failed"}),path:Kd.prefix,payload:{rtpCapabilities:e},error:t})}),Kd.debug("device loaded",{routerRtpCapabilities:e,rtpCapabilities:this._device.rtpCapabilities}))})}createTransport(e,t,n,r,i,a){const u=(r==="send"?h=>this._device.createSendTransport(h):h=>this._device.createRecvTransport(h))(de(ee({},n),{iceServers:i.iceServers,iceTransportPolicy:this._context.config.rtcConfig.turnPolicy==="turnOnly"?"relay":void 0,additionalSettings:this._context.config.rtcConfig})),p=new XT(u,t,i,this._api,this._context,a);return this._transports[e+u.id]=p,this.onTransportCreated.emit(u.id),p}deleteTransports(e){Object.entries(ee({},this._transports)).forEach(([t,n])=>{t.includes(e)&&(n.close(),delete this._transports[t])})}};W();var eR="1.14.2",us=new De("packages/sfu-bot/src/plugin.ts"),Z_=class J_ extends bf{constructor(t={}){super(),this.subtype=J_.subtype,this._createRemoteMember=(n,r)=>new Cs(de(ee({},this._context),{channel:n,id:r.id,name:r.name,metadata:r.metadata,plugin:this,api:this._api,context:this._context,transportRepository:this._transportRepository,options:this.options})),this.createBot=n=>B(this,null,function*(){var r;const i=us.info("[start] createBot",yield Qe({operationName:"SfuBotPlugin.createBot",channel:n})),a=this._context.authToken.getAppId(),o=yield this._api.createBot({appId:a,channelId:n.id}),u=(r=n._getMember(o))!=null?r:(yield n.onMemberJoined.watch(p=>p.member.id===o,this._context.config.rtcApi.timeout).catch(p=>{throw we({operationName:"SfuBotPlugin.createBot",info:de(ee({},mt.timeout),{detail:"onMemberJoined"}),path:us.prefix,error:p,context:this._context})})).member;return us.elapsed(i,"[end] createBot",yield Qe({operationName:"SfuBotPlugin.createBot",channel:n})),u}),this.deleteBot=(n,r)=>B(this,null,function*(){return new Promise((i,a)=>B(this,null,function*(){const o=us.info("[start] deleteBot",yield Qe({operationName:"SfuBotPlugin.deleteBot",channel:n}));let u=!1;this._api.deleteBot({botId:r}).catch(p=>{u=!0,a(p)}),n.onMemberLeft.watch(p=>p.member.id===r,this._context.config.rtcApi.timeout).then(()=>B(this,null,function*(){us.elapsed(o,"[end] deleteBot",yield Qe({operationName:"SfuBotPlugin.deleteBot",channel:n})),i()})).catch(p=>{u||a(we({operationName:"SfuBotPlugin.deleteBot",info:de(ee({},mt.timeout),{detail:"onMemberLeft"}),path:us.prefix,channel:n,error:p,context:this._context}))})}))}),this.options=ee(ee({},QT),t),this._onContextAttached.once(n=>{De.level=n.config.log.level,De.format=n.config.log.format,us.info("SfuBotPlugin spawned",{operationName:"SfuBotPlugin.constructor",endpoint:{sfu:this.options.domain},options:this.options,sdkName:"sfu-bot",sdkVersion:eR}),this._api=new KT(n.authTokenString,de(ee({},this.options),{log:n.config.log})),this._transportRepository=new YT(n,this._api),n._onTokenUpdated.add(r=>{this._api.updateToken(r)})}),this._whenDisposeLocalPerson=n=>B(this,null,function*(){this._transportRepository.deleteTransports(n.id)})}};Z_.subtype=Cs.subtype;var ju=Z_,tR={invalidParameter:{name:"invalidParameter",detail:"",solution:""},timeout:{name:"timeout",detail:"",solution:""},internal:{name:"internal",detail:"",solution:""},notImplemented:{name:"notImplemented",detail:"対応していないRoomTypeです",solution:"正しいRoomTypeを指定してください"},roomNotOpened:{name:"roomNotOpened",detail:"RoomがOpenされていません",solution:"Roomの状態を確かめてください"},subscribeOtherMemberType:{name:"subscribeOtherMemberType",detail:"RemoteMemberにSubscribe/Unsubscribeさせる場合、対象のMemberのTypeはPersonである必要があります",solution:"対象のRemoteMemberが正しいか確認してください"},sfuRoomNotSupportDataStream:{name:"sfuRoomNotSupportDataStream",detail:"SFURoomでDataStreamを使うことは出来ません",solution:"ありません"},publicationNotHasOrigin:{name:"publicationNotHasOrigin",detail:"SfuRoomで操作するPublicationはOriginをもつ必要があります",solution:"SfuRoomとP2PRoomを同一のIDで混在させていないか確かめてください"},notFound:{name:"notFound",detail:"参照しようとしていたものが見つかりません",solution:"参照しようとしたものが存在するか確かめてください"}},Fn=ee(ee(ee({},Ae),mt),tR);W();var Q_=class{constructor(e,t){this.member=e,this.room=t,this.onLeft=new Me;const{removeListener:n}=t.onMemberLeft.add(r=>{r.member.id===this.member.id&&(n(),this.onLeft.emit())});this.onMetadataUpdated=e.onMetadataUpdated}get id(){return this.member.id}get name(){return this.member.name}get roomId(){return this.room.id}get roomName(){return this.room.name}get roomType(){return this.room.type}get state(){return this.member.state}get metadata(){return this.member.metadata}get _member(){return this.member}get publications(){return this.room.publications.filter(e=>e.publisher.id===this.id)}get subscriptions(){return this.member.subscriptions.map(e=>this.room._getSubscription(e.id))}updateMetadata(e){return this.member.updateMetadata(e)}leave(){return this.member.leave()}toJSON(){return{id:this.id,name:this.name,metadata:this.metadata}}};W();var X_=class extends Q_{constructor(e,t){super(e,t),this.side="local",this._local=this._member,this.onStreamPublished=new Me,this.onStreamUnpublished=new Me,this.onPublicationListChanged=new Me,this.onPublicationSubscribed=new Me,this.onPublicationUnsubscribed=new Me,this.onSubscriptionListChanged=new Me,this.onFatalError=new Me,this._context=this.room._context,this._local.onPublicationSubscribed.add(n=>B(this,null,function*(){const r=t._addSubscription(n.subscription);this.onPublicationSubscribed.emit({subscription:r,stream:n.stream})})),this._local.onFatalError.pipe(this.onFatalError),this._listenRoomEvent(),this.onStreamPublished.add(()=>this.onPublicationListChanged.emit()),this.onStreamUnpublished.add(()=>this.onPublicationListChanged.emit()),this.onPublicationSubscribed.add(()=>this.onSubscriptionListChanged.emit()),this.onPublicationUnsubscribed.add(()=>this.onSubscriptionListChanged.emit())}get subscriptions(){return this.member.subscriptions.map(e=>this.room._getSubscription(e.id)).filter(e=>e.stream)}_listenRoomEvent(){this.room.onPublicationUnsubscribed.add(e=>{e.subscription.subscriber._member.id===this._local.id&&this.onPublicationUnsubscribed.emit(e)})}};W();W();function In({operationName:e,context:t,info:n,error:r,path:i,payload:a,room:o}){const u={operationName:e,payload:a};return o&&(u.appId=o._channel.appId,u.roomId=o.id,o.localRoomMember&&(u.memberId=o.localRoomMember.id)),t&&(u.info=t.info,u.plugins=t.plugins.map(p=>p.subtype)),new Kn({error:r,info:n,payload:u,path:i})}var no=new De("packages/room/src/member/local/p2p.ts"),nR=class extends X_{constructor(e,t){super(e,t)}publish(e){return B(this,arguments,function*(t,n={}){const r=yield this._local.publish(t,n),i=this.room._addPublication(r);return this.onStreamPublished.emit({publication:i}),i})}unpublish(e){return B(this,null,function*(){const t=typeof e=="string"?e:e.id;this._local.unpublish(t).catch(r=>{no.error("unpublish",r,{target:e},this.toJSON())});const{publication:n}=yield this.room.onStreamUnpublished.watch(r=>r.publication.id===t,this._context.config.rtcApi.timeout).catch(r=>{throw In({operationName:"LocalP2PRoomMemberImpl.unpublish",context:this._context,room:this.room,info:de(ee({},Fn.timeout),{detail:"onStreamUnpublished"}),path:no.prefix,error:r})});this.onStreamUnpublished.emit({publication:n})})}subscribe(e){return B(this,null,function*(){const t=typeof e=="string"?e:e.id,{subscription:n,stream:r}=yield this._local.subscribe(t);return{subscription:this.room._addSubscription(n),stream:r}})}unsubscribe(e){return B(this,null,function*(){const t=typeof e=="string"?e:e.id;this._local.unsubscribe(t).catch(n=>{no.error("unsubscribe",n,{target:e},this.toJSON())}),yield this.room.onPublicationUnsubscribed.watch(n=>n.subscription.id===t,this._context.config.rtcApi.timeout).catch(n=>{throw In({operationName:"LocalP2PRoomMemberImpl.unsubscribe",context:this._context,room:this.room,info:de(ee({},Fn.timeout),{detail:"onPublicationUnsubscribed"}),path:no.prefix,error:n})})})}_updateRoom(e){no.debug("_updateRoom",{memberId:this.id}),this.room=e,this._listenRoomEvent()}};W();W();var rR=10,Ai=new De("packages/room/src/member/local/sfu.ts"),iR=class extends X_{constructor(e,t){super(e,t)}publish(e){return B(this,arguments,function*(t,n={}){var r;if(t instanceof yf)throw In({operationName:"LocalSFURoomMemberImpl.publish",context:this._context,room:this.room,info:Fn.sfuRoomNotSupportDataStream,path:Ai.prefix});n.maxSubscribers=(r=n.maxSubscribers)!=null?r:rR;const i=yield this._local.publish(t,n),a=this.room._channel.members.find(h=>h.subtype===Cs.subtype);if(!a)throw In({operationName:"LocalSFURoomMemberImpl.publish",context:this._context,room:this.room,info:mt.sfuBotNotInChannel,path:Ai.prefix});const u=(yield a.startForwarding(i,{maxSubscribers:n.maxSubscribers})).relayingPublication,p=this.room._addPublication(u);return this.onStreamPublished.emit({publication:p}),p})}unpublish(e){return B(this,null,function*(){const t=typeof e=="string"?e:e.id,n=this.room._getPublication(t),r=n._publication.origin;if(!r)throw In({operationName:"LocalSFURoomMemberImpl.unpublish",context:this._context,room:this.room,info:Fn.publicationNotHasOrigin,path:Ai.prefix});this._local.unpublish(r.id).catch(i=>{Ai.error("unpublish error",i,{target:e},this.toJSON())}),yield this.room.onStreamUnpublished.watch(i=>i.publication.id===t,this._context.config.rtcApi.timeout).catch(i=>{throw In({operationName:"LocalSFURoomMemberImpl.unpublish",context:this._context,room:this.room,info:de(ee({},Fn.timeout),{detail:"onStreamUnpublished"}),path:Ai.prefix,error:i})}),this.onStreamUnpublished.emit({publication:n})})}subscribe(e,t){return B(this,null,function*(){const n=typeof e=="string"?e:e.id,{subscription:r,stream:i}=yield this._local.subscribe(n,t);return{subscription:this.room._addSubscription(r),stream:i}})}unsubscribe(e){return B(this,null,function*(){const t=typeof e=="string"?e:e.id;this._local.unsubscribe(t).catch(n=>{Ai.error("unsubscribe error",n,{target:e},this.toJSON())}),yield this.room.onPublicationUnsubscribed.watch(n=>n.subscription.id===t,this._context.config.rtcApi.timeout).catch(n=>{throw In({operationName:"LocalSFURoomMemberImpl.unsubscribe",context:this._context,room:this.room,info:de(ee({},Fn.timeout),{detail:"onPublicationUnsubscribed"}),path:Ai.prefix,error:n})})})}_updateRoom(e){Ai.debug("_updateRoom",{memberId:this.id}),this.room=e,this._listenRoomEvent()}};W();var Ug=new De("packages/room/src/member/remote/base.ts"),nu=class extends Q_{constructor(e,t){super(e,t),this.side="remote",this.onPublicationSubscribed=new Me,this.onPublicationUnsubscribed=new Me,this.onSubscriptionListChanged=new Me,this.onPublicationListChanged=new Me,this._disposer=new lr,this.subscribe=n=>new Promise((r,i)=>{if(!(this.member instanceof yl)){i(In({operationName:"RemoteRoomMemberImpl.subscribe",context:this.room._context,room:this.room,info:Fn.subscribeOtherMemberType,path:Ug.prefix}));return}let a=!1;this.member.subscribe(n).catch(o=>{a=!0,i(o)}),this.onPublicationSubscribed.watch(o=>o.subscription.publication.id===n).then(o=>r(o)).catch(o=>{a||i(o)})}),this.unsubscribe=n=>new Promise((r,i)=>{if(!(this.member instanceof yl)){i(In({operationName:"RemoteRoomMemberImpl.unsubscribe",context:this.room._context,room:this.room,info:Fn.subscribeOtherMemberType,path:Ug.prefix}));return}let a=!1;this.member.unsubscribe(n).catch(o=>{a=!0,i(o)}),this.onPublicationUnsubscribed.watch(o=>o.subscription.id===n).then(()=>r()).catch(o=>{a||i(o)})}),t.onPublicationSubscribed.add(n=>{n.subscription.subscriber._member.id===e.id&&(this.onPublicationSubscribed.emit(n),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),t.onPublicationUnsubscribed.add(n=>{n.subscription.subscriber._member.id===e.id&&(this.onPublicationUnsubscribed.emit(n),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),e instanceof yl&&e.onPublicationListChanged.pipe(this.onPublicationListChanged).disposer(this._disposer)}_dispose(){this._disposer.dispose()}};W();var _l="packages/room/src/publication/index.ts",Hg=new De(_l),sR=class{constructor(e,t){this._publication=e,this._room=t,this._disposer=new lr,this._events=new ai,this.onCanceled=this._events.make(),this.onSubscribed=this._events.make(),this.onUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onEnabled=this._events.make(),this.onDisabled=this._events.make(),this.onStateChanged=this._events.make(),this.onConnectionStateChanged=new Me,this.enable=()=>new Promise((r,i)=>{if(this.state==="enabled"){r();return}this._origin?Promise.all([this._origin.enable(),this._publication.onEnabled.asPromise()]).then(()=>r()).catch(i):this._publication.enable().then(r).catch(i)}),this.disable=()=>new Promise((r,i)=>{if(this.state==="disabled"){r();return}this._origin?Promise.all([this._origin.disable(),this._publication.onDisabled.asPromise()]).then(()=>r()).catch(i):this._publication.disable().then(r).catch(i)}),this.replaceStream=(r,i={})=>{this._preferredPublication.replaceStream(r,i)};var n;this.id=e.id,this.contentType=e.contentType,this._origin=e.origin;{const r=(n=this._origin)!=null?n:this._publication;this.publisher=this._room._getMember(r.publisher.id)}this._setEvents()}_setEvents(){var e;this._room.onStreamUnpublished.add(t=>{t.publication.id===this.id&&this._dispose()}),this._room.onPublicationSubscribed.add(t=>{t.subscription.publication.id===this.id&&(this.onSubscribed.emit({subscription:t.subscription}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this._room.onPublicationUnsubscribed.add(t=>{t.subscription.publication.id===this.id&&(this.onUnsubscribed.emit({subscription:t.subscription}),this.onSubscriptionListChanged.emit())}).disposer(this._disposer),this._publication.onEnabled.pipe(this.onEnabled),this._publication.onDisabled.pipe(this.onDisabled),this._publication.onStateChanged.pipe(this.onStateChanged),((e=this._origin)!=null?e:this._publication).onMetadataUpdated.pipe(this.onMetadataUpdated),this._origin?this._origin.onConnectionStateChanged.add(t=>{Hg.debug("this._origin.onConnectionStateChanged",this.id,t),this.onConnectionStateChanged.emit({state:t.state})}):this._publication.onConnectionStateChanged.add(t=>{Hg.debug("this._publication.onConnectionStateChanged",this.id,t),this.onConnectionStateChanged.emit({state:t.state,remoteMember:this._room._getMember(t.remoteMember.id)})})}get subscriptions(){return this._publication.subscriptions.map(e=>this._room._getSubscription(e.id))}get _preferredPublication(){var e;return(e=this._origin)!=null?e:this._publication}get codecCapabilities(){return this._preferredPublication.codecCapabilities}get encodings(){return this._preferredPublication.encodings}get stream(){return this._preferredPublication.stream}get state(){return this._preferredPublication.state}get metadata(){return this._preferredPublication.metadata}cancel(){return B(this,null,function*(){yield Promise.all([this._preferredPublication.cancel(),this.onCanceled.asPromise()])})}updateMetadata(e){return B(this,null,function*(){yield this._preferredPublication.updateMetadata(e)})}updateEncodings(e){this._preferredPublication.updateEncodings(e)}_dispose(){this.onCanceled.emit(),this._events.dispose(),this._disposer.dispose()}getStats(e){var t;if(this._origin){const n=(t=this._origin.subscriptions.find(r=>r.subscriber.subtype===Cs.subtype))==null?void 0:t.subscriber;if(!n)throw In({operationName:"RoomPublicationImpl.getStats",room:this._room,path:_l,info:de(ee({},Fn.notFound),{detail:"bot not found"})});return this._origin.getStats(n)}else{const n=typeof e=="string"?e:e.id;return this._publication.getStats(n)}}getRTCPeerConnection(e){var t;if(this._origin){const n=(t=this._origin.subscriptions.find(r=>r.subscriber.subtype===Cs.subtype))==null?void 0:t.subscriber;if(!n)throw In({operationName:"RoomPublicationImpl.getRTCPeerConnection",room:this._room,path:_l,info:de(ee({},Fn.notFound),{detail:"bot not found"})});return this._origin.getRTCPeerConnection(n)}else{const n=typeof e=="string"?e:e.id;return this._publication.getRTCPeerConnection(n)}}getConnectionState(e){var t;if(this._origin){const n=(t=this._origin.subscriptions.find(r=>r.subscriber.subtype===Cs.subtype))==null?void 0:t.subscriber;if(!n)throw In({operationName:"RoomPublicationImpl.getConnectionState",room:this._room,path:_l,info:de(ee({},Fn.notFound),{detail:"bot not found"})});return this._origin.getConnectionState(n)}else{const n=typeof e=="string"?e:e.id;return this._publication.getConnectionState(n)}}toJSON(){return{id:this.id,contentType:this.contentType,metadata:this.metadata,publisher:this.publisher,subscriptions:this.subscriptions,codecCapabilities:this.codecCapabilities,encodings:this.encodings,state:this.state}}};W();W();var aR="1.15.1";W();W();W();var $d=new De("packages/room/src/subscription/index.ts"),oR=class{constructor(e,t){this._subscription=e,this._room=t,this._context=this._room._context,this.onStreamAttached=new Me,this.onCanceled=new Me,this.onConnectionStateChanged=new Me,this.id=e.id,this.contentType=e.contentType,this.publication=this._room._getPublication(e.publication.id),this.subscriber=this._room._getMember(e.subscriber.id),e.onStreamAttached.pipe(this.onStreamAttached),e.onCanceled.pipe(this.onCanceled),e.onConnectionStateChanged.add(n=>{$d.debug("_subscription.onConnectionStateChanged",this.id,n),this.onConnectionStateChanged.emit(n)})}get stream(){return this._subscription.stream}get state(){return this._subscription.state}get codec(){return this._subscription.codec}get preferredEncoding(){return this._subscription.preferredEncoding}changePreferredEncoding(e){this._subscription.changePreferredEncoding(e)}cancel(){return B(this,null,function*(){this._subscription.cancel().catch(e=>{$d.error("subscription.cancel",e,this.toJSON())}),yield this._room.onPublicationUnsubscribed.watch(e=>e.subscription.id===this.id,this._context.config.rtcApi.timeout).catch(e=>{throw In({operationName:"RoomSubscriptionImpl.cancel",context:this._context,room:this._room,info:de(ee({},Fn.timeout),{detail:"onPublicationUnsubscribed"}),error:e,path:$d.prefix})})})}toJSON(){return{id:this.id,contentType:this.contentType,publication:this.publication,codec:this.codec}}getStats(){return this._subscription.getStats()}getRTCPeerConnection(){return this._subscription.getRTCPeerConnection()}getConnectionState(){return this._subscription.getConnectionState()}},Vg=new De("packages/room/src/room/base.ts"),Y_=class{constructor(e,t){this._channel=t,this._members={},this._publications={},this._subscriptions={},this._context=this._channel._context,this._events=new ai,this.onClosed=this._events.make(),this.onMetadataUpdated=this._events.make(),this.onMemberJoined=this._events.make(),this.onMemberLeft=this._events.make(),this.onMemberListChanged=this._events.make(),this.onMemberMetadataUpdated=this._events.make(),this.onStreamPublished=this._events.make(),this.onStreamUnpublished=this._events.make(),this.onPublicationListChanged=this._events.make(),this.onPublicationMetadataUpdated=this._events.make(),this.onPublicationEnabled=this._events.make(),this.onPublicationDisabled=this._events.make(),this.onPublicationSubscribed=this._events.make(),this.onPublicationUnsubscribed=this._events.make(),this.onSubscriptionListChanged=this._events.make(),this.type=e,this._channel.onClosed.pipe(this.onClosed),this._channel.onMetadataUpdated.pipe(this.onMetadataUpdated),this._channel.onMemberMetadataUpdated.add(n=>{this._handleOnMemberMetadataUpdate(n)})}_getMember(e){return this._members[e]}_getPublication(e){return this._publications[e]}_addPublication(e){const t=this._publications[e.id];if(t)return t;const n=new sR(e,this);return this._publications[e.id]=n,n}_getSubscription(e){return this._subscriptions[e]}_addSubscription(e){const t=this._subscriptions[e.id];if(t)return t;const n=new oR(e,this);return this._subscriptions[e.id]=n,n}get id(){return this._channel.id}get name(){return this._channel.name}get metadata(){return this._channel.metadata}get state(){return this._channel.state}get disposed(){return this._channel.disposed}_handleOnMemberMetadataUpdate(e){const t=this._getMember(e.member.id);this.onMemberMetadataUpdated.emit({member:t,metadata:e.metadata})}get members(){return Object.values(this._members)}get publications(){return Object.values(this._publications)}get subscriptions(){return Object.values(this._subscriptions)}joinChannel(){return B(this,arguments,function*(e={}){var t;if(this.state!=="opened")throw In({operationName:"RoomImpl.joinChannel",context:this._context,room:this,info:Fn.roomNotOpened,path:Vg.prefix});e.name=(t=e.name)!=null?t:$r();const n=yield this._channel.join(e);return this._getMember(n.id)||(yield this.onMemberJoined.watch(r=>r.member._member.id===n.id,this._context.config.rtcApi.timeout).catch(r=>{throw In({operationName:"RoomImpl.joinChannel",context:this._context,room:this,info:de(ee({},Fn.timeout),{detail:"RoomImpl onMemberJoined"}),path:Vg.prefix,error:r})})),n})}leave(e){return B(this,null,function*(){yield this._channel.leave(e._member)})}moveRoom(e){return B(this,null,function*(){return yield this._channel.moveChannel(e._local),e._updateRoom(this),e})}updateMetadata(e){return this._channel.updateMetadata(e)}close(){return B(this,null,function*(){yield this._channel.close()})}dispose(){return B(this,null,function*(){return this._channel.dispose()})}toJSON(){return{type:this.type,id:this.id,name:this.name,metadata:this.metadata,members:this.members,publications:this.publications,subscriptions:this.subscriptions}}},cR=new De("packages/room/src/room/p2p.ts"),lR=class extends Y_{constructor(e){super("p2p",e),this.setChannelState(),this.setChannelListener()}setChannelState(){this._channel.members.forEach(e=>{const t=new nu(e,this);this._members[e.id]=t}),this._channel.publications.forEach(e=>{this._addPublication(e)}),this._channel.subscriptions.forEach(e=>{this._addSubscription(e)})}setChannelListener(){this._channel.onMemberJoined.add(e=>this._handleOnMemberJoin(e.member)),this._channel.onMemberLeft.add(e=>this._handleOnMemberLeft(e.member)),this._channel.onStreamPublished.add(e=>this._handleOnStreamPublish(e.publication)),this._channel.onStreamUnpublished.add(e=>this._handleOnStreamUnpublish(e.publication)),this._channel.onPublicationMetadataUpdated.add(e=>{this._handleOnPublicationMetadataUpdate(e.publication)}),this._channel.onPublicationEnabled.add(e=>{this._handleOnPublicationEnabled(e.publication)}),this._channel.onPublicationDisabled.add(e=>{this._handleOnPublicationDisabled(e.publication)}),this._channel.onPublicationSubscribed.add(e=>this._handleOnStreamSubscribe(e.subscription)),this._channel.onPublicationUnsubscribed.add(e=>this._handleOnStreamUnsubscribe(e.subscription))}_handleOnMemberJoin(e){if(this._getMember(e.id))return;const t=new nu(e,this);this._members[e.id]=t,this.onMemberJoined.emit({member:t}),this.onMemberListChanged.emit({})}_handleOnMemberLeft(e){const t=this._getMember(e.id);delete this._members[e.id],t._dispose(),this.onMemberLeft.emit({member:t}),this.onMemberListChanged.emit({})}_handleOnStreamPublish(e){if(this._getPublication(e.id))return;const t=this._addPublication(e);this.onStreamPublished.emit({publication:t}),this.onPublicationListChanged.emit({})}_handleOnStreamUnpublish(e){const t=this._getPublication(e.id);delete this._publications[e.id],this.onStreamUnpublished.emit({publication:t}),this.onPublicationListChanged.emit({})}_handleOnPublicationMetadataUpdate(e){const t=this._getPublication(e.id);this.onPublicationMetadataUpdated.emit({publication:t,metadata:t.metadata})}_handleOnPublicationEnabled(e){const t=this._getPublication(e.id);this.onPublicationEnabled.emit({publication:t})}_handleOnPublicationDisabled(e){const t=this._getPublication(e.id);this.onPublicationDisabled.emit({publication:t})}_handleOnStreamSubscribe(e){if(this._getSubscription(e.id))return;const t=this._addSubscription(e);this.onPublicationSubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit({})}_handleOnStreamUnsubscribe(e){const t=this._getSubscription(e.id);delete this._subscriptions[e.id],this.onPublicationUnsubscribed.emit({subscription:t}),this.onSubscriptionListChanged.emit({})}join(){return B(this,arguments,function*(e={}){const t=yield this.joinChannel(e),n=new nR(t,this);return cR.debug("member joined",e),this.localRoomMember=n,n.onLeft.once(()=>{this.localRoomMember=void 0}),n})}};W();var uR=new De("packages/room/src/room/sfu.ts"),dR=class e1 extends Y_{constructor(t,n){super("sfu",t),this._plugin=n,this.setChannelState(),this.setChannelListener()}static Create(t,n){return B(this,null,function*(){const r=t.plugins.find(o=>o.subtype==="sfu");return n.members.find(o=>o.subtype===Cs.subtype)||(yield r.createBot(n)),new e1(n,r)})}setChannelState(){this._channel.members.forEach(t=>{if(t.type==="bot")return;const n=new nu(t,this);this._members[t.id]=n}),this._channel.publications.forEach(t=>{t.origin&&this._addPublication(t)}),this._channel.subscriptions.forEach(t=>{t.subscriber.type!=="bot"&&this._addSubscription(t)})}setChannelListener(){this._channel.onMemberJoined.add(t=>this._handleOnMemberJoin(t.member)),this._channel.onMemberLeft.add(t=>this._handleOnMemberLeft(t.member)),this._channel.onStreamPublished.add(t=>{this._handleOnStreamPublish(t.publication)}),this._channel.onStreamUnpublished.add(t=>this._handleOnStreamUnpublish(t.publication)),this._channel.onPublicationMetadataUpdated.add(t=>{this._handleOnPublicationMetadataUpdate(t.publication)}),this._channel.onPublicationEnabled.add(t=>{this._handleOnPublicationEnabled(t.publication)}),this._channel.onPublicationDisabled.add(t=>{this._handleOnPublicationDisabled(t.publication)}),this._channel.onPublicationSubscribed.add(t=>{this._handleOnStreamSubscribe(t.subscription)}),this._channel.onPublicationUnsubscribed.add(t=>this._handleOnStreamUnsubscribe(t.subscription))}_handleOnMemberJoin(t){if(t.type==="bot")return;const n=new nu(t,this);this._members[t.id]=n,this.onMemberJoined.emit({member:n}),this.onMemberListChanged.emit({})}_handleOnMemberLeft(t){const n=this._getMember(t.id);n&&(delete this._members[t.id],n._dispose(),this.onMemberLeft.emit({member:n}),this.onMemberListChanged.emit({}))}_handleOnStreamPublish(t){var n;if(!((n=t.origin)!=null&&n.id))return;const r=this._addPublication(t);this.onStreamPublished.emit({publication:r}),this.onPublicationListChanged.emit({})}_handleOnStreamUnpublish(t){var n;if(!((n=t.origin)!=null&&n.id))return;const r=this._getPublication(t.id);delete this._publications[t.id],this.onStreamUnpublished.emit({publication:r}),this.onPublicationListChanged.emit({})}_getRelayedPublication(t){return this.publications.find(r=>{var i;return((i=r._publication.origin)==null?void 0:i.id)===t})}_handleOnPublicationMetadataUpdate(t){const n=this._getRelayedPublication(t.id);n&&this.onPublicationMetadataUpdated.emit({publication:n,metadata:n.metadata})}_handleOnPublicationEnabled(t){const n=this._getRelayedPublication(t.id);n&&this.onPublicationEnabled.emit({publication:n})}_handleOnPublicationDisabled(t){const n=this._getRelayedPublication(t.id);n&&this.onPublicationDisabled.emit({publication:n})}_handleOnStreamSubscribe(t){if(t.subscriber.type==="bot")return;const n=this._addSubscription(t);this.onPublicationSubscribed.emit({subscription:n}),this.onSubscriptionListChanged.emit({})}_handleOnStreamUnsubscribe(t){if(t.subscriber.type==="bot")return;const n=this._getSubscription(t.id);delete this._subscriptions[t.id],this.onPublicationUnsubscribed.emit({subscription:n}),this.onSubscriptionListChanged.emit({})}join(){return B(this,arguments,function*(t={}){const n=yield this.joinChannel(de(ee({},t),{disableSignaling:!0})),r=new iR(n,this);return this.localRoomMember=r,r.onLeft.once(()=>{this.localRoomMember=void 0}),uR.debug("member joined",t),r})}},t1=new De("packages/room/src/room/index.ts"),Yi=class{constructor(){}};Yi.Create=(e,t)=>B(null,null,function*(){var n,r;t1.info("room created",{operationName:"SkyWayRoom._Factory",sdkName:"room",sdkVersion:aR,init:t});const i=new ju((n=t==null?void 0:t.options)==null?void 0:n.sfu);e.registerPlugin(i);const a=yield _f.Create(e,{name:(r=t.name)!=null?r:$r(),metadata:t.metadata});return yield Yi._Factory(e,t.type,a)});Yi.Find=(e,t,n,r)=>B(null,null,function*(){const i=new ju(r==null?void 0:r.sfu);e.registerPlugin(i);const a=yield _f.Find(e,t);return yield Yi._Factory(e,n,a)});Yi.FindOrCreate=(e,t)=>B(null,null,function*(){var n;const r=new ju((n=t==null?void 0:t.options)==null?void 0:n.sfu);e.registerPlugin(r);const i=yield _f.FindOrCreate(e,ee({},t));return yield Yi._Factory(e,t.type,i)});Yi._Factory=(e,t,n)=>B(null,null,function*(){switch(t){case"p2p":return new lR(n);case"sfu":return yield dR.Create(e,n);default:throw we({operationName:"SkyWayRoom._Factory",context:e,channel:n,info:Fn.notImplemented,path:t1.prefix})}});var hR=Yi;W();/*! Bundled license information:

jsrsasign/lib/jsrsasign.js:
  (*! CryptoJS v3.1.2 core-fix.js
   * code.google.com/p/crypto-js
   * (c) 2009-2013 by Jeff Mott. All rights reserved.
   * code.google.com/p/crypto-js/wiki/License
   * THIS IS FIX of 'core.js' to fix Hmac issue.
   * https://code.google.com/p/crypto-js/issues/detail?id=84
   * https://crypto-js.googlecode.com/svn-history/r667/branches/3.x/src/core.js
   *)
  (*! (c) Tom Wu | http://www-cs-students.stanford.edu/~tjw/jsbn/
   *)
  (*! (c) Tom Wu, Kenji Urushima | http://www-cs-students.stanford.edu/~tjw/jsbn/
   *)
  (*! (c) Stefan Thomas | https://github.com/bitcoinjs/bitcoinjs-lib
   *)
  (*! Mike Samuel (c) 2009 | code.google.com/p/json-sans-eval
   *)
*/const pR="78d4247e-9c81-45c4-a3ad-cad69d3fa502",fR="q30eIW0sHi102yMNovcPpJm31EX/AbcjpsZnjHbOmoI=",mR=new Xo({jti:Da(),iat:Sg(),exp:Sg()+60*60*24,version:3,scope:{appId:pR,rooms:[{name:"*",methods:["create","close","updateMetadata"],member:{name:"*",methods:["publish","subscribe","updateMetadata"]},sfu:{enabled:!0}}],turn:{enabled:!0}}}),gR=mR.encode(fR),vR={log:{level:"debug"}},yR={};var n1={exports:{}},Bu={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _R=bs,bR=Symbol.for("react.element"),SR=Symbol.for("react.fragment"),wR=Object.prototype.hasOwnProperty,xR=_R.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,CR={key:!0,ref:!0,__self:!0,__source:!0};function r1(e,t,n){var r,i={},a=null,o=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)wR.call(t,r)&&!CR.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)i[r]===void 0&&(i[r]=t[r]);return{$$typeof:bR,type:e,key:a,ref:o,props:i,_owner:xR.current}}Bu.Fragment=SR;Bu.jsx=r1;Bu.jsxs=r1;n1.exports=Bu;var i1=n1.exports;const ji=i1.jsx,ER=i1.jsxs,PR=()=>{const[e,t]=bs.useState(""),n=bs.useRef(null),[r,i]=bs.useState([]);return ER("div",{children:[ji("input",{onChange:o=>t(o.target.value),value:e}),ji("button",{onClick:async()=>{const o=await sp.Create(gR,vR),u=await hR.FindOrCreate(o,{name:e,type:"sfu",options:yR}),p=await u.join(),{audio:h,video:y}=await qT.createMicrophoneAudioAndCameraStream({video:{height:640,width:360,frameRate:15}});await p.publish(h,{maxSubscribers:50}),await p.publish(y,{maxSubscribers:50,encodings:[{scaleResolutionDownBy:4,id:"low",maxBitrate:8e4},{scaleResolutionDownBy:1,id:"high",maxBitrate:4e5}]}),p.onPublicationSubscribed.add(_=>{if(_.stream.contentType==="audio"){const w=n.current,R=document.createElement("audio");R.srcObject=new MediaStream([_.stream.track]),R.play(),w.appendChild(R),_.subscription.onCanceled.once(()=>{w.removeChild(R)})}}),p.onSubscriptionListChanged.add(()=>{i(p.subscriptions.filter(_=>_.contentType==="video"))});const f=async _=>{_.publisher.id!==p.id&&(_.contentType==="video"?await p.subscribe(_,{preferredEncodingId:"low"}):await p.subscribe(_))};u.onStreamPublished.add(async _=>{await f(_.publication)}),await Promise.all(u.publications.map(f))},children:"join"}),ji("div",{style:{display:"flex",flexWrap:"wrap"},children:r.map(o=>ji(kR,{subscription:o},o.id))}),ji("div",{ref:n})]})},kR=({subscription:e})=>{const t=bs.useRef(null);return bs.useEffect(()=>{t.current.srcObject=new MediaStream([e.stream.track])},[t.current]),ji("div",{children:ji("video",{muted:!0,autoPlay:!0,playsInline:!0,ref:t,onClick:async()=>{e.preferredEncoding==="high"?e.changePreferredEncoding("low"):e.preferredEncoding==="low"&&e.changePreferredEncoding("high")}})})},TR=Y0(document.getElementById("root"));TR.render(ji(PR,{}));
